{"version":3,"file":"Markup/Markup.min.js","mappings":"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","sources":["webpack://Autodesk.Extensions/./Markup/core/Markups.css","webpack://Autodesk.Extensions/./Markup/gui/MarkupsGui.css","webpack://Autodesk.Extensions/./node_modules/css-loader/dist/runtime/api.js","webpack://Autodesk.Extensions/./node_modules/css-loader/dist/runtime/sourceMaps.js","webpack://Autodesk.Extensions/./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js","webpack://Autodesk.Extensions/./node_modules/style-loader/dist/runtime/insertBySelector.js","webpack://Autodesk.Extensions/./node_modules/style-loader/dist/runtime/insertStyleElement.js","webpack://Autodesk.Extensions/./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js","webpack://Autodesk.Extensions/./node_modules/style-loader/dist/runtime/styleDomAPI.js","webpack://Autodesk.Extensions/./node_modules/style-loader/dist/runtime/styleTagTransform.js","webpack://Autodesk.Extensions/./thirdparty/canvg/canvg.js","webpack://Autodesk.Extensions/./thirdparty/canvg/rgbcolor.js","webpack://Autodesk.Extensions/./thirdparty/resize-observer-polyfill/ResizeObserver.min.js","webpack://Autodesk.Extensions/webpack/bootstrap","webpack://Autodesk.Extensions/webpack/runtime/compat get default export","webpack://Autodesk.Extensions/webpack/runtime/define property getters","webpack://Autodesk.Extensions/webpack/runtime/hasOwnProperty shorthand","webpack://Autodesk.Extensions/webpack/runtime/make namespace object","webpack://Autodesk.Extensions/webpack/runtime/nonce","webpack://Autodesk.Extensions/./Markup/core/MarkupTypes.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/EditAction.js","webpack://Autodesk.Extensions/./Markup/core/StyleUtils.js","webpack://Autodesk.Extensions/./Markup/core/MarkupEvents.js","webpack://Autodesk.Extensions/./Markup/core/Markup.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/SetStyle.js","webpack://Autodesk.Extensions/./Markup/core/edit-modes/EditMode.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/DeleteArrow.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/SetArrow.js","webpack://Autodesk.Extensions/./Markup/core/edit-modes/EditModeArrow.js","webpack://Autodesk.Extensions/./Markup/core/MarkupArrow.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/CreateArrow.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/DeleteRectangle.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/SetRectangle.js","webpack://Autodesk.Extensions/./Markup/core/edit-modes/EditModeRectangle.js","webpack://Autodesk.Extensions/./Markup/core/MarkupRectangle.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/CreateRectangle.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/DeleteText.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/SetCallout.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/SetSize.js","webpack://Autodesk.Extensions/./Markup/core/edit-modes/EditorTextAutosize.js","webpack://Autodesk.Extensions/./Markup/core/DomElementStyle.js","webpack://Autodesk.Extensions/./Markup/core/edit-modes/EditorTextInput.js","webpack://Autodesk.Extensions/./Markup/core/edit-modes/EditModeCallout.js","webpack://Autodesk.Extensions/./Markup/core/MarkupCallout.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/CreateCallout.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/DeleteCallout.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/SetText.js","webpack://Autodesk.Extensions/./Markup/core/edit-modes/EditModeText.js","webpack://Autodesk.Extensions/./Markup/core/MarkupText.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/CreateText.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/DeleteCircle.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/SetCircle.js","webpack://Autodesk.Extensions/./Markup/core/edit-modes/EditModeCircle.js","webpack://Autodesk.Extensions/./Markup/core/MarkupCircle.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/CreateCircle.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/DeleteCloud.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/SetCloud.js","webpack://Autodesk.Extensions/./Markup/core/edit-modes/EditModeCloud.js","webpack://Autodesk.Extensions/./Markup/core/MarkupCloud.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/CreateCloud.js","webpack://Autodesk.Extensions/./Markup/core/MarkupPen.js","webpack://Autodesk.Extensions/./Markup/core/edit-modes/EditModePen.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/DeleteFreehand.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/SetFreehand.js","webpack://Autodesk.Extensions/./Markup/core/edit-modes/EditModeFreehand.js","webpack://Autodesk.Extensions/./Markup/core/MarkupFreehand.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/CreateFreehand.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/DeletePolyline.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/SetPolyline.js","webpack://Autodesk.Extensions/./Markup/core/edit-modes/EditModePolyline.js","webpack://Autodesk.Extensions/./Markup/core/MarkupPolyLine.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/CreatePolyline.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/DeletePolycloud.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/SetPolycloud.js","webpack://Autodesk.Extensions/./Markup/core/edit-modes/EditModePolycloud.js","webpack://Autodesk.Extensions/./Markup/core/MarkupPolycloud.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/CreatePolycloud.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/DeleteHighlight.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/SetHighlight.js","webpack://Autodesk.Extensions/./Markup/core/edit-modes/EditModeHighlight.js","webpack://Autodesk.Extensions/./Markup/core/MarkupHighlight.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/CreateHighlight.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/DeleteDimension.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/SetDimension.js","webpack://Autodesk.Extensions/./Markup/core/edit-modes/EditModeDimension.js","webpack://Autodesk.Extensions/./Markup/core/MarkupDimension.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/CreateDimension.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/DeleteStamp.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/SetStamp.js","webpack://Autodesk.Extensions/./Markup/core/edit-modes/EditModeStamp.js","webpack://Autodesk.Extensions/./Markup/core/MarkupStamp.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/CreateStamp.js","webpack://Autodesk.Extensions/./Markup/core/MarkupsCoreUtils.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/EditActionGroup.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/EditActionManager.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/CloneMarkup.js","webpack://Autodesk.Extensions/./Markup/core/edit-clipboard/Clipboard.js","webpack://Autodesk.Extensions/./Markup/core/edit-input/InputHandler.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/SetPosition.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/SetRotation.js","webpack://Autodesk.Extensions/./Markup/core/EditFrame.js","webpack://Autodesk.Extensions/./Markup/core/MarkupTool.js","webpack://Autodesk.Extensions/./Markup/core/EditModeManager.js","webpack://Autodesk.Extensions/./Markup/core/edit-modes/BuiltinEditModes.js","webpack://Autodesk.Extensions/./Markup/core/Markups.css?ced7","webpack://Autodesk.Extensions/./Markup/core/MarkupsCore.js","webpack://Autodesk.Extensions/./Markup/gui/MarkupsGui.css?2da1","webpack://Autodesk.Extensions/./Markup/gui/MarkupsGui.js","webpack://Autodesk.Extensions/./Markup/Markup.js"],"sourcesContent":["// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".adsk-viewing-viewer .autodesk-markups-extension-core-make-me-bigger:after {\\r\\n\\tcontent: \\\"\\\"; \\r\\n\\tposition: absolute; \\r\\n\\ttop: -15px; \\r\\n\\tbottom: -15px; \\r\\n\\tleft: -15px; \\r\\n\\tright: -15px;\\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .autodesk-markups-extension-core-make-me-bigger.rotation-bridge:after {\\r\\n\\ttop: 0; \\r\\n\\tbottom: 0px; \\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .selector-box {\\r\\n\\tposition: absolute;\\r\\n    border: 1px dashed #0696D7;\\r\\n    background: rgba(6, 150, 215, 0.05);\\r\\n    z-index: 1;\\r\\n    cursor: move;\\r\\n    box-sizing: border-box;\\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .selector-drag-point,\\r\\n.adsk-viewing-viewer .selector-rotate-point {\\r\\n\\tposition: absolute;\\r\\n\\theight: 8px;\\r\\n\\twidth: 8px;\\r\\n\\tborder-radius: 8px;\\t\\t\\t\\t\\t/*HANDLE_SIZE*/\\r\\n    background: #FFFFFF;\\t\\t\\t\\t/*HANDLE_BACKGROUND_COLOR*/\\r\\n    border-color: rgba(107,120,127,0.7); /* HANDLE_BORDER_COLOR; */\\r\\n    border-width: 1px; \\t\\t\\t\\t\\t/* BORDER_WIDTH */\\r\\n    border-style: solid;\\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .selector-rotate-point {\\r\\n\\ttop: calc(100% + 22px); /* 30 - 8 = 22 */\\r\\n\\tleft: calc(50% + 1px);\\r\\n\\ttransform: translate3d(-50%, 0px, 0px);\\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .selector-drag-point.selected,\\r\\n.adsk-viewing-viewer .selector-rotate-point.selected:not(.rotation-bridge) {\\r\\n\\tbackground: #0696D7;\\r\\n\\tborder-color: #0696D7;\\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .rotation-bridge {\\r\\n\\tposition: absolute;\\r\\n\\tbackground-color: rgba(0,0,0,0);\\r\\n\\theight: 30px;\\r\\n\\twidth: 0px;\\r\\n\\ttop: 100%;\\r\\n\\tleft: calc(50% + 1px);\\r\\n\\tborder: unset;\\r\\n    border-left: 1px dashed #0696D7;\\r\\n}\\r\\n/*var placementOffset = -6;*/\\r\\n.adsk-viewing-viewer .selector-drag-point.sdp-handle-n {\\r\\n\\ttop: -6px;\\r\\n\\tleft: calc(50% - 4px);\\r\\n\\tposition: relative;\\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .selector-drag-point.sdp-handle-s {\\r\\n\\ttop: calc(100% - 14px);\\r\\n    left: calc(50% - 4px);\\r\\n    position: relative;\\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .selector-drag-point.sdp-handle-w {\\r\\n\\tleft: -6px;\\r\\n\\ttop: 50%;\\r\\n\\ttransform: translate3d(0, -50%, 0);\\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .selector-drag-point.sdp-handle-e {\\r\\n\\tright: -6px;\\r\\n\\ttop: 50%;\\r\\n    transform: translate3d(0, -50%, 0);\\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .selector-drag-point.sdp-handle-nw {\\r\\n\\ttop: -6px;\\r\\n\\tleft: -6px;\\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .selector-drag-point.sdp-handle-ne {\\r\\n\\ttop: -6px;\\r\\n\\tright: -6px;\\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .selector-drag-point.sdp-handle-sw {\\r\\n\\tbottom: -6px;\\r\\n\\tleft: -6px;\\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .selector-drag-point.sdp-handle-se {\\r\\n\\tbottom: -6px;\\r\\n\\tright: -6px;\\r\\n}\", \"\",{\"version\":3,\"sources\":[\"webpack://./Markup/core/Markups.css\"],\"names\":[],\"mappings\":\"AAAA;CACC,WAAW;CACX,kBAAkB;CAClB,UAAU;CACV,aAAa;CACb,WAAW;CACX,YAAY;AACb;;AAEA;CACC,MAAM;CACN,WAAW;AACZ;;AAEA;CACC,kBAAkB;IACf,0BAA0B;IAC1B,mCAAmC;IACnC,UAAU;IACV,YAAY;IACZ,sBAAsB;AAC1B;;AAEA;;CAEC,kBAAkB;CAClB,WAAW;CACX,UAAU;CACV,kBAAkB,MAAM,cAAc;IACnC,mBAAmB,KAAK,0BAA0B;IAClD,mCAAmC,EAAE,yBAAyB;IAC9D,iBAAiB,OAAO,iBAAiB;IACzC,mBAAmB;AACvB;;AAEA;CACC,sBAAsB,EAAE,gBAAgB;CACxC,qBAAqB;CACrB,sCAAsC;AACvC;;AAEA;;CAEC,mBAAmB;CACnB,qBAAqB;AACtB;;AAEA;CACC,kBAAkB;CAClB,+BAA+B;CAC/B,YAAY;CACZ,UAAU;CACV,SAAS;CACT,qBAAqB;CACrB,aAAa;IACV,+BAA+B;AACnC;AACA,4BAA4B;AAC5B;CACC,SAAS;CACT,qBAAqB;CACrB,kBAAkB;AACnB;;AAEA;CACC,sBAAsB;IACnB,qBAAqB;IACrB,kBAAkB;AACtB;;AAEA;CACC,UAAU;CACV,QAAQ;CACR,kCAAkC;AACnC;;AAEA;CACC,WAAW;CACX,QAAQ;IACL,kCAAkC;AACtC;;AAEA;CACC,SAAS;CACT,UAAU;AACX;;AAEA;CACC,SAAS;CACT,WAAW;AACZ;;AAEA;CACC,YAAY;CACZ,UAAU;AACX;;AAEA;CACC,YAAY;CACZ,WAAW;AACZ\",\"sourcesContent\":[\".adsk-viewing-viewer .autodesk-markups-extension-core-make-me-bigger:after {\\r\\n\\tcontent: \\\"\\\"; \\r\\n\\tposition: absolute; \\r\\n\\ttop: -15px; \\r\\n\\tbottom: -15px; \\r\\n\\tleft: -15px; \\r\\n\\tright: -15px;\\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .autodesk-markups-extension-core-make-me-bigger.rotation-bridge:after {\\r\\n\\ttop: 0; \\r\\n\\tbottom: 0px; \\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .selector-box {\\r\\n\\tposition: absolute;\\r\\n    border: 1px dashed #0696D7;\\r\\n    background: rgba(6, 150, 215, 0.05);\\r\\n    z-index: 1;\\r\\n    cursor: move;\\r\\n    box-sizing: border-box;\\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .selector-drag-point,\\r\\n.adsk-viewing-viewer .selector-rotate-point {\\r\\n\\tposition: absolute;\\r\\n\\theight: 8px;\\r\\n\\twidth: 8px;\\r\\n\\tborder-radius: 8px;\\t\\t\\t\\t\\t/*HANDLE_SIZE*/\\r\\n    background: #FFFFFF;\\t\\t\\t\\t/*HANDLE_BACKGROUND_COLOR*/\\r\\n    border-color: rgba(107,120,127,0.7); /* HANDLE_BORDER_COLOR; */\\r\\n    border-width: 1px; \\t\\t\\t\\t\\t/* BORDER_WIDTH */\\r\\n    border-style: solid;\\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .selector-rotate-point {\\r\\n\\ttop: calc(100% + 22px); /* 30 - 8 = 22 */\\r\\n\\tleft: calc(50% + 1px);\\r\\n\\ttransform: translate3d(-50%, 0px, 0px);\\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .selector-drag-point.selected,\\r\\n.adsk-viewing-viewer .selector-rotate-point.selected:not(.rotation-bridge) {\\r\\n\\tbackground: #0696D7;\\r\\n\\tborder-color: #0696D7;\\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .rotation-bridge {\\r\\n\\tposition: absolute;\\r\\n\\tbackground-color: rgba(0,0,0,0);\\r\\n\\theight: 30px;\\r\\n\\twidth: 0px;\\r\\n\\ttop: 100%;\\r\\n\\tleft: calc(50% + 1px);\\r\\n\\tborder: unset;\\r\\n    border-left: 1px dashed #0696D7;\\r\\n}\\r\\n/*var placementOffset = -6;*/\\r\\n.adsk-viewing-viewer .selector-drag-point.sdp-handle-n {\\r\\n\\ttop: -6px;\\r\\n\\tleft: calc(50% - 4px);\\r\\n\\tposition: relative;\\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .selector-drag-point.sdp-handle-s {\\r\\n\\ttop: calc(100% - 14px);\\r\\n    left: calc(50% - 4px);\\r\\n    position: relative;\\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .selector-drag-point.sdp-handle-w {\\r\\n\\tleft: -6px;\\r\\n\\ttop: 50%;\\r\\n\\ttransform: translate3d(0, -50%, 0);\\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .selector-drag-point.sdp-handle-e {\\r\\n\\tright: -6px;\\r\\n\\ttop: 50%;\\r\\n    transform: translate3d(0, -50%, 0);\\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .selector-drag-point.sdp-handle-nw {\\r\\n\\ttop: -6px;\\r\\n\\tleft: -6px;\\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .selector-drag-point.sdp-handle-ne {\\r\\n\\ttop: -6px;\\r\\n\\tright: -6px;\\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .selector-drag-point.sdp-handle-sw {\\r\\n\\tbottom: -6px;\\r\\n\\tleft: -6px;\\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .selector-drag-point.sdp-handle-se {\\r\\n\\tbottom: -6px;\\r\\n\\tright: -6px;\\r\\n}\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \"\\r\\n.adsk-icon-markup:before {\\r\\n  content: \\\"a\\\";\\r\\n}\\r\\n\\r\\n.lmv-markup-gui-toolbar {\\r\\n  position: absolute;\\r\\n  top: 0;\\r\\n  margin: 5px 5px;\\r\\n  color: #000000;\\r\\n}\\r\\n\\r\\n.lmv-markup-gui-toolbar-content > * {\\r\\n  margin: 0 2px;\\r\\n}\\r\\n\\r\\n.lmv-markup-gui-style-options {\\r\\n  display: inline-block;\\r\\n}\", \"\",{\"version\":3,\"sources\":[\"webpack://./Markup/gui/MarkupsGui.css\"],\"names\":[],\"mappings\":\";AACA;EACE,YAAY;AACd;;AAEA;EACE,kBAAkB;EAClB,MAAM;EACN,eAAe;EACf,cAAc;AAChB;;AAEA;EACE,aAAa;AACf;;AAEA;EACE,qBAAqB;AACvB\",\"sourcesContent\":[\"\\r\\n.adsk-icon-markup:before {\\r\\n  content: \\\"a\\\";\\r\\n}\\r\\n\\r\\n.lmv-markup-gui-toolbar {\\r\\n  position: absolute;\\r\\n  top: 0;\\r\\n  margin: 5px 5px;\\r\\n  color: #000000;\\r\\n}\\r\\n\\r\\n.lmv-markup-gui-toolbar-content > * {\\r\\n  margin: 0 2px;\\r\\n}\\r\\n\\r\\n.lmv-markup-gui-style-options {\\r\\n  display: inline-block;\\r\\n}\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","\"use strict\";\n\n/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n*/\nmodule.exports = function (cssWithMappingToString) {\n  var list = []; // return the list of modules as css string\n\n  list.toString = function toString() {\n    return this.map(function (item) {\n      var content = \"\";\n      var needLayer = typeof item[5] !== \"undefined\";\n\n      if (item[4]) {\n        content += \"@supports (\".concat(item[4], \") {\");\n      }\n\n      if (item[2]) {\n        content += \"@media \".concat(item[2], \" {\");\n      }\n\n      if (needLayer) {\n        content += \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\");\n      }\n\n      content += cssWithMappingToString(item);\n\n      if (needLayer) {\n        content += \"}\";\n      }\n\n      if (item[2]) {\n        content += \"}\";\n      }\n\n      if (item[4]) {\n        content += \"}\";\n      }\n\n      return content;\n    }).join(\"\");\n  }; // import a list of modules into the list\n\n\n  list.i = function i(modules, media, dedupe, supports, layer) {\n    if (typeof modules === \"string\") {\n      modules = [[null, modules, undefined]];\n    }\n\n    var alreadyImportedModules = {};\n\n    if (dedupe) {\n      for (var k = 0; k < this.length; k++) {\n        var id = this[k][0];\n\n        if (id != null) {\n          alreadyImportedModules[id] = true;\n        }\n      }\n    }\n\n    for (var _k = 0; _k < modules.length; _k++) {\n      var item = [].concat(modules[_k]);\n\n      if (dedupe && alreadyImportedModules[item[0]]) {\n        continue;\n      }\n\n      if (typeof layer !== \"undefined\") {\n        if (typeof item[5] === \"undefined\") {\n          item[5] = layer;\n        } else {\n          item[1] = \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\").concat(item[1], \"}\");\n          item[5] = layer;\n        }\n      }\n\n      if (media) {\n        if (!item[2]) {\n          item[2] = media;\n        } else {\n          item[1] = \"@media \".concat(item[2], \" {\").concat(item[1], \"}\");\n          item[2] = media;\n        }\n      }\n\n      if (supports) {\n        if (!item[4]) {\n          item[4] = \"\".concat(supports);\n        } else {\n          item[1] = \"@supports (\".concat(item[4], \") {\").concat(item[1], \"}\");\n          item[4] = supports;\n        }\n      }\n\n      list.push(item);\n    }\n  };\n\n  return list;\n};","\"use strict\";\n\nmodule.exports = function (item) {\n  var content = item[1];\n  var cssMapping = item[3];\n\n  if (!cssMapping) {\n    return content;\n  }\n\n  if (typeof btoa === \"function\") {\n    var base64 = btoa(unescape(encodeURIComponent(JSON.stringify(cssMapping))));\n    var data = \"sourceMappingURL=data:application/json;charset=utf-8;base64,\".concat(base64);\n    var sourceMapping = \"/*# \".concat(data, \" */\");\n    var sourceURLs = cssMapping.sources.map(function (source) {\n      return \"/*# sourceURL=\".concat(cssMapping.sourceRoot || \"\").concat(source, \" */\");\n    });\n    return [content].concat(sourceURLs).concat([sourceMapping]).join(\"\\n\");\n  }\n\n  return [content].join(\"\\n\");\n};","\"use strict\";\n\nvar stylesInDOM = [];\n\nfunction getIndexByIdentifier(identifier) {\n  var result = -1;\n\n  for (var i = 0; i < stylesInDOM.length; i++) {\n    if (stylesInDOM[i].identifier === identifier) {\n      result = i;\n      break;\n    }\n  }\n\n  return result;\n}\n\nfunction modulesToDom(list, options) {\n  var idCountMap = {};\n  var identifiers = [];\n\n  for (var i = 0; i < list.length; i++) {\n    var item = list[i];\n    var id = options.base ? item[0] + options.base : item[0];\n    var count = idCountMap[id] || 0;\n    var identifier = \"\".concat(id, \" \").concat(count);\n    idCountMap[id] = count + 1;\n    var indexByIdentifier = getIndexByIdentifier(identifier);\n    var obj = {\n      css: item[1],\n      media: item[2],\n      sourceMap: item[3],\n      supports: item[4],\n      layer: item[5]\n    };\n\n    if (indexByIdentifier !== -1) {\n      stylesInDOM[indexByIdentifier].references++;\n      stylesInDOM[indexByIdentifier].updater(obj);\n    } else {\n      var updater = addElementStyle(obj, options);\n      options.byIndex = i;\n      stylesInDOM.splice(i, 0, {\n        identifier: identifier,\n        updater: updater,\n        references: 1\n      });\n    }\n\n    identifiers.push(identifier);\n  }\n\n  return identifiers;\n}\n\nfunction addElementStyle(obj, options) {\n  var api = options.domAPI(options);\n  api.update(obj);\n\n  var updater = function updater(newObj) {\n    if (newObj) {\n      if (newObj.css === obj.css && newObj.media === obj.media && newObj.sourceMap === obj.sourceMap && newObj.supports === obj.supports && newObj.layer === obj.layer) {\n        return;\n      }\n\n      api.update(obj = newObj);\n    } else {\n      api.remove();\n    }\n  };\n\n  return updater;\n}\n\nmodule.exports = function (list, options) {\n  options = options || {};\n  list = list || [];\n  var lastIdentifiers = modulesToDom(list, options);\n  return function update(newList) {\n    newList = newList || [];\n\n    for (var i = 0; i < lastIdentifiers.length; i++) {\n      var identifier = lastIdentifiers[i];\n      var index = getIndexByIdentifier(identifier);\n      stylesInDOM[index].references--;\n    }\n\n    var newLastIdentifiers = modulesToDom(newList, options);\n\n    for (var _i = 0; _i < lastIdentifiers.length; _i++) {\n      var _identifier = lastIdentifiers[_i];\n\n      var _index = getIndexByIdentifier(_identifier);\n\n      if (stylesInDOM[_index].references === 0) {\n        stylesInDOM[_index].updater();\n\n        stylesInDOM.splice(_index, 1);\n      }\n    }\n\n    lastIdentifiers = newLastIdentifiers;\n  };\n};","\"use strict\";\n\nvar memo = {};\n/* istanbul ignore next  */\n\nfunction getTarget(target) {\n  if (typeof memo[target] === \"undefined\") {\n    var styleTarget = document.querySelector(target); // Special case to return head of iframe instead of iframe itself\n\n    if (window.HTMLIFrameElement && styleTarget instanceof window.HTMLIFrameElement) {\n      try {\n        // This will throw an exception if access to iframe is blocked\n        // due to cross-origin restrictions\n        styleTarget = styleTarget.contentDocument.head;\n      } catch (e) {\n        // istanbul ignore next\n        styleTarget = null;\n      }\n    }\n\n    memo[target] = styleTarget;\n  }\n\n  return memo[target];\n}\n/* istanbul ignore next  */\n\n\nfunction insertBySelector(insert, style) {\n  var target = getTarget(insert);\n\n  if (!target) {\n    throw new Error(\"Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.\");\n  }\n\n  target.appendChild(style);\n}\n\nmodule.exports = insertBySelector;","\"use strict\";\n\n/* istanbul ignore next  */\nfunction insertStyleElement(options) {\n  var element = document.createElement(\"style\");\n  options.setAttributes(element, options.attributes);\n  options.insert(element, options.options);\n  return element;\n}\n\nmodule.exports = insertStyleElement;","\"use strict\";\n\n/* istanbul ignore next  */\nfunction setAttributesWithoutAttributes(styleElement) {\n  var nonce = typeof __webpack_nonce__ !== \"undefined\" ? __webpack_nonce__ : null;\n\n  if (nonce) {\n    styleElement.setAttribute(\"nonce\", nonce);\n  }\n}\n\nmodule.exports = setAttributesWithoutAttributes;","\"use strict\";\n\n/* istanbul ignore next  */\nfunction apply(styleElement, options, obj) {\n  var css = \"\";\n\n  if (obj.supports) {\n    css += \"@supports (\".concat(obj.supports, \") {\");\n  }\n\n  if (obj.media) {\n    css += \"@media \".concat(obj.media, \" {\");\n  }\n\n  var needLayer = typeof obj.layer !== \"undefined\";\n\n  if (needLayer) {\n    css += \"@layer\".concat(obj.layer.length > 0 ? \" \".concat(obj.layer) : \"\", \" {\");\n  }\n\n  css += obj.css;\n\n  if (needLayer) {\n    css += \"}\";\n  }\n\n  if (obj.media) {\n    css += \"}\";\n  }\n\n  if (obj.supports) {\n    css += \"}\";\n  }\n\n  var sourceMap = obj.sourceMap;\n\n  if (sourceMap && typeof btoa !== \"undefined\") {\n    css += \"\\n/*# sourceMappingURL=data:application/json;base64,\".concat(btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap)))), \" */\");\n  } // For old IE\n\n  /* istanbul ignore if  */\n\n\n  options.styleTagTransform(css, styleElement, options.options);\n}\n\nfunction removeStyleElement(styleElement) {\n  // istanbul ignore if\n  if (styleElement.parentNode === null) {\n    return false;\n  }\n\n  styleElement.parentNode.removeChild(styleElement);\n}\n/* istanbul ignore next  */\n\n\nfunction domAPI(options) {\n  var styleElement = options.insertStyleElement(options);\n  return {\n    update: function update(obj) {\n      apply(styleElement, options, obj);\n    },\n    remove: function remove() {\n      removeStyleElement(styleElement);\n    }\n  };\n}\n\nmodule.exports = domAPI;","\"use strict\";\n\n/* istanbul ignore next  */\nfunction styleTagTransform(css, styleElement) {\n  if (styleElement.styleSheet) {\n    styleElement.styleSheet.cssText = css;\n  } else {\n    while (styleElement.firstChild) {\n      styleElement.removeChild(styleElement.firstChild);\n    }\n\n    styleElement.appendChild(document.createTextNode(css));\n  }\n}\n\nmodule.exports = styleTagTransform;","/*\r\n * canvg.js - Javascript SVG parser and renderer on Canvas\r\n * version 2.0.0\r\n * MIT Licensed\r\n * Gabe Lerner (gabelerner@gmail.com)\r\n * https://github.com/canvg/canvg\r\n *\r\n */\r\n\r\n(function (global, factory) {\r\n    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory(require('./rgbcolor')) :\r\n        typeof define === 'function' && define.amd ? define(['./rgbcolor'], factory) :\r\n            (global.canvg = factory(global.RGBColor,global.StackBlur,global.Canvas));\r\n}(this, (function (rgbcolor,stackblurCanvas,canvas) { 'use strict';\r\n\r\n    rgbcolor = rgbcolor && rgbcolor.hasOwnProperty('default') ? rgbcolor['default'] : rgbcolor;\r\n    stackblurCanvas = stackblurCanvas && stackblurCanvas.hasOwnProperty('default') ? stackblurCanvas['default'] : stackblurCanvas;\r\n    canvas = canvas && canvas.hasOwnProperty('default') ? canvas['default'] : canvas;\r\n\r\n    function createCommonjsModule(fn, module) {\r\n        return module = { exports: {} }, fn(module, module.exports), module.exports;\r\n    }\r\n\r\n    var canvg_1 = createCommonjsModule(function (module) {\r\n        /* eslint-env browser, node */\r\n        /* globals $, Sizzle, Windows, ActiveXObject */\r\n        /* eslint-disable no-redeclare */\r\n\r\n\r\n        var isNode = (module.exports && typeof window === 'undefined'),\r\n            nodeEnv = false;\r\n        var windowEnv;\r\n\r\n        {\r\n            windowEnv = window;\r\n            windowEnv.DOMParser = window.DOMParser;\r\n        }\r\n\r\n        var doc = windowEnv.document,\r\n            defaultClientWidth = 800,\r\n            defaultClientHeight = 600;\r\n\r\n        function createCanvas(width, height) {\r\n            var c;\r\n            {\r\n                c = doc.createElement('canvas');\r\n                c.width = width;\r\n                c.height = height;\r\n            }\r\n            return c;\r\n        }\r\n\r\n        // canvg(target, s)\r\n        // empty parameters: replace all 'svg' elements on page with 'canvas' elements\r\n        // target: canvas element or the id of a canvas element\r\n        // s: svg string, url to svg file, or xml document\r\n        // opts: optional hash of options\r\n        //       ignoreMouse: true => ignore mouse events\r\n        //       ignoreAnimation: true => ignore animations\r\n        //       ignoreDimensions: true => does not try to resize canvas\r\n        //       ignoreClear: true => does not clear canvas\r\n        //       offsetX: int => draws at a x offset\r\n        //       offsetY: int => draws at a y offset\r\n        //       scaleWidth: int => scales horizontally to width\r\n        //       scaleHeight: int => scales vertically to height\r\n        //       renderCallback: function => will call the function after the first render is completed\r\n        //       enableRedraw: function => whether enable the redraw interval in node environment\r\n        //       forceRedraw: function => will call the function on every frame, if it returns true, will redraw\r\n        var canvg = function (target, s, opts) {\r\n            // no parameters\r\n            if (target == null && s == null && opts == null) {\r\n                var svgTags = doc.querySelectorAll('svg');\r\n                for (var i = 0; i < svgTags.length; i++) {\r\n                    var svgTag = svgTags[i];\r\n                    var c = doc.createElement('canvas');\r\n                    if (typeof(svgTag.clientWidth) !== 'undefined' && typeof(svgTag.clientHeight) !== 'undefined') {\r\n                        c.width = svgTag.clientWidth;\r\n                        c.height = svgTag.clientHeight;\r\n                    } else {\r\n                        var rect = svgTag.getBoundingClientRect();\r\n                        c.width = rect.width;\r\n                        c.height = rect.height;\r\n                    }\r\n                    svgTag.parentNode.insertBefore(c, svgTag);\r\n                    svgTag.parentNode.removeChild(svgTag);\r\n                    var div = doc.createElement('div');\r\n                    div.appendChild(svgTag);\r\n                    canvg(c, div.innerHTML);\r\n                }\r\n                return;\r\n            }\r\n\r\n            var svg = build(opts || {});\r\n\r\n            if (typeof target == 'string') {\r\n                target = doc.getElementById(target);\r\n            }\r\n\r\n            // store class on canvas\r\n            if (target.svg != null) target.svg.stop();\r\n\r\n            // on i.e. 8 for flash canvas, we can't assign the property so check for it\r\n            if (!(target.childNodes && target.childNodes.length == 1 && target.childNodes[0].nodeName == 'OBJECT')) target.svg = svg;\r\n\r\n            var ctx = target.getContext('2d');\r\n\r\n            if (typeof s.documentElement != 'undefined') {\r\n                // load from xml doc\r\n                svg.loadXmlDoc(ctx, s);\r\n            } else if (s.substr(0, 1) == '<') {\r\n                // load from xml string\r\n                svg.loadXml(ctx, s);\r\n            } else {\r\n                // load from url\r\n                svg.load(ctx, s);\r\n            }\r\n        };\r\n\r\n        var matchesSelector;\r\n        {\r\n            // see https://developer.mozilla.org/en-US/docs/Web/API/Element.matches\r\n            if (typeof Element == 'undefined') ; else if (typeof Element.prototype.matches != 'undefined') {\r\n                matchesSelector = function (node, selector) {\r\n                    return node.matches(selector);\r\n                };\r\n            } else if (typeof Element.prototype.webkitMatchesSelector != 'undefined') {\r\n                matchesSelector = function (node, selector) {\r\n                    return node.webkitMatchesSelector(selector);\r\n                };\r\n            } else if (typeof Element.prototype.mozMatchesSelector != 'undefined') {\r\n                matchesSelector = function (node, selector) {\r\n                    return node.mozMatchesSelector(selector);\r\n                };\r\n            } else if (typeof Element.prototype.msMatchesSelector != 'undefined') {\r\n                matchesSelector = function (node, selector) {\r\n                    return node.msMatchesSelector(selector);\r\n                };\r\n            } else if (typeof Element.prototype.oMatchesSelector != 'undefined') {\r\n                matchesSelector = function (node, selector) {\r\n                    return node.oMatchesSelector(selector);\r\n                };\r\n            } else {\r\n                // requires Sizzle: https://github.com/jquery/sizzle/wiki/Sizzle-Documentation\r\n                // or jQuery: http://jquery.com/download/\r\n                // or Zepto: http://zeptojs.com/#\r\n                // without it, this is a ReferenceError\r\n\r\n                if (typeof jQuery === 'function' || typeof Zepto === 'function') {\r\n                    matchesSelector = function (node, selector) {\r\n                        return $(node).is(selector);\r\n                    };\r\n                }\r\n\r\n                if (typeof matchesSelector === 'undefined' && typeof Sizzle !== 'undefined') {\r\n                    matchesSelector = Sizzle.matchesSelector;\r\n                }\r\n            }\r\n        }\r\n\r\n        // slightly modified version of https://github.com/keeganstreet/specificity/blob/master/specificity.js\r\n        var attributeRegex = /(\\[[^\\]]+\\])/g;\r\n        var idRegex = /(#[^\\s\\+>~\\.\\[:]+)/g;\r\n        var classRegex = /(\\.[^\\s\\+>~\\.\\[:]+)/g;\r\n        var pseudoElementRegex = /(::[^\\s\\+>~\\.\\[:]+|:first-line|:first-letter|:before|:after)/gi;\r\n        var pseudoClassWithBracketsRegex = /(:[\\w-]+\\([^\\)]*\\))/gi;\r\n        var pseudoClassRegex = /(:[^\\s\\+>~\\.\\[:]+)/g;\r\n        var elementRegex = /([^\\s\\+>~\\.\\[:]+)/g;\r\n\r\n        function getSelectorSpecificity(selector) {\r\n            var typeCount = [0, 0, 0];\r\n            var findMatch = function (regex, type) {\r\n                var matches = selector.match(regex);\r\n                if (matches == null) {\r\n                    return;\r\n                }\r\n                typeCount[type] += matches.length;\r\n                selector = selector.replace(regex, ' ');\r\n            };\r\n\r\n            selector = selector.replace(/:not\\(([^\\)]*)\\)/g, '     $1 ');\r\n            selector = selector.replace(/{[\\s\\S]*/gm, ' ');\r\n            findMatch(attributeRegex, 1);\r\n            findMatch(idRegex, 0);\r\n            findMatch(classRegex, 1);\r\n            findMatch(pseudoElementRegex, 2);\r\n            findMatch(pseudoClassWithBracketsRegex, 1);\r\n            findMatch(pseudoClassRegex, 1);\r\n            selector = selector.replace(/[\\*\\s\\+>~]/g, ' ');\r\n            selector = selector.replace(/[#\\.]/g, ' ');\r\n            findMatch(elementRegex, 2);\r\n            return typeCount.join('');\r\n        }\r\n\r\n        function build(opts) {\r\n            var svg = { opts: opts };\r\n\r\n            svg.FRAMERATE = 30;\r\n            svg.MAX_VIRTUAL_PIXELS = 30000;\r\n\r\n            svg.rootEmSize = 12;\r\n            svg.emSize = 12;\r\n\r\n            svg.log = function (/* msg */) { };\r\n            if (svg.opts['log'] == true && typeof console != 'undefined') {\r\n                svg.log = function (msg) { console.log(msg); }; // eslint-disable-line no-console\r\n            }\r\n\r\n            // globals\r\n            svg.init = function (ctx) {\r\n                var uniqueId = 0;\r\n                svg.UniqueId = function () { uniqueId++; return 'canvg' + uniqueId; };\r\n                svg.Definitions = {};\r\n                svg.Styles = {};\r\n                svg.StylesSpecificity = {};\r\n                svg.Animations = [];\r\n                svg.Images = [];\r\n                svg.ctx = ctx;\r\n                svg.ViewPort = new (function () {\r\n\r\n                    this.viewPorts = [];\r\n                    this.Clear = function () { this.viewPorts = []; };\r\n                    this.SetCurrent = function (width, height) { this.viewPorts.push({ width: width, height: height }); };\r\n                    this.RemoveCurrent = function () { this.viewPorts.pop(); };\r\n                    this.Current = function () { return this.viewPorts[this.viewPorts.length - 1]; };\r\n                    this.width = function () { return this.Current().width; };\r\n                    this.height = function () { return this.Current().height; };\r\n                    this.ComputeSize = function (d) {\r\n                        if (d != null && typeof d == 'number') return d;\r\n                        if (d == 'x') return this.width();\r\n                        if (d == 'y') return this.height();\r\n                        return Math.sqrt(Math.pow(this.width(), 2) + Math.pow(this.height(), 2)) / Math.sqrt(2);\r\n                    };\r\n                });\r\n            };\r\n            svg.init();\r\n\r\n            // images loaded\r\n            svg.ImagesLoaded = function () {\r\n                for (var i = 0; i < svg.Images.length; i++) {\r\n                    if (!svg.Images[i].loaded) return false;\r\n                }\r\n                return true;\r\n            };\r\n\r\n            // trim\r\n            svg.trim = function (s) { return s.replace(/^\\s+|\\s+$/g, ''); };\r\n\r\n            // compress non-ideographic spaces\r\n            svg.compressSpaces = function (s) { return s.replace(/(?!\\u3000)\\s+/gm, ' '); };\r\n\r\n            // ajax\r\n            svg.ajax = function (url) {\r\n                var AJAX;\r\n                if (windowEnv.XMLHttpRequest) { AJAX = new windowEnv.XMLHttpRequest(); } else { AJAX = new ActiveXObject('Microsoft.XMLHTTP'); }\r\n                if (AJAX) {\r\n                    AJAX.open('GET', url, false);\r\n                    AJAX.send(null);\r\n                    return AJAX.responseText;\r\n                }\r\n                return null;\r\n            };\r\n\r\n            // parse xml\r\n            svg.parseXml = function (xml) {\r\n                if (typeof Windows != 'undefined' && typeof Windows.Data != 'undefined' && typeof Windows.Data.Xml != 'undefined') {\r\n                    var xmlDoc = new Windows.Data.Xml.Dom.XmlDocument();\r\n                    var settings = new Windows.Data.Xml.Dom.XmlLoadSettings();\r\n                    settings.prohibitDtd = false;\r\n                    xmlDoc.loadXml(xml, settings);\r\n                    return xmlDoc;\r\n                } else if (windowEnv.DOMParser) {\r\n                    try {\r\n                        var parser = opts.xmldom ? new windowEnv.DOMParser(opts.xmldom) : new windowEnv.DOMParser();\r\n                        return parser.parseFromString(xml, 'image/svg+xml');\r\n                    } catch (e) {\r\n                        parser = opts.xmldom ? new windowEnv.DOMParser(opts.xmldom) : new windowEnv.DOMParser();\r\n                        return parser.parseFromString(xml, 'text/xml');\r\n                    }\r\n                } else {\r\n                    xml = xml.replace(/<!DOCTYPE svg[^>]*>/, '');\r\n                    var xmlDoc = new ActiveXObject('Microsoft.XMLDOM');\r\n                    xmlDoc.async = 'false';\r\n                    xmlDoc.loadXML(xml);\r\n                    return xmlDoc;\r\n                }\r\n            };\r\n\r\n            svg.Property = function (name, value) {\r\n                this.name = name;\r\n                this.value = value;\r\n            };\r\n            svg.Property.prototype.getValue = function () {\r\n                return this.value;\r\n            };\r\n\r\n            svg.Property.prototype.hasValue = function () {\r\n                return (this.value != null && this.value !== '');\r\n            };\r\n\r\n            // return the numerical value of the property\r\n            svg.Property.prototype.numValue = function () {\r\n                if (!this.hasValue()) return 0;\r\n\r\n                var n = parseFloat(this.value);\r\n                if ((this.value + '').match(/%$/)) {\r\n                    n = n / 100.0;\r\n                }\r\n                return n;\r\n            };\r\n\r\n            svg.Property.prototype.valueOrDefault = function (def) {\r\n                if (this.hasValue()) return this.value;\r\n                return def;\r\n            };\r\n\r\n            svg.Property.prototype.numValueOrDefault = function (def) {\r\n                if (this.hasValue()) return this.numValue();\r\n                return def;\r\n            };\r\n\r\n            // color extensions\r\n            // augment the current color value with the opacity\r\n            svg.Property.prototype.addOpacity = function (opacityProp) {\r\n                var newValue = this.value;\r\n                if (opacityProp.value != null && opacityProp.value != '' && typeof this.value == 'string') { // can only add opacity to colors, not patterns\r\n                    var color = new rgbcolor(this.value);\r\n                    if (color.ok) {\r\n                        newValue = 'rgba(' + color.r + ', ' + color.g + ', ' + color.b + ', ' + opacityProp.numValue() + ')';\r\n                    }\r\n                }\r\n                return new svg.Property(this.name, newValue);\r\n            };\r\n\r\n            // definition extensions\r\n            // get the definition from the definitions table\r\n            svg.Property.prototype.getDefinition = function () {\r\n                var name = this.value.match(/#([^\\)'\"]+)/);\r\n                if (name) { name = name[1]; }\r\n                if (!name) { name = this.value; }\r\n                return svg.Definitions[name];\r\n            };\r\n\r\n            svg.Property.prototype.isUrlDefinition = function () {\r\n                return this.value.indexOf('url(') == 0\r\n            };\r\n\r\n            svg.Property.prototype.getFillStyleDefinition = function (e, opacityProp) {\r\n                var def = this.getDefinition();\r\n\r\n                // gradient\r\n                if (def != null && def.createGradient) {\r\n                    return def.createGradient(svg.ctx, e, opacityProp);\r\n                }\r\n\r\n                // pattern\r\n                if (def != null && def.createPattern) {\r\n                    if (def.getHrefAttribute().hasValue()) {\r\n                        var pt = def.attribute('patternTransform');\r\n                        def = def.getHrefAttribute().getDefinition();\r\n                        if (pt.hasValue()) { def.attribute('patternTransform', true).value = pt.value; }\r\n                    }\r\n                    return def.createPattern(svg.ctx, e);\r\n                }\r\n\r\n                return null;\r\n            };\r\n\r\n            // length extensions\r\n            svg.Property.prototype.getDPI = function (/* viewPort */) {\r\n                return 96.0; // TODO: compute?\r\n            };\r\n\r\n            svg.Property.prototype.getREM = function (/* viewPort */) {\r\n                return svg.rootEmSize;\r\n            };\r\n\r\n            svg.Property.prototype.getEM = function (/* viewPort */) {\r\n                return svg.emSize;\r\n            };\r\n\r\n            svg.Property.prototype.getUnits = function () {\r\n                var s = this.value + '';\r\n                return s.replace(/[0-9\\.\\-]/g, '');\r\n            };\r\n\r\n            svg.Property.prototype.isPixels = function () {\r\n                if (!this.hasValue()) return false;\r\n                var s = this.value + '';\r\n                if (s.match(/px$/)) return true;\r\n                if (s.match(/^[0-9]+$/)) return true;\r\n                return false;\r\n            };\r\n\r\n            // get the length as pixels\r\n            svg.Property.prototype.toPixels = function (viewPort, processPercent) {\r\n                if (!this.hasValue()) return 0;\r\n                var s = this.value + '';\r\n                if (s.match(/rem$/)) return this.numValue() * this.getREM(viewPort);\r\n                if (s.match(/em$/)) return this.numValue() * this.getEM(viewPort);\r\n                if (s.match(/ex$/)) return this.numValue() * this.getEM(viewPort) / 2.0;\r\n                if (s.match(/px$/)) return this.numValue();\r\n                if (s.match(/pt$/)) return this.numValue() * this.getDPI(viewPort) * (1.0 / 72.0);\r\n                if (s.match(/pc$/)) return this.numValue() * 15;\r\n                if (s.match(/cm$/)) return this.numValue() * this.getDPI(viewPort) / 2.54;\r\n                if (s.match(/mm$/)) return this.numValue() * this.getDPI(viewPort) / 25.4;\r\n                if (s.match(/in$/)) return this.numValue() * this.getDPI(viewPort);\r\n                if (s.match(/%$/)) return this.numValue() * svg.ViewPort.ComputeSize(viewPort);\r\n                var n = this.numValue();\r\n                if (processPercent && n < 1.0) return n * svg.ViewPort.ComputeSize(viewPort);\r\n                return n;\r\n            };\r\n\r\n            // time extensions\r\n            // get the time as milliseconds\r\n            svg.Property.prototype.toMilliseconds = function () {\r\n                if (!this.hasValue()) return 0;\r\n                var s = this.value + '';\r\n                if (s.match(/s$/)) return this.numValue() * 1000;\r\n                if (s.match(/ms$/)) return this.numValue();\r\n                return this.numValue();\r\n            };\r\n\r\n            // angle extensions\r\n            // get the angle as radians\r\n            svg.Property.prototype.toRadians = function () {\r\n                if (!this.hasValue()) return 0;\r\n                var s = this.value + '';\r\n                if (s.match(/deg$/)) return this.numValue() * (Math.PI / 180.0);\r\n                if (s.match(/grad$/)) return this.numValue() * (Math.PI / 200.0);\r\n                if (s.match(/rad$/)) return this.numValue();\r\n                return this.numValue() * (Math.PI / 180.0);\r\n            };\r\n\r\n            // text extensions\r\n            // get the text baseline\r\n            var textBaselineMapping = {\r\n                'baseline': 'alphabetic',\r\n                'before-edge': 'top',\r\n                'text-before-edge': 'top',\r\n                'middle': 'middle',\r\n                'central': 'middle',\r\n                'after-edge': 'bottom',\r\n                'text-after-edge': 'bottom',\r\n                'ideographic': 'ideographic',\r\n                'alphabetic': 'alphabetic',\r\n                'hanging': 'hanging',\r\n                'mathematical': 'alphabetic'\r\n            };\r\n            svg.Property.prototype.toTextBaseline = function () {\r\n                if (!this.hasValue()) return null;\r\n                return textBaselineMapping[this.value];\r\n            };\r\n\r\n            // fonts\r\n            svg.Font = new (function () {\r\n                this.Styles = 'normal|italic|oblique|inherit';\r\n                this.Variants = 'normal|small-caps|inherit';\r\n                this.Weights = 'normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit';\r\n\r\n                this.CreateFont = function (fontStyle, fontVariant, fontWeight, fontSize, fontFamily, inherit) {\r\n                    var f = inherit != null ? this.Parse(inherit) : this.CreateFont('', '', '', '', '', svg.ctx.font);\r\n                    fontFamily = fontFamily || f.fontFamily;\r\n                    return {\r\n                        fontFamily: fontFamily,\r\n                        fontSize: fontSize || f.fontSize,\r\n                        fontStyle: fontStyle || f.fontStyle,\r\n                        fontWeight: fontWeight || f.fontWeight,\r\n                        fontVariant: fontVariant || f.fontVariant,\r\n                        toString: function () { return [this.fontStyle, this.fontVariant, this.fontWeight, this.fontSize, this.fontFamily].join(' ') }\r\n                    }\r\n                };\r\n\r\n                var that = this;\r\n                this.Parse = function (s) {\r\n                    var f = {};\r\n                    var d = svg.trim(svg.compressSpaces(s || '')).split(' ');\r\n                    var set = { fontSize: false, fontStyle: false, fontWeight: false, fontVariant: false };\r\n                    var ff = '';\r\n                    for (var i = 0; i < d.length; i++) {\r\n                        if (!set.fontStyle && that.Styles.indexOf(d[i]) != -1) {\r\n                            if (d[i] != 'inherit') f.fontStyle = d[i];\r\n                            set.fontStyle = true;\r\n                        } else if (!set.fontVariant && that.Variants.indexOf(d[i]) != -1) {\r\n                            if (d[i] != 'inherit') f.fontVariant = d[i];\r\n                            set.fontStyle = set.fontVariant = true;\r\n                        } else if (!set.fontWeight && that.Weights.indexOf(d[i]) != -1) {\r\n                            if (d[i] != 'inherit') f.fontWeight = d[i];\r\n                            set.fontStyle = set.fontVariant = set.fontWeight = true;\r\n                        } else if (!set.fontSize) {\r\n                            if (d[i] != 'inherit') f.fontSize = d[i].split('/')[0];\r\n                            set.fontStyle = set.fontVariant = set.fontWeight = set.fontSize = true;\r\n                        } else { if (d[i] != 'inherit') ff += d[i]; }\r\n                    }\r\n                    if (ff != '') f.fontFamily = ff;\r\n                    return f;\r\n                };\r\n            });\r\n\r\n            // points and paths\r\n            svg.ToNumberArray = function (s) {\r\n                var a = svg.trim(svg.compressSpaces((s || '').replace(/,/g, ' '))).split(' ');\r\n                for (var i = 0; i < a.length; i++) {\r\n                    a[i] = parseFloat(a[i]);\r\n                }\r\n                return a;\r\n            };\r\n            svg.Point = function (x, y) {\r\n                this.x = x;\r\n                this.y = y;\r\n            };\r\n            svg.Point.prototype.angleTo = function (p) {\r\n                return Math.atan2(p.y - this.y, p.x - this.x);\r\n            };\r\n\r\n            svg.Point.prototype.applyTransform = function (v) {\r\n                var xp = this.x * v[0] + this.y * v[2] + v[4];\r\n                var yp = this.x * v[1] + this.y * v[3] + v[5];\r\n                this.x = xp;\r\n                this.y = yp;\r\n            };\r\n\r\n            svg.CreatePoint = function (s) {\r\n                var a = svg.ToNumberArray(s);\r\n                return new svg.Point(a[0], a[1]);\r\n            };\r\n            svg.CreatePath = function (s) {\r\n                var a = svg.ToNumberArray(s);\r\n                var path = [];\r\n                for (var i = 0; i < a.length; i += 2) {\r\n                    path.push(new svg.Point(a[i], a[i + 1]));\r\n                }\r\n                return path;\r\n            };\r\n\r\n            // bounding box\r\n            svg.BoundingBox = function (x1, y1, x2, y2) { // pass in initial points if you want\r\n                this.x1 = Number.NaN;\r\n                this.y1 = Number.NaN;\r\n                this.x2 = Number.NaN;\r\n                this.y2 = Number.NaN;\r\n\r\n                this.x = function () { return this.x1; };\r\n                this.y = function () { return this.y1; };\r\n                this.width = function () { return this.x2 - this.x1; };\r\n                this.height = function () { return this.y2 - this.y1; };\r\n\r\n                this.addPoint = function (x, y) {\r\n                    if (x != null) {\r\n                        if (isNaN(this.x1) || isNaN(this.x2)) {\r\n                            this.x1 = x;\r\n                            this.x2 = x;\r\n                        }\r\n                        if (x < this.x1) this.x1 = x;\r\n                        if (x > this.x2) this.x2 = x;\r\n                    }\r\n\r\n                    if (y != null) {\r\n                        if (isNaN(this.y1) || isNaN(this.y2)) {\r\n                            this.y1 = y;\r\n                            this.y2 = y;\r\n                        }\r\n                        if (y < this.y1) this.y1 = y;\r\n                        if (y > this.y2) this.y2 = y;\r\n                    }\r\n                };\r\n                this.addX = function (x) { this.addPoint(x, null); };\r\n                this.addY = function (y) { this.addPoint(null, y); };\r\n\r\n                this.addBoundingBox = function (bb) {\r\n                    this.addPoint(bb.x1, bb.y1);\r\n                    this.addPoint(bb.x2, bb.y2);\r\n                };\r\n\r\n                this.addQuadraticCurve = function (p0x, p0y, p1x, p1y, p2x, p2y) {\r\n                    var cp1x = p0x + 2 / 3 * (p1x - p0x); // CP1 = QP0 + 2/3 *(QP1-QP0)\r\n                    var cp1y = p0y + 2 / 3 * (p1y - p0y); // CP1 = QP0 + 2/3 *(QP1-QP0)\r\n                    var cp2x = cp1x + 1 / 3 * (p2x - p0x); // CP2 = CP1 + 1/3 *(QP2-QP0)\r\n                    var cp2y = cp1y + 1 / 3 * (p2y - p0y); // CP2 = CP1 + 1/3 *(QP2-QP0)\r\n                    this.addBezierCurve(p0x, p0y, cp1x, cp2x, cp1y, cp2y, p2x, p2y);\r\n                };\r\n\r\n                this.addBezierCurve = function (p0x, p0y, p1x, p1y, p2x, p2y, p3x, p3y) {\r\n                    // from http://blog.hackers-cafe.net/2009/06/how-to-calculate-bezier-curves-bounding.html\r\n                    var p0 = [p0x, p0y],\r\n                        p1 = [p1x, p1y],\r\n                        p2 = [p2x, p2y],\r\n                        p3 = [p3x, p3y];\r\n                    this.addPoint(p0[0], p0[1]);\r\n                    this.addPoint(p3[0], p3[1]);\r\n\r\n                    for (var i = 0; i <= 1; i++) {\r\n                        var f = function (t) {\r\n                            return Math.pow(1 - t, 3) * p0[i] +\r\n                                3 * Math.pow(1 - t, 2) * t * p1[i] +\r\n                                3 * (1 - t) * Math.pow(t, 2) * p2[i] +\r\n                                Math.pow(t, 3) * p3[i];\r\n                        };\r\n\r\n                        var b = 6 * p0[i] - 12 * p1[i] + 6 * p2[i];\r\n                        var a = -3 * p0[i] + 9 * p1[i] - 9 * p2[i] + 3 * p3[i];\r\n                        var c = 3 * p1[i] - 3 * p0[i];\r\n\r\n                        if (a == 0) {\r\n                            if (b == 0) continue;\r\n                            var t = -c / b;\r\n                            if (0 < t && t < 1) {\r\n                                if (i == 0) this.addX(f(t));\r\n                                if (i == 1) this.addY(f(t));\r\n                            }\r\n                            continue;\r\n                        }\r\n\r\n                        var b2ac = Math.pow(b, 2) - 4 * c * a;\r\n                        if (b2ac < 0) continue;\r\n                        var t1 = (-b + Math.sqrt(b2ac)) / (2 * a);\r\n                        if (0 < t1 && t1 < 1) {\r\n                            if (i == 0) this.addX(f(t1));\r\n                            if (i == 1) this.addY(f(t1));\r\n                        }\r\n                        var t2 = (-b - Math.sqrt(b2ac)) / (2 * a);\r\n                        if (0 < t2 && t2 < 1) {\r\n                            if (i == 0) this.addX(f(t2));\r\n                            if (i == 1) this.addY(f(t2));\r\n                        }\r\n                    }\r\n                };\r\n\r\n                this.isPointInBox = function (x, y) {\r\n                    return (this.x1 <= x && x <= this.x2 && this.y1 <= y && y <= this.y2);\r\n                };\r\n\r\n                this.addPoint(x1, y1);\r\n                this.addPoint(x2, y2);\r\n            };\r\n\r\n            // transforms\r\n            svg.Transform = function (v) {\r\n                var that = this;\r\n                this.Type = {};\r\n\r\n                // translate\r\n                this.Type.translate = function (s) {\r\n                    this.p = svg.CreatePoint(s);\r\n                    this.apply = function (ctx) {\r\n                        ctx.translate(this.p.x || 0.0, this.p.y || 0.0);\r\n                    };\r\n                    this.unapply = function (ctx) {\r\n                        ctx.translate(-1.0 * this.p.x || 0.0, -1.0 * this.p.y || 0.0);\r\n                    };\r\n                    this.applyToPoint = function (p) {\r\n                        p.applyTransform([1, 0, 0, 1, this.p.x || 0.0, this.p.y || 0.0]);\r\n                    };\r\n                };\r\n\r\n                // rotate\r\n                this.Type.rotate = function (s) {\r\n                    var a = svg.ToNumberArray(s);\r\n                    this.angle = new svg.Property('angle', a[0]);\r\n                    this.cx = a[1] || 0;\r\n                    this.cy = a[2] || 0;\r\n                    this.apply = function (ctx) {\r\n                        ctx.translate(this.cx, this.cy);\r\n                        ctx.rotate(this.angle.toRadians());\r\n                        ctx.translate(-this.cx, -this.cy);\r\n                    };\r\n                    this.unapply = function (ctx) {\r\n                        ctx.translate(this.cx, this.cy);\r\n                        ctx.rotate(-1.0 * this.angle.toRadians());\r\n                        ctx.translate(-this.cx, -this.cy);\r\n                    };\r\n                    this.applyToPoint = function (p) {\r\n                        var a = this.angle.toRadians();\r\n                        p.applyTransform([1, 0, 0, 1, this.p.x || 0.0, this.p.y || 0.0]);\r\n                        p.applyTransform([Math.cos(a), Math.sin(a), -Math.sin(a), Math.cos(a), 0, 0]);\r\n                        p.applyTransform([1, 0, 0, 1, -this.p.x || 0.0, -this.p.y || 0.0]);\r\n                    };\r\n                };\r\n\r\n                this.Type.scale = function (s) {\r\n                    this.p = svg.CreatePoint(s);\r\n                    this.apply = function (ctx) {\r\n                        ctx.scale(this.p.x || 1.0, this.p.y || this.p.x || 1.0);\r\n                    };\r\n                    this.unapply = function (ctx) {\r\n                        ctx.scale(1.0 / this.p.x || 1.0, 1.0 / this.p.y || this.p.x || 1.0);\r\n                    };\r\n                    this.applyToPoint = function (p) {\r\n                        p.applyTransform([this.p.x || 0.0, 0, 0, this.p.y || 0.0, 0, 0]);\r\n                    };\r\n                };\r\n\r\n                this.Type.matrix = function (s) {\r\n                    this.m = svg.ToNumberArray(s);\r\n                    this.apply = function (ctx) {\r\n                        ctx.transform(this.m[0], this.m[1], this.m[2], this.m[3], this.m[4], this.m[5]);\r\n                    };\r\n                    this.unapply = function (ctx) {\r\n                        var a = this.m[0];\r\n                        var b = this.m[2];\r\n                        var c = this.m[4];\r\n                        var d = this.m[1];\r\n                        var e = this.m[3];\r\n                        var f = this.m[5];\r\n                        var g = 0.0;\r\n                        var h = 0.0;\r\n                        var i = 1.0;\r\n                        var det = 1 / (a * (e * i - f * h) - b * (d * i - f * g) + c * (d * h - e * g));\r\n                        ctx.transform(\r\n                            det * (e * i - f * h),\r\n                            det * (f * g - d * i),\r\n                            det * (c * h - b * i),\r\n                            det * (a * i - c * g),\r\n                            det * (b * f - c * e),\r\n                            det * (c * d - a * f)\r\n                        );\r\n                    };\r\n                    this.applyToPoint = function (p) {\r\n                        p.applyTransform(this.m);\r\n                    };\r\n                };\r\n\r\n                this.Type.SkewBase = function (s) {\r\n                    this.base = that.Type.matrix;\r\n                    this.base(s);\r\n                    this.angle = new svg.Property('angle', s);\r\n                };\r\n                this.Type.SkewBase.prototype = new this.Type.matrix;\r\n\r\n                this.Type.skewX = function (s) {\r\n                    this.base = that.Type.SkewBase;\r\n                    this.base(s);\r\n                    this.m = [1, 0, Math.tan(this.angle.toRadians()), 1, 0, 0];\r\n                };\r\n                this.Type.skewX.prototype = new this.Type.SkewBase;\r\n\r\n                this.Type.skewY = function (s) {\r\n                    this.base = that.Type.SkewBase;\r\n                    this.base(s);\r\n                    this.m = [1, Math.tan(this.angle.toRadians()), 0, 1, 0, 0];\r\n                };\r\n                this.Type.skewY.prototype = new this.Type.SkewBase;\r\n\r\n                this.transforms = [];\r\n\r\n                this.apply = function (ctx) {\r\n                    for (var i = 0; i < this.transforms.length; i++) {\r\n                        this.transforms[i].apply(ctx);\r\n                    }\r\n                };\r\n\r\n                this.unapply = function (ctx) {\r\n                    for (var i = this.transforms.length - 1; i >= 0; i--) {\r\n                        this.transforms[i].unapply(ctx);\r\n                    }\r\n                };\r\n\r\n                this.applyToPoint = function (p) {\r\n                    for (var i = 0; i < this.transforms.length; i++) {\r\n                        this.transforms[i].applyToPoint(p);\r\n                    }\r\n                };\r\n\r\n                var data = svg.trim(svg.compressSpaces(v)).replace(/\\)([a-zA-Z])/g, ') $1').replace(/\\)(\\s?,\\s?)/g, ') ').split(/\\s(?=[a-z])/);\r\n                for (var i = 0; i < data.length; i++) {\r\n                    if (data[i] === 'none') {\r\n                        continue;\r\n                    }\r\n\r\n                    var type = svg.trim(data[i].split('(')[0]);\r\n                    var s = data[i].split('(')[1].replace(')', '');\r\n                    var transformType = this.Type[type];\r\n                    if (typeof transformType != 'undefined') {\r\n                        var transform = new transformType(s);\r\n                        transform.type = type;\r\n                        this.transforms.push(transform);\r\n                    }\r\n                }\r\n            };\r\n\r\n            // aspect ratio\r\n            svg.AspectRatio = function (ctx, aspectRatio, width, desiredWidth, height, desiredHeight, minX, minY, refX, refY) {\r\n                // aspect ratio - http://www.w3.org/TR/SVG/coords.html#PreserveAspectRatioAttribute\r\n                aspectRatio = svg.compressSpaces(aspectRatio);\r\n                aspectRatio = aspectRatio.replace(/^defer\\s/, ''); // ignore defer\r\n                var align = aspectRatio.split(' ')[0] || 'xMidYMid';\r\n                var meetOrSlice = aspectRatio.split(' ')[1] || 'meet';\r\n\r\n                // calculate scale\r\n                var scaleX = width / desiredWidth;\r\n                var scaleY = height / desiredHeight;\r\n                var scaleMin = Math.min(scaleX, scaleY);\r\n                var scaleMax = Math.max(scaleX, scaleY);\r\n                if (meetOrSlice == 'meet') {\r\n                    desiredWidth *= scaleMin;\r\n                    desiredHeight *= scaleMin;\r\n                }\r\n                if (meetOrSlice == 'slice') {\r\n                    desiredWidth *= scaleMax;\r\n                    desiredHeight *= scaleMax;\r\n                }\r\n\r\n                refX = new svg.Property('refX', refX);\r\n                refY = new svg.Property('refY', refY);\r\n                if (refX.hasValue() && refY.hasValue()) {\r\n                    ctx.translate(-scaleMin * refX.toPixels('x'), -scaleMin * refY.toPixels('y'));\r\n                } else {\r\n                    // align\r\n                    if (align.match(/^xMid/) && ((meetOrSlice == 'meet' && scaleMin == scaleY) || (meetOrSlice == 'slice' && scaleMax == scaleY))) ctx.translate(width / 2.0 - desiredWidth / 2.0, 0);\r\n                    if (align.match(/YMid$/) && ((meetOrSlice == 'meet' && scaleMin == scaleX) || (meetOrSlice == 'slice' && scaleMax == scaleX))) ctx.translate(0, height / 2.0 - desiredHeight / 2.0);\r\n                    if (align.match(/^xMax/) && ((meetOrSlice == 'meet' && scaleMin == scaleY) || (meetOrSlice == 'slice' && scaleMax == scaleY))) ctx.translate(width - desiredWidth, 0);\r\n                    if (align.match(/YMax$/) && ((meetOrSlice == 'meet' && scaleMin == scaleX) || (meetOrSlice == 'slice' && scaleMax == scaleX))) ctx.translate(0, height - desiredHeight);\r\n                }\r\n\r\n                // scale\r\n                if (align == 'none') ctx.scale(scaleX, scaleY);\r\n                else if (meetOrSlice == 'meet') ctx.scale(scaleMin, scaleMin);\r\n                else if (meetOrSlice == 'slice') ctx.scale(scaleMax, scaleMax);\r\n\r\n                // translate\r\n                ctx.translate(minX == null ? 0 : -minX, minY == null ? 0 : -minY);\r\n            };\r\n\r\n            // elements\r\n            svg.Element = {};\r\n\r\n            svg.EmptyProperty = new svg.Property('EMPTY', '');\r\n\r\n            svg.Element.ElementBase = function (node) {\r\n                this.attributes = {};\r\n                this.styles = {};\r\n                this.stylesSpecificity = {};\r\n                this.children = [];\r\n\r\n                // get or create attribute\r\n                this.attribute = function (name, createIfNotExists) {\r\n                    var a = this.attributes[name];\r\n                    if (a != null) return a;\r\n\r\n                    if (createIfNotExists == true) {\r\n                        a = new svg.Property(name, '');\r\n                        this.attributes[name] = a;\r\n                    }\r\n                    return a || svg.EmptyProperty;\r\n                };\r\n\r\n                this.getHrefAttribute = function () {\r\n                    for (var a in this.attributes) {\r\n                        if (a == 'href' || a.match(/:href$/)) {\r\n                            return this.attributes[a];\r\n                        }\r\n                    }\r\n                    return svg.EmptyProperty;\r\n                };\r\n\r\n                // get or create style, crawls up node tree\r\n                this.style = function (name, createIfNotExists, skipAncestors) {\r\n                    var s = this.styles[name];\r\n                    if (s != null) return s;\r\n\r\n                    var a = this.attribute(name);\r\n                    if (a != null && a.hasValue()) {\r\n                        this.styles[name] = a; // move up to me to cache\r\n                        return a;\r\n                    }\r\n\r\n                    if (skipAncestors != true) {\r\n                        var p = this.parent;\r\n                        if (p != null) {\r\n                            var ps = p.style(name);\r\n                            if (ps != null && ps.hasValue()) {\r\n                                return ps;\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    if (createIfNotExists == true) {\r\n                        s = new svg.Property(name, '');\r\n                        this.styles[name] = s;\r\n                    }\r\n                    return s || svg.EmptyProperty;\r\n                };\r\n\r\n                // base render\r\n                this.render = function (ctx) {\r\n                    // don't render display=none\r\n                    if (this.style('display').value == 'none') return;\r\n\r\n                    // don't render visibility=hidden\r\n                    if (this.style('visibility').value == 'hidden') return;\r\n\r\n                    ctx.save();\r\n                    if (this.style('mask').hasValue()) { // mask\r\n                        var mask = this.style('mask').getDefinition();\r\n                        if (mask != null) mask.apply(ctx, this);\r\n                    } else if (this.style('filter').hasValue()) { // filter\r\n                        var filter = this.style('filter').getDefinition();\r\n                        if (filter != null) filter.apply(ctx, this);\r\n                    } else {\r\n                        this.setContext(ctx);\r\n                        this.renderChildren(ctx);\r\n                        this.clearContext(ctx);\r\n                    }\r\n                    ctx.restore();\r\n                };\r\n\r\n                // base set context\r\n                this.setContext = function (/* ctx */) {\r\n                    // OVERRIDE ME!\r\n                };\r\n\r\n                // base clear context\r\n                this.clearContext = function (/* ctx */) {\r\n                    // OVERRIDE ME!\r\n                };\r\n\r\n                // base render children\r\n                this.renderChildren = function (ctx) {\r\n                    for (var i = 0; i < this.children.length; i++) {\r\n                        this.children[i].render(ctx);\r\n                    }\r\n                };\r\n\r\n                this.addChild = function (childNode, create) {\r\n                    var child = childNode;\r\n                    if (create) child = svg.CreateElement(childNode);\r\n                    child.parent = this;\r\n                    if (child.type != 'title') { this.children.push(child); }\r\n                };\r\n\r\n                this.addStylesFromStyleDefinition = function () {\r\n                    // add styles\r\n                    for (var selector in svg.Styles) {\r\n                        if (selector[0] != '@' && matchesSelector(node, selector)) {\r\n                            var styles = svg.Styles[selector];\r\n                            var specificity = svg.StylesSpecificity[selector];\r\n                            if (styles != null) {\r\n                                for (var name in styles) {\r\n                                    var existingSpecificity = this.stylesSpecificity[name];\r\n                                    if (typeof existingSpecificity == 'undefined') {\r\n                                        existingSpecificity = '000';\r\n                                    }\r\n                                    if (specificity >= existingSpecificity) {\r\n                                        this.styles[name] = styles[name];\r\n                                        this.stylesSpecificity[name] = specificity;\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                };\r\n\r\n                // Microsoft Edge fix\r\n                var allUppercase = new RegExp('^[A-Z\\-]+$');\r\n                var normalizeAttributeName = function (name) {\r\n                    if (allUppercase.test(name)) {\r\n                        return name.toLowerCase();\r\n                    }\r\n                    return name;\r\n                };\r\n\r\n                if (node != null && node.nodeType == 1) { //ELEMENT_NODE\r\n                    // add attributes\r\n                    for (var i = 0; i < node.attributes.length; i++) {\r\n                        var attribute = node.attributes[i];\r\n                        var nodeName = normalizeAttributeName(attribute.nodeName);\r\n                        this.attributes[nodeName] = new svg.Property(nodeName, attribute.value);\r\n                    }\r\n\r\n                    this.addStylesFromStyleDefinition();\r\n\r\n                    // add inline styles\r\n                    if (this.attribute('style').hasValue()) {\r\n                        var styles = this.attribute('style').value.split(';');\r\n                        for (var i = 0; i < styles.length; i++) {\r\n                            if (svg.trim(styles[i]) != '') {\r\n                                var style = styles[i].split(':');\r\n                                var name = svg.trim(style[0]);\r\n                                var value = svg.trim(style[1]);\r\n                                this.styles[name] = new svg.Property(name, value);\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    // add id\r\n                    if (this.attribute('id').hasValue()) {\r\n                        if (svg.Definitions[this.attribute('id').value] == null) {\r\n                            svg.Definitions[this.attribute('id').value] = this;\r\n                        }\r\n                    }\r\n\r\n                    // add children\r\n                    for (var i = 0; i < node.childNodes.length; i++) {\r\n                        var childNode = node.childNodes[i];\r\n                        if (childNode.nodeType == 1) this.addChild(childNode, true); //ELEMENT_NODE\r\n                        if (this.captureTextNodes && (childNode.nodeType == 3 || childNode.nodeType == 4)) {\r\n                            var text = childNode.value || childNode.text || childNode.textContent || '';\r\n                            if (svg.compressSpaces(text) != '') {\r\n                                this.addChild(new svg.Element.tspan(childNode), false); // TEXT_NODE\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            };\r\n\r\n            svg.Element.RenderedElementBase = function (node) {\r\n                this.base = svg.Element.ElementBase;\r\n                this.base(node);\r\n\r\n                this.calculateOpacity = function() {\r\n                    var opacity = 1.0;\r\n\r\n                    var el = this;\r\n                    while (el != null) {\r\n                        var opacityStyle = el.style('opacity', false, true); // no ancestors on style call\r\n                        if (opacityStyle.hasValue()) {\r\n                            opacity = opacity * opacityStyle.numValue();\r\n                        }\r\n                        el = el.parent;\r\n                    }\r\n\r\n                    return opacity;\r\n                };\r\n\r\n                this.setContext = function (ctx, fromMeasure) {\r\n                    if (!fromMeasure) { // causes stack overflow when measuring text with gradients\r\n                        // fill\r\n                        if (this.style('fill').isUrlDefinition()) {\r\n                            var fs = this.style('fill').getFillStyleDefinition(this, this.style('fill-opacity'));\r\n                            if (fs != null) ctx.fillStyle = fs;\r\n                        } else if (this.style('fill').hasValue()) {\r\n                            var fillStyle = this.style('fill');\r\n                            if (fillStyle.value == 'currentColor') fillStyle.value = this.style('color').value;\r\n                            if (fillStyle.value != 'inherit') ctx.fillStyle = (fillStyle.value == 'none' ? 'rgba(0,0,0,0)' : fillStyle.value);\r\n                        }\r\n                        if (this.style('fill-opacity').hasValue()) {\r\n                            var fillStyle = new svg.Property('fill', ctx.fillStyle);\r\n                            fillStyle = fillStyle.addOpacity(this.style('fill-opacity'));\r\n                            ctx.fillStyle = fillStyle.value;\r\n                        }\r\n\r\n                        // stroke\r\n                        if (this.style('stroke').isUrlDefinition()) {\r\n                            var fs = this.style('stroke').getFillStyleDefinition(this, this.style('stroke-opacity'));\r\n                            if (fs != null) ctx.strokeStyle = fs;\r\n                        } else if (this.style('stroke').hasValue()) {\r\n                            var strokeStyle = this.style('stroke');\r\n                            if (strokeStyle.value == 'currentColor') strokeStyle.value = this.style('color').value;\r\n                            if (strokeStyle.value != 'inherit') ctx.strokeStyle = (strokeStyle.value == 'none' ? 'rgba(0,0,0,0)' : strokeStyle.value);\r\n                        }\r\n                        if (this.style('stroke-opacity').hasValue()) {\r\n                            var strokeStyle = new svg.Property('stroke', ctx.strokeStyle);\r\n                            strokeStyle = strokeStyle.addOpacity(this.style('stroke-opacity'));\r\n                            ctx.strokeStyle = strokeStyle.value;\r\n                        }\r\n                        if (this.style('stroke-width').hasValue()) {\r\n                            var newLineWidth = this.style('stroke-width').toPixels();\r\n                            ctx.lineWidth = newLineWidth == 0 ? 0.001 : newLineWidth; // browsers don't respect 0\r\n                        }\r\n                        if (this.style('stroke-linecap').hasValue()) ctx.lineCap = this.style('stroke-linecap').value;\r\n                        if (this.style('stroke-linejoin').hasValue()) ctx.lineJoin = this.style('stroke-linejoin').value;\r\n                        if (this.style('stroke-miterlimit').hasValue()) ctx.miterLimit = this.style('stroke-miterlimit').value;\r\n                        if (this.style('paint-order').hasValue()) ctx.paintOrder = this.style('paint-order').value;\r\n                        if (this.style('stroke-dasharray').hasValue() && this.style('stroke-dasharray').value != 'none') {\r\n                            var gaps = svg.ToNumberArray(this.style('stroke-dasharray').value);\r\n                            if (typeof ctx.setLineDash != 'undefined') { ctx.setLineDash(gaps); } else if (typeof ctx.webkitLineDash != 'undefined') { ctx.webkitLineDash = gaps; } else if (typeof ctx.mozDash != 'undefined' && !(gaps.length == 1 && gaps[0] == 0)) { ctx.mozDash = gaps; }\r\n\r\n                            var offset = this.style('stroke-dashoffset').toPixels();\r\n                            if (typeof ctx.lineDashOffset != 'undefined') { ctx.lineDashOffset = offset; } else if (typeof ctx.webkitLineDashOffset != 'undefined') { ctx.webkitLineDashOffset = offset; } else if (typeof ctx.mozDashOffset != 'undefined') { ctx.mozDashOffset = offset; }\r\n                        }\r\n                    }\r\n\r\n                    // font\r\n                    if (typeof ctx.font != 'undefined') {\r\n                        ctx.font = svg.Font.CreateFont(\r\n                            this.style('font-style').value,\r\n                            this.style('font-variant').value,\r\n                            this.style('font-weight').value,\r\n                            this.style('font-size').hasValue() ? this.style('font-size').toPixels() + 'px' : '',\r\n                            this.style('font-family').value).toString();\r\n\r\n                        // update em size if needed\r\n                        var currentFontSize = this.style('font-size', false, false);\r\n                        if (currentFontSize.isPixels()) {\r\n                            svg.emSize = currentFontSize.toPixels();\r\n                        }\r\n                    }\r\n\r\n                    // transform\r\n                    if (this.style('transform', false, true).hasValue()) {\r\n                        var transform = new svg.Transform(this.style('transform', false, true).value);\r\n                        transform.apply(ctx);\r\n                    }\r\n\r\n                    // clip\r\n                    if (this.style('clip-path', false, true).hasValue()) {\r\n                        var clip = this.style('clip-path', false, true).getDefinition();\r\n                        if (clip != null) clip.apply(ctx);\r\n                    }\r\n\r\n                    // opacity\r\n                    ctx.globalAlpha = this.calculateOpacity();\r\n                };\r\n            };\r\n            svg.Element.RenderedElementBase.prototype = new svg.Element.ElementBase;\r\n\r\n            svg.Element.PathElementBase = function (node) {\r\n                this.base = svg.Element.RenderedElementBase;\r\n                this.base(node);\r\n\r\n                this.path = function (ctx) {\r\n                    if (ctx != null) ctx.beginPath();\r\n                    return new svg.BoundingBox();\r\n                };\r\n\r\n                this.renderChildren = function (ctx) {\r\n                    this.path(ctx);\r\n                    svg.Mouse.checkPath(this, ctx);\r\n                    if (ctx.fillStyle != '') {\r\n                        if (this.style('fill-rule').valueOrDefault('inherit') != 'inherit') { ctx.fill(this.style('fill-rule').value); } else { ctx.fill(); }\r\n                    }\r\n                    if (ctx.strokeStyle != '') ctx.stroke();\r\n\r\n                    var markers = this.getMarkers();\r\n                    if (markers != null) {\r\n                        if (this.style('marker-start').isUrlDefinition()) {\r\n                            var marker = this.style('marker-start').getDefinition();\r\n                            marker.render(ctx, markers[0][0], markers[0][1]);\r\n                        }\r\n                        if (this.style('marker-mid').isUrlDefinition()) {\r\n                            var marker = this.style('marker-mid').getDefinition();\r\n                            for (var i = 1; i < markers.length - 1; i++) {\r\n                                marker.render(ctx, markers[i][0], markers[i][1]);\r\n                            }\r\n                        }\r\n                        if (this.style('marker-end').isUrlDefinition()) {\r\n                            var marker = this.style('marker-end').getDefinition();\r\n                            marker.render(ctx, markers[markers.length - 1][0], markers[markers.length - 1][1]);\r\n                        }\r\n                    }\r\n                };\r\n\r\n                this.getBoundingBox = function () {\r\n                    return this.path();\r\n                };\r\n\r\n                this.getMarkers = function () {\r\n                    return null;\r\n                };\r\n            };\r\n            svg.Element.PathElementBase.prototype = new svg.Element.RenderedElementBase;\r\n\r\n            // svg element\r\n            svg.Element.svg = function (node) {\r\n                this.base = svg.Element.RenderedElementBase;\r\n                this.base(node);\r\n\r\n                this.baseClearContext = this.clearContext;\r\n                this.clearContext = function (ctx) {\r\n                    this.baseClearContext(ctx);\r\n                    svg.ViewPort.RemoveCurrent();\r\n                };\r\n\r\n                this.baseSetContext = this.setContext;\r\n                this.setContext = function (ctx) {\r\n                    // initial values and defaults\r\n                    ctx.strokeStyle = 'rgba(0,0,0,0)';\r\n                    ctx.lineCap = 'butt';\r\n                    ctx.lineJoin = 'miter';\r\n                    ctx.miterLimit = 4;\r\n                    if (ctx.canvas.style && typeof ctx.font != 'undefined' && typeof windowEnv.getComputedStyle != 'undefined') {\r\n                        ctx.font = windowEnv.getComputedStyle(ctx.canvas).getPropertyValue('font');\r\n\r\n                        var fontSize = new svg.Property('fontSize', svg.Font.Parse(ctx.font).fontSize);\r\n                        if (fontSize.hasValue()) svg.rootEmSize = svg.emSize = fontSize.toPixels('y');\r\n                    }\r\n\r\n                    this.baseSetContext(ctx);\r\n\r\n                    // create new view port\r\n                    if (!this.attribute('x').hasValue()) this.attribute('x', true).value = 0;\r\n                    if (!this.attribute('y').hasValue()) this.attribute('y', true).value = 0;\r\n                    ctx.translate(this.attribute('x').toPixels('x'), this.attribute('y').toPixels('y'));\r\n\r\n                    var width = svg.ViewPort.width();\r\n                    var height = svg.ViewPort.height();\r\n\r\n                    if (!this.attribute('width').hasValue()) this.attribute('width', true).value = '100%';\r\n                    if (!this.attribute('height').hasValue()) this.attribute('height', true).value = '100%';\r\n                    if (typeof this.root == 'undefined') {\r\n                        width = this.attribute('width').toPixels('x');\r\n                        height = this.attribute('height').toPixels('y');\r\n\r\n                        var x = 0;\r\n                        var y = 0;\r\n                        if (this.attribute('refX').hasValue() && this.attribute('refY').hasValue()) {\r\n                            x = -this.attribute('refX').toPixels('x');\r\n                            y = -this.attribute('refY').toPixels('y');\r\n                        }\r\n\r\n                        if (this.attribute('overflow').valueOrDefault('hidden') != 'visible') {\r\n                            ctx.beginPath();\r\n                            ctx.moveTo(x, y);\r\n                            ctx.lineTo(width, y);\r\n                            ctx.lineTo(width, height);\r\n                            ctx.lineTo(x, height);\r\n                            ctx.closePath();\r\n                            ctx.clip();\r\n                        }\r\n                    }\r\n                    svg.ViewPort.SetCurrent(width, height);\r\n\r\n                    // viewbox\r\n                    if (this.attribute('viewBox').hasValue()) {\r\n                        var viewBox = svg.ToNumberArray(this.attribute('viewBox').value);\r\n                        var minX = viewBox[0];\r\n                        var minY = viewBox[1];\r\n                        width = viewBox[2];\r\n                        height = viewBox[3];\r\n\r\n                        svg.AspectRatio(ctx,\r\n                            this.attribute('preserveAspectRatio').value,\r\n                            svg.ViewPort.width(),\r\n                            width,\r\n                            svg.ViewPort.height(),\r\n                            height,\r\n                            minX,\r\n                            minY,\r\n                            this.attribute('refX').value,\r\n                            this.attribute('refY').value);\r\n\r\n                        svg.ViewPort.RemoveCurrent();\r\n                        svg.ViewPort.SetCurrent(viewBox[2], viewBox[3]);\r\n                    }\r\n                };\r\n            };\r\n            svg.Element.svg.prototype = new svg.Element.RenderedElementBase;\r\n\r\n            // rect element\r\n            svg.Element.rect = function (node) {\r\n                this.base = svg.Element.PathElementBase;\r\n                this.base(node);\r\n\r\n                this.path = function (ctx) {\r\n                    var x = this.attribute('x').toPixels('x');\r\n                    var y = this.attribute('y').toPixels('y');\r\n                    var width = this.attribute('width').toPixels('x');\r\n                    var height = this.attribute('height').toPixels('y');\r\n                    var rx = this.attribute('rx').toPixels('x');\r\n                    var ry = this.attribute('ry').toPixels('y');\r\n                    if (this.attribute('rx').hasValue() && !this.attribute('ry').hasValue()) ry = rx;\r\n                    if (this.attribute('ry').hasValue() && !this.attribute('rx').hasValue()) rx = ry;\r\n                    rx = Math.min(rx, width / 2.0);\r\n                    ry = Math.min(ry, height / 2.0);\r\n                    if (ctx != null) {\r\n                        var KAPPA = 4 * ((Math.sqrt(2) - 1) / 3);\r\n                        ctx.beginPath();\r\n                        ctx.moveTo(x + rx, y);\r\n                        ctx.lineTo(x + width - rx, y);\r\n                        ctx.bezierCurveTo(x + width - rx + (KAPPA * rx), y, x + width, y + ry - (KAPPA * ry), x + width, y + ry);\r\n                        ctx.lineTo(x + width, y + height - ry);\r\n                        ctx.bezierCurveTo(x + width, y + height - ry + (KAPPA * ry), x + width - rx + (KAPPA * rx), y + height, x + width - rx, y + height);\r\n                        ctx.lineTo(x + rx, y + height);\r\n                        ctx.bezierCurveTo(x + rx - (KAPPA * rx), y + height, x, y + height - ry + (KAPPA * ry), x, y + height - ry);\r\n                        ctx.lineTo(x, y + ry);\r\n                        ctx.bezierCurveTo(x, y + ry - (KAPPA * ry), x + rx - (KAPPA * rx), y, x + rx, y);\r\n                        ctx.closePath();\r\n                    }\r\n\r\n                    return new svg.BoundingBox(x, y, x + width, y + height);\r\n                };\r\n            };\r\n            svg.Element.rect.prototype = new svg.Element.PathElementBase;\r\n\r\n            // circle element\r\n            svg.Element.circle = function (node) {\r\n                this.base = svg.Element.PathElementBase;\r\n                this.base(node);\r\n\r\n                this.path = function (ctx) {\r\n                    var cx = this.attribute('cx').toPixels('x');\r\n                    var cy = this.attribute('cy').toPixels('y');\r\n                    var r = this.attribute('r').toPixels();\r\n\r\n                    if (ctx != null) {\r\n                        ctx.beginPath();\r\n                        ctx.arc(cx, cy, r, 0, Math.PI * 2, false);\r\n                        ctx.closePath();\r\n                    }\r\n\r\n                    return new svg.BoundingBox(cx - r, cy - r, cx + r, cy + r);\r\n                };\r\n            };\r\n            svg.Element.circle.prototype = new svg.Element.PathElementBase;\r\n\r\n            // ellipse element\r\n            svg.Element.ellipse = function (node) {\r\n                this.base = svg.Element.PathElementBase;\r\n                this.base(node);\r\n\r\n                this.path = function (ctx) {\r\n                    var KAPPA = 4 * ((Math.sqrt(2) - 1) / 3);\r\n                    var rx = this.attribute('rx').toPixels('x');\r\n                    var ry = this.attribute('ry').toPixels('y');\r\n                    var cx = this.attribute('cx').toPixels('x');\r\n                    var cy = this.attribute('cy').toPixels('y');\r\n\r\n                    if (ctx != null) {\r\n                        ctx.beginPath();\r\n                        ctx.moveTo(cx + rx, cy);\r\n                        ctx.bezierCurveTo(cx + rx, cy + (KAPPA * ry), cx + (KAPPA * rx), cy + ry, cx, cy + ry);\r\n                        ctx.bezierCurveTo(cx - (KAPPA * rx), cy + ry, cx - rx, cy + (KAPPA * ry), cx - rx, cy);\r\n                        ctx.bezierCurveTo(cx - rx, cy - (KAPPA * ry), cx - (KAPPA * rx), cy - ry, cx, cy - ry);\r\n                        ctx.bezierCurveTo(cx + (KAPPA * rx), cy - ry, cx + rx, cy - (KAPPA * ry), cx + rx, cy);\r\n                        ctx.closePath();\r\n                    }\r\n\r\n                    return new svg.BoundingBox(cx - rx, cy - ry, cx + rx, cy + ry);\r\n                };\r\n            };\r\n            svg.Element.ellipse.prototype = new svg.Element.PathElementBase;\r\n\r\n            // line element\r\n            svg.Element.line = function (node) {\r\n                this.base = svg.Element.PathElementBase;\r\n                this.base(node);\r\n\r\n                this.getPoints = function () {\r\n                    return [\r\n                        new svg.Point(this.attribute('x1').toPixels('x'), this.attribute('y1').toPixels('y')),\r\n                        new svg.Point(this.attribute('x2').toPixels('x'), this.attribute('y2').toPixels('y'))\r\n                    ];\r\n                };\r\n\r\n                this.path = function (ctx) {\r\n                    var points = this.getPoints();\r\n\r\n                    if (ctx != null) {\r\n                        ctx.beginPath();\r\n                        ctx.moveTo(points[0].x, points[0].y);\r\n                        ctx.lineTo(points[1].x, points[1].y);\r\n                    }\r\n\r\n                    return new svg.BoundingBox(points[0].x, points[0].y, points[1].x, points[1].y);\r\n                };\r\n\r\n                this.getMarkers = function () {\r\n                    var points = this.getPoints();\r\n                    var a = points[0].angleTo(points[1]);\r\n                    return [\r\n                        [points[0], a],\r\n                        [points[1], a]\r\n                    ];\r\n                };\r\n            };\r\n            svg.Element.line.prototype = new svg.Element.PathElementBase;\r\n\r\n            // polyline element\r\n            svg.Element.polyline = function (node) {\r\n                this.base = svg.Element.PathElementBase;\r\n                this.base(node);\r\n\r\n                this.points = svg.CreatePath(this.attribute('points').value);\r\n                this.path = function (ctx) {\r\n                    var bb = new svg.BoundingBox(this.points[0].x, this.points[0].y);\r\n                    if (ctx != null) {\r\n                        ctx.beginPath();\r\n                        ctx.moveTo(this.points[0].x, this.points[0].y);\r\n                    }\r\n                    for (var i = 1; i < this.points.length; i++) {\r\n                        bb.addPoint(this.points[i].x, this.points[i].y);\r\n                        if (ctx != null) ctx.lineTo(this.points[i].x, this.points[i].y);\r\n                    }\r\n                    return bb;\r\n                };\r\n\r\n                this.getMarkers = function () {\r\n                    var markers = [];\r\n                    for (var i = 0; i < this.points.length - 1; i++) {\r\n                        markers.push([this.points[i], this.points[i].angleTo(this.points[i + 1])]);\r\n                    }\r\n                    if (markers.length > 0) {\r\n                        markers.push([this.points[this.points.length - 1], markers[markers.length - 1][1]]);\r\n                    }\r\n                    return markers;\r\n                };\r\n            };\r\n            svg.Element.polyline.prototype = new svg.Element.PathElementBase;\r\n\r\n            // polygon element\r\n            svg.Element.polygon = function (node) {\r\n                this.base = svg.Element.polyline;\r\n                this.base(node);\r\n\r\n                this.basePath = this.path;\r\n                this.path = function (ctx) {\r\n                    var bb = this.basePath(ctx);\r\n                    if (ctx != null) {\r\n                        ctx.lineTo(this.points[0].x, this.points[0].y);\r\n                        ctx.closePath();\r\n                    }\r\n                    return bb;\r\n                };\r\n            };\r\n            svg.Element.polygon.prototype = new svg.Element.polyline;\r\n\r\n            // path element\r\n            svg.Element.path = function (node) {\r\n                this.base = svg.Element.PathElementBase;\r\n                this.base(node);\r\n\r\n                var d = this.attribute('d').value;\r\n                // TODO: convert to real lexer based on http://www.w3.org/TR/SVG11/paths.html#PathDataBNF\r\n                d = d.replace(/,/gm, ' '); // get rid of all commas\r\n                // As the end of a match can also be the start of the next match, we need to run this replace twice.\r\n                for (var i = 0; i < 2; i++)\r\n                    d = d.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\\s])/gm, '$1 $2'); // suffix commands with spaces\r\n                d = d.replace(/([^\\s])([MmZzLlHhVvCcSsQqTtAa])/gm, '$1 $2'); // prefix commands with spaces\r\n                d = d.replace(/([0-9])([+\\-])/gm, '$1 $2'); // separate digits on +- signs\r\n                // Again, we need to run this twice to find all occurances\r\n                for (var i = 0; i < 2; i++)\r\n                    d = d.replace(/(\\.[0-9]*)(\\.)/gm, '$1 $2'); // separate digits when they start with a comma\r\n                d = d.replace(/([Aa](\\s+[0-9]+){3})\\s+([01])\\s*([01])/gm, '$1 $3 $4 '); // shorthand elliptical arc path syntax\r\n                d = svg.compressSpaces(d); // compress multiple spaces\r\n                d = svg.trim(d);\r\n                this.PathParser = new (function (d) {\r\n                    this.tokens = d.split(' ');\r\n\r\n                    this.reset = function () {\r\n                        this.i = -1;\r\n                        this.command = '';\r\n                        this.previousCommand = '';\r\n                        this.start = new svg.Point(0, 0);\r\n                        this.control = new svg.Point(0, 0);\r\n                        this.current = new svg.Point(0, 0);\r\n                        this.points = [];\r\n                        this.angles = [];\r\n                    };\r\n\r\n                    this.isEnd = function () {\r\n                        return this.i >= this.tokens.length - 1;\r\n                    };\r\n\r\n                    this.isCommandOrEnd = function () {\r\n                        if (this.isEnd()) return true;\r\n                        return this.tokens[this.i + 1].match(/^[A-Za-z]$/) != null;\r\n                    };\r\n\r\n                    this.isRelativeCommand = function () {\r\n                        switch (this.command) {\r\n                            case 'm':\r\n                            case 'l':\r\n                            case 'h':\r\n                            case 'v':\r\n                            case 'c':\r\n                            case 's':\r\n                            case 'q':\r\n                            case 't':\r\n                            case 'a':\r\n                            case 'z':\r\n                                return true;\r\n                        }\r\n                        return false;\r\n                    };\r\n\r\n                    this.getToken = function () {\r\n                        this.i++;\r\n                        return this.tokens[this.i];\r\n                    };\r\n\r\n                    this.getScalar = function () {\r\n                        return parseFloat(this.getToken());\r\n                    };\r\n\r\n                    this.nextCommand = function () {\r\n                        this.previousCommand = this.command;\r\n                        this.command = this.getToken();\r\n                    };\r\n\r\n                    this.getPoint = function () {\r\n                        var p = new svg.Point(this.getScalar(), this.getScalar());\r\n                        return this.makeAbsolute(p);\r\n                    };\r\n\r\n                    this.getAsControlPoint = function () {\r\n                        var p = this.getPoint();\r\n                        this.control = p;\r\n                        return p;\r\n                    };\r\n\r\n                    this.getAsCurrentPoint = function () {\r\n                        var p = this.getPoint();\r\n                        this.current = p;\r\n                        return p;\r\n                    };\r\n\r\n                    this.getReflectedControlPoint = function () {\r\n                        if (this.previousCommand.toLowerCase() != 'c' &&\r\n                            this.previousCommand.toLowerCase() != 's' &&\r\n                            this.previousCommand.toLowerCase() != 'q' &&\r\n                            this.previousCommand.toLowerCase() != 't') {\r\n                            return this.current;\r\n                        }\r\n\r\n                        // reflect point\r\n                        var p = new svg.Point(2 * this.current.x - this.control.x, 2 * this.current.y - this.control.y);\r\n                        return p;\r\n                    };\r\n\r\n                    this.makeAbsolute = function (p) {\r\n                        if (this.isRelativeCommand()) {\r\n                            p.x += this.current.x;\r\n                            p.y += this.current.y;\r\n                        }\r\n                        return p;\r\n                    };\r\n\r\n                    this.addMarker = function (p, from, priorTo) {\r\n                        // if the last angle isn't filled in because we didn't have this point yet ...\r\n                        if (priorTo != null && this.angles.length > 0 && this.angles[this.angles.length - 1] == null) {\r\n                            this.angles[this.angles.length - 1] = this.points[this.points.length - 1].angleTo(priorTo);\r\n                        }\r\n                        this.addMarkerAngle(p, from == null ? null : from.angleTo(p));\r\n                    };\r\n\r\n                    this.addMarkerAngle = function (p, a) {\r\n                        this.points.push(p);\r\n                        this.angles.push(a);\r\n                    };\r\n\r\n                    this.getMarkerPoints = function () { return this.points; };\r\n                    this.getMarkerAngles = function () {\r\n                        for (var i = 0; i < this.angles.length; i++) {\r\n                            if (this.angles[i] == null) {\r\n                                for (var j = i + 1; j < this.angles.length; j++) {\r\n                                    if (this.angles[j] != null) {\r\n                                        this.angles[i] = this.angles[j];\r\n                                        break;\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                        return this.angles;\r\n                    };\r\n                })(d);\r\n\r\n                this.path = function (ctx) {\r\n                    var pp = this.PathParser;\r\n                    pp.reset();\r\n\r\n                    var bb = new svg.BoundingBox();\r\n                    if (ctx != null) ctx.beginPath();\r\n                    while (!pp.isEnd()) {\r\n                        pp.nextCommand();\r\n                        switch (pp.command) {\r\n                            case 'M':\r\n                            case 'm':\r\n                                var p = pp.getAsCurrentPoint();\r\n                                pp.addMarker(p);\r\n                                bb.addPoint(p.x, p.y);\r\n                                if (ctx != null) ctx.moveTo(p.x, p.y);\r\n                                pp.start = pp.current;\r\n                                while (!pp.isCommandOrEnd()) {\r\n                                    var p = pp.getAsCurrentPoint();\r\n                                    pp.addMarker(p, pp.start);\r\n                                    bb.addPoint(p.x, p.y);\r\n                                    if (ctx != null) ctx.lineTo(p.x, p.y);\r\n                                }\r\n                                break;\r\n                            case 'L':\r\n                            case 'l':\r\n                                while (!pp.isCommandOrEnd()) {\r\n                                    var c = pp.current;\r\n                                    var p = pp.getAsCurrentPoint();\r\n                                    pp.addMarker(p, c);\r\n                                    bb.addPoint(p.x, p.y);\r\n                                    if (ctx != null) ctx.lineTo(p.x, p.y);\r\n                                }\r\n                                break;\r\n                            case 'H':\r\n                            case 'h':\r\n                                while (!pp.isCommandOrEnd()) {\r\n                                    var newP = new svg.Point((pp.isRelativeCommand() ? pp.current.x : 0) + pp.getScalar(), pp.current.y);\r\n                                    pp.addMarker(newP, pp.current);\r\n                                    pp.current = newP;\r\n                                    bb.addPoint(pp.current.x, pp.current.y);\r\n                                    if (ctx != null) ctx.lineTo(pp.current.x, pp.current.y);\r\n                                }\r\n                                break;\r\n                            case 'V':\r\n                            case 'v':\r\n                                while (!pp.isCommandOrEnd()) {\r\n                                    var newP = new svg.Point(pp.current.x, (pp.isRelativeCommand() ? pp.current.y : 0) + pp.getScalar());\r\n                                    pp.addMarker(newP, pp.current);\r\n                                    pp.current = newP;\r\n                                    bb.addPoint(pp.current.x, pp.current.y);\r\n                                    if (ctx != null) ctx.lineTo(pp.current.x, pp.current.y);\r\n                                }\r\n                                break;\r\n                            case 'C':\r\n                            case 'c':\r\n                                while (!pp.isCommandOrEnd()) {\r\n                                    var curr = pp.current;\r\n                                    var p1 = pp.getPoint();\r\n                                    var cntrl = pp.getAsControlPoint();\r\n                                    var cp = pp.getAsCurrentPoint();\r\n                                    pp.addMarker(cp, cntrl, p1);\r\n                                    bb.addBezierCurve(curr.x, curr.y, p1.x, p1.y, cntrl.x, cntrl.y, cp.x, cp.y);\r\n                                    if (ctx != null) ctx.bezierCurveTo(p1.x, p1.y, cntrl.x, cntrl.y, cp.x, cp.y);\r\n                                }\r\n                                break;\r\n                            case 'S':\r\n                            case 's':\r\n                                while (!pp.isCommandOrEnd()) {\r\n                                    var curr = pp.current;\r\n                                    var p1 = pp.getReflectedControlPoint();\r\n                                    var cntrl = pp.getAsControlPoint();\r\n                                    var cp = pp.getAsCurrentPoint();\r\n                                    pp.addMarker(cp, cntrl, p1);\r\n                                    bb.addBezierCurve(curr.x, curr.y, p1.x, p1.y, cntrl.x, cntrl.y, cp.x, cp.y);\r\n                                    if (ctx != null) ctx.bezierCurveTo(p1.x, p1.y, cntrl.x, cntrl.y, cp.x, cp.y);\r\n                                }\r\n                                break;\r\n                            case 'Q':\r\n                            case 'q':\r\n                                while (!pp.isCommandOrEnd()) {\r\n                                    var curr = pp.current;\r\n                                    var cntrl = pp.getAsControlPoint();\r\n                                    var cp = pp.getAsCurrentPoint();\r\n                                    pp.addMarker(cp, cntrl, cntrl);\r\n                                    bb.addQuadraticCurve(curr.x, curr.y, cntrl.x, cntrl.y, cp.x, cp.y);\r\n                                    if (ctx != null) ctx.quadraticCurveTo(cntrl.x, cntrl.y, cp.x, cp.y);\r\n                                }\r\n                                break;\r\n                            case 'T':\r\n                            case 't':\r\n                                while (!pp.isCommandOrEnd()) {\r\n                                    var curr = pp.current;\r\n                                    var cntrl = pp.getReflectedControlPoint();\r\n                                    pp.control = cntrl;\r\n                                    var cp = pp.getAsCurrentPoint();\r\n                                    pp.addMarker(cp, cntrl, cntrl);\r\n                                    bb.addQuadraticCurve(curr.x, curr.y, cntrl.x, cntrl.y, cp.x, cp.y);\r\n                                    if (ctx != null) ctx.quadraticCurveTo(cntrl.x, cntrl.y, cp.x, cp.y);\r\n                                }\r\n                                break;\r\n                            case 'A':\r\n                            case 'a':\r\n                                while (!pp.isCommandOrEnd()) {\r\n                                    var curr = pp.current;\r\n                                    var rx = pp.getScalar();\r\n                                    var ry = pp.getScalar();\r\n                                    var xAxisRotation = pp.getScalar() * (Math.PI / 180.0);\r\n                                    var largeArcFlag = pp.getScalar();\r\n                                    var sweepFlag = pp.getScalar();\r\n                                    var cp = pp.getAsCurrentPoint();\r\n\r\n                                    // Conversion from endpoint to center parameterization\r\n                                    // http://www.w3.org/TR/SVG11/implnote.html#ArcImplementationNotes\r\n                                    // x1', y1'\r\n                                    var currp = new svg.Point(\r\n                                        Math.cos(xAxisRotation) * (curr.x - cp.x) / 2.0 + Math.sin(xAxisRotation) * (curr.y - cp.y) / 2.0, -Math.sin(xAxisRotation) * (curr.x - cp.x) / 2.0 + Math.cos(xAxisRotation) * (curr.y - cp.y) / 2.0\r\n                                    );\r\n                                    // adjust radii\r\n                                    var l = Math.pow(currp.x, 2) / Math.pow(rx, 2) + Math.pow(currp.y, 2) / Math.pow(ry, 2);\r\n                                    if (l > 1) {\r\n                                        rx *= Math.sqrt(l);\r\n                                        ry *= Math.sqrt(l);\r\n                                    }\r\n                                    // cx', cy'\r\n                                    var s = (largeArcFlag == sweepFlag ? -1 : 1) * Math.sqrt(\r\n                                        ((Math.pow(rx, 2) * Math.pow(ry, 2)) - (Math.pow(rx, 2) * Math.pow(currp.y, 2)) - (Math.pow(ry, 2) * Math.pow(currp.x, 2))) /\r\n                                        (Math.pow(rx, 2) * Math.pow(currp.y, 2) + Math.pow(ry, 2) * Math.pow(currp.x, 2))\r\n                                    );\r\n                                    if (isNaN(s)) s = 0;\r\n                                    var cpp = new svg.Point(s * rx * currp.y / ry, s * -ry * currp.x / rx);\r\n                                    // cx, cy\r\n                                    var centp = new svg.Point(\r\n                                        (curr.x + cp.x) / 2.0 + Math.cos(xAxisRotation) * cpp.x - Math.sin(xAxisRotation) * cpp.y,\r\n                                        (curr.y + cp.y) / 2.0 + Math.sin(xAxisRotation) * cpp.x + Math.cos(xAxisRotation) * cpp.y\r\n                                    );\r\n                                    // vector magnitude\r\n                                    var m = function (v) { return Math.sqrt(Math.pow(v[0], 2) + Math.pow(v[1], 2)); };\r\n                                    // ratio between two vectors\r\n                                    var r = function (u, v) { return (u[0] * v[0] + u[1] * v[1]) / (m(u) * m(v)) };\r\n                                    // angle between two vectors\r\n                                    var a = function (u, v) { return (u[0] * v[1] < u[1] * v[0] ? -1 : 1) * Math.acos(r(u, v)); };\r\n                                    // initial angle\r\n                                    var a1 = a([1, 0], [(currp.x - cpp.x) / rx, (currp.y - cpp.y) / ry]);\r\n                                    // angle delta\r\n                                    var u = [(currp.x - cpp.x) / rx, (currp.y - cpp.y) / ry];\r\n                                    var v = [(-currp.x - cpp.x) / rx, (-currp.y - cpp.y) / ry];\r\n                                    var ad = a(u, v);\r\n                                    if (r(u, v) <= -1) ad = Math.PI;\r\n                                    if (r(u, v) >= 1) ad = 0;\r\n\r\n                                    // for markers\r\n                                    var dir = 1 - sweepFlag ? 1.0 : -1.0;\r\n                                    var ah = a1 + dir * (ad / 2.0);\r\n                                    var halfWay = new svg.Point(\r\n                                        centp.x + rx * Math.cos(ah),\r\n                                        centp.y + ry * Math.sin(ah)\r\n                                    );\r\n                                    pp.addMarkerAngle(halfWay, ah - dir * Math.PI / 2);\r\n                                    pp.addMarkerAngle(cp, ah - dir * Math.PI);\r\n\r\n                                    bb.addPoint(cp.x, cp.y); // TODO: this is too naive, make it better\r\n                                    if (ctx != null && !isNaN(a1) && !isNaN(ad)) {\r\n                                        var r = rx > ry ? rx : ry;\r\n                                        var sx = rx > ry ? 1 : rx / ry;\r\n                                        var sy = rx > ry ? ry / rx : 1;\r\n\r\n                                        ctx.translate(centp.x, centp.y);\r\n                                        ctx.rotate(xAxisRotation);\r\n                                        ctx.scale(sx, sy);\r\n                                        ctx.arc(0, 0, r, a1, a1 + ad, 1 - sweepFlag);\r\n                                        ctx.scale(1 / sx, 1 / sy);\r\n                                        ctx.rotate(-xAxisRotation);\r\n                                        ctx.translate(-centp.x, -centp.y);\r\n                                    }\r\n                                }\r\n                                break;\r\n                            case 'Z':\r\n                            case 'z':\r\n                                if (ctx != null) {\r\n                                    // only close path if it is not a straight line\r\n                                    if (bb.x1 !== bb.x2 && bb.y1 !== bb.y2) {\r\n                                        ctx.closePath();\r\n                                    }\r\n                                }\r\n                                pp.current = pp.start;\r\n                        }\r\n                    }\r\n\r\n                    return bb;\r\n                };\r\n\r\n                this.getMarkers = function () {\r\n                    var points = this.PathParser.getMarkerPoints();\r\n                    var angles = this.PathParser.getMarkerAngles();\r\n\r\n                    var markers = [];\r\n                    for (var i = 0; i < points.length; i++) {\r\n                        markers.push([points[i], angles[i]]);\r\n                    }\r\n                    return markers;\r\n                };\r\n            };\r\n            svg.Element.path.prototype = new svg.Element.PathElementBase;\r\n\r\n            // pattern element\r\n            svg.Element.pattern = function (node) {\r\n                this.base = svg.Element.ElementBase;\r\n                this.base(node);\r\n\r\n                this.createPattern = function (ctx /* , element */) {\r\n                    var width = this.attribute('width').toPixels('x', true);\r\n                    var height = this.attribute('height').toPixels('y', true);\r\n\r\n                    // render me using a temporary svg element\r\n                    var tempSvg = new svg.Element.svg();\r\n                    tempSvg.attributes['viewBox'] = new svg.Property('viewBox', this.attribute('viewBox').value);\r\n                    tempSvg.attributes['width'] = new svg.Property('width', width + 'px');\r\n                    tempSvg.attributes['height'] = new svg.Property('height', height + 'px');\r\n                    tempSvg.attributes['transform'] = new svg.Property('transform', this.attribute('patternTransform').value);\r\n                    tempSvg.children = this.children;\r\n\r\n                    var c = createCanvas(width, height);\r\n                    var cctx = c.getContext('2d');\r\n                    if (this.attribute('x').hasValue() && this.attribute('y').hasValue()) {\r\n                        cctx.translate(this.attribute('x').toPixels('x', true), this.attribute('y').toPixels('y', true));\r\n                    }\r\n                    // render 3x3 grid so when we transform there's no white space on edges\r\n                    for (var x = -1; x <= 1; x++) {\r\n                        for (var y = -1; y <= 1; y++) {\r\n                            cctx.save();\r\n                            tempSvg.attributes['x'] = new svg.Property('x', x * c.width);\r\n                            tempSvg.attributes['y'] = new svg.Property('y', y * c.height);\r\n                            tempSvg.render(cctx);\r\n                            cctx.restore();\r\n                        }\r\n                    }\r\n                    var pattern = ctx.createPattern(c, 'repeat');\r\n                    return pattern;\r\n                };\r\n            };\r\n            svg.Element.pattern.prototype = new svg.Element.ElementBase;\r\n\r\n            // marker element\r\n            svg.Element.marker = function (node) {\r\n                this.base = svg.Element.ElementBase;\r\n                this.base(node);\r\n\r\n                this.baseRender = this.render;\r\n                this.render = function (ctx, point, angle) {\r\n                    if (!point) { return; }\r\n                    ctx.translate(point.x, point.y);\r\n                    if (this.attribute('orient').valueOrDefault('auto') == 'auto') ctx.rotate(angle);\r\n                    if (this.attribute('markerUnits').valueOrDefault('strokeWidth') == 'strokeWidth') ctx.scale(ctx.lineWidth, ctx.lineWidth);\r\n                    ctx.save();\r\n\r\n                    // render me using a temporary svg element\r\n                    var tempSvg = new svg.Element.svg();\r\n                    tempSvg.attributes['viewBox'] = new svg.Property('viewBox', this.attribute('viewBox').value);\r\n                    tempSvg.attributes['refX'] = new svg.Property('refX', this.attribute('refX').value);\r\n                    tempSvg.attributes['refY'] = new svg.Property('refY', this.attribute('refY').value);\r\n                    tempSvg.attributes['width'] = new svg.Property('width', this.attribute('markerWidth').value);\r\n                    tempSvg.attributes['height'] = new svg.Property('height', this.attribute('markerHeight').value);\r\n                    tempSvg.attributes['fill'] = new svg.Property('fill', this.attribute('fill').valueOrDefault('black'));\r\n                    tempSvg.attributes['stroke'] = new svg.Property('stroke', this.attribute('stroke').valueOrDefault('none'));\r\n                    tempSvg.children = this.children;\r\n                    tempSvg.render(ctx);\r\n\r\n                    ctx.restore();\r\n                    if (this.attribute('markerUnits').valueOrDefault('strokeWidth') == 'strokeWidth') ctx.scale(1 / ctx.lineWidth, 1 / ctx.lineWidth);\r\n                    if (this.attribute('orient').valueOrDefault('auto') == 'auto') ctx.rotate(-angle);\r\n                    ctx.translate(-point.x, -point.y);\r\n                };\r\n            };\r\n            svg.Element.marker.prototype = new svg.Element.ElementBase;\r\n\r\n            // definitions element\r\n            svg.Element.defs = function (node) {\r\n                this.base = svg.Element.ElementBase;\r\n                this.base(node);\r\n\r\n                this.render = function (/* ctx */) {\r\n                    // NOOP\r\n                };\r\n            };\r\n            svg.Element.defs.prototype = new svg.Element.ElementBase;\r\n\r\n            // base for gradients\r\n            svg.Element.GradientBase = function (node) {\r\n                this.base = svg.Element.ElementBase;\r\n                this.base(node);\r\n\r\n                this.stops = [];\r\n                for (var i = 0; i < this.children.length; i++) {\r\n                    var child = this.children[i];\r\n                    if (child.type == 'stop') this.stops.push(child);\r\n                }\r\n\r\n                this.getGradient = function () {\r\n                    // OVERRIDE ME!\r\n                };\r\n\r\n                this.gradientUnits = function () {\r\n                    return this.attribute('gradientUnits').valueOrDefault('objectBoundingBox');\r\n                };\r\n\r\n                this.attributesToInherit = ['gradientUnits'];\r\n\r\n                this.inheritStopContainer = function (stopsContainer) {\r\n                    for (var i = 0; i < this.attributesToInherit.length; i++) {\r\n                        var attributeToInherit = this.attributesToInherit[i];\r\n                        if (!this.attribute(attributeToInherit).hasValue() && stopsContainer.attribute(attributeToInherit).hasValue()) {\r\n                            this.attribute(attributeToInherit, true).value = stopsContainer.attribute(attributeToInherit).value;\r\n                        }\r\n                    }\r\n                };\r\n\r\n                this.createGradient = function (ctx, element, parentOpacityProp) {\r\n                    var stopsContainer = this;\r\n                    if (this.getHrefAttribute().hasValue()) {\r\n                        stopsContainer = this.getHrefAttribute().getDefinition();\r\n                        this.inheritStopContainer(stopsContainer);\r\n                    }\r\n\r\n                    var addParentOpacity = function (color) {\r\n                        if (parentOpacityProp.hasValue()) {\r\n                            var p = new svg.Property('color', color);\r\n                            return p.addOpacity(parentOpacityProp).value;\r\n                        }\r\n                        return color;\r\n                    };\r\n\r\n                    var g = this.getGradient(ctx, element);\r\n                    if (g == null) return addParentOpacity(stopsContainer.stops[stopsContainer.stops.length - 1].color);\r\n                    for (var i = 0; i < stopsContainer.stops.length; i++) {\r\n                        g.addColorStop(stopsContainer.stops[i].offset, addParentOpacity(stopsContainer.stops[i].color));\r\n                    }\r\n\r\n                    if (this.attribute('gradientTransform').hasValue()) {\r\n                        // render as transformed pattern on temporary canvas\r\n                        var rootView = svg.ViewPort.viewPorts[0];\r\n\r\n                        var rect = new svg.Element.rect();\r\n                        rect.attributes['x'] = new svg.Property('x', -svg.MAX_VIRTUAL_PIXELS / 3.0);\r\n                        rect.attributes['y'] = new svg.Property('y', -svg.MAX_VIRTUAL_PIXELS / 3.0);\r\n                        rect.attributes['width'] = new svg.Property('width', svg.MAX_VIRTUAL_PIXELS);\r\n                        rect.attributes['height'] = new svg.Property('height', svg.MAX_VIRTUAL_PIXELS);\r\n\r\n                        var group = new svg.Element.g();\r\n                        group.attributes['transform'] = new svg.Property('transform', this.attribute('gradientTransform').value);\r\n                        group.children = [rect];\r\n\r\n                        var tempSvg = new svg.Element.svg();\r\n                        tempSvg.attributes['x'] = new svg.Property('x', 0);\r\n                        tempSvg.attributes['y'] = new svg.Property('y', 0);\r\n                        tempSvg.attributes['width'] = new svg.Property('width', rootView.width);\r\n                        tempSvg.attributes['height'] = new svg.Property('height', rootView.height);\r\n                        tempSvg.children = [group];\r\n                        var c = createCanvas(rootView.width, rootView.height);\r\n                        var tempCtx = c.getContext('2d');\r\n                        tempCtx.fillStyle = g;\r\n                        tempSvg.render(tempCtx);\r\n                        return tempCtx.createPattern(c, 'no-repeat');\r\n                    }\r\n\r\n                    return g;\r\n                };\r\n            };\r\n            svg.Element.GradientBase.prototype = new svg.Element.ElementBase;\r\n\r\n            // linear gradient element\r\n            svg.Element.linearGradient = function (node) {\r\n                this.base = svg.Element.GradientBase;\r\n                this.base(node);\r\n\r\n                this.attributesToInherit.push('x1');\r\n                this.attributesToInherit.push('y1');\r\n                this.attributesToInherit.push('x2');\r\n                this.attributesToInherit.push('y2');\r\n\r\n                this.getGradient = function (ctx, element) {\r\n                    var bb = this.gradientUnits() == 'objectBoundingBox' ? element.getBoundingBox(ctx) : null;\r\n\r\n                    if (!this.attribute('x1').hasValue() &&\r\n                        !this.attribute('y1').hasValue() &&\r\n                        !this.attribute('x2').hasValue() &&\r\n                        !this.attribute('y2').hasValue()) {\r\n                        this.attribute('x1', true).value = 0;\r\n                        this.attribute('y1', true).value = 0;\r\n                        this.attribute('x2', true).value = 1;\r\n                        this.attribute('y2', true).value = 0;\r\n                    }\r\n\r\n                    var x1 = (this.gradientUnits() == 'objectBoundingBox' ?\r\n                        bb.x() + bb.width() * this.attribute('x1').numValue() :\r\n                        this.attribute('x1').toPixels('x'));\r\n                    var y1 = (this.gradientUnits() == 'objectBoundingBox' ?\r\n                        bb.y() + bb.height() * this.attribute('y1').numValue() :\r\n                        this.attribute('y1').toPixels('y'));\r\n                    var x2 = (this.gradientUnits() == 'objectBoundingBox' ?\r\n                        bb.x() + bb.width() * this.attribute('x2').numValue() :\r\n                        this.attribute('x2').toPixels('x'));\r\n                    var y2 = (this.gradientUnits() == 'objectBoundingBox' ?\r\n                        bb.y() + bb.height() * this.attribute('y2').numValue() :\r\n                        this.attribute('y2').toPixels('y'));\r\n\r\n                    if (x1 == x2 && y1 == y2) return null;\r\n                    return ctx.createLinearGradient(x1, y1, x2, y2);\r\n                };\r\n            };\r\n            svg.Element.linearGradient.prototype = new svg.Element.GradientBase;\r\n\r\n            // radial gradient element\r\n            svg.Element.radialGradient = function (node) {\r\n                this.base = svg.Element.GradientBase;\r\n                this.base(node);\r\n\r\n                this.attributesToInherit.push('cx');\r\n                this.attributesToInherit.push('cy');\r\n                this.attributesToInherit.push('r');\r\n                this.attributesToInherit.push('fx');\r\n                this.attributesToInherit.push('fy');\r\n\r\n                this.getGradient = function (ctx, element) {\r\n                    var bb = element.getBoundingBox(ctx);\r\n\r\n                    if (!this.attribute('cx').hasValue()) this.attribute('cx', true).value = '50%';\r\n                    if (!this.attribute('cy').hasValue()) this.attribute('cy', true).value = '50%';\r\n                    if (!this.attribute('r').hasValue()) this.attribute('r', true).value = '50%';\r\n\r\n                    var cx = (this.gradientUnits() == 'objectBoundingBox' ?\r\n                        bb.x() + bb.width() * this.attribute('cx').numValue() :\r\n                        this.attribute('cx').toPixels('x'));\r\n                    var cy = (this.gradientUnits() == 'objectBoundingBox' ?\r\n                        bb.y() + bb.height() * this.attribute('cy').numValue() :\r\n                        this.attribute('cy').toPixels('y'));\r\n\r\n                    var fx = cx;\r\n                    var fy = cy;\r\n                    if (this.attribute('fx').hasValue()) {\r\n                        fx = (this.gradientUnits() == 'objectBoundingBox' ?\r\n                            bb.x() + bb.width() * this.attribute('fx').numValue() :\r\n                            this.attribute('fx').toPixels('x'));\r\n                    }\r\n                    if (this.attribute('fy').hasValue()) {\r\n                        fy = (this.gradientUnits() == 'objectBoundingBox' ?\r\n                            bb.y() + bb.height() * this.attribute('fy').numValue() :\r\n                            this.attribute('fy').toPixels('y'));\r\n                    }\r\n\r\n                    var r = (this.gradientUnits() == 'objectBoundingBox' ?\r\n                        (bb.width() + bb.height()) / 2.0 * this.attribute('r').numValue() :\r\n                        this.attribute('r').toPixels());\r\n\r\n                    return ctx.createRadialGradient(fx, fy, 0, cx, cy, r);\r\n                };\r\n            };\r\n            svg.Element.radialGradient.prototype = new svg.Element.GradientBase;\r\n\r\n            // gradient stop element\r\n            svg.Element.stop = function (node) {\r\n                this.base = svg.Element.ElementBase;\r\n                this.base(node);\r\n\r\n                this.offset = this.attribute('offset').numValue();\r\n                if (this.offset < 0) this.offset = 0;\r\n                if (this.offset > 1) this.offset = 1;\r\n\r\n                var stopColor = this.style('stop-color', true);\r\n                if (stopColor.value === '') stopColor.value = '#000';\r\n                if (this.style('stop-opacity').hasValue()) stopColor = stopColor.addOpacity(this.style('stop-opacity'));\r\n                this.color = stopColor.value;\r\n            };\r\n            svg.Element.stop.prototype = new svg.Element.ElementBase;\r\n\r\n            // animation base element\r\n            svg.Element.AnimateBase = function (node) {\r\n                this.base = svg.Element.ElementBase;\r\n                this.base(node);\r\n\r\n                svg.Animations.push(this);\r\n\r\n                this.duration = 0.0;\r\n                this.begin = this.attribute('begin').toMilliseconds();\r\n                this.maxDuration = this.begin + this.attribute('dur').toMilliseconds();\r\n\r\n                this.getProperty = function () {\r\n                    var attributeType = this.attribute('attributeType').value;\r\n                    var attributeName = this.attribute('attributeName').value;\r\n\r\n                    if (attributeType == 'CSS') {\r\n                        return this.parent.style(attributeName, true);\r\n                    }\r\n                    return this.parent.attribute(attributeName, true);\r\n                };\r\n\r\n                this.initialValue = null;\r\n                this.initialUnits = '';\r\n                this.removed = false;\r\n\r\n                this.calcValue = function () {\r\n                    // OVERRIDE ME!\r\n                    return '';\r\n                };\r\n\r\n                this.update = function (delta) {\r\n                    // set initial value\r\n                    if (this.initialValue == null) {\r\n                        this.initialValue = this.getProperty().value;\r\n                        this.initialUnits = this.getProperty().getUnits();\r\n                    }\r\n\r\n                    // if we're past the end time\r\n                    if (this.duration > this.maxDuration) {\r\n                        // loop for indefinitely repeating animations\r\n                        if (this.attribute('repeatCount').value == 'indefinite' ||\r\n                            this.attribute('repeatDur').value == 'indefinite') {\r\n                            this.duration = 0.0;\r\n                        } else if (this.attribute('fill').valueOrDefault('remove') == 'freeze' && !this.frozen) {\r\n                            this.frozen = true;\r\n                            this.parent.animationFrozen = true;\r\n                            this.parent.animationFrozenValue = this.getProperty().value;\r\n                        } else if (this.attribute('fill').valueOrDefault('remove') == 'remove' && !this.removed) {\r\n                            this.removed = true;\r\n                            this.getProperty().value = this.parent.animationFrozen ? this.parent.animationFrozenValue : this.initialValue;\r\n                            return true;\r\n                        }\r\n                        return false;\r\n                    }\r\n                    this.duration = this.duration + delta;\r\n\r\n                    // if we're past the begin time\r\n                    var updated = false;\r\n                    if (this.begin < this.duration) {\r\n                        var newValue = this.calcValue(); // tween\r\n\r\n                        if (this.attribute('type').hasValue()) {\r\n                            // for transform, etc.\r\n                            var type = this.attribute('type').value;\r\n                            newValue = type + '(' + newValue + ')';\r\n                        }\r\n\r\n                        this.getProperty().value = newValue;\r\n                        updated = true;\r\n                    }\r\n\r\n                    return updated;\r\n                };\r\n\r\n                this.from = this.attribute('from');\r\n                this.to = this.attribute('to');\r\n                this.values = this.attribute('values');\r\n                if (this.values.hasValue()) this.values.value = this.values.value.split(';');\r\n\r\n                // fraction of duration we've covered\r\n                this.progress = function () {\r\n                    var ret = { progress: (this.duration - this.begin) / (this.maxDuration - this.begin) };\r\n                    if (this.values.hasValue()) {\r\n                        var p = ret.progress * (this.values.value.length - 1);\r\n                        var lb = Math.floor(p),\r\n                            ub = Math.ceil(p);\r\n                        ret.from = new svg.Property('from', parseFloat(this.values.value[lb]));\r\n                        ret.to = new svg.Property('to', parseFloat(this.values.value[ub]));\r\n                        ret.progress = (p - lb) / (ub - lb);\r\n                    } else {\r\n                        ret.from = this.from;\r\n                        ret.to = this.to;\r\n                    }\r\n                    return ret;\r\n                };\r\n            };\r\n            svg.Element.AnimateBase.prototype = new svg.Element.ElementBase;\r\n\r\n            // animate element\r\n            svg.Element.animate = function (node) {\r\n                this.base = svg.Element.AnimateBase;\r\n                this.base(node);\r\n\r\n                this.calcValue = function () {\r\n                    var p = this.progress();\r\n\r\n                    // tween value linearly\r\n                    var newValue = p.from.numValue() + (p.to.numValue() - p.from.numValue()) * p.progress;\r\n                    return newValue + this.initialUnits;\r\n                };\r\n            };\r\n            svg.Element.animate.prototype = new svg.Element.AnimateBase;\r\n\r\n            // animate color element\r\n            svg.Element.animateColor = function (node) {\r\n                this.base = svg.Element.AnimateBase;\r\n                this.base(node);\r\n\r\n                this.calcValue = function () {\r\n                    var p = this.progress();\r\n                    var from = new rgbcolor(p.from.value);\r\n                    var to = new rgbcolor(p.to.value);\r\n\r\n                    if (from.ok && to.ok) {\r\n                        // tween color linearly\r\n                        var r = from.r + (to.r - from.r) * p.progress;\r\n                        var g = from.g + (to.g - from.g) * p.progress;\r\n                        var b = from.b + (to.b - from.b) * p.progress;\r\n                        return 'rgb(' + parseInt(r, 10) + ',' + parseInt(g, 10) + ',' + parseInt(b, 10) + ')';\r\n                    }\r\n                    return this.attribute('from').value;\r\n                };\r\n            };\r\n            svg.Element.animateColor.prototype = new svg.Element.AnimateBase;\r\n\r\n            // animate transform element\r\n            svg.Element.animateTransform = function (node) {\r\n                this.base = svg.Element.AnimateBase;\r\n                this.base(node);\r\n\r\n                this.calcValue = function () {\r\n                    var p = this.progress();\r\n\r\n                    // tween value linearly\r\n                    var from = svg.ToNumberArray(p.from.value);\r\n                    var to = svg.ToNumberArray(p.to.value);\r\n                    var newValue = '';\r\n                    for (var i = 0; i < from.length; i++) {\r\n                        newValue += from[i] + (to[i] - from[i]) * p.progress + ' ';\r\n                    }\r\n                    return newValue;\r\n                };\r\n            };\r\n            svg.Element.animateTransform.prototype = new svg.Element.animate;\r\n\r\n            // font element\r\n            svg.Element.font = function (node) {\r\n                this.base = svg.Element.ElementBase;\r\n                this.base(node);\r\n\r\n                this.horizAdvX = this.attribute('horiz-adv-x').numValue();\r\n\r\n                this.isRTL = false;\r\n                this.isArabic = false;\r\n                this.fontFace = null;\r\n                this.missingGlyph = null;\r\n                this.glyphs = [];\r\n                for (var i = 0; i < this.children.length; i++) {\r\n                    var child = this.children[i];\r\n                    if (child.type == 'font-face') {\r\n                        this.fontFace = child;\r\n                        if (child.style('font-family').hasValue()) {\r\n                            svg.Definitions[child.style('font-family').value] = this;\r\n                        }\r\n                    } else if (child.type == 'missing-glyph') this.missingGlyph = child;\r\n                    else if (child.type == 'glyph') {\r\n                        if (child.arabicForm != '') {\r\n                            this.isRTL = true;\r\n                            this.isArabic = true;\r\n                            if (typeof this.glyphs[child.unicode] == 'undefined') this.glyphs[child.unicode] = [];\r\n                            this.glyphs[child.unicode][child.arabicForm] = child;\r\n                        } else {\r\n                            this.glyphs[child.unicode] = child;\r\n                        }\r\n                    }\r\n                }\r\n\r\n                this.render = function(/* ctx */) {\r\n                    // NO RENDER\r\n                };\r\n            };\r\n            svg.Element.font.prototype = new svg.Element.ElementBase;\r\n\r\n            // font-face element\r\n            svg.Element.fontface = function (node) {\r\n                this.base = svg.Element.ElementBase;\r\n                this.base(node);\r\n\r\n                this.ascent = this.attribute('ascent').value;\r\n                this.descent = this.attribute('descent').value;\r\n                this.unitsPerEm = this.attribute('units-per-em').numValue();\r\n            };\r\n            svg.Element.fontface.prototype = new svg.Element.ElementBase;\r\n\r\n            // missing-glyph element\r\n            svg.Element.missingglyph = function (node) {\r\n                this.base = svg.Element.path;\r\n                this.base(node);\r\n\r\n                this.horizAdvX = 0;\r\n            };\r\n            svg.Element.missingglyph.prototype = new svg.Element.path;\r\n\r\n            // glyph element\r\n            svg.Element.glyph = function (node) {\r\n                this.base = svg.Element.path;\r\n                this.base(node);\r\n\r\n                this.horizAdvX = this.attribute('horiz-adv-x').numValue();\r\n                this.unicode = this.attribute('unicode').value;\r\n                this.arabicForm = this.attribute('arabic-form').value;\r\n            };\r\n            svg.Element.glyph.prototype = new svg.Element.path;\r\n\r\n            // text element\r\n            svg.Element.text = function (node) {\r\n                this.captureTextNodes = true;\r\n                this.base = svg.Element.RenderedElementBase;\r\n                this.base(node);\r\n\r\n                this.baseSetContext = this.setContext;\r\n                this.setContext = function (ctx) {\r\n                    this.baseSetContext(ctx);\r\n\r\n                    var textBaseline = this.style('dominant-baseline').toTextBaseline();\r\n                    if (textBaseline == null) textBaseline = this.style('alignment-baseline').toTextBaseline();\r\n                    if (textBaseline != null) ctx.textBaseline = textBaseline;\r\n                };\r\n\r\n                this.initializeCoordinates = function (ctx) {\r\n                    this.x = this.attribute('x').toPixels('x');\r\n                    this.y = this.attribute('y').toPixels('y');\r\n                    if (this.attribute('dx').hasValue()) this.x += this.attribute('dx').toPixels('x');\r\n                    if (this.attribute('dy').hasValue()) this.y += this.attribute('dy').toPixels('y');\r\n                    this.x += this.getAnchorDelta(ctx, this, 0);\r\n                };\r\n\r\n                this.getBoundingBox = function (ctx) {\r\n                    this.initializeCoordinates(ctx);\r\n                    var bb = null;\r\n                    for (var i = 0; i < this.children.length; i++) {\r\n                        var childBB = this.getChildBoundingBox(ctx, this, this, i);\r\n                        if (bb == null) bb = childBB;\r\n                        else bb.addBoundingBox(childBB);\r\n                    }\r\n                    return bb;\r\n                };\r\n\r\n                this.renderChildren = function (ctx) {\r\n                    this.initializeCoordinates(ctx);\r\n                    for (var i = 0; i < this.children.length; i++) {\r\n                        this.renderChild(ctx, this, this, i);\r\n                    }\r\n                };\r\n\r\n                this.getAnchorDelta = function (ctx, parent, startI) {\r\n                    var textAnchor = this.style('text-anchor').valueOrDefault('start');\r\n                    if (textAnchor != 'start') {\r\n                        var width = 0;\r\n                        for (var i = startI; i < parent.children.length; i++) {\r\n                            var child = parent.children[i];\r\n                            if (i > startI && child.attribute('x').hasValue()) break; // new group\r\n                            width += child.measureTextRecursive(ctx);\r\n                        }\r\n                        return -1 * (textAnchor == 'end' ? width : width / 2.0);\r\n                    }\r\n                    return 0;\r\n                };\r\n\r\n                this.adjustChildCoordinates = function(ctx, textParent, parent, i) {\r\n                    var child = parent.children[i];\r\n\r\n                    if (child.attribute('x').hasValue()) {\r\n                        child.x = child.attribute('x').toPixels('x') + textParent.getAnchorDelta(ctx, parent, i);\r\n                        if (child.attribute('dx').hasValue()) child.x += child.attribute('dx').toPixels('x');\r\n                    } else {\r\n                        if (child.attribute('dx').hasValue()) textParent.x += child.attribute('dx').toPixels('x');\r\n                        child.x = textParent.x;\r\n                    }\r\n                    textParent.x = child.x + child.measureText(ctx);\r\n\r\n                    if (child.attribute('y').hasValue()) {\r\n                        child.y = child.attribute('y').toPixels('y');\r\n                        if (child.attribute('dy').hasValue()) child.y += child.attribute('dy').toPixels('y');\r\n                    } else {\r\n                        if (child.attribute('dy').hasValue()) textParent.y += child.attribute('dy').toPixels('y');\r\n                        child.y = textParent.y;\r\n                    }\r\n                    textParent.y = child.y;\r\n\r\n                    return child;\r\n                };\r\n\r\n                this.getChildBoundingBox = function (ctx, textParent, parent, i) {\r\n                    var child = this.adjustChildCoordinates(ctx, textParent, parent, i);\r\n                    var bb = child.getBoundingBox(ctx);\r\n\r\n                    for (var i = 0; i < child.children.length; i++) {\r\n                        var childBB = textParent.getChildBoundingBox(ctx, textParent, child, i);\r\n                        bb.addBoundingBox(childBB);\r\n                    }\r\n\r\n                    return bb;\r\n                };\r\n\r\n                this.renderChild = function (ctx, textParent, parent, i) {\r\n                    var child = this.adjustChildCoordinates(ctx, textParent, parent, i);\r\n                    child.render(ctx);\r\n\r\n                    for (var i = 0; i < child.children.length; i++) {\r\n                        textParent.renderChild(ctx, textParent, child, i);\r\n                    }\r\n                };\r\n            };\r\n            svg.Element.text.prototype = new svg.Element.RenderedElementBase;\r\n\r\n            // text base\r\n            svg.Element.TextElementBase = function (node) {\r\n                this.base = svg.Element.RenderedElementBase;\r\n                this.base(node);\r\n\r\n                this.getGlyph = function (font, text, i) {\r\n                    var c = text[i];\r\n                    var glyph = null;\r\n                    if (font.isArabic) {\r\n                        var arabicForm = 'isolated';\r\n                        if ((i == 0 || text[i - 1] == ' ') && i < text.length - 2 && text[i + 1] != ' ') arabicForm = 'terminal';\r\n                        if (i > 0 && text[i - 1] != ' ' && i < text.length - 2 && text[i + 1] != ' ') arabicForm = 'medial';\r\n                        if (i > 0 && text[i - 1] != ' ' && (i == text.length - 1 || text[i + 1] == ' ')) arabicForm = 'initial';\r\n                        if (typeof font.glyphs[c] != 'undefined') {\r\n                            glyph = font.glyphs[c][arabicForm];\r\n                            if (glyph == null && font.glyphs[c].type == 'glyph') glyph = font.glyphs[c];\r\n                        }\r\n                    } else {\r\n                        glyph = font.glyphs[c];\r\n                    }\r\n                    if (glyph == null) glyph = font.missingGlyph;\r\n                    return glyph;\r\n                };\r\n\r\n                this.renderChildren = function (ctx) {\r\n                    var customFont = this.parent.style('font-family').getDefinition();\r\n                    if (customFont != null) {\r\n                        var fontSize = this.parent.style('font-size').numValueOrDefault(svg.Font.Parse(svg.ctx.font).fontSize);\r\n                        var fontStyle = this.parent.style('font-style').valueOrDefault(svg.Font.Parse(svg.ctx.font).fontStyle);\r\n                        var text = this.getText();\r\n                        if (customFont.isRTL) text = text.split('').reverse().join('');\r\n\r\n                        var dx = svg.ToNumberArray(this.parent.attribute('dx').value);\r\n                        for (var i = 0; i < text.length; i++) {\r\n                            var glyph = this.getGlyph(customFont, text, i);\r\n                            var scale = fontSize / customFont.fontFace.unitsPerEm;\r\n                            ctx.translate(this.x, this.y);\r\n                            ctx.scale(scale, -scale);\r\n                            var lw = ctx.lineWidth;\r\n                            ctx.lineWidth = ctx.lineWidth * customFont.fontFace.unitsPerEm / fontSize;\r\n                            if (fontStyle == 'italic') ctx.transform(1, 0, .4, 1, 0, 0);\r\n                            glyph.render(ctx);\r\n                            if (fontStyle == 'italic') ctx.transform(1, 0, -.4, 1, 0, 0);\r\n                            ctx.lineWidth = lw;\r\n                            ctx.scale(1 / scale, -1 / scale);\r\n                            ctx.translate(-this.x, -this.y);\r\n\r\n                            this.x += fontSize * (glyph.horizAdvX || customFont.horizAdvX) / customFont.fontFace.unitsPerEm;\r\n                            if (typeof dx[i] != 'undefined' && !isNaN(dx[i])) {\r\n                                this.x += dx[i];\r\n                            }\r\n                        }\r\n                        return;\r\n                    }\r\n                    if (ctx.paintOrder == 'stroke') {\r\n                        if (ctx.strokeStyle != '') ctx.strokeText(svg.compressSpaces(this.getText()), this.x, this.y);\r\n                        if (ctx.fillStyle != '') ctx.fillText(svg.compressSpaces(this.getText()), this.x, this.y);\r\n                    } else {\r\n                        if (ctx.fillStyle != '') ctx.fillText(svg.compressSpaces(this.getText()), this.x, this.y);\r\n                        if (ctx.strokeStyle != '') ctx.strokeText(svg.compressSpaces(this.getText()), this.x, this.y);\r\n                    }\r\n                };\r\n\r\n                this.getText = function () {\r\n                    // OVERRIDE ME\r\n                };\r\n\r\n                this.measureTextRecursive = function (ctx) {\r\n                    var width = this.measureText(ctx);\r\n                    for (var i = 0; i < this.children.length; i++) {\r\n                        width += this.children[i].measureTextRecursive(ctx);\r\n                    }\r\n                    return width;\r\n                };\r\n\r\n                this.measureText = function (ctx) {\r\n                    var customFont = this.parent.style('font-family').getDefinition();\r\n                    if (customFont != null) {\r\n                        var fontSize = this.parent.style('font-size').numValueOrDefault(svg.Font.Parse(svg.ctx.font).fontSize);\r\n                        var measure = 0;\r\n                        var text = this.getText();\r\n                        if (customFont.isRTL) text = text.split('').reverse().join('');\r\n                        var dx = svg.ToNumberArray(this.parent.attribute('dx').value);\r\n                        for (var i = 0; i < text.length; i++) {\r\n                            var glyph = this.getGlyph(customFont, text, i);\r\n                            measure += (glyph.horizAdvX || customFont.horizAdvX) * fontSize / customFont.fontFace.unitsPerEm;\r\n                            if (typeof dx[i] != 'undefined' && !isNaN(dx[i])) {\r\n                                measure += dx[i];\r\n                            }\r\n                        }\r\n                        return measure;\r\n                    }\r\n\r\n                    var textToMeasure = svg.compressSpaces(this.getText());\r\n                    if (!ctx.measureText) return textToMeasure.length * 10;\r\n\r\n                    ctx.save();\r\n                    this.setContext(ctx, true);\r\n                    var width = ctx.measureText(textToMeasure).width;\r\n                    ctx.restore();\r\n                    return width;\r\n                };\r\n\r\n                this.getBoundingBox = function (ctx) {\r\n                    var fontSize = this.parent.style('font-size').numValueOrDefault(svg.Font.Parse(svg.ctx.font).fontSize);\r\n                    return new svg.BoundingBox(this.x, this.y - fontSize, this.x + this.measureText(ctx), this.y);\r\n                };\r\n            };\r\n            svg.Element.TextElementBase.prototype = new svg.Element.RenderedElementBase;\r\n\r\n            // tspan\r\n            svg.Element.tspan = function (node) {\r\n                this.captureTextNodes = true;\r\n                this.base = svg.Element.TextElementBase;\r\n                this.base(node);\r\n\r\n                this.text = svg.compressSpaces(node.value || node.text || node.textContent || '');\r\n                this.getText = function () {\r\n                    // if this node has children, then they own the text\r\n                    if (this.children.length > 0) { return ''; }\r\n                    return this.text;\r\n                };\r\n            };\r\n            svg.Element.tspan.prototype = new svg.Element.TextElementBase;\r\n\r\n            // tref\r\n            svg.Element.tref = function (node) {\r\n                this.base = svg.Element.TextElementBase;\r\n                this.base(node);\r\n\r\n                this.getText = function () {\r\n                    var element = this.getHrefAttribute().getDefinition();\r\n                    if (element != null) return element.children[0].getText();\r\n                };\r\n            };\r\n            svg.Element.tref.prototype = new svg.Element.TextElementBase;\r\n\r\n            // a element\r\n            svg.Element.a = function (node) {\r\n                this.base = svg.Element.TextElementBase;\r\n                this.base(node);\r\n\r\n                this.hasText = node.childNodes.length > 0;\r\n                for (var i = 0; i < node.childNodes.length; i++) {\r\n                    if (node.childNodes[i].nodeType != 3) this.hasText = false;\r\n                }\r\n\r\n                // this might contain text\r\n                this.text = this.hasText ? node.childNodes[0].value || node.childNodes[0].data : '';\r\n                this.getText = function () {\r\n                    return this.text;\r\n                };\r\n\r\n                this.baseRenderChildren = this.renderChildren;\r\n                this.renderChildren = function (ctx) {\r\n                    if (this.hasText) {\r\n                        // render as text element\r\n                        this.baseRenderChildren(ctx);\r\n                        var fontSize = new svg.Property('fontSize', svg.Font.Parse(svg.ctx.font).fontSize);\r\n                        svg.Mouse.checkBoundingBox(this, new svg.BoundingBox(this.x, this.y - fontSize.toPixels('y'), this.x + this.measureText(ctx), this.y));\r\n                    } else if (this.children.length > 0) {\r\n                        // render as temporary group\r\n                        var g = new svg.Element.g();\r\n                        g.children = this.children;\r\n                        g.parent = this;\r\n                        g.render(ctx);\r\n                    }\r\n                };\r\n\r\n                this.onclick = function () {\r\n                    windowEnv.open(this.getHrefAttribute().value);\r\n                };\r\n\r\n                this.onmousemove = function () {\r\n                    svg.ctx.canvas.style.cursor = 'pointer';\r\n                };\r\n            };\r\n            svg.Element.a.prototype = new svg.Element.TextElementBase;\r\n\r\n            // image element\r\n            svg.Element.image = function (node) {\r\n                this.base = svg.Element.RenderedElementBase;\r\n                this.base(node);\r\n\r\n                var href = this.getHrefAttribute().value;\r\n                if (href == '') { return; }\r\n                var isSvg = href.match(/\\.svg$/);\r\n\r\n                svg.Images.push(this);\r\n                this.loaded = false;\r\n                if (!isSvg) {\r\n                    this.img = doc.createElement('img');\r\n                    if (svg.opts['useCORS'] == true) { this.img.crossOrigin = 'Anonymous'; }\r\n                    var self = this;\r\n                    this.img.onload = function () { self.loaded = true; };\r\n                    this.img.onerror = function () {\r\n                        svg.log('ERROR: image \"' + href + '\" not found');\r\n                        self.loaded = true;\r\n                    };\r\n                    this.img.src = href;\r\n                } else {\r\n                    this.img = svg.ajax(href);\r\n                    this.loaded = true;\r\n                }\r\n\r\n                this.renderChildren = function (ctx) {\r\n                    var x = this.attribute('x').toPixels('x');\r\n                    var y = this.attribute('y').toPixels('y');\r\n\r\n                    var width = this.attribute('width').toPixels('x');\r\n                    var height = this.attribute('height').toPixels('y');\r\n                    if (width == 0 || height == 0) return;\r\n\r\n                    ctx.save();\r\n                    if (isSvg) {\r\n                        ctx.drawSvg(this.img, x, y, width, height);\r\n                    } else {\r\n                        ctx.translate(x, y);\r\n                        svg.AspectRatio(ctx,\r\n                            this.attribute('preserveAspectRatio').value,\r\n                            width,\r\n                            this.img.width,\r\n                            height,\r\n                            this.img.height,\r\n                            0,\r\n                            0);\r\n                        if (self.loaded) {\r\n                            if (this.img.complete === undefined || this.img.complete) {\r\n                                ctx.drawImage(this.img, 0, 0);\r\n                            }\r\n                        }\r\n                    }\r\n                    ctx.restore();\r\n                };\r\n\r\n                this.getBoundingBox = function () {\r\n                    var x = this.attribute('x').toPixels('x');\r\n                    var y = this.attribute('y').toPixels('y');\r\n                    var width = this.attribute('width').toPixels('x');\r\n                    var height = this.attribute('height').toPixels('y');\r\n                    return new svg.BoundingBox(x, y, x + width, y + height);\r\n                };\r\n            };\r\n            svg.Element.image.prototype = new svg.Element.RenderedElementBase;\r\n\r\n            // group element\r\n            svg.Element.g = function (node) {\r\n                this.base = svg.Element.RenderedElementBase;\r\n                this.base(node);\r\n\r\n                this.getBoundingBox = function (ctx) {\r\n                    var bb = new svg.BoundingBox();\r\n                    for (var i = 0; i < this.children.length; i++) {\r\n                        bb.addBoundingBox(this.children[i].getBoundingBox(ctx));\r\n                    }\r\n                    return bb;\r\n                };\r\n            };\r\n            svg.Element.g.prototype = new svg.Element.RenderedElementBase;\r\n\r\n            // symbol element\r\n            svg.Element.symbol = function (node) {\r\n                this.base = svg.Element.RenderedElementBase;\r\n                this.base(node);\r\n\r\n                this.render = function (/* ctx */) {\r\n                    // NO RENDER\r\n                };\r\n            };\r\n            svg.Element.symbol.prototype = new svg.Element.RenderedElementBase;\r\n\r\n            // style element\r\n            svg.Element.style = function (node) {\r\n                this.base = svg.Element.ElementBase;\r\n                this.base(node);\r\n\r\n                // text, or spaces then CDATA\r\n                var css = '';\r\n                for (var i = 0; i < node.childNodes.length; i++) {\r\n                    css += node.childNodes[i].data;\r\n                }\r\n                css = css.replace(/(\\/\\*([^*]|[\\r\\n]|(\\*+([^*\\/]|[\\r\\n])))*\\*+\\/)|(^[\\s]*\\/\\/.*)/gm, ''); // remove comments\r\n                css = svg.compressSpaces(css); // replace whitespace\r\n                var cssDefs = css.split('}');\r\n                for (var i = 0; i < cssDefs.length; i++) {\r\n                    if (svg.trim(cssDefs[i]) != '') {\r\n                        var cssDef = cssDefs[i].split('{');\r\n                        var cssClasses = cssDef[0].split(',');\r\n                        var cssProps = cssDef[1].split(';');\r\n                        for (var j = 0; j < cssClasses.length; j++) {\r\n                            var cssClass = svg.trim(cssClasses[j]);\r\n                            if (cssClass != '') {\r\n                                var props = svg.Styles[cssClass] || {};\r\n                                for (var k = 0; k < cssProps.length; k++) {\r\n                                    var prop = cssProps[k].indexOf(':');\r\n                                    var name = cssProps[k].substr(0, prop);\r\n                                    var value = cssProps[k].substr(prop + 1, cssProps[k].length - prop);\r\n                                    if (name != null && value != null) {\r\n                                        props[svg.trim(name)] = new svg.Property(svg.trim(name), svg.trim(value));\r\n                                    }\r\n                                }\r\n                                svg.Styles[cssClass] = props;\r\n                                svg.StylesSpecificity[cssClass] = getSelectorSpecificity(cssClass);\r\n                                if (cssClass == '@font-face' && !nodeEnv) {\r\n                                    var fontFamily = props['font-family'].value.replace(/\"/g, '');\r\n                                    var srcs = props['src'].value.split(',');\r\n                                    for (var s = 0; s < srcs.length; s++) {\r\n                                        if (srcs[s].indexOf('format(\"svg\")') > 0) {\r\n                                            var urlStart = srcs[s].indexOf('url');\r\n                                            var urlEnd = srcs[s].indexOf(')', urlStart);\r\n                                            var url = srcs[s].substr(urlStart + 5, urlEnd - urlStart - 6);\r\n                                            var doc = svg.parseXml(svg.ajax(url));\r\n                                            var fonts = doc.getElementsByTagName('font');\r\n                                            for (var f = 0; f < fonts.length; f++) {\r\n                                                var font = svg.CreateElement(fonts[f]);\r\n                                                svg.Definitions[fontFamily] = font;\r\n                                            }\r\n                                        }\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            };\r\n            svg.Element.style.prototype = new svg.Element.ElementBase;\r\n\r\n            // use element\r\n            svg.Element.use = function (node) {\r\n                this.base = svg.Element.RenderedElementBase;\r\n                this.base(node);\r\n\r\n                this.baseSetContext = this.setContext;\r\n                this.setContext = function (ctx) {\r\n                    this.baseSetContext(ctx);\r\n                    if (this.attribute('x').hasValue()) ctx.translate(this.attribute('x').toPixels('x'), 0);\r\n                    if (this.attribute('y').hasValue()) ctx.translate(0, this.attribute('y').toPixels('y'));\r\n                };\r\n\r\n                var element = this.getHrefAttribute().getDefinition();\r\n\r\n                this.path = function (ctx) {\r\n                    if (element != null) element.path(ctx);\r\n                };\r\n\r\n                this.elementTransform = function () {\r\n                    if (element != null && element.style('transform', false, true).hasValue()) {\r\n                        return new svg.Transform(element.style('transform', false, true).value);\r\n                    }\r\n                };\r\n\r\n                this.getBoundingBox = function (ctx) {\r\n                    if (element != null) return element.getBoundingBox(ctx);\r\n                };\r\n\r\n                this.renderChildren = function (ctx) {\r\n                    if (element != null) {\r\n                        var tempSvg = element;\r\n                        if (element.type == 'symbol') {\r\n                            // render me using a temporary svg element in symbol cases (http://www.w3.org/TR/SVG/struct.html#UseElement)\r\n                            tempSvg = new svg.Element.svg();\r\n                            tempSvg.type = 'svg';\r\n                            tempSvg.attributes['viewBox'] = new svg.Property('viewBox', element.attribute('viewBox').value);\r\n                            tempSvg.attributes['preserveAspectRatio'] = new svg.Property('preserveAspectRatio', element.attribute('preserveAspectRatio').value);\r\n                            tempSvg.attributes['overflow'] = new svg.Property('overflow', element.attribute('overflow').value);\r\n                            tempSvg.children = element.children;\r\n                        }\r\n                        if (tempSvg.type == 'svg') {\r\n                            // if symbol or svg, inherit width/height from me\r\n                            if (this.attribute('width').hasValue()) tempSvg.attributes['width'] = new svg.Property('width', this.attribute('width').value);\r\n                            if (this.attribute('height').hasValue()) tempSvg.attributes['height'] = new svg.Property('height', this.attribute('height').value);\r\n                        }\r\n                        var oldParent = tempSvg.parent;\r\n                        tempSvg.parent = null;\r\n                        tempSvg.render(ctx);\r\n                        tempSvg.parent = oldParent;\r\n                    }\r\n                };\r\n            };\r\n            svg.Element.use.prototype = new svg.Element.RenderedElementBase;\r\n\r\n            // mask element\r\n            svg.Element.mask = function (node) {\r\n                this.base = svg.Element.ElementBase;\r\n                this.base(node);\r\n\r\n                this.apply = function (ctx, element) {\r\n                    // render as temp svg\r\n                    var x = this.attribute('x').toPixels('x');\r\n                    var y = this.attribute('y').toPixels('y');\r\n                    var width = this.attribute('width').toPixels('x');\r\n                    var height = this.attribute('height').toPixels('y');\r\n\r\n                    if (width == 0 && height == 0) {\r\n                        var bb = new svg.BoundingBox();\r\n                        for (var i = 0; i < this.children.length; i++) {\r\n                            bb.addBoundingBox(this.children[i].getBoundingBox(ctx));\r\n                        }\r\n                        var x = Math.floor(bb.x1);\r\n                        var y = Math.floor(bb.y1);\r\n                        var width = Math.floor(bb.width());\r\n                        var height = Math.floor(bb.height());\r\n                    }\r\n\r\n                    // temporarily remove mask to avoid recursion\r\n                    var mask = element.style('mask').value;\r\n                    element.style('mask').value = '';\r\n\r\n                    var cMask = createCanvas(x + width, y + height);\r\n                    var maskCtx = cMask.getContext('2d');\r\n                    this.renderChildren(maskCtx);\r\n\r\n                    var c = createCanvas(x + width, y + height);\r\n                    var tempCtx = c.getContext('2d');\r\n                    element.render(tempCtx);\r\n                    tempCtx.globalCompositeOperation = 'destination-in';\r\n                    tempCtx.fillStyle = maskCtx.createPattern(cMask, 'no-repeat');\r\n                    tempCtx.fillRect(0, 0, x + width, y + height);\r\n\r\n                    ctx.fillStyle = tempCtx.createPattern(c, 'no-repeat');\r\n                    ctx.fillRect(0, 0, x + width, y + height);\r\n\r\n                    // reassign mask\r\n                    element.style('mask').value = mask;\r\n                };\r\n\r\n                this.render = function (/* ctx */) {\r\n                    // NO RENDER\r\n                };\r\n            };\r\n            svg.Element.mask.prototype = new svg.Element.ElementBase;\r\n\r\n            // clip element\r\n            svg.Element.clipPath = function (node) {\r\n                this.base = svg.Element.ElementBase;\r\n                this.base(node);\r\n\r\n                this.apply = function (ctx) {\r\n                    var hasContext2D = (typeof CanvasRenderingContext2D !== 'undefined');\r\n                    var oldBeginPath = ctx.beginPath;\r\n                    var oldClosePath = ctx.closePath;\r\n                    if (hasContext2D) {\r\n                        CanvasRenderingContext2D.prototype.beginPath = function () { };\r\n                        CanvasRenderingContext2D.prototype.closePath = function () { };\r\n                    }\r\n\r\n                    oldBeginPath.call(ctx);\r\n                    for (var i = 0; i < this.children.length; i++) {\r\n                        var child = this.children[i];\r\n                        if (typeof child.path != 'undefined') {\r\n                            var transform = typeof child.elementTransform != 'undefined' && child.elementTransform(); // handle <use />\r\n                            if (!transform && child.style('transform', false, true).hasValue()) {\r\n                                transform = new svg.Transform(child.style('transform', false, true).value);\r\n                            }\r\n                            if (transform) {\r\n                                transform.apply(ctx);\r\n                            }\r\n                            child.path(ctx);\r\n                            if (hasContext2D) {\r\n                                CanvasRenderingContext2D.prototype.closePath = oldClosePath;\r\n                            }\r\n                            if (transform) { transform.unapply(ctx); }\r\n                        }\r\n                    }\r\n                    oldClosePath.call(ctx);\r\n                    ctx.clip();\r\n                    if (hasContext2D) {\r\n                        CanvasRenderingContext2D.prototype.beginPath = oldBeginPath;\r\n                        CanvasRenderingContext2D.prototype.closePath = oldClosePath;\r\n                    }\r\n                };\r\n\r\n                this.render = function (/* ctx */) {\r\n                    // NO RENDER\r\n                };\r\n            };\r\n            svg.Element.clipPath.prototype = new svg.Element.ElementBase;\r\n\r\n            // filters\r\n            svg.Element.filter = function (node) {\r\n                this.base = svg.Element.ElementBase;\r\n                this.base(node);\r\n\r\n                this.apply = function (ctx, element) {\r\n                    // render as temp svg\r\n                    var bb = element.getBoundingBox(ctx);\r\n                    var x = Math.floor(bb.x1);\r\n                    var y = Math.floor(bb.y1);\r\n                    var width = Math.floor(bb.width());\r\n                    var height = Math.floor(bb.height());\r\n\r\n                    // temporarily remove filter to avoid recursion\r\n                    var filter = element.style('filter').value;\r\n                    element.style('filter').value = '';\r\n\r\n                    var px = 0,\r\n                        py = 0;\r\n                    for (var i = 0; i < this.children.length; i++) {\r\n                        var efd = this.children[i].extraFilterDistance || 0;\r\n                        px = Math.max(px, efd);\r\n                        py = Math.max(py, efd);\r\n                    }\r\n\r\n                    var c = createCanvas(width + 2 * px, height + 2 * py);\r\n                    var tempCtx = c.getContext('2d');\r\n                    tempCtx.translate(-x + px, -y + py);\r\n                    element.render(tempCtx);\r\n\r\n                    // apply filters\r\n                    for (var i = 0; i < this.children.length; i++) {\r\n                        if (typeof this.children[i].apply == 'function') {\r\n                            this.children[i].apply(tempCtx, 0, 0, width + 2 * px, height + 2 * py);\r\n                        }\r\n                    }\r\n\r\n                    // render on me\r\n                    ctx.drawImage(c, 0, 0, width + 2 * px, height + 2 * py, x - px, y - py, width + 2 * px, height + 2 * py);\r\n\r\n                    // reassign filter\r\n                    element.style('filter', true).value = filter;\r\n                };\r\n\r\n                this.render = function (/* ctx */) {\r\n                    // NO RENDER\r\n                };\r\n            };\r\n            svg.Element.filter.prototype = new svg.Element.ElementBase;\r\n\r\n            svg.Element.feDropShadow = function (node) {\r\n                this.base = svg.Element.ElementBase;\r\n                this.base(node);\r\n                this.addStylesFromStyleDefinition();\r\n\r\n                this.apply = function (/* ctx, x, y, width, height */) {\r\n                    // TODO: implement\r\n                };\r\n            };\r\n            svg.Element.feDropShadow.prototype = new svg.Element.ElementBase;\r\n\r\n            svg.Element.feMorphology = function (node) {\r\n                this.base = svg.Element.ElementBase;\r\n                this.base(node);\r\n\r\n                this.apply = function (/* ctx, x, y, width, height */) {\r\n                    // TODO: implement\r\n                };\r\n            };\r\n            svg.Element.feMorphology.prototype = new svg.Element.ElementBase;\r\n\r\n            svg.Element.feComposite = function (node) {\r\n                this.base = svg.Element.ElementBase;\r\n                this.base(node);\r\n\r\n                this.apply = function (/* ctx, x, y, width, height */) {\r\n                    // TODO: implement\r\n                };\r\n            };\r\n            svg.Element.feComposite.prototype = new svg.Element.ElementBase;\r\n\r\n            svg.Element.feColorMatrix = function (node) {\r\n                this.base = svg.Element.ElementBase;\r\n                this.base(node);\r\n\r\n                var matrix = svg.ToNumberArray(this.attribute('values').value);\r\n                switch (this.attribute('type').valueOrDefault('matrix')) { // http://www.w3.org/TR/SVG/filters.html#feColorMatrixElement\r\n                    case 'saturate':\r\n                        var s = matrix[0];\r\n                        matrix = [0.213 + 0.787 * s, 0.715 - 0.715 * s, 0.072 - 0.072 * s, 0, 0,\r\n                            0.213 - 0.213 * s, 0.715 + 0.285 * s, 0.072 - 0.072 * s, 0, 0,\r\n                            0.213 - 0.213 * s, 0.715 - 0.715 * s, 0.072 + 0.928 * s, 0, 0,\r\n                            0, 0, 0, 1, 0,\r\n                            0, 0, 0, 0, 1\r\n                        ];\r\n                        break;\r\n                    case 'hueRotate':\r\n                        var a = matrix[0] * Math.PI / 180.0;\r\n                        var c = function (m1, m2, m3) { return m1 + Math.cos(a) * m2 + Math.sin(a) * m3; };\r\n                        matrix = [c(0.213, 0.787, -0.213), c(0.715, -0.715, -0.715), c(0.072, -0.072, 0.928), 0, 0,\r\n                            c(0.213, -0.213, 0.143), c(0.715, 0.285, 0.140), c(0.072, -0.072, -0.283), 0, 0,\r\n                            c(0.213, -0.213, -0.787), c(0.715, -0.715, 0.715), c(0.072, 0.928, 0.072), 0, 0,\r\n                            0, 0, 0, 1, 0,\r\n                            0, 0, 0, 0, 1\r\n                        ];\r\n                        break;\r\n                    case 'luminanceToAlpha':\r\n                        matrix = [0, 0, 0, 0, 0,\r\n                            0, 0, 0, 0, 0,\r\n                            0, 0, 0, 0, 0,\r\n                            0.2125, 0.7154, 0.0721, 0, 0,\r\n                            0, 0, 0, 0, 1\r\n                        ];\r\n                        break;\r\n                }\r\n\r\n                function imGet(img, x, y, width, height, rgba) {\r\n                    return img[y * width * 4 + x * 4 + rgba];\r\n                }\r\n\r\n                function imSet(img, x, y, width, height, rgba, val) {\r\n                    img[y * width * 4 + x * 4 + rgba] = val;\r\n                }\r\n\r\n                function m(i, v) {\r\n                    var mi = matrix[i];\r\n                    return mi * (mi < 0 ? v - 255 : v);\r\n                }\r\n\r\n                this.apply = function (ctx, x, y, width, height) {\r\n                    // assuming x==0 && y==0 for now\r\n                    var srcData = ctx.getImageData(0, 0, width, height);\r\n                    for (var y = 0; y < height; y++) {\r\n                        for (var x = 0; x < width; x++) {\r\n                            var r = imGet(srcData.data, x, y, width, height, 0);\r\n                            var g = imGet(srcData.data, x, y, width, height, 1);\r\n                            var b = imGet(srcData.data, x, y, width, height, 2);\r\n                            var a = imGet(srcData.data, x, y, width, height, 3);\r\n                            imSet(srcData.data, x, y, width, height, 0, m(0, r) + m(1, g) + m(2, b) + m(3, a) + m(4, 1));\r\n                            imSet(srcData.data, x, y, width, height, 1, m(5, r) + m(6, g) + m(7, b) + m(8, a) + m(9, 1));\r\n                            imSet(srcData.data, x, y, width, height, 2, m(10, r) + m(11, g) + m(12, b) + m(13, a) + m(14, 1));\r\n                            imSet(srcData.data, x, y, width, height, 3, m(15, r) + m(16, g) + m(17, b) + m(18, a) + m(19, 1));\r\n                        }\r\n                    }\r\n                    ctx.clearRect(0, 0, width, height);\r\n                    ctx.putImageData(srcData, 0, 0);\r\n                };\r\n            };\r\n            svg.Element.feColorMatrix.prototype = new svg.Element.ElementBase;\r\n\r\n            svg.Element.feGaussianBlur = function (node) {\r\n                this.base = svg.Element.ElementBase;\r\n                this.base(node);\r\n\r\n                this.blurRadius = Math.floor(this.attribute('stdDeviation').numValue());\r\n                this.extraFilterDistance = this.blurRadius;\r\n\r\n                this.apply = function (ctx, x, y, width, height) {\r\n                    if (!stackblurCanvas || typeof stackblurCanvas.canvasRGBA === 'undefined') {\r\n                        svg.log('ERROR: StackBlur.js must be included for blur to work');\r\n                        return;\r\n                    }\r\n\r\n                    // StackBlur requires canvas be on document\r\n                    ctx.canvas.id = svg.UniqueId();\r\n                    {\r\n                        ctx.canvas.style.display = 'none';\r\n                        doc.body.appendChild(ctx.canvas);\r\n                    }\r\n                    stackblurCanvas.canvasRGBA(ctx.canvas, x, y, width, height, this.blurRadius);\r\n                    {\r\n                        doc.body.removeChild(ctx.canvas);\r\n                    }\r\n                };\r\n            };\r\n            svg.Element.feGaussianBlur.prototype = new svg.Element.ElementBase;\r\n\r\n            // title element, do nothing\r\n            svg.Element.title = function (/* node */) { };\r\n            svg.Element.title.prototype = new svg.Element.ElementBase;\r\n\r\n            // desc element, do nothing\r\n            svg.Element.desc = function (/* node */) { };\r\n            svg.Element.desc.prototype = new svg.Element.ElementBase;\r\n\r\n            svg.Element.MISSING = function (node) {\r\n                svg.log('ERROR: Element \\'' + node.nodeName + '\\' not yet implemented.');\r\n            };\r\n            svg.Element.MISSING.prototype = new svg.Element.ElementBase;\r\n\r\n            // element factory\r\n            svg.CreateElement = function (node) {\r\n                var className = node.nodeName.replace(/^[^:]+:/, ''); // remove namespace\r\n                className = className.replace(/\\-/g, ''); // remove dashes\r\n                var e = null;\r\n                if (typeof svg.Element[className] != 'undefined') {\r\n                    e = new svg.Element[className](node);\r\n                } else {\r\n                    e = new svg.Element.MISSING(node);\r\n                }\r\n\r\n                e.type = node.nodeName;\r\n                return e;\r\n            };\r\n\r\n            // load from url\r\n            svg.load = function (ctx, url) {\r\n                svg.loadXml(ctx, svg.ajax(url));\r\n            };\r\n\r\n            // load from xml\r\n            svg.loadXml = function (ctx, xml) {\r\n                svg.loadXmlDoc(ctx, svg.parseXml(xml));\r\n            };\r\n\r\n            svg.loadXmlDoc = function (ctx, dom) {\r\n                svg.init(ctx);\r\n\r\n                var mapXY = function (p) {\r\n                    var e = ctx.canvas;\r\n                    while (e) {\r\n                        p.x -= e.offsetLeft;\r\n                        p.y -= e.offsetTop;\r\n                        e = e.offsetParent;\r\n                    }\r\n                    if (windowEnv.scrollX) p.x += windowEnv.scrollX;\r\n                    if (windowEnv.scrollY) p.y += windowEnv.scrollY;\r\n                    return p;\r\n                };\r\n\r\n                // bind mouse\r\n                if (svg.opts['ignoreMouse'] != true) {\r\n                    ctx.canvas.onclick = function (e) {\r\n                        var p = mapXY(new svg.Point(e != null ? e.clientX : event.clientX, e != null ? e.clientY : event.clientY));\r\n                        svg.Mouse.onclick(p.x, p.y);\r\n                    };\r\n                    ctx.canvas.onmousemove = function (e) {\r\n                        var p = mapXY(new svg.Point(e != null ? e.clientX : event.clientX, e != null ? e.clientY : event.clientY));\r\n                        svg.Mouse.onmousemove(p.x, p.y);\r\n                    };\r\n                }\r\n\r\n                var e = svg.CreateElement(dom.documentElement);\r\n                e.root = true;\r\n                e.addStylesFromStyleDefinition();\r\n\r\n                // render loop\r\n                var isFirstRender = true;\r\n                var draw = function () {\r\n                    svg.ViewPort.Clear();\r\n                    if (ctx.canvas.parentNode) {\r\n                        svg.ViewPort.SetCurrent(ctx.canvas.parentNode.clientWidth, ctx.canvas.parentNode.clientHeight);\r\n                    } else {\r\n                        svg.ViewPort.SetCurrent(defaultClientWidth, defaultClientHeight);\r\n                    }\r\n\r\n                    if (svg.opts['ignoreDimensions'] != true) {\r\n                        // set canvas size\r\n                        if (e.style('width').hasValue()) {\r\n                            ctx.canvas.width = e.style('width').toPixels('x');\r\n                            if (ctx.canvas.style) { ctx.canvas.style.width = ctx.canvas.width + 'px'; }\r\n                        }\r\n                        if (e.style('height').hasValue()) {\r\n                            ctx.canvas.height = e.style('height').toPixels('y');\r\n                            if (ctx.canvas.style) { ctx.canvas.style.height = ctx.canvas.height + 'px'; }\r\n                        }\r\n                    }\r\n                    var cWidth = ctx.canvas.clientWidth || ctx.canvas.width;\r\n                    var cHeight = ctx.canvas.clientHeight || ctx.canvas.height;\r\n                    if (svg.opts['ignoreDimensions'] == true && e.style('width').hasValue() && e.style('height').hasValue()) {\r\n                        cWidth = e.style('width').toPixels('x');\r\n                        cHeight = e.style('height').toPixels('y');\r\n                    }\r\n                    svg.ViewPort.SetCurrent(cWidth, cHeight);\r\n\r\n                    if (svg.opts['offsetX'] != null) e.attribute('x', true).value = svg.opts['offsetX'];\r\n                    if (svg.opts['offsetY'] != null) e.attribute('y', true).value = svg.opts['offsetY'];\r\n                    if (svg.opts['scaleWidth'] != null || svg.opts['scaleHeight'] != null) {\r\n                        var xRatio = null,\r\n                            yRatio = null,\r\n                            viewBox = svg.ToNumberArray(e.attribute('viewBox').value);\r\n\r\n                        if (svg.opts['scaleWidth'] != null) {\r\n                            if (e.attribute('width').hasValue()) xRatio = e.attribute('width').toPixels('x') / svg.opts['scaleWidth'];\r\n                            else if (!isNaN(viewBox[2])) xRatio = viewBox[2] / svg.opts['scaleWidth'];\r\n                        }\r\n\r\n                        if (svg.opts['scaleHeight'] != null) {\r\n                            if (e.attribute('height').hasValue()) yRatio = e.attribute('height').toPixels('y') / svg.opts['scaleHeight'];\r\n                            else if (!isNaN(viewBox[3])) yRatio = viewBox[3] / svg.opts['scaleHeight'];\r\n                        }\r\n\r\n                        if (xRatio == null) { xRatio = yRatio; }\r\n                        if (yRatio == null) { yRatio = xRatio; }\r\n\r\n                        e.attribute('width', true).value = svg.opts['scaleWidth'];\r\n                        e.attribute('height', true).value = svg.opts['scaleHeight'];\r\n                        e.style('transform', true, true).value += ' scale(' + (1.0 / xRatio) + ',' + (1.0 / yRatio) + ')';\r\n                    }\r\n\r\n                    // clear and render\r\n                    if (svg.opts['ignoreClear'] != true) {\r\n                        ctx.clearRect(0, 0, cWidth, cHeight);\r\n                    }\r\n                    e.render(ctx);\r\n                    if (isFirstRender) {\r\n                        isFirstRender = false;\r\n                        if (typeof svg.opts['renderCallback'] == 'function') svg.opts['renderCallback'](dom);\r\n                    }\r\n                };\r\n\r\n                var waitingForImages = true;\r\n                if (svg.ImagesLoaded()) {\r\n                    waitingForImages = false;\r\n                    draw();\r\n                }\r\n                {\r\n                    //In node, in the most cases, we don't need the animation listener.\r\n                    svg.intervalID = setInterval(function () {\r\n                        var needUpdate = false;\r\n\r\n                        if (waitingForImages && svg.ImagesLoaded()) {\r\n                            waitingForImages = false;\r\n                            needUpdate = true;\r\n                        }\r\n\r\n                        // need update from mouse events?\r\n                        if (svg.opts['ignoreMouse'] != true) {\r\n                            needUpdate = needUpdate || svg.Mouse.hasEvents();\r\n                        }\r\n\r\n                        // need update from animations?\r\n                        if (svg.opts['ignoreAnimation'] != true) {\r\n                            for (var i = 0; i < svg.Animations.length; i++) {\r\n                                var needAnimationUpdate = svg.Animations[i].update(1000 / svg.FRAMERATE);\r\n                                needUpdate = needUpdate || needAnimationUpdate;\r\n                            }\r\n                        }\r\n\r\n                        // need update from redraw?\r\n                        if (typeof svg.opts['forceRedraw'] == 'function') {\r\n                            if (svg.opts['forceRedraw']() == true) needUpdate = true;\r\n                        }\r\n\r\n                        // render if needed\r\n                        if (needUpdate) {\r\n                            draw();\r\n                            svg.Mouse.runEvents(); // run and clear our events\r\n                        }\r\n                    }, 1000 / svg.FRAMERATE);\r\n                }\r\n            };\r\n\r\n            svg.stop = function () {\r\n                if (svg.intervalID) {\r\n                    clearInterval(svg.intervalID);\r\n                }\r\n            };\r\n\r\n            svg.Mouse = new (function () {\r\n                this.events = [];\r\n                this.hasEvents = function () { return this.events.length != 0; };\r\n\r\n                this.onclick = function (x, y) {\r\n                    this.events.push({\r\n                        type: 'onclick',\r\n                        x: x,\r\n                        y: y,\r\n                        run: function (e) { if (e.onclick) e.onclick(); }\r\n                    });\r\n                };\r\n\r\n                this.onmousemove = function (x, y) {\r\n                    this.events.push({\r\n                        type: 'onmousemove',\r\n                        x: x,\r\n                        y: y,\r\n                        run: function (e) { if (e.onmousemove) e.onmousemove(); }\r\n                    });\r\n                };\r\n\r\n                this.eventElements = [];\r\n\r\n                this.checkPath = function (element, ctx) {\r\n                    for (var i = 0; i < this.events.length; i++) {\r\n                        var e = this.events[i];\r\n                        if (ctx.isPointInPath && ctx.isPointInPath(e.x, e.y)) this.eventElements[i] = element;\r\n                    }\r\n                };\r\n\r\n                this.checkBoundingBox = function (element, bb) {\r\n                    for (var i = 0; i < this.events.length; i++) {\r\n                        var e = this.events[i];\r\n                        if (bb.isPointInBox(e.x, e.y)) this.eventElements[i] = element;\r\n                    }\r\n                };\r\n\r\n                this.runEvents = function () {\r\n                    svg.ctx.canvas.style.cursor = '';\r\n\r\n                    for (var i = 0; i < this.events.length; i++) {\r\n                        var e = this.events[i];\r\n                        var element = this.eventElements[i];\r\n                        while (element) {\r\n                            e.run(element);\r\n                            element = element.parent;\r\n                        }\r\n                    }\r\n\r\n                    // done running, clear\r\n                    this.events = [];\r\n                    this.eventElements = [];\r\n                };\r\n            });\r\n\r\n            return svg;\r\n        }\r\n\r\n        if (typeof CanvasRenderingContext2D != 'undefined') {\r\n            CanvasRenderingContext2D.prototype.drawSvg = function (s, dx, dy, dw, dh, opts) {\r\n                var cOpts = {\r\n                    ignoreMouse: true,\r\n                    ignoreAnimation: true,\r\n                    ignoreDimensions: true,\r\n                    ignoreClear: true,\r\n                    offsetX: dx,\r\n                    offsetY: dy,\r\n                    scaleWidth: dw,\r\n                    scaleHeight: dh\r\n                };\r\n\r\n                for (var prop in opts) {\r\n                    if (opts.hasOwnProperty(prop)) {\r\n                        cOpts[prop] = opts[prop];\r\n                    }\r\n                }\r\n                canvg(this.canvas, s, cOpts);\r\n            };\r\n        }\r\n\r\n        module.exports = canvg;\r\n    });\r\n\r\n    return canvg_1;\r\n\r\n})));","/**\r\n * A class to parse color values\r\n * @author Stoyan Stefanov <sstoo@gmail.com>\r\n * @link   http://www.phpied.com/rgb-color-parser-in-javascript/\r\n * @license Use it if you like it\r\n */\r\n\r\n(function ( global ) {\r\n\r\n    function RGBColor(color_string)\r\n    {\r\n        this.ok = false;\r\n\r\n        // strip any leading #\r\n        if (color_string.charAt(0) == '#') { // remove # if any\r\n            color_string = color_string.substr(1,6);\r\n        }\r\n\r\n        color_string = color_string.replace(/ /g,'');\r\n        color_string = color_string.toLowerCase();\r\n\r\n        // before getting into regexps, try simple matches\r\n        // and overwrite the input\r\n        var simple_colors = {\r\n            aliceblue: 'f0f8ff',\r\n            antiquewhite: 'faebd7',\r\n            aqua: '00ffff',\r\n            aquamarine: '7fffd4',\r\n            azure: 'f0ffff',\r\n            beige: 'f5f5dc',\r\n            bisque: 'ffe4c4',\r\n            black: '000000',\r\n            blanchedalmond: 'ffebcd',\r\n            blue: '0000ff',\r\n            blueviolet: '8a2be2',\r\n            brown: 'a52a2a',\r\n            burlywood: 'deb887',\r\n            cadetblue: '5f9ea0',\r\n            chartreuse: '7fff00',\r\n            chocolate: 'd2691e',\r\n            coral: 'ff7f50',\r\n            cornflowerblue: '6495ed',\r\n            cornsilk: 'fff8dc',\r\n            crimson: 'dc143c',\r\n            cyan: '00ffff',\r\n            darkblue: '00008b',\r\n            darkcyan: '008b8b',\r\n            darkgoldenrod: 'b8860b',\r\n            darkgray: 'a9a9a9',\r\n            darkgreen: '006400',\r\n            darkkhaki: 'bdb76b',\r\n            darkmagenta: '8b008b',\r\n            darkolivegreen: '556b2f',\r\n            darkorange: 'ff8c00',\r\n            darkorchid: '9932cc',\r\n            darkred: '8b0000',\r\n            darksalmon: 'e9967a',\r\n            darkseagreen: '8fbc8f',\r\n            darkslateblue: '483d8b',\r\n            darkslategray: '2f4f4f',\r\n            darkturquoise: '00ced1',\r\n            darkviolet: '9400d3',\r\n            deeppink: 'ff1493',\r\n            deepskyblue: '00bfff',\r\n            dimgray: '696969',\r\n            dodgerblue: '1e90ff',\r\n            feldspar: 'd19275',\r\n            firebrick: 'b22222',\r\n            floralwhite: 'fffaf0',\r\n            forestgreen: '228b22',\r\n            fuchsia: 'ff00ff',\r\n            gainsboro: 'dcdcdc',\r\n            ghostwhite: 'f8f8ff',\r\n            gold: 'ffd700',\r\n            goldenrod: 'daa520',\r\n            gray: '808080',\r\n            green: '008000',\r\n            greenyellow: 'adff2f',\r\n            honeydew: 'f0fff0',\r\n            hotpink: 'ff69b4',\r\n            indianred : 'cd5c5c',\r\n            indigo : '4b0082',\r\n            ivory: 'fffff0',\r\n            khaki: 'f0e68c',\r\n            lavender: 'e6e6fa',\r\n            lavenderblush: 'fff0f5',\r\n            lawngreen: '7cfc00',\r\n            lemonchiffon: 'fffacd',\r\n            lightblue: 'add8e6',\r\n            lightcoral: 'f08080',\r\n            lightcyan: 'e0ffff',\r\n            lightgoldenrodyellow: 'fafad2',\r\n            lightgrey: 'd3d3d3',\r\n            lightgreen: '90ee90',\r\n            lightpink: 'ffb6c1',\r\n            lightsalmon: 'ffa07a',\r\n            lightseagreen: '20b2aa',\r\n            lightskyblue: '87cefa',\r\n            lightslateblue: '8470ff',\r\n            lightslategray: '778899',\r\n            lightsteelblue: 'b0c4de',\r\n            lightyellow: 'ffffe0',\r\n            lime: '00ff00',\r\n            limegreen: '32cd32',\r\n            linen: 'faf0e6',\r\n            magenta: 'ff00ff',\r\n            maroon: '800000',\r\n            mediumaquamarine: '66cdaa',\r\n            mediumblue: '0000cd',\r\n            mediumorchid: 'ba55d3',\r\n            mediumpurple: '9370d8',\r\n            mediumseagreen: '3cb371',\r\n            mediumslateblue: '7b68ee',\r\n            mediumspringgreen: '00fa9a',\r\n            mediumturquoise: '48d1cc',\r\n            mediumvioletred: 'c71585',\r\n            midnightblue: '191970',\r\n            mintcream: 'f5fffa',\r\n            mistyrose: 'ffe4e1',\r\n            moccasin: 'ffe4b5',\r\n            navajowhite: 'ffdead',\r\n            navy: '000080',\r\n            oldlace: 'fdf5e6',\r\n            olive: '808000',\r\n            olivedrab: '6b8e23',\r\n            orange: 'ffa500',\r\n            orangered: 'ff4500',\r\n            orchid: 'da70d6',\r\n            palegoldenrod: 'eee8aa',\r\n            palegreen: '98fb98',\r\n            paleturquoise: 'afeeee',\r\n            palevioletred: 'd87093',\r\n            papayawhip: 'ffefd5',\r\n            peachpuff: 'ffdab9',\r\n            peru: 'cd853f',\r\n            pink: 'ffc0cb',\r\n            plum: 'dda0dd',\r\n            powderblue: 'b0e0e6',\r\n            purple: '800080',\r\n            red: 'ff0000',\r\n            rosybrown: 'bc8f8f',\r\n            royalblue: '4169e1',\r\n            saddlebrown: '8b4513',\r\n            salmon: 'fa8072',\r\n            sandybrown: 'f4a460',\r\n            seagreen: '2e8b57',\r\n            seashell: 'fff5ee',\r\n            sienna: 'a0522d',\r\n            silver: 'c0c0c0',\r\n            skyblue: '87ceeb',\r\n            slateblue: '6a5acd',\r\n            slategray: '708090',\r\n            snow: 'fffafa',\r\n            springgreen: '00ff7f',\r\n            steelblue: '4682b4',\r\n            tan: 'd2b48c',\r\n            teal: '008080',\r\n            thistle: 'd8bfd8',\r\n            tomato: 'ff6347',\r\n            turquoise: '40e0d0',\r\n            violet: 'ee82ee',\r\n            violetred: 'd02090',\r\n            wheat: 'f5deb3',\r\n            white: 'ffffff',\r\n            whitesmoke: 'f5f5f5',\r\n            yellow: 'ffff00',\r\n            yellowgreen: '9acd32'\r\n        };\r\n        for (var key in simple_colors) {\r\n            if (color_string == key) {\r\n                color_string = simple_colors[key];\r\n            }\r\n        }\r\n        // emd of simple type-in colors\r\n\r\n        // array of color definition objects\r\n        var color_defs = [\r\n            {\r\n                re: /^rgb\\((\\d{1,3}),\\s*(\\d{1,3}),\\s*(\\d{1,3})\\)$/,\r\n                example: ['rgb(123, 234, 45)', 'rgb(255,234,245)'],\r\n                process: function (bits){\r\n                    return [\r\n                        parseInt(bits[1]),\r\n                        parseInt(bits[2]),\r\n                        parseInt(bits[3])\r\n                    ];\r\n                }\r\n            },\r\n            {\r\n                re: /^(\\w{2})(\\w{2})(\\w{2})$/,\r\n                example: ['#00ff00', '336699'],\r\n                process: function (bits){\r\n                    return [\r\n                        parseInt(bits[1], 16),\r\n                        parseInt(bits[2], 16),\r\n                        parseInt(bits[3], 16)\r\n                    ];\r\n                }\r\n            },\r\n            {\r\n                re: /^(\\w{1})(\\w{1})(\\w{1})$/,\r\n                example: ['#fb0', 'f0f'],\r\n                process: function (bits){\r\n                    return [\r\n                        parseInt(bits[1] + bits[1], 16),\r\n                        parseInt(bits[2] + bits[2], 16),\r\n                        parseInt(bits[3] + bits[3], 16)\r\n                    ];\r\n                }\r\n            }\r\n        ];\r\n\r\n        // search through the definitions to find a match\r\n        for (var i = 0; i < color_defs.length; i++) {\r\n            var re = color_defs[i].re;\r\n            var processor = color_defs[i].process;\r\n            var bits = re.exec(color_string);\r\n            if (bits) {\r\n                channels = processor(bits);\r\n                this.r = channels[0];\r\n                this.g = channels[1];\r\n                this.b = channels[2];\r\n                this.ok = true;\r\n            }\r\n\r\n        }\r\n\r\n        // validate/cleanup values\r\n        this.r = (this.r < 0 || isNaN(this.r)) ? 0 : ((this.r > 255) ? 255 : this.r);\r\n        this.g = (this.g < 0 || isNaN(this.g)) ? 0 : ((this.g > 255) ? 255 : this.g);\r\n        this.b = (this.b < 0 || isNaN(this.b)) ? 0 : ((this.b > 255) ? 255 : this.b);\r\n\r\n        // some getters\r\n        this.toRGB = function () {\r\n            return 'rgb(' + this.r + ', ' + this.g + ', ' + this.b + ')';\r\n        }\r\n        this.toHex = function () {\r\n            var r = this.r.toString(16);\r\n            var g = this.g.toString(16);\r\n            var b = this.b.toString(16);\r\n            if (r.length == 1) r = '0' + r;\r\n            if (g.length == 1) g = '0' + g;\r\n            if (b.length == 1) b = '0' + b;\r\n            return '#' + r + g + b;\r\n        }\r\n\r\n        // help\r\n        this.getHelpXML = function () {\r\n\r\n            var examples = new Array();\r\n            // add regexps\r\n            for (var i = 0; i < color_defs.length; i++) {\r\n                var example = color_defs[i].example;\r\n                for (var j = 0; j < example.length; j++) {\r\n                    examples[examples.length] = example[j];\r\n                }\r\n            }\r\n            // add type-in colors\r\n            for (var sc in simple_colors) {\r\n                examples[examples.length] = sc;\r\n            }\r\n\r\n            var xml = document.createElement('ul');\r\n            xml.setAttribute('id', 'rgbcolor-examples');\r\n            for (var i = 0; i < examples.length; i++) {\r\n                try {\r\n                    var list_item = document.createElement('li');\r\n                    var list_color = new RGBColor(examples[i]);\r\n                    var example_div = document.createElement('div');\r\n                    example_div.style.cssText =\r\n                        'margin: 3px; '\r\n                        + 'border: 1px solid black; '\r\n                        + 'background:' + list_color.toHex() + '; '\r\n                        + 'color:' + list_color.toHex()\r\n                    ;\r\n                    example_div.appendChild(document.createTextNode('test'));\r\n                    var list_item_value = document.createTextNode(\r\n                        ' ' + examples[i] + ' -> ' + list_color.toRGB() + ' -> ' + list_color.toHex()\r\n                    );\r\n                    list_item.appendChild(example_div);\r\n                    list_item.appendChild(list_item_value);\r\n                    xml.appendChild(list_item);\r\n\r\n                } catch(e){}\r\n            }\r\n            return xml;\r\n\r\n        }\r\n\r\n    }\r\n\r\n    // export as AMD...\r\n    if ( typeof define !== 'undefined' && define.amd ) {\r\n        define( function () { return RGBColor; });\r\n    }\r\n\r\n    // ...or as browserify\r\n    else if ( typeof module !== 'undefined' && module.exports ) {\r\n        module.exports = RGBColor;\r\n    }\r\n\r\n    global.RGBColor = RGBColor;\r\n\r\n}( typeof window !== 'undefined' ? window : this ));","!function(t,e){\"object\"==typeof exports&&\"undefined\"!=typeof module?module.exports=e():\"function\"==typeof define&&define.amd?define(e):t.ResizeObserver=e()}(this,function(){\"use strict\";var t=function(){if(\"undefined\"!=typeof Map)return Map;function t(t,e){var n=-1;return t.some(function(t,i){return t[0]===e&&(n=i,!0)}),n}return function(){function e(){this.__entries__=[]}var n={size:{configurable:!0}};return n.size.get=function(){return this.__entries__.length},e.prototype.get=function(e){var n=t(this.__entries__,e),i=this.__entries__[n];return i&&i[1]},e.prototype.set=function(e,n){var i=t(this.__entries__,e);~i?this.__entries__[i][1]=n:this.__entries__.push([e,n])},e.prototype.delete=function(e){var n=this.__entries__,i=t(n,e);~i&&n.splice(i,1)},e.prototype.has=function(e){return!!~t(this.__entries__,e)},e.prototype.clear=function(){this.__entries__.splice(0)},e.prototype.forEach=function(t,e){void 0===e&&(e=null);for(var n=0,i=this.__entries__;n<i.length;n+=1){var r=i[n];t.call(e,r[1],r[0])}},Object.defineProperties(e.prototype,n),e}()}(),e=\"undefined\"!=typeof window&&\"undefined\"!=typeof document&&window.document===document,n=\"undefined\"!=typeof global&&global.Math===Math?global:\"undefined\"!=typeof self&&self.Math===Math?self:\"undefined\"!=typeof window&&window.Math===Math?window:Function(\"return this\")(),i=\"function\"==typeof requestAnimationFrame?requestAnimationFrame.bind(n):function(t){return setTimeout(function(){return t(Date.now())},1e3/60)},r=2,o=[\"top\",\"right\",\"bottom\",\"left\",\"width\",\"height\",\"size\",\"weight\"],s=\"undefined\"!=typeof MutationObserver,a=function(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(t,e){var n=!1,o=!1,s=0;function a(){n&&(n=!1,t()),o&&h()}function c(){i(a)}function h(){var t=Date.now();if(n){if(t-s<r)return;o=!0}else n=!0,o=!1,setTimeout(c,e);s=t}return h}(this.refresh.bind(this),20)};a.prototype.addObserver=function(t){~this.observers_.indexOf(t)||this.observers_.push(t),this.connected_||this.connect_()},a.prototype.removeObserver=function(t){var e=this.observers_,n=e.indexOf(t);~n&&e.splice(n,1),!e.length&&this.connected_&&this.disconnect_()},a.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},a.prototype.updateObservers_=function(){var t=this.observers_.filter(function(t){return t.gatherActive(),t.hasActive()});return t.forEach(function(t){return t.broadcastActive()}),t.length>0},a.prototype.connect_=function(){e&&!this.connected_&&(document.addEventListener(\"transitionend\",this.onTransitionEnd_),window.addEventListener(\"resize\",this.refresh),s?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener(\"DOMSubtreeModified\",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},a.prototype.disconnect_=function(){e&&this.connected_&&(document.removeEventListener(\"transitionend\",this.onTransitionEnd_),window.removeEventListener(\"resize\",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener(\"DOMSubtreeModified\",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},a.prototype.onTransitionEnd_=function(t){var e=t.propertyName;void 0===e&&(e=\"\"),o.some(function(t){return!!~e.indexOf(t)})&&this.refresh()},a.getInstance=function(){return this.instance_||(this.instance_=new a),this.instance_},a.instance_=null;var c=function(t,e){for(var n=0,i=Object.keys(e);n<i.length;n+=1){var r=i[n];Object.defineProperty(t,r,{value:e[r],enumerable:!1,writable:!1,configurable:!0})}return t},h=function(t){return t&&t.ownerDocument&&t.ownerDocument.defaultView||n},u=_(0,0,0,0);function f(t){return parseFloat(t)||0}function d(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];return e.reduce(function(e,n){return e+f(t[\"border-\"+n+\"-width\"])},0)}function p(t){var e=t.clientWidth,n=t.clientHeight;if(!e&&!n)return u;var i,r=h(t).getComputedStyle(t),o=function(t){for(var e={},n=0,i=[\"top\",\"right\",\"bottom\",\"left\"];n<i.length;n+=1){var r=i[n],o=t[\"padding-\"+r];e[r]=f(o)}return e}(r),s=o.left+o.right,a=o.top+o.bottom,c=f(r.width),p=f(r.height);if(\"border-box\"===r.boxSizing&&(Math.round(c+s)!==e&&(c-=d(r,\"left\",\"right\")+s),Math.round(p+a)!==n&&(p-=d(r,\"top\",\"bottom\")+a)),(i=t)!==h(i).document.documentElement){var v=Math.round(c+s)-e,l=Math.round(p+a)-n;1!==Math.abs(v)&&(c-=v),1!==Math.abs(l)&&(p-=l)}return _(o.left,o.top,c,p)}var v=\"undefined\"!=typeof SVGGraphicsElement?function(t){return t instanceof h(t).SVGGraphicsElement}:function(t){return t instanceof h(t).SVGElement&&\"function\"==typeof t.getBBox};function l(t){return e?v(t)?_(0,0,(n=t.getBBox()).width,n.height):p(t):u;var n}function _(t,e,n,i){return{x:t,y:e,width:n,height:i}}var b=function(t){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=_(0,0,0,0),this.target=t};b.prototype.isActive=function(){var t=l(this.target);return this.contentRect_=t,t.width!==this.broadcastWidth||t.height!==this.broadcastHeight},b.prototype.broadcastRect=function(){var t=this.contentRect_;return this.broadcastWidth=t.width,this.broadcastHeight=t.height,t};var m=function(t,e){var n,i,r,o,s,a,h,u=(i=(n=e).x,r=n.y,o=n.width,s=n.height,a=\"undefined\"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,h=Object.create(a.prototype),c(h,{x:i,y:r,width:o,height:s,top:r,right:i+o,bottom:s+r,left:i}),h);c(this,{target:t,contentRect:u})},y=function(e,n,i){if(this.activeObservations_=[],this.observations_=new t,\"function\"!=typeof e)throw new TypeError(\"The callback provided as parameter 1 is not a function.\");this.callback_=e,this.controller_=n,this.callbackCtx_=i};y.prototype.observe=function(t){if(!arguments.length)throw new TypeError(\"1 argument required, but only 0 present.\");if(\"undefined\"!=typeof Element&&Element instanceof Object){if(!(t instanceof h(t).Element))throw new TypeError('parameter 1 is not of type \"Element\".');var e=this.observations_;e.has(t)||(e.set(t,new b(t)),this.controller_.addObserver(this),this.controller_.refresh())}},y.prototype.unobserve=function(t){if(!arguments.length)throw new TypeError(\"1 argument required, but only 0 present.\");if(\"undefined\"!=typeof Element&&Element instanceof Object){if(!(t instanceof h(t).Element))throw new TypeError('parameter 1 is not of type \"Element\".');var e=this.observations_;e.has(t)&&(e.delete(t),e.size||this.controller_.removeObserver(this))}},y.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},y.prototype.gatherActive=function(){var t=this;this.clearActive(),this.observations_.forEach(function(e){e.isActive()&&t.activeObservations_.push(e)})},y.prototype.broadcastActive=function(){if(this.hasActive()){var t=this.callbackCtx_,e=this.activeObservations_.map(function(t){return new m(t.target,t.broadcastRect())});this.callback_.call(t,e,t),this.clearActive()}},y.prototype.clearActive=function(){this.activeObservations_.splice(0)},y.prototype.hasActive=function(){return this.activeObservations_.length>0};var g=\"undefined\"!=typeof WeakMap?new WeakMap:new t,w=function(t){if(!(this instanceof w))throw new TypeError(\"Cannot call a class as a function.\");if(!arguments.length)throw new TypeError(\"1 argument required, but only 0 present.\");var e=a.getInstance(),n=new y(t,e,this);g.set(this,n)};return[\"observe\",\"unobserve\",\"disconnect\"].forEach(function(t){w.prototype[t]=function(){return(e=g.get(this))[t].apply(e,arguments);var e}}),void 0!==n.ResizeObserver?n.ResizeObserver:w});","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","__webpack_require__.nc = undefined;","\r\n// These are all the supported markup types.\r\n\r\n    export const MARKUP_TYPE_ARROW = \"arrow\";\r\n    export const MARKUP_TYPE_TEXT = \"label\";\r\n    export const MARKUP_TYPE_RECTANGLE = \"rectangle\";\r\n    export const MARKUP_TYPE_CIRCLE = \"ellipse\";\r\n    export const MARKUP_TYPE_CLOUD = \"cloud\";\r\n    export const MARKUP_TYPE_FREEHAND = \"freehand\";\r\n    export const MARKUP_TYPE_HIGHLIGHT = \"highlight\";\r\n    export const MARKUP_TYPE_POLYLINE = \"polyline\";\r\n    export const MARKUP_TYPE_POLYCLOUD = \"polycloud\";\r\n    export const MARKUP_TYPE_CALLOUT = \"callout\";\r\n    export const MARKUP_TYPE_DIMENSION = \"dimension\";\r\n    export const MARKUP_TYPE_STAMP = \"stamp\";","'use strict';\r\n\r\n    /**\r\n     * Base class for all markup edit actions.\r\n     *\r\n     * EditActions encapsulate {@link Autodesk.Viewing.Extensions.Markups.Core.Markup|Markup}\r\n     * operations (such as creation, edition and deletion) that hook into the undo/redo system.\r\n     *\r\n     * The minimum set of methods to implement on an EditAction extension are:\r\n     * - execute()\r\n     * - undo()\r\n     * - redo()\r\n     *\r\n     * A good set of classes to check their implementation are:\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.CreateCircle|CreateCircle}.\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.DeleteCircle|DeleteCircle}.\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.SetCircle|SetCircle}.\r\n     *\r\n     * @tutorial feature_markup\r\n     * @constructor\r\n     * @memberof Autodesk.Viewing.Extensions.Markups.Core\r\n     *\r\n     * @param {Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore} editor\r\n     * @param {String} type - An identifier for the EditAction.\r\n     * @param {number} targetId - The id of the markup being affected.\r\n     */\r\n    export function EditAction(editor, type, targetId) {\r\n\r\n        this.type =  type;\r\n        this.editor = editor;\r\n        this.targetId = targetId;\r\n        this.addToHistory = true;\r\n        this.selectOnExecution = true;\r\n    }\r\n\r\n    /**\r\n     * Performs the action.\r\n     */\r\n    EditAction.prototype.execute = function() {\r\n\r\n        this.editor.actionManager.execute(this);\r\n    };\r\n\r\n    /**\r\n     * @abstract\r\n     */\r\n    EditAction.prototype.redo = function() {\r\n\r\n    };\r\n\r\n    /**\r\n     * @abstract\r\n     */\r\n    EditAction.prototype.undo = function() {\r\n\r\n    };\r\n\r\n    /**\r\n     * Provides a mechanism to merge consecutive actions of the same type.\r\n     * @param {Autodesk.Viewing.Extensions.Markups.Core.EditAction} action - Action to check if it can be merged with 'this'.\r\n     * @returns {boolean} Returns true if merge has been applied. Parameter will be discarded.\r\n     */\r\n    EditAction.prototype.merge = function(action) {\r\n\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * Provides a mechanism to check whether the action yields no results.\r\n     * @returns {boolean} Returns true if no changes happen with this action.\r\n     */\r\n    EditAction.prototype.isIdentity = function() {\r\n\r\n        return false;\r\n    };\r\n\r\n","\r\n/**\r\n * \r\n * @param {*} attributes \r\n * @param {*} editor \r\n */\r\nexport var createStyle = function(attributes, editor) {\r\n\r\n    var style = {};\r\n\r\n    for(var i = 0; i < attributes.length; ++i) {\r\n\r\n        style[attributes[i]] = null;\r\n    }\r\n\r\n    var defaults = getStyleDefaultValues(style, editor);\r\n\r\n    for(let i = 0; i < attributes.length; ++i) {\r\n\r\n        var attribute = attributes[i];\r\n        style[attribute] = defaults[attribute].values[defaults[attribute].default].value;\r\n    }\r\n\r\n    return style;\r\n};\r\n\r\n/**\r\n *\r\n * @param source\r\n * @param destination\r\n * @returns {*}\r\n */\r\nexport var copyStyle = function(source, destination) {\r\n\r\n    for(var attribute in destination) {\r\n        if (source.hasOwnProperty(attribute)) {\r\n            destination[attribute] = source[attribute];\r\n        }\r\n    }\r\n\r\n    return destination;\r\n};\r\n\r\n/**\r\n *\r\n * @param source\r\n * @param destination\r\n * @returns {*}\r\n */\r\nexport var isStyleEqual = function(source, destination) {\r\n\r\n    for(var attribute in destination) {\r\n        if (source.hasOwnProperty(attribute) && source[attribute] !== destination[attribute]) {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    return true;\r\n};\r\n\r\n/**\r\n *\r\n * @param source\r\n * @returns {{}}\r\n */\r\nexport var cloneStyle = function(source) {\r\n\r\n    var clone = {};\r\n\r\n    for(var attribute in source) {\r\n        clone[attribute] = source[attribute];\r\n    }\r\n\r\n    return clone;\r\n};\r\n\r\n/**\r\n *\r\n * @param style\r\n * @param editor\r\n * @returns {{}}\r\n */\r\nexport var getStyleDefaultValues = function(style, editor) {\r\n\r\n    function getWidths(normalWidth) {\r\n\r\n        return {\r\n            values: [\r\n                {name:'Thin', value: normalWidth / 3},\r\n                {name:'Normal', value: normalWidth},\r\n                {name:'Thick', value: normalWidth * 3},\r\n                {name:'Very Thick', value: normalWidth * 9}],\r\n            default: 1\r\n        };\r\n    }\r\n\r\n    function getLineJoins() {\r\n\r\n        return {\r\n            values: [\r\n                {name:'Miter', value: 'miter'},\r\n                {name:'Round', value: 'round'},\r\n                {name:'Bevel', value: 'bevel'}],\r\n            default: 0\r\n        };\r\n    }\r\n\r\n    function getFontSizes(normalWidth) {\r\n\r\n        return {\r\n            values: [\r\n                {name:'Thin', value: normalWidth / 2},\r\n                {name:'Normal', value: normalWidth},\r\n                {name:'Thick', value: normalWidth * 4}],\r\n            default: 1\r\n        };\r\n    }\r\n\r\n    function getColors() {\r\n\r\n        return {\r\n            values: [\r\n                {name:'red', value: '#ff0000'},\r\n                {name:'green', value: '#00ff00'},\r\n                {name:'blue', value: '#0000ff'},\r\n                {name:'white', value: '#ffffff'},\r\n                {name:'black', value: '#000000'},\r\n                {name:'yellow', value: '#ffff00'}],\r\n            default: 0\r\n        };\r\n    }\r\n\r\n    function getOpacities(defaultTransparent) {\r\n\r\n        return {\r\n            values: [\r\n                {name:'100%', value: 1.00},\r\n                {name:'75%', value:  0.75},\r\n                {name:'50%', value: 0.50},\r\n                {name:'25%', value: 0.25},\r\n                {name:'0%', value: 0.00}],\r\n            default: (defaultTransparent ? 4 : 0)\r\n        };\r\n    }\r\n\r\n    function getFontFamilies() {\r\n\r\n        // TODO: Localize?\r\n        // TODO: Validate fonts with design\r\n        // Source: http://www.webdesigndev.com/web-development/16-gorgeous-web-safe-fonts-to-use-with-css\r\n        return {\r\n            values:[\r\n                {name:'Arial', value: 'Arial'},\r\n                {name:'Arial Black', value: 'Arial Black'},\r\n                {name:'Arial Narrow', value: 'Arial Narrow'},\r\n                {name:'Century Gothic', value: 'Century Gothic'},\r\n                {name:'Courier New', value: 'Courier New'},\r\n                {name:'Georgia', value: 'Georgia'},\r\n                {name:'Impact', value: 'Impact'},\r\n                {name:'Lucida Console', value: 'Lucida Console'},\r\n                {name:'Tahoma', value: 'Tahoma'},\r\n                {name:'Verdana', value: 'Verdana'}\r\n            ],\r\n            default: 0\r\n        };\r\n    }\r\n\r\n    function getFontStyles() {\r\n        return {\r\n            values:[\r\n                {name:'Normal', value: 'normal'},\r\n                {name:'Italic', value: 'italic'}],\r\n            default: 0\r\n        };\r\n    }\r\n\r\n    function getFontWeights() {\r\n        return {\r\n            values:[\r\n                {name:'Normal', value: 'normal'},\r\n                {name:'Bold', value: 'bold'}],\r\n            default: 0};\r\n    }\r\n\r\n    function getSvgString() {\r\n        return {\r\n            values: [\r\n            {\r\n                name: 'DefaultValue',\r\n                value: '<svg height=\"100\" width=\"100\" viewBox=\"0 0 100 100\"><circle cx=\"50\" cy=\"50\" r=\"40\" stroke=\"black\" stroke-width=\"3\" fill=\"red\" /></svg>' }],\r\n        \r\n        \r\n            default: 0 };\r\n        \r\n    }\r\n    \r\n    var values = cloneStyle(style);\r\n    var normaStrokeWidth = editor.getStrokeWidth();\r\n    var normaFontWidth = editor.getFontWidth();\r\n\r\n    for(var attribute in values) {\r\n\r\n        switch(attribute) {\r\n            case 'stroke-width':\r\n                values[attribute] = getWidths(normaStrokeWidth);\r\n                break;\r\n\r\n            case 'stroke-linejoin':\r\n                values[attribute] = getLineJoins();\r\n                break;\r\n\r\n            case 'font-size':\r\n                values[attribute] = getFontSizes(normaFontWidth);\r\n                break;\r\n\r\n            case 'font-family':\r\n                values[attribute] = getFontFamilies();\r\n                break;\r\n\r\n            case 'font-style':\r\n                values[attribute] = getFontStyles();\r\n                break;\r\n\r\n            case 'font-weight':\r\n                values[attribute] = getFontWeights();\r\n                break;\r\n\r\n            case 'stroke-color':\r\n            case 'fill-color':\r\n                values[attribute] = getColors();\r\n                break;\r\n\r\n            case 'stroke-opacity':{\r\n                    let defaultTransparent = false;\r\n                    values[attribute] = getOpacities(defaultTransparent);\r\n                    break;\r\n                }\r\n\r\n            case 'fill-opacity':{\r\n                    let defaultTransparent = true;\r\n                    values[attribute] = getOpacities(defaultTransparent);\r\n                    break;\r\n                }\r\n                \r\n            case 'text-data':                        \r\n                values[attribute] = getSvgString();\r\n                break;\r\n\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n\r\n    return values;\r\n};\r\n","'use strict';\r\n\r\n    /**\r\n     * Fired whenever the drawing tool changes. For example, when the Arrow drawing\r\n     * tool changes into the Rectangle drawing tool.\r\n     * See {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#changeEditMode|MarkupsCore.changeEditMode()}\r\n     * for a list of all supported drawing tools (EditModes).\r\n     * \r\n     * @event Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore#EVENT_EDITMODE_CHANGED\r\n     * @type {string}\r\n     */\r\n    export const EVENT_EDITMODE_CHANGED = \"EVENT_EDITMODE_CHANGED\";\r\n\r\n    /**\r\n     * Fired when Edit mode has been enabled, which allows the end user to start\r\n     * drawing markups over the Viewer canvas.\r\n     * See also {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#enterEditMode|MarkupsCore.enterEditMode()}.\r\n     * \r\n     * @event Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore#EVENT_EDITMODE_ENTER\r\n     * @type {string}\r\n     */\r\n    export const EVENT_EDITMODE_ENTER = \"EVENT_EDITMODE_ENTER\";\r\n\r\n    /**\r\n     * Fired when Edit mode has been disabled, preventing the end user from\r\n     * drawing markups over the Viewer canvas.\r\n     * See also {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#leaveEditMode|MarkupsCore.leaveEditMode()}.\r\n     * \r\n     * @event Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore#EVENT_EDITMODE_LEAVE\r\n     * @type {string}\r\n     */\r\n    export const EVENT_EDITMODE_LEAVE = \"EVENT_EDITMODE_LEAVE\";\r\n\r\n    /**\r\n     * Fired when a drawn markup has been selected by the end user with a click command.\r\n     * \r\n     * @event Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore#EVENT_MARKUP_SELECTED\r\n     * @type {string}\r\n     */\r\n    export const EVENT_MARKUP_SELECTED = \"EVENT_MARKUP_SELECTED\";\r\n\r\n    /**\r\n     * Fired when a drawn markup is being dragged over the Viewer canvas.\r\n     * \r\n     * @event Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore#EVENT_MARKUP_DRAGGING\r\n     * @type {string}\r\n     */\r\n    export const EVENT_MARKUP_DRAGGING = \"EVENT_MARKUP_DRAGGING\";\r\n\r\n    /**\r\n     * Internal usage only.\r\n     * \r\n     * @event Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore#EVENT_MARKUP_ENTER_EDITION\r\n     * @type {string}\r\n     * @private\r\n     */\r\n    export const EVENT_MARKUP_ENTER_EDITION = \"EVENT_MARKUP_ENTER_EDITION\";\r\n\r\n    /**\r\n     * Internal usage only.\r\n     * \r\n     * @event Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore#EVENT_MARKUP_CANCEL_EDITION\r\n     * @type {string}\r\n     * @private\r\n     */\r\n    export const EVENT_MARKUP_CANCEL_EDITION = \"EVENT_MARKUP_CANCEL_EDITION\";\r\n\r\n    /**\r\n     * Internal usage only.\r\n     * \r\n     * @event Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore#EVENT_MARKUP_DELETE_EDITION\r\n     * @type {string}\r\n     * @private\r\n     */\r\n    export const EVENT_MARKUP_DELETE_EDITION = \"EVENT_MARKUP_DELETE_EDITION\";\r\n\r\n\r\n    /**\r\n     * Fired whenever a new undo or redo action is available.\r\n     */\r\n    export const EVENT_HISTORY_CHANGED = \"EVENT_HISTORY_CHANGED\";\r\n\r\n    /**\r\n     * Fired when a markup creation begins. \r\n     * For example, as soon as the user starts dragging with the mouse\r\n     * to draw an arrow on the screen.\r\n     */\r\n    export const EVENT_EDITMODE_CREATION_BEGIN = \"EVENT_EDITMODE_CREATION_BEGIN\";\r\n\r\n    /**\r\n     * Fired when a markup has been created.\r\n     * For example, as soon as the user stops dragging and releases the\r\n     * mouse button to finish drawing an arrow on the screen\r\n     */\r\n    export const EVENT_EDITMODE_CREATION_END = \"EVENT_EDITMODE_CREATION_END\";\r\n\r\n    /**\r\n     * Fired when a markup is no longer selected.\r\n     */\r\n    export const EVENT_MARKUP_DESELECT = \"EVENT_MARKUP_DESELECT\";\r\n\r\n    /**\r\n     * The selected markup is being modified\r\n     */\r\n    export const EVENT_EDITFRAME_EDITION_START = \"EVENT_EDITFRAME_EDITION_START\";\r\n\r\n    /**\r\n     * The selected markup is no longer being modified\r\n     */\r\n    export const EVENT_EDITFRAME_EDITION_END = \"EVENT_EDITFRAME_EDITION_END\";","'use strict';\r\n\r\nimport { addTraitEventDispatcher, renderToCanvas, radiansToDegrees, \r\n         checkPolygon, checkLineSegment, isTouchDevice } from './MarkupsCoreUtils'\r\nimport { createStyle, copyStyle, cloneStyle } from './StyleUtils'\r\nimport * as MarkupEvents from './MarkupEvents'\r\n\r\n    var av = Autodesk.Viewing;\r\n\r\n    /**\r\n     * Base class for all markups.\r\n     *\r\n     * A Markup is a class that is capable of rendering itself as an Svg node.<br>\r\n     * It can also render itself into a canvas-2d context.\r\n     * Component within {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore MarkupsCore} extension.\r\n     *\r\n     * Any class extending Markup should contain at least the following methods:\r\n     * - getEditMode()\r\n     * - set()\r\n     * - updateStyle()\r\n     * - setParent()\r\n     * - setRotation()\r\n     * - setSize()\r\n     * - setPosition()\r\n     * - renderToCanvas()\r\n     * - setMetadata()\r\n     *\r\n     * A good reference is the rectangle markup implementation available in\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupRectangle|MarkupRectangle}.\r\n     *\r\n     * @tutorial feature_markup\r\n     * @constructor\r\n     * @memberof Autodesk.Viewing.Extensions.Markups.Core\r\n     *\r\n     * @param {number} id - Identifier, populated with return value of {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore#getId getId()}.\r\n     * @param {Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore} editor - Markups extension\r\n     * @param {Array} styleAttributes - Attributes for customization. Related to {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore#setStyle setStyle()}.\r\n     * @constructor\r\n     */\r\n    export function Markup(id, editor, styleAttributes) {\r\n\r\n        this.id = id;\r\n        this.type = \"\";\r\n        this.editor = editor;\r\n        this.viewer = editor.viewer;\r\n        this.setGlobalManager(this.viewer.globalManager);\r\n        this.position = {x: 0, y: 0};\r\n        this.size = {x:0, y:0};\r\n        this.rotation = 0;\r\n        this.style = createStyle(styleAttributes, this.editor);\r\n        this.style = copyStyle(editor.getDefaultStyle(), this.style);\r\n        this.highlightColor = '#0696D7';\r\n        this.constraintWidth = false;\r\n        this.constraintHeight = false;\r\n        this.constraintRotation = false;\r\n        this.minWidth = -10000;\r\n        this.minHeight = -10000;\r\n        this.highlighted = false;\r\n        this.selected = false;\r\n\r\n        // bind to this to pass this.globalManager\r\n        this.checkLineSegment = checkLineSegment.bind(this);\r\n        this.checkPolygon = checkPolygon.bind(this);\r\n        this.renderToCanvasX = renderToCanvas.bind(this);\r\n\r\n        addTraitEventDispatcher(this);\r\n    }\r\n\r\n    av.GlobalManagerMixin.call(Markup.prototype);\r\n    var proto = Markup.prototype;\r\n\r\n    proto.destroy = function () {\r\n\r\n        this.unselect();\r\n        this.setParent(null);\r\n    };\r\n\r\n    /**\r\n     * Specifies the parent layer which will contain the markup.\r\n     * @param {HTMLElement} parent\r\n     */\r\n    proto.setParent = function(parent) {\r\n\r\n        var div = this.shape;\r\n        div.parentNode && div.parentNode.removeChild(div);\r\n        parent && parent.appendChild(div);\r\n    };\r\n\r\n    /**\r\n     * Clones (deep-copy) the markup. Used internally by the copy/cut/paste mechanism in\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore MarkupsCore}.\r\n     *\r\n     * @returns {Autodesk.Viewing.Extensions.Markups.Core.Markup} clone of the current markup\r\n     */\r\n    proto.clone = function() {\r\n\r\n        var clone = Object.create(this.__proto__);\r\n        var overrides = this.getCloneOverrides();\r\n\r\n        for (var name in this) {\r\n\r\n            if(!this.hasOwnProperty(name)) {\r\n                continue;\r\n            }\r\n\r\n            var member = this[name];\r\n\r\n            // Is there an override for this member?\r\n            if (overrides.hasOwnProperty(name)) {\r\n                clone[name] = overrides[name];\r\n                continue;\r\n            }\r\n\r\n            // Member is null or undefined?\r\n            if (member === null || member === undefined) {\r\n                clone[name] = member;\r\n                continue;\r\n            }\r\n\r\n            // Member has a clone function?\r\n            if (member['clone'] instanceof Function) {\r\n                clone[name] = member.clone();\r\n                continue;\r\n            }\r\n\r\n            // Is it a function?\r\n            if (member instanceof Function) {\r\n                clone[name] = member.bind(clone);\r\n                continue;\r\n            }\r\n\r\n            // Is it an html node?\r\n            if (member.nodeType) {\r\n                clone[name] = member.cloneNode(true);\r\n                continue;\r\n            }\r\n\r\n            // Is it the globalManager?\r\n            if (member instanceof av.GlobalManager) {\r\n                av.GlobalManagerMixin.call(clone);\r\n                clone.setGlobalManager(member);\r\n                continue;\r\n            }\r\n\r\n            // Just a plain object?\r\n            if (member instanceof Object) {\r\n                clone[name] = JSON.parse(JSON.stringify(member));\r\n                continue;\r\n            }\r\n\r\n            // Ok, it seems it's just a primitive type.\r\n            clone[name] = member;\r\n        }\r\n\r\n        this.cloneShape(clone);\r\n        return clone;\r\n    };\r\n\r\n    proto.cloneShape = function(clone) {\r\n\r\n        clone.shape.markup = clone.shape.childNodes.item(0);\r\n        clone.shape.hitarea = clone.shape.childNodes.item(1);\r\n        clone.bindDomEvents();\r\n    };\r\n\r\n    /**\r\n     * Used internally by\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.Markup#clone clone()},\r\n     * provides a mechanism to avoid cloning specific attributes.<br>\r\n     * Developers only need to override this method when creating new Markup types.\r\n     * When overriding, first call the super() implementation and then include additional attribute/value pairs to it.\r\n     * @returns {Object} containing attributes that need not to be cloned.\r\n     */\r\n    proto.getCloneOverrides = function() {\r\n\r\n        return {\r\n            viewer: this.viewer,\r\n            editor: this.editor,\r\n            hammer: null,\r\n            listeners: {}\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Used internally to select a markup.<br>\r\n     * Fires event Autodesk.Viewing.Extensions.Markups.Core.EVENT_MARKUP_SELECTED.\r\n     */\r\n    proto.select = function () {\r\n\r\n        if (this.selected) {\r\n            return;\r\n        }\r\n\r\n        this.selected = true;\r\n        this.highlighted = false;\r\n        this.updateStyle();\r\n        this.dispatchEvent({type: MarkupEvents.EVENT_MARKUP_SELECTED, markup: this});\r\n    };\r\n\r\n    /**\r\n     * Used internally to signal that the current markup has been unselected.<br>\r\n     * No event is fired.\r\n     */\r\n    proto.unselect = function() {\r\n\r\n        this.selected = false;\r\n    };\r\n\r\n    proto.highlight = function(highlight) {\r\n\r\n        if (this.interactionsDisabled) {\r\n            return;\r\n        }\r\n\r\n        this.highlighted = highlight;\r\n        this.updateStyle();\r\n    };\r\n\r\n    /**\r\n     * Returns a copy of the markup's style.\r\n     * @returns {Object}\r\n     */\r\n    proto.getStyle = function() {\r\n\r\n        return cloneStyle(this.style);\r\n    };\r\n\r\n    /**\r\n     * Used internally to set the style object. Triggers a re-render of the markup (Svg)\r\n     * @param {Object} style - Dictionary with key/value pairs\r\n     */\r\n    proto.setStyle = function(style) {\r\n\r\n        copyStyle(style, this.style);\r\n        this.updateStyle();\r\n    };\r\n\r\n    /**\r\n     * Used internally and implemented by specific Markup types to render themselves as Svg.\r\n     */\r\n    proto.updateStyle = function () {\r\n\r\n    };\r\n\r\n    /**\r\n     * Used internally to notify the markup that it is now being edited.<br>\r\n     * Fires event Autodesk.Viewing.Extensions.Markups.Core.EVENT_MARKUP_ENTER_EDITION.\r\n     */\r\n    proto.edit = function() {\r\n\r\n        this.dispatchEvent({type: MarkupEvents.EVENT_MARKUP_ENTER_EDITION, markup: this});\r\n    };\r\n\r\n    /**\r\n     * Used internally to signal that it is no longer being edited.<br>\r\n     * Fires event Autodesk.Viewing.Extensions.Markups.Core.EVENT_MARKUP_CANCEL_EDITION.\r\n     */\r\n    proto.cancel = function() {\r\n\r\n        this.dispatchEvent({type: MarkupEvents.EVENT_MARKUP_CANCEL_EDITION, markup: this});\r\n    };\r\n\r\n    /**\r\n     * Used internally to signal that the markup is being deleted.<br>\r\n     * Fires event Autodesk.Viewing.Extensions.Markups.Core.EVENT_MARKUP_DELETE_EDITION.\r\n     */\r\n    proto.deleteMarkup = function() {\r\n\r\n        this.dispatchEvent({type: MarkupEvents.EVENT_MARKUP_DELETE_EDITION, markup: this});\r\n    };\r\n\r\n    /**\r\n     * Used internally to get the {@link Autodesk.Viewing.Extensions.Markups.Core.EditMode EditMode}\r\n     * associated with the current Markup.<br>\r\n     * Implemented by classes extending this one.\r\n     * @returns {Autodesk.Viewing.Extensions.Markups.Core.EditMode}\r\n     */\r\n    proto.getEditMode = function() {\r\n\r\n        console.warn('EditMode of markup type' + this.type + ' not defined.' );\r\n        return null;\r\n    };\r\n\r\n    /**\r\n     * Used internally to get the markup's position in browser pixel space.<br>\r\n     * Notice that (0,0) is top left.<br>\r\n     * See also\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.Markup#getClientSize|getClientSize()}.\r\n     * @returns {*}\r\n     */\r\n    proto.getClientPosition = function() {\r\n\r\n        var position = this.position;\r\n        return this.editor.positionFromMarkupsToClient(position.x, position.y);\r\n    };\r\n\r\n    /**\r\n     * Used internally to get the markup's bounding rect in browser pixel space.<br>\r\n     * See also\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.Markup#getClientPosition|getClientPosition()}.\r\n     * @returns {*}\r\n     */\r\n    proto.getClientSize = function () {\r\n\r\n        var size = this.size;\r\n        return this.editor.sizeFromMarkupsToClient(size.x, size.y);\r\n    };\r\n\r\n    /**\r\n     * Used internally to get the markup's bounding rect in browser pixel space, including the stroke width.<br>\r\n     * @returns {Object} a rectangle with right, top, left, bottom attributes\r\n     */\r\n    proto.getBoundingRect = function () {\r\n\r\n        var rotation = this.rotation;\r\n\r\n        if (rotation !== 0) { // Undo rotation to find a tight bounding rect\r\n            this.setRotation(0);\r\n        }\r\n\r\n        var parentRect = this.viewer.impl.getCanvasBoundingClientRect();\r\n\r\n        var boundRect = this.shape.markup.getBoundingClientRect();\r\n        var top = boundRect.top - parentRect.top;\r\n\r\n        var strokeWidth = this.style['stroke-width'] || 0;\r\n        var offset = this.editor.sizeFromMarkupsToClient(strokeWidth, 0).x;\r\n\r\n        if (rotation !== 0) {\r\n            this.setRotation(rotation);\r\n        }\r\n\r\n        return {\r\n            x: boundRect.left - parentRect.left - offset,\r\n            y: top - offset,\r\n            width: boundRect.width + 2*offset,\r\n            height: boundRect.height + 2*offset\r\n        };\r\n    };\r\n\r\n    /**\r\n     * Changes the rotation of the markup to the given angle.\r\n     * This gets called by the Autodesk.Viewing.Extensions.Markups.Core.SetRotation edit action\r\n     *\r\n     * @param {Number} angle\r\n     */\r\n    proto.setRotation = function(angle) {\r\n\r\n        this.rotation = angle;\r\n        this.updateStyle();\r\n    };\r\n\r\n    proto.getRotation = function () {\r\n\r\n        return this.rotation;\r\n    };\r\n\r\n    /**\r\n     * Used by the EditFrame to move the markup in Client Space coordinates\r\n     * @param {Number} x - New X location for the markup. Notice that markups are centered on this value.\r\n     * @param {Number} y - New Y location for the markup. Notice that markups are centered on this value.\r\n     */\r\n    proto.setPosition = function(x,y) {\r\n\r\n        this.position.x = x;\r\n        this.position.y = y;\r\n\r\n        this.updateStyle();\r\n    };\r\n\r\n    /**\r\n     * Changes the position and size of the markup.\r\n     * This gets called by the Autodesk.Viewing.Extensions.Markups.Core.SetSize edit action\r\n     * @param {{x: Number, y: Number}} position\r\n     * @param {Number} width\r\n     * @param {Number} height\r\n     */\r\n    proto.setSize = function (position, width, height) {\r\n\r\n        this.position.x = position.x;\r\n        this.position.y = position.y;\r\n        this.size.x = width;\r\n        this.size.y = height;\r\n\r\n        this.updateStyle();\r\n    };\r\n\r\n    proto.isWidthConstrained = function() {\r\n\r\n        return this.constraintWidth;\r\n    };\r\n\r\n    proto.isHeightConstrained = function() {\r\n\r\n        return this.constraintHeight;\r\n    };\r\n\r\n    proto.isRotationConstrained = function() {\r\n\r\n        return this.constraintRotation;\r\n    };\r\n\r\n    proto.setMinWidth = function(minWidth) {\r\n        this.minWidth = minWidth;\r\n    };\r\n\r\n    proto.setMinHeight = function(minHeight) {\r\n        this.minHeight = minHeight;\r\n    };\r\n\r\n    proto.getMinWidth = function() {\r\n        return this.minWidth;\r\n    };\r\n\r\n    proto.getMinHeight = function() {\r\n        return this.minHeight;\r\n    };\r\n\r\n    /**\r\n     * Used to disable highlight on annotations while a new annotation is being created.\r\n     * @param {Boolean} disable - Whether (mouse) interactions are enable.\r\n     */\r\n    proto.disableInteractions = function(disable) {\r\n\r\n        this.interactionsDisabled = disable;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param width\r\n     */\r\n    proto.setStrokeWidth = function(width) {\r\n\r\n    };\r\n\r\n    proto.constrainsToBounds = function(bounds) {\r\n\r\n    };\r\n\r\n    proto.onMouseDown = function(event) {\r\n\r\n        if (this.interactionsDisabled) {\r\n            return;\r\n        }\r\n\r\n        this.select();\r\n        this.editor.editFrame.startDrag(event);\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param idTarget\r\n     * @returns *\r\n     */\r\n    proto.generatePoint3d = function(idTarget) {\r\n\r\n        var viewer = this.viewer;\r\n        var polygon = this.generateBoundingPolygon();\r\n        var self = this;\r\n\r\n        function checkLineSegmentAux(a, b) {\r\n\r\n            var point2d = self.checkLineSegment(a.x, a.y, b.x, b.y, idTarget);\r\n            var point3d = point2d && viewer.clientToWorld(point2d.x, point2d.y);\r\n            return point3d && point3d.point;\r\n        }\r\n\r\n        function checkPolygonAux(polygon) {\r\n\r\n            var point2d = self.checkPolygon(polygon, idTarget);\r\n            var point3d = point2d && viewer.clientToWorld(point2d.x, point2d.y);\r\n            return point3d && point3d.point;\r\n        }\r\n\r\n        // Try to avoid expensive calculations by checking some lines segments first.\r\n        // If line check cannot find a point the costly one by area is used.\r\n        // A ----midAB---- B\r\n        // |               |\r\n        // |     center    |\r\n        // |               |\r\n        // C --------------D\r\n\r\n        var xVertices = polygon.xVertices;\r\n        var yVertices = polygon.yVertices;\r\n\r\n        var midAB = new THREE.Vector2(xVertices[0] + xVertices[1], yVertices[0] + yVertices[1]).multiplyScalar(0.5);\r\n        var midAC = new THREE.Vector2(xVertices[0] + xVertices[3], yVertices[0] + yVertices[3]).multiplyScalar(0.5);\r\n        var midDB = new THREE.Vector2(xVertices[2] + xVertices[1], yVertices[2] + yVertices[1]).multiplyScalar(0.5);\r\n        var midDC = new THREE.Vector2(xVertices[2] + xVertices[3], yVertices[2] + yVertices[3]).multiplyScalar(0.5);\r\n        var center = midAC.clone().add(midDB).multiplyScalar(0.5);\r\n\r\n        var point3d =\r\n            checkLineSegmentAux(center, midDB) ||\r\n            checkLineSegmentAux(center, midAC) ||\r\n            checkLineSegmentAux(center, midAB) ||\r\n            checkLineSegmentAux(center, midDC);\r\n\r\n        return point3d || checkPolygonAux(polygon);\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @returns {{min: {x: number, y: number}, max: {x: number, y: number}}}\r\n     */\r\n    proto.generateBoundingBox = function() {\r\n\r\n        var boundingBox = {min: {x: 0,y: 0}, max: {x: 0, y: 0}};\r\n\r\n        // Get bounding box from markup bounding polygon.\r\n        var polygon = this.generateBoundingPolygon();\r\n\r\n        var vertexCount = polygon.vertexCount;\r\n        var xVertices = polygon.xVertices;\r\n        var yVertices = polygon.yVertices;\r\n\r\n        var bbX0 = Number.POSITIVE_INFINITY;\r\n        var bbY0 = Number.POSITIVE_INFINITY;\r\n        var bbX1 = Number.NEGATIVE_INFINITY;\r\n        var bbY1 = Number.NEGATIVE_INFINITY;\r\n\r\n        for(var i = 0; i < vertexCount; ++i) {\r\n\r\n            var bbX = xVertices[i];\r\n            var bbY = yVertices[i];\r\n\r\n            bbX0 = Math.min(bbX0, bbX);\r\n            bbY0 = Math.min(bbY0, bbY);\r\n            bbX1 = Math.max(bbX1, bbX);\r\n            bbY1 = Math.max(bbY1, bbY);\r\n        }\r\n\r\n        boundingBox.min.x = bbX0;\r\n        boundingBox.min.y = bbY0;\r\n        boundingBox.max.x = bbX1;\r\n        boundingBox.max.y = bbY1;\r\n\r\n        return boundingBox;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @returns {{vertexCount: number, xVertices: Float32Array, yVertices: Float32Array}}\r\n     */\r\n    proto.generateBoundingPolygon = function() {\r\n\r\n        var position = this.getClientPosition();\r\n        var halfSize = this.getClientSize();\r\n\r\n        halfSize.x *= 0.5;\r\n        halfSize.y *= 0.5;\r\n\r\n        var lt = new THREE.Vector3(-halfSize.x,-halfSize.y).add(position);\r\n        var rt = new THREE.Vector3( halfSize.x,-halfSize.y).add(position);\r\n        var rb = new THREE.Vector3( halfSize.x, halfSize.y).add(position);\r\n        var lb = new THREE.Vector3(-halfSize.x, halfSize.y).add(position);\r\n\r\n        if (this.rotation !== 0) {\r\n\r\n            var m1 = new THREE.Matrix4().makeTranslation(-position.x, -position.y, 0);\r\n            var m2 = new THREE.Matrix4().makeRotationZ(this.rotation);\r\n            var m3 = new THREE.Matrix4().makeTranslation(position.x, position.y, 0);\r\n            var transform = m3.multiply(m2).multiply(m1);\r\n\r\n            lt.applyMatrix4(transform);\r\n            rt.applyMatrix4(transform);\r\n            rb.applyMatrix4(transform);\r\n            lb.applyMatrix4(transform);\r\n        }\r\n\r\n        return { // packed for fast access in test algorithm.\r\n            vertexCount: 4,\r\n            xVertices : new Float32Array([lt.x, rt.x, rb.x, lb.x]),\r\n            yVertices : new Float32Array([lt.y, rt.y, rb.y, lb.y])\r\n        };\r\n    };\r\n\r\n    /**\r\n     * Implemented by extending classes.<br>\r\n     * Gets called automatically when\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore#generateData|generateData()}\r\n     * @returns {null|Element} - Either null (default) or the metadata Svg node\r\n     */\r\n    proto.setMetadata = function() {\r\n\r\n        return null; // No metadata is injected by default.\r\n    };\r\n\r\n    proto.setMouseDisabledWhenTouching = function(event) {\r\n\r\n        if (event.isFirst) {\r\n            this.shape.removeEventListener('mousedown', this.onMouseDownBinded);\r\n        } else if (event.isFinal) {\r\n            var _this = this;\r\n            setTimeout(function() {\r\n                _this.shape.addEventListener('mousedown', _this.onMouseDownBinded);\r\n            }, 10);\r\n        }\r\n    };\r\n\r\n    proto.bindDomEvents = function() {\r\n\r\n        if (isTouchDevice()) {\r\n\r\n            this.hammer = new av.Hammer.Manager(this.shape, {\r\n                recognizers: [\r\n                    av.GestureRecognizers.singletap\r\n                ],\r\n                handlePointerEventMouse: false,\r\n                inputClass: av.isIE11 ? av.Hammer.PointerEventInput : av.Hammer.TouchInput\r\n            });\r\n\r\n            this.onSingleTapBinded = function(event) {\r\n\r\n                this.onMouseDown(event);\r\n            }.bind(this);\r\n\r\n            this.onHammerInputBinded = function(event) {\r\n\r\n                this.setMouseDisabledWhenTouching(event);\r\n            }.bind(this);\r\n\r\n            this.hammer.on('singletap', this.onSingleTapBinded);\r\n            this.hammer.on('hammer.input', this.onHammerInputBinded);\r\n        }\r\n\r\n        this.onMouseDownBinded = this.onMouseDown.bind(this);\r\n        this.onMouseOutBinded = function() {\r\n\r\n            this.highlight(false);\r\n        }.bind(this);\r\n\r\n        this.onMouseOverBinded = function() {\r\n\r\n            this.highlight(true);\r\n        }.bind(this);\r\n\r\n        this.shape.addEventListener('mousedown', this.onMouseDownBinded);\r\n        this.shape.addEventListener('mouseout', this.onMouseOutBinded);\r\n        this.shape.addEventListener('mouseover', this.onMouseOverBinded);\r\n    };\r\n\r\n    proto.renderToCanvas = function(ctx, viewBox, width, height, callback) {\r\n\r\n        this.renderToCanvasX(this.shape, viewBox, width, height, ctx, callback);\r\n    };\r\n\r\n    proto.getPath = function() {\r\n\r\n    };\r\n\r\n    proto.getTransform = function() {\r\n\r\n        return [\r\n            'translate(', this.position.x, ',', this.position.y, ')',\r\n            'rotate(', radiansToDegrees(-this.rotation), ')'\r\n        ].join(' ');\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\nimport { cloneStyle } from '../StyleUtils'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param markup\r\n     * @param style\r\n     * @constructor\r\n     */\r\n    export function SetStyle(editor, markup, style) {\r\n\r\n        EditAction.call(this, editor, 'SET-STYLE', markup.id);\r\n\r\n        this.newStyle = cloneStyle(style);\r\n        this.oldStyle = markup.getStyle();\r\n    }\r\n\r\n    SetStyle.prototype = Object.create(EditAction.prototype);\r\n    SetStyle.prototype.constructor = SetStyle;\r\n\r\n    var proto = SetStyle.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        var markup = this.editor.getMarkup(this.targetId);\r\n        markup && markup.setStyle(this.newStyle);\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        var markup = this.editor.getMarkup(this.targetId);\r\n        markup && markup.setStyle(this.oldStyle);\r\n    };\r\n","'use strict';\r\n\r\nimport * as MarkupEvents from '../MarkupEvents'\r\nimport { createStyle, copyStyle } from '../StyleUtils'\r\nimport { addTraitEventDispatcher, removeTraitEventDispatcher, sign } from '../MarkupsCoreUtils'\r\nimport { SetStyle } from '../edit-actions/SetStyle'\r\n\r\nconst av = Autodesk.Viewing;\r\n\r\n    /**\r\n     * Base class for all markup edit modes.\r\n     *\r\n     * An EditMode is responsible for handling user input to create and edit a\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.Markup|Markup}.\r\n     *\r\n     * Any class extending Markup should contain at least the following methods:\r\n     * - deleteMarkup()\r\n     * - onMouseDown()\r\n     * - onMouseMove()\r\n     *\r\n     * A good reference is the Circle EditMode implementation available in\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.EditModeCircle|EditModeCircle}.\r\n     *\r\n     * @tutorial feature_markup\r\n     * @constructor\r\n     * @memberof Autodesk.Viewing.Extensions.Markups.Core\r\n     *\r\n     * @param {Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore} editor - Markups extension.\r\n     * @param {String} type - An identifier for the EditMode type. Not to be confused by the Markup's id.\r\n     * @param {Array} styleAttributes - Attributes for customization.\r\n     * @constructor\r\n     */\r\n    export function EditMode(editor, type, styleAttributes) {\r\n\r\n        this.editor = editor;\r\n        this.viewer = editor.viewer;\r\n        this.setGlobalManager(this.viewer.globalManager);\r\n        this.type = type;\r\n        this.selectedMarkup = null;\r\n        this.dragging = false;\r\n        this.draggingAnnotationIniPosition = null;\r\n        this.draggingMouseIniPosition = new THREE.Vector2();\r\n        this.initialX = 0;\r\n        this.initialY = 0;\r\n        this.minSize = 9; // In pixels\r\n        this.creating = false;\r\n        this.size = {x: 0, y: 0};\r\n        this.style = createStyle(styleAttributes, this.editor);\r\n        this.style = copyStyle(editor.getDefaultStyle(), this.style);\r\n\r\n        this.CREATION_METHOD_DRAG = 'CREATION_METHOD_DRAG';\r\n        this.CREATION_METHOD_CLICK = 'CREATION_METHOD_CLICK';\r\n        this.CREATION_METHOD_CLICKS = 'CREATION_METHOD_CLICKS';\r\n        this.creationMethod = this.CREATION_METHOD_DRAG;\r\n\r\n        addTraitEventDispatcher(this);\r\n    }\r\n\r\n    av.GlobalManagerMixin.call(EditMode.prototype);\r\n    var proto = EditMode.prototype;\r\n\r\n    proto.destroy = function() {\r\n\r\n        this.unselect();\r\n        removeTraitEventDispatcher(this);\r\n    };\r\n\r\n    proto.unselect = function() {\r\n\r\n        var fireEv = false;\r\n        var selectedMarkup = this.selectedMarkup;\r\n        var selectedId = null;\r\n\r\n        if (selectedMarkup) {\r\n            selectedId = selectedMarkup.id;\r\n            selectedMarkup.unselect();\r\n            this.selectedMarkup = null;\r\n            fireEv = true;\r\n        }\r\n\r\n        this.editor.editFrame.setMarkup(null);\r\n\r\n        if (fireEv) {\r\n            this.dispatchEvent({ type: MarkupEvents.EVENT_MARKUP_DESELECT, markupId: selectedId });\r\n        }\r\n    };\r\n\r\n    proto.creationBegin = function() {\r\n\r\n        if (this.creating) {\r\n            return;\r\n        }\r\n\r\n        this.creating = true;\r\n        this.dispatchEvent({ type: MarkupEvents.EVENT_EDITMODE_CREATION_BEGIN });\r\n    };\r\n\r\n    proto.creationEnd = function(isCancelling) {\r\n\r\n        if (!this.creating) {\r\n            return false;\r\n        }\r\n\r\n        if (this.creationMethod !== this.CREATION_METHOD_CLICK) {\r\n\r\n            if (this.selectedMarkup && !this.isMinSizeValid()) {\r\n\r\n                this.creationCancel();\r\n                isCancelling = true;\r\n            } else {\r\n\r\n                if (this.creationMethod === this.CREATION_METHOD_DRAG) {\r\n                    this.finishDragging();\r\n                }\r\n\r\n                if (this.selectedMarkup) {\r\n\r\n                    // Opened on mouse down.\r\n                    this.editor.closeActionGroup();\r\n                    this.selectedMarkup = null;\r\n                }\r\n            }\r\n        }\r\n\r\n        this.creating = false;\r\n        this.dispatchEvent({ type: MarkupEvents.EVENT_EDITMODE_CREATION_END, creationCancelled: !!isCancelling });\r\n        return true;\r\n    };\r\n\r\n    proto.creationCancel = function() {\r\n\r\n        this.editor.cancelActionGroup();\r\n        this.creationEnd(true);\r\n        this.selectedMarkup = null; // No need to call unselect\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param style\r\n     */\r\n    proto.setStyle = function(style) {\r\n\r\n        this.style = style;\r\n\r\n        var selectedMarkup = this.selectedMarkup;\r\n        if(!selectedMarkup) {\r\n            return;\r\n        }\r\n\r\n        var setStyle = new SetStyle(this.editor, selectedMarkup, style);\r\n        setStyle.execute();\r\n    };\r\n\r\n    proto.getStyle = function() {\r\n\r\n        return this.style;\r\n    };\r\n\r\n    proto.setSelection = function(markup) {\r\n\r\n        if (this.selectedMarkup !== markup) {\r\n            this.unselect();\r\n            markup && markup.select();\r\n        }\r\n\r\n        this.selectedMarkup = markup;\r\n\r\n        var editor = this.editor;\r\n        markup && editor.bringToFront(markup);\r\n\r\n        if (this.isTextInputHelperActive() && editor.editFrame.markup) {\r\n            this.textInputHelper.setEditFrame();\r\n        } else if (!this.creating) {\r\n            editor.editFrame.setMarkup(markup);\r\n        }\r\n    };\r\n\r\n    proto.getSelection = function() {\r\n\r\n        return this.selectedMarkup;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param [markup] If provided deletes markup (has to have same type that the edit mode), otherwise deletes selected one.\r\n     * @param [cantUndo] If true to not add deletion to undo history.\r\n     * @returns {boolean}\r\n     */\r\n    proto.deleteMarkup = function (markup, cantUndo) {\r\n\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * Used by classes extending EditMode to validate the minimum size (in screen coordinates) of the markup.\r\n     * See minSize attribute\r\n     * @return {Boolean} Whether current size is valid for creating the markup\r\n     * @private\r\n     */\r\n    proto.isMinSizeValid = function() {\r\n\r\n        if (this.minSize !== 0) {\r\n\r\n            var tmp = this.editor.sizeFromMarkupsToClient(this.size.x, this.size.y);\r\n            return (tmp.x*tmp.x + tmp.y*tmp.y) >= (this.minSize * this.minSize);\r\n\r\n        }\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    proto.startDragging = function() {\r\n\r\n        var selectedMarkup = this.selectedMarkup;\r\n        var mousePosition = this.editor.getMousePosition();\r\n\r\n        if (selectedMarkup) {\r\n\r\n            this.dragging = true;\r\n            this.draggingAnnotationIniPosition = selectedMarkup.getClientPosition();\r\n            this.draggingMouseIniPosition.set(mousePosition.x, mousePosition.y);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    proto.finishDragging = function() {\r\n\r\n        var dragging = this.dragging;\r\n        var selectedMarkup = this.selectedMarkup;\r\n\r\n        this.dragging = false;\r\n\r\n        if (selectedMarkup && dragging) {\r\n\r\n            selectedMarkup.finishDragging();\r\n        }\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @returns {{x: number, y: number}}\r\n     */\r\n    proto.getFinalMouseDraggingPosition = function() {\r\n\r\n        var editor = this.editor;\r\n        var bounds = editor.getBounds();\r\n        var mousePosition = editor.getMousePosition();\r\n\r\n        var initialX = this.initialX;\r\n        var initialY = this.initialY;\r\n\r\n        var finalX = Math.min(Math.max(bounds.x, mousePosition.x), bounds.x + bounds.width);\r\n        var finalY = Math.min(Math.max(bounds.y, mousePosition.y), bounds.y + bounds.height);\r\n\r\n        if (finalX == initialX &&\r\n            finalY == initialY) {\r\n            finalX++;\r\n            finalY++;\r\n        }\r\n\r\n        // Make equal x/y when shift is down\r\n        if (editor.input.makeSameXY) {\r\n            var dx = Math.abs(finalX - initialX);\r\n            var dy = Math.abs(finalY - initialY);\r\n\r\n            var maxDelta = Math.max(dx, dy);\r\n\r\n            // These calculations have the opportunity to go beyond 'bounds'.\r\n            finalX = initialX + maxDelta * sign(finalX - initialX);\r\n            finalY = initialY + maxDelta * sign(finalY - initialY);\r\n        }\r\n\r\n        return { x:finalX, y:finalY };\r\n    };\r\n\r\n    proto.notifyAllowNavigation = function(allows) {\r\n\r\n    };\r\n\r\n    proto.onMouseMove = function (event) {\r\n        if (!this.selectedMarkup || !this.creating) {\r\n            return false;\r\n          }\r\n          return true;\r\n    };\r\n\r\n    proto.onMouseDown = function () {\r\n\r\n    };\r\n\r\n    /**\r\n     * Handler to mouse up events, used to start annotations creation.\r\n     * It will cancel the creation of a markup if its minSize conditions are not met.\r\n     *\r\n     * @param {MouseEvent} event Mouse event.\r\n     * @private\r\n     */\r\n    proto.onMouseUp = function(event) {\r\n\r\n        if (this.creationMethod !== this.CREATION_METHOD_DRAG) {\r\n            return false;\r\n        }\r\n\r\n        return this.creationEnd();\r\n    };\r\n\r\n    proto.onMouseDoubleClick = function(event) {\r\n\r\n        if (this.creationMethod !== this.CREATION_METHOD_CLICKS) {\r\n            return;\r\n        }\r\n\r\n        this.creationEnd();\r\n    };\r\n\r\n    /**\r\n     * Notify the markup that the displayed markups are being saved so edit mode can finish current editions.\r\n     */\r\n    proto.onSave = function() {\r\n\r\n        if (this.creating) {\r\n            this.creationCancel();\r\n        }\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @returns {{x: *, y: *}}\r\n     */\r\n    proto.getDraggingPosition = function () {\r\n\r\n        var mousePosition = this.editor.getMousePosition();\r\n\r\n        var dx = mousePosition.x - this.draggingMouseIniPosition.x;\r\n        var dy = mousePosition.y - this.draggingMouseIniPosition.y;\r\n\r\n        return {\r\n            x: this.draggingAnnotationIniPosition.x + dx,\r\n            y: this.draggingAnnotationIniPosition.y + dy\r\n        };\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param x\r\n     * @param y\r\n     * @param bounds\r\n     * @returns {boolean}\r\n     * @orivate\r\n     */\r\n    proto.isInsideBounds = function (x, y, bounds) {\r\n\r\n        return x >= bounds.x && x <= bounds.x + bounds.width &&\r\n               y >= bounds.y && y <= bounds.y + bounds.height;\r\n    };\r\n\r\n    /*\r\n     * Decides whether to use the snapper in the current edit mode or not.\r\n     * \r\n     * @returns {boolean}\r\n     */\r\n    proto.useWithSnapping = function () {\r\n        return this.viewer.model.is2d();\r\n    };\r\n\r\n    \r\n    proto.isTextInputHelperActive = function() {\r\n        return this.textInputHelper && this.textInputHelper.isActive();\r\n    };\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\nimport { CreateArrow } from './CreateArrow'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param arrow\r\n     * @constructor\r\n     */\r\n    export function DeleteArrow(editor, arrow) {\r\n\r\n        // Confusing naming here. Arrow.tail is the starting point of the arrow,\r\n        // and arrow.head is the final point. In CreateArrow the head argument\r\n        // is the first point of the arrow and the tail argument is the second\r\n        // point of the argument. So construct CreateArrow with the tail before\r\n        // the head. \r\n        EditAction.call(this, editor, 'DELETE-ARROW', arrow.id);\r\n        this.createArrow = new CreateArrow(\r\n            editor,\r\n            arrow.id,\r\n            arrow.tail,\r\n            arrow.head,\r\n            arrow.getStyle());\r\n    }\r\n\r\n    DeleteArrow.prototype = Object.create(EditAction.prototype);\r\n    DeleteArrow.prototype.constructor = DeleteArrow;\r\n\r\n    var proto = DeleteArrow.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        this.createArrow.undo();\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        this.createArrow.redo();\r\n    };\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param arrow\r\n     * @param head\r\n     * @param tail\r\n     * @constructor\r\n     */\r\n    export function SetArrow(editor, arrow, head, tail) {\r\n\r\n        EditAction.call(this, editor, 'SET-ARROW', arrow.id);\r\n\r\n        this.newHead = {x: head.x, y: head.y};\r\n        this.newTail = {x: tail.x, y: tail.y};\r\n        this.oldHead = {x: arrow.head.x, y: arrow.head.y};\r\n        this.oldTail = {x: arrow.tail.x, y: arrow.tail.y};\r\n    }\r\n\r\n    SetArrow.prototype = Object.create(EditAction.prototype);\r\n    SetArrow.prototype.constructor = SetArrow;\r\n\r\n    var proto = SetArrow.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        this.applyState(this.targetId, this.newHead, this.newTail);\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        this.applyState(this.targetId, this.oldHead, this.oldTail);\r\n    };\r\n\r\n    proto.merge = function(action) {\r\n\r\n        if (this.targetId === action.targetId &&\r\n            this.type === action.type) {\r\n\r\n            this.newHead = action.newHead;\r\n            this.newTail = action.newTail;\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @private\r\n     */\r\n    proto.applyState = function(targetId, head, tail) {\r\n\r\n        var arrow = this.editor.getMarkup(targetId);\r\n        if(!arrow) {\r\n            return;\r\n        }\r\n\r\n        // Different stroke widths make positions differ at sub-pixel level.\r\n        var epsilon = 0.0001;\r\n\r\n        if (Math.abs(arrow.head.x - head.x) >= epsilon || Math.abs(arrow.head.y - head.y) >= epsilon ||\r\n            Math.abs(arrow.tail.x - tail.x) >= epsilon || Math.abs(arrow.tail.y - tail.y) >= epsilon) {\r\n\r\n            // Confusing naming here. in arrow.set the first two numbers are\r\n            // the point you drag from and the second two are the point you\r\n            // drag to. So the head point is actually where the tail of the\r\n            // arrow is positioned and the tail point is the head is positioned.\r\n            arrow.set(head.x, head.y, tail.x, tail.y);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * @returns {boolean}\r\n     */\r\n    proto.isIdentity = function() {\r\n\r\n        return (\r\n            this.newHead.x === this.oldHead.x &&\r\n            this.newHead.y === this.oldHead.y &&\r\n            this.newTail.x === this.oldTail.x &&\r\n            this.newTail.y === this.oldTail.y);\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { EditMode } from './EditMode'\r\nimport { DeleteArrow } from '../edit-actions/DeleteArrow'\r\nimport { CreateArrow } from '../edit-actions/CreateArrow'\r\nimport { SetArrow } from '../edit-actions/SetArrow'\r\nimport * as MarkupTypes from '../MarkupTypes'\r\n\r\n\r\n    var MeasureCommon = Autodesk.Viewing.MeasureCommon;\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @constructor\r\n     */\r\n    export function EditModeArrow(editor) {\r\n\r\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity'];\r\n        EditMode.call(this, editor, MarkupTypes.MARKUP_TYPE_ARROW, styleAttributes);\r\n    }\r\n\r\n    EditModeArrow.prototype = Object.create(EditMode.prototype);\r\n    EditModeArrow.prototype.constructor = EditModeArrow;\r\n\r\n\r\n    var proto = EditModeArrow.prototype;\r\n\r\n    proto.deleteMarkup = function(markup, cantUndo) {\r\n\r\n        markup = markup || this.selectedMarkup;\r\n        if (markup && markup.type == this.type) {\r\n            var deleteArrow = new DeleteArrow(this.editor, markup);\r\n            deleteArrow.addToHistory = !cantUndo;\r\n            deleteArrow.execute();\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * Handler to mouse down events, used to start markups creation.\r\n     * @private\r\n     */\r\n    proto.onMouseDown = function() {\r\n\r\n        EditMode.prototype.onMouseDown.call(this);\r\n\r\n        if (this.selectedMarkup) {\r\n            return;\r\n        }\r\n\r\n        var editor = this.editor;\r\n        var mousePosition = editor.getMousePosition();\r\n\r\n        this.initialX = mousePosition.x;\r\n        this.initialY = mousePosition.y;\r\n\r\n        this.size.x = 0;\r\n        this.size.y = 0;\r\n\r\n        // Snap to parallel/perpendicular of underlying vectors\r\n        this.lineSnapped = null;\r\n        if (editor.snapper) {\r\n            var geomType = editor.snapper.getGeometryType();\r\n            if (geomType === MeasureCommon.SnapType.SNAP_VERTEX || \r\n                geomType === MeasureCommon.SnapType.SNAP_EDGE || \r\n                geomType === MeasureCommon.SnapType.SNAP_MIDPOINT || \r\n                geomType === MeasureCommon.SnapType.SNAP_CIRCLE_CENTER) \r\n            {\r\n                this.lineSnapped = editor.snapper.getEdge();\r\n            }\r\n        }\r\n\r\n        // Calculate head and tail.\r\n        var arrowMinSize = this.style['stroke-width'] * 3.5;\r\n\r\n        var head = this.head = editor.positionFromClientToMarkups(this.initialX, this.initialY);\r\n        var tail = {\r\n            x: head.x + Math.cos( Math.PI * 0.25) * arrowMinSize,\r\n            y: head.y + Math.sin(-Math.PI * 0.25) * arrowMinSize\r\n        };\r\n        // Constrain head and tail inside working area.\r\n        var constrain = function(head, tail, size, bounds) {\r\n\r\n            if (this.isInsideBounds(tail.x, tail.y, bounds)) {\r\n                return;\r\n            }\r\n\r\n            tail.y = head.y + Math.sin( Math.PI * 0.25) * size;\r\n            if (this.isInsideBounds( tail.x, tail.y, bounds)) {\r\n                return;\r\n            }\r\n\r\n            tail.x = head.x + Math.cos(-Math.PI * 0.25) * size;\r\n            if (this.isInsideBounds( tail.x, tail.y, bounds)) {\r\n                return;\r\n            }\r\n\r\n            tail.y = head.y + Math.sin(-Math.PI * 0.25) * size;\r\n\r\n        }.bind(this);\r\n\r\n        constrain( head, tail, arrowMinSize, editor.getBounds());\r\n\r\n        // Create arrow.\r\n        editor.beginActionGroup();\r\n\r\n        var arrowVector = new THREE.Vector2(tail.x - head.x, tail.y - head.y);\r\n        if (arrowVector.lengthSq() < arrowMinSize * arrowMinSize) {\r\n\r\n            arrowVector = arrowVector.normalize().multiplyScalar(arrowMinSize);\r\n            tail.x = head.x + arrowVector.x;\r\n            tail.y = head.y + arrowVector.y;\r\n        }\r\n\r\n        var arrowId = editor.getId();\r\n        var create = new CreateArrow(editor, arrowId, head, tail, this.style);\r\n        create.execute();\r\n\r\n        this.selectedMarkup = editor.getMarkup(arrowId);\r\n        this.creationBegin();\r\n    };\r\n\r\n    /**\r\n     * Handler to mouse move events, used to create markups.\r\n     * @param {MouseEvent} event Mouse event.\r\n     * @private\r\n     */\r\n    proto.onMouseMove = function(event) {\r\n\r\n        if(!EditMode.prototype.onMouseMove.call( this, event )) {\r\n            return false;\r\n        }\r\n\r\n        var selectedMarkup = this.selectedMarkup;\r\n\r\n        var editor = this.editor;\r\n        var final = this.getFinalMouseDraggingPosition();\r\n        var initialX = this.initialX;\r\n        var initialY = this.initialY;\r\n\r\n        // Snap to parallel/perpendicular of underlying vectors\r\n        if (editor.snapper && !editor.snapper.isSnapped() && this.lineSnapped) {\r\n            var start = editor.project(this.lineSnapped.vertices[0]);\r\n            var end = editor.project(this.lineSnapped.vertices[1]);\r\n            var p = new THREE.Vector3(final.x, final.y, start.z);\r\n\r\n            var parallel = MeasureCommon.nearestPointInPointToLine(p, start, end);\r\n\r\n            // select an arbitrary point on the perpendicular line\r\n            var k = -(start.x - end.x) / (start.y - end.y);\r\n            var b = initialY - k * initialX;\r\n            var x = initialX + 1;\r\n            var y = k * x + b;\r\n            var pEnd = new THREE.Vector3(x, y, start.z);\r\n\r\n            var pStart = new THREE.Vector3(initialX, initialY, start.z);\r\n            var perpendicular = MeasureCommon.nearestPointInPointToLine(p, pStart, pEnd);\r\n\r\n            // Snap to parallel of underlying vectors\r\n            if (parallel.distanceTo(p) <= 20) {\r\n                final.x = parallel.x;\r\n                final.y = parallel.y;\r\n            }\r\n            // Snap to perpendicular of underlying vectors\r\n            else if (perpendicular.distanceTo(p) <= 20) {\r\n                final.x = perpendicular.x;\r\n                final.y = perpendicular.y;\r\n            }\r\n        }\r\n\r\n        var head = this.head;\r\n        var tail = editor.positionFromClientToMarkups(final.x, final.y);\r\n\r\n        var arrowVector = new THREE.Vector2(tail.x - head.x, tail.y - head.y);\r\n        var arrowMinSize = selectedMarkup.style['stroke-width'] * 3.5;\r\n\r\n        if (arrowVector.lengthSq() < arrowMinSize * arrowMinSize) {\r\n\r\n            arrowVector = arrowVector.normalize().multiplyScalar(arrowMinSize);\r\n            tail.x = head.x + arrowVector.x;\r\n            tail.y = head.y + arrowVector.y;\r\n        }\r\n\r\n        this.size = editor.sizeFromClientToMarkups((final.x - initialX), (final.y - initialY));\r\n\r\n        var setArrow = new SetArrow(editor, selectedMarkup, head, tail);\r\n        setArrow.execute();\r\n        return true;\r\n    };","'use strict';\r\n\r\nimport { Markup } from './Markup'\r\nimport * as MarkupTypes from './MarkupTypes'\r\nimport { createMarkupPathSvg, composeRGBAString, setAttributeToMarkupSvg,\r\n    updateMarkupPathSvgHitarea, checkLineSegment, addMarkupMetadata } from './MarkupsCoreUtils'\r\nimport { cloneStyle } from './StyleUtils'\r\nimport { EditModeArrow } from './edit-modes/EditModeArrow'\r\n\r\n    /**\r\n     *\r\n     * @param id\r\n     * @param editor\r\n     * @constructor\r\n     */\r\n    export function MarkupArrow(id, editor) {\r\n\r\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity'];\r\n        Markup.call(this, id, editor, styleAttributes);\r\n\r\n        // bind to this to pass this.globalManager\r\n        this.addMarkupMetadata = addMarkupMetadata.bind(this);\r\n        this.checkLineSegment = checkLineSegment.bind(this);\r\n\r\n        this.type = MarkupTypes.MARKUP_TYPE_ARROW;\r\n        this.constraintHeight = true;\r\n\r\n        // Create head and tail.\r\n        this.head = new THREE.Vector3();\r\n        this.tail = new THREE.Vector3();\r\n        this.size.y = this.style['stroke-width'] * 3;\r\n        this.shape = createMarkupPathSvg();\r\n\r\n        this.bindDomEvents();\r\n    }\r\n\r\n    MarkupArrow.prototype = Object.create(Markup.prototype);\r\n    MarkupArrow.prototype.constructor = MarkupArrow;\r\n\r\n    var proto = MarkupArrow.prototype;\r\n\r\n    proto.getEditMode = function() {\r\n\r\n        return new EditModeArrow(this.editor);\r\n    };\r\n\r\n    /**\r\n     * Sets top-left and bottom-right values in client space coordinates (2d).\r\n     * Notice that for the arrow, the top left is the \"tail\" of the arrow and\r\n     * the bottom right is the \"head\" of it.\r\n     *\r\n     * @param {Number} xO - tail\r\n     * @param {Number} yO - tail\r\n     * @param {Number} xF - head\r\n     * @param {Number} yF - head\r\n     */\r\n    proto.set = function(xO, yO, xF, yF) {\r\n\r\n        var vO = new THREE.Vector2(xO, yO);\r\n        var vF = new THREE.Vector2(xF, yF);\r\n        var vDir = vF.clone().sub(vO).normalize();\r\n\r\n        this.size.x = vO.distanceTo(vF); // TODO: Clamp min length\r\n        this.rotation = Math.acos(vDir.dot(new THREE.Vector2(1,0)));\r\n        this.rotation = yF > yO ? (Math.PI*2)-this.rotation : this.rotation;\r\n\r\n        var head = this.head;\r\n        var tail = this.tail;\r\n\r\n        head.set(xF, yF, 0);\r\n        tail.set(xO, yO, 0);\r\n\r\n        this.position.x = tail.x + (head.x - tail.x) * 0.5;\r\n        this.position.y = tail.y + (head.y - tail.y) * 0.5;\r\n\r\n        this.updateStyle();\r\n    };\r\n\r\n    /**\r\n     * Changes the rotation of the markup to the given angle.\r\n     * This gets called by the Autodesk.Viewing.Extensions.Markups.Core.SetRotation edit action\r\n     *\r\n     * @param {Number} angle\r\n     */\r\n    proto.setRotation = function(angle) {\r\n\r\n        this.rotation = angle;\r\n\r\n        var xF = Math.cos(-angle);\r\n        var yF = Math.sin(-angle);\r\n        var vFDir = new THREE.Vector2(xF, yF); // already normalized\r\n        vFDir.multiplyScalar(this.size.x*0.5);\r\n\r\n        var vCenter = new THREE.Vector2(this.position.x, this.position.y);\r\n        var vO = vCenter.clone().sub(vFDir);\r\n        var vF = vCenter.clone().add(vFDir);\r\n\r\n        this.head.set(vF.x, vF.y, 0);\r\n        this.tail.set(vO.x, vO.y, 0);\r\n\r\n        this.updateStyle();\r\n    };\r\n\r\n    /**\r\n     * Changes the position and size of the markup.\r\n     * This gets called by the namespace.SetSize edit action\r\n     * @param {{x: Number, y: Number}} position - arrow's center\r\n     * @param {Number} width - Arrow's length\r\n     * @param {Number} height - We ignore this one because we use the arrow's stroke width instead\r\n     */\r\n    proto.setSize = function(position, width, height) {\r\n\r\n        var xF = Math.cos(-this.rotation);\r\n        var yF = Math.sin(-this.rotation);\r\n        var vFDir = new THREE.Vector2(xF, yF); // already normalized\r\n        vFDir.multiplyScalar(width*0.5);\r\n\r\n        var vCenter = new THREE.Vector2(position.x, position.y);\r\n        var vO = vCenter.clone().sub(vFDir);\r\n        var vF = vCenter.clone().add(vFDir);\r\n\r\n        this.head.set(vF.x, vF.y, 0);\r\n        this.tail.set(vO.x, vO.y, 0);\r\n\r\n        this.position.x = position.x;\r\n        this.position.y = position.y;\r\n        this.size.x = width;\r\n\r\n        this.updateStyle();\r\n    };\r\n\r\n    proto.updateStyle = function() {\r\n\r\n        var style = this.style;\r\n        var shape = this.shape;\r\n        var strokeWidth = style['stroke-width'];\r\n        var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\r\n        var transform = this.getTransform();\r\n\r\n        this.size.y = strokeWidth * 3;\r\n        this.style['fill-color'] = style['stroke-color'];\r\n        this.style['fill-opacity'] = style['stroke-opacity'];\r\n\r\n        setAttributeToMarkupSvg(shape, 'd', this.getPath().join(' '));\r\n        setAttributeToMarkupSvg(shape, 'stroke-width', strokeWidth);\r\n        setAttributeToMarkupSvg(shape, 'stroke', strokeColor);\r\n        setAttributeToMarkupSvg(shape, 'fill', strokeColor);\r\n        setAttributeToMarkupSvg(shape, 'transform', transform);\r\n        updateMarkupPathSvgHitarea(shape, this.editor);\r\n    };\r\n\r\n    /**\r\n     * Used by the EditFrame to move the markup in Client Space coordinates\r\n     * @param {Number} x - New X location for the markup. Notice that markups are centered on this value.\r\n     * @param {Number} y - New Y location for the markup. Notice that markups are centered on this value.\r\n     */\r\n    proto.setPosition = function (x, y) {\r\n\r\n        var head = this.head;\r\n        var tail = this.tail;\r\n\r\n        var dx = head.x - tail.x;\r\n        var dy = head.y - tail.y;\r\n\r\n        var xo = x + dx * 0.5;\r\n        var yo = y + dy * 0.5;\r\n\r\n        head.x = xo;\r\n        head.y = yo;\r\n\r\n        tail.x = xo - dx;\r\n        tail.y = yo - dy;\r\n\r\n        this.position.x = tail.x + (head.x - tail.x) * 0.5;\r\n        this.position.y = tail.y + (head.y - tail.y) * 0.5;\r\n\r\n        this.updateStyle();\r\n    };\r\n\r\n    proto.generatePoint3d = function(idTarget) {\r\n\r\n        var head = this.editor.positionFromMarkupsToClient(this.head.x, this.head.y);\r\n        var tail = this.editor.positionFromMarkupsToClient(this.tail.x, this.tail.y);\r\n\r\n        var direction = head.clone().sub(tail).normalize();\r\n\r\n        var point2d = this.checkLineSegment(head.x, head.y, head.x + direction.x * 200, head.y + direction.y * 200, idTarget);\r\n        var point3d = point2d && this.viewer.clientToWorld(point2d.x, point2d.y);\r\n\r\n        return point3d && point3d.point;\r\n    };\r\n\r\n    proto.setMetadata = function() {\r\n\r\n        var metadata = cloneStyle(this.style);\r\n\r\n        metadata.type = this.type;\r\n        metadata.head = [this.head.x, this.head.y].join(\" \");\r\n        metadata.tail = [this.tail.x, this.tail.y].join(\" \");\r\n        metadata.rotation = String(this.rotation);\r\n\r\n        return this.addMarkupMetadata(this.shape, metadata);\r\n    };\r\n\r\n    proto.getPath = function() {\r\n\r\n        // To build the arrow we need 7 points in total\r\n        // The 'default' arrow built here has the following characteristics:\r\n        //\r\n        // 1. It is built horizontally facing right\r\n        // 2. It's bounding rectangle has length: this.size.x\r\n        // 3. It's bounding rectangle has height: 2 * this.strokeWidth\r\n        // 4. The arrow tail's thickness is: this.strokeWidth\r\n        // 5. The arrow head's length is: 2/3 of (point 3)\r\n        // 6. The arrow head's thickness is: (point 3)\r\n        // 7. The arrow generated is centered in its local (0,0), meaning that\r\n        //    two points are placed with negative x values, and all other have\r\n        //    positive x values:\r\n        //\r\n        //                            (3)\\\r\n        //                              \\  \\\r\n        //             (1)-------------(2)   \\\r\n        //              |         (0)        (4)\r\n        //             (7)-------------(6)   /\r\n        //                              /  /\r\n        //                            (5)/\r\n        //\r\n\r\n        var sizeX = this.size.x;\r\n        var sizeY = this.size.y;\r\n        var sizeYOver3 = sizeY/3;\r\n        var strokeWidth = this.style['stroke-width'];\r\n        var tailW = sizeX - strokeWidth * 3;\r\n        var headW = sizeX - tailW;\r\n        var spikeOffset = strokeWidth * 0.3;\r\n\r\n        return [\r\n            'M', -sizeX * 0.5        , -sizeY * 0.5 + sizeYOver3,    // (1)\r\n            'l',  tailW              ,  0,                           // (2)\r\n            'l', -spikeOffset        , -sizeYOver3,                  // (3)\r\n            'l',  headW + spikeOffset,  sizeYOver3 * 1.5,            // (4)\r\n            'l', -headW - spikeOffset,  sizeYOver3 * 1.5,            // (5)\r\n            'l',  spikeOffset        , -sizeYOver3,                  // (6)\r\n            'l', -tailW              ,  0,                           // (7)\r\n            'z'\r\n        ];\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\nimport { MarkupArrow } from '../MarkupArrow'\r\nimport { cloneStyle } from '../StyleUtils'\r\n\r\n    /**\r\n     * @constructor\r\n     */\r\n    export function CreateArrow(editor, id, head, tail, style) {\r\n\r\n        EditAction.call(this, editor, 'CREATE-ARROW', id);\r\n\r\n        this.selectOnExecution = false;\r\n        this.tail = tail;\r\n        this.head = head;\r\n        this.style = cloneStyle(style);\r\n    }\r\n\r\n    CreateArrow.prototype = Object.create(EditAction.prototype);\r\n    CreateArrow.prototype.constructor = CreateArrow;\r\n\r\n    var proto = CreateArrow.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        var editor = this.editor;\r\n        var arrow = new MarkupArrow(this.targetId, editor);\r\n\r\n        editor.addMarkup(arrow);\r\n\r\n        // Confusing naming here. in arrow.set the first two numbers are\r\n        // the point you drag from and the second two are the point you\r\n        // drag to. So the head point is actually where the tail of the\r\n        // arrow is positioned and the tail point is the head is positioned.\r\n\r\n        //TODO: In MarkupArrow \"set\" function has tail x, tail y, head x, head y but used here in the opposite way\r\n        arrow.set(this.head.x, this.head.y, this.tail.x, this.tail.y);\r\n        arrow.setStyle(this.style);\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        var markup = this.editor.getMarkup(this.targetId);\r\n        markup && this.editor.removeMarkup(markup);\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\nimport { CreateRectangle } from './CreateRectangle'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param rectangle\r\n     * @constructor\r\n     */\r\n    export var DeleteRectangle = function(editor, rectangle) {\r\n\r\n        EditAction.call(this, editor, 'DELETE-RECTANGLE', rectangle.id);\r\n        this.createRectangle = new CreateRectangle(\r\n            editor,\r\n            rectangle.id,\r\n            rectangle.position,\r\n            rectangle.size,\r\n            rectangle.rotation,\r\n            rectangle.getStyle());\r\n    };\r\n\r\n    DeleteRectangle.prototype = Object.create(EditAction.prototype);\r\n    DeleteRectangle.prototype.constructor = DeleteRectangle;\r\n\r\n    var proto = DeleteRectangle.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        this.createRectangle.undo();\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        this.createRectangle.redo();\r\n    };\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param rectangle\r\n     * @param position\r\n     * @param size\r\n     * @constructor\r\n     */\r\n    export function SetRectangle(editor, rectangle, position, size) {\r\n\r\n        EditAction.call(this, editor, 'SET-RECTANGLE', rectangle.id);\r\n\r\n        this.newPosition = {x: position.x, y: position.y};\r\n        this.newSize = {x: size.x, y: size.y};\r\n        this.oldPosition = {x: rectangle.position.x, y: rectangle.position.y};\r\n        this.oldSize = {x: rectangle.size.x, y: rectangle.size.y};\r\n    }\r\n\r\n    SetRectangle.prototype = Object.create(EditAction.prototype);\r\n    SetRectangle.prototype.constructor = SetRectangle;\r\n\r\n    var proto = SetRectangle.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        this.applyState(this.targetId, this.newPosition, this.newSize);\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        this.applyState(this.targetId, this.oldPosition, this.oldSize);\r\n    };\r\n\r\n    proto.merge = function(action) {\r\n\r\n        if (this.targetId === action.targetId &&\r\n            this.type === action.type) {\r\n\r\n            this.newPosition = action.newPosition;\r\n            this.newSize = action.newSize;\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @private\r\n     */\r\n    proto.applyState = function(targetId, position, size) {\r\n\r\n        var rectangle = this.editor.getMarkup(targetId);\r\n        if(!rectangle) {\r\n            return;\r\n        }\r\n\r\n        // Different stroke widths make positions differ at sub-pixel level.\r\n        var epsilon = 0.0001;\r\n\r\n        if (Math.abs(rectangle.position.x - position.x) > epsilon || Math.abs(rectangle.size.y - size.y) > epsilon ||\r\n            Math.abs(rectangle.position.y - position.y) > epsilon || Math.abs(rectangle.size.y - size.y) > epsilon) {\r\n\r\n            rectangle.set(position, size);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * @returns {boolean}\r\n     */\r\n    proto.isIdentity = function() {\r\n\r\n        return(\r\n            this.newPosition.x === this.oldPosition.x &&\r\n            this.newPosition.y === this.oldPosition.y &&\r\n            this.newSize.x === this.oldSize.x &&\r\n            this.newSize.y === this.oldSize.y);\r\n    };\r\n","'use strict';\r\n\r\nimport { EditMode } from './EditMode'\r\nimport { DeleteRectangle } from '../edit-actions/DeleteRectangle'\r\nimport { CreateRectangle } from '../edit-actions/CreateRectangle'\r\nimport { SetRectangle } from '../edit-actions/SetRectangle'\r\nimport * as MarkupTypes from '../MarkupTypes'\r\n\r\n    var MeasureCommon = Autodesk.Viewing.MeasureCommon;\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @constructor\r\n     */\r\n    export function EditModeRectangle(editor) {\r\n\r\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity', 'fill-color', 'fill-opacity'];\r\n        EditMode.call(this, editor, MarkupTypes.MARKUP_TYPE_RECTANGLE, styleAttributes);\r\n    }\r\n\r\n    EditModeRectangle.prototype = Object.create(EditMode.prototype);\r\n    EditModeRectangle.prototype.constructor = EditModeRectangle;\r\n\r\n    var proto = EditModeRectangle.prototype;\r\n\r\n    proto.deleteMarkup = function(markup, cantUndo) {\r\n\r\n        markup = markup || this.selectedMarkup;\r\n        if (markup && markup.type == this.type) {\r\n            var deleteRectangle = new DeleteRectangle(this.editor, markup);\r\n            deleteRectangle.addToHistory = !cantUndo;\r\n            deleteRectangle.execute();\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * Handler to mouse move events, used to create markups.\r\n     * @param {MouseEvent} event Mouse event.\r\n     * @private\r\n     */\r\n    proto.onMouseMove = function(event) {\r\n\r\n        if (!EditMode.prototype.onMouseMove.call( this, event )) {\r\n            return false;\r\n        }\r\n\r\n        var selectedMarkup = this.selectedMarkup;\r\n\r\n        var editor = this.editor;\r\n\r\n        var pos = this.getFinalMouseDraggingPosition();\r\n        var final = editor.clientToMarkups(pos.x, pos.y);\r\n        var position = {x: (this.firstCorner.x + final.x) / 2, y: (this.firstCorner.y + final.y) / 2};\r\n\r\n        var width, height;\r\n        // Snap to parallel/perpendicular of underlying vectors\r\n        if (editor.snapper && this.lineSnapped) {\r\n            var start = editor.project(this.lineSnapped.vertices[0]);\r\n            var end = editor.project(this.lineSnapped.vertices[1]);\r\n\r\n            var startZ = start.z;\r\n\r\n            start = editor.clientToMarkups(start.x, start.y);\r\n            end = editor.clientToMarkups(end.x, end.y);\r\n\r\n            start = new THREE.Vector3(start.x, start.y, startZ);\r\n            end = new THREE.Vector3(end.x, end.y, startZ);\r\n\r\n            var p = new THREE.Vector3(final.x, final.y, startZ);\r\n\r\n            var parallel = MeasureCommon.nearestPointInPointToLine(p, start, end);\r\n            height = p.distanceTo(parallel);\r\n\r\n            // select an arbitrary point on the perpendicular line\r\n            var k = -(start.x - end.x) / (start.y - end.y);\r\n            var b = this.firstCorner.y - k * this.firstCorner.x;\r\n            var x = this.firstCorner.x + 1;\r\n            var y = k * x + b;\r\n            var pEnd = new THREE.Vector3(x, y, startZ);\r\n\r\n            var pStart = new THREE.Vector3(this.firstCorner.x, this.firstCorner.y, startZ);\r\n            var perpendicular = MeasureCommon.nearestPointInPointToLine(p, pStart, pEnd);\r\n            width = p.distanceTo(perpendicular);\r\n        }\r\n        else {\r\n            width = final.x - this.firstCorner.x;\r\n            height = final.y - this.firstCorner.y;\r\n        }\r\n\r\n        var size = this.size = {x: Math.abs(width), y: Math.abs(height)};\r\n\r\n        var setRectangle = new SetRectangle(\r\n            editor,\r\n            selectedMarkup,\r\n            position,\r\n            size);\r\n\r\n        setRectangle.execute();\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Handler to mouse down events, used to start markups creation.\r\n     * @private\r\n     */\r\n    proto.onMouseDown = function() {\r\n\r\n        EditMode.prototype.onMouseDown.call(this);\r\n\r\n        if (this.selectedMarkup) {\r\n            return;\r\n        }\r\n\r\n        var editor = this.editor;\r\n        var mousePosition = editor.getMousePosition();\r\n\r\n        this.initialX = mousePosition.x;\r\n        this.initialY = mousePosition.y;\r\n\r\n        // Calculate center and size.\r\n        var position = this.firstCorner = editor.clientToMarkups(this.initialX, this.initialY);\r\n        var size = this.size = editor.sizeFromClientToMarkups(1, 1);\r\n\r\n        // Calculate rotation\r\n        var rotation = 0;\r\n        this.lineSnapped = null;\r\n        if (editor.snapper) {\r\n            // Snap to parallel/perpendicular of underlying vectors\r\n            var geomType = editor.snapper.getGeometryType();\r\n            if (geomType === MeasureCommon.SnapType.SNAP_EDGE) {\r\n                this.lineSnapped = editor.snapper.getEdge();\r\n                var start = editor.project(this.lineSnapped.vertices[0]);\r\n                var end = editor.project(this.lineSnapped.vertices[1]);\r\n                var dx = end.x - start.x;\r\n                var dy = end.y - start.y;\r\n                rotation = this.rotation = Math.atan2(dy, dx);\r\n            }\r\n        }\r\n\r\n        // Create rectangle.\r\n        editor.beginActionGroup();\r\n\r\n        var markupId = editor.getId();\r\n        var create = new CreateRectangle(\r\n            editor,\r\n            markupId,\r\n            position,\r\n            size,\r\n            rotation,\r\n            this.style);\r\n\r\n        create.execute();\r\n\r\n        this.selectedMarkup = editor.getMarkup(markupId);\r\n        this.creationBegin();\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { Markup } from './Markup'\r\nimport * as MarkupTypes from './MarkupTypes'\r\nimport { createMarkupPathSvg, composeRGBAString, createRectanglePath,\r\n    setAttributeToMarkupSvg, updateMarkupPathSvgHitarea, addMarkupMetadata } from './MarkupsCoreUtils'\r\nimport { cloneStyle } from './StyleUtils'\r\nimport { EditModeRectangle } from './edit-modes/EditModeRectangle'\r\n\r\n    /**\r\n     * Rectangle markup.\r\n     *\r\n     * Implements a Rectangle {@link Autodesk.Viewing.Extensions.Markups.Core.Markup|Markup}.\r\n     * Included in documentation as an example of how to create\r\n     * a specific markup type. Developers are encourage to look into this class's source code and copy\r\n     * as much code as they need. Find link to source code below.\r\n     *\r\n     * @tutorial feature_markup\r\n     * @constructor\r\n     * @memberof Autodesk.Viewing.Extensions.Markups.Core\r\n     * @extends Autodesk.Viewing.Extensions.Markups.Core.Markup\r\n     *\r\n     * @param {number} id\r\n     * @param {Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore} editor\r\n     * @constructor\r\n     */\r\n    export function MarkupRectangle(id, editor) {\r\n\r\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity', 'fill-color', 'fill-opacity'];\r\n        Markup.call(this, id, editor, styleAttributes);\r\n\r\n        // Bind to this to pass this.globalManager\r\n        this.addMarkupMetadata = addMarkupMetadata.bind(this);\r\n\r\n        this.type = MarkupTypes.MARKUP_TYPE_RECTANGLE;\r\n        this.shape = createMarkupPathSvg();\r\n\r\n        this.bindDomEvents();\r\n    }\r\n\r\n    MarkupRectangle.prototype = Object.create(Markup.prototype);\r\n    MarkupRectangle.prototype.constructor = MarkupRectangle;\r\n\r\n    var proto = MarkupRectangle.prototype;\r\n\r\n    proto.getEditMode = function() {\r\n\r\n        return new EditModeRectangle(this.editor);\r\n    };\r\n\r\n    /**\r\n     * Sets position and size in markup space coordinates\r\n     * @param {Object} position\r\n     * @param {Object} size\r\n     */\r\n    proto.set = function(position, size) {\r\n\r\n        this.position.x = position.x;\r\n        this.position.y = position.y;\r\n        this.size.x = size.x;\r\n        this.size.y = size.y;\r\n\r\n        this.updateStyle();\r\n    };\r\n\r\n    /**\r\n     * Applies data values into DOM element style/attribute(s)\r\n     *\r\n     */\r\n    proto.updateStyle = function() {\r\n\r\n        var style = this.style;\r\n        var shape = this.shape;\r\n        var path = this.getPath().join(' ');\r\n\r\n        var strokeWidth = this.style['stroke-width'];\r\n        var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\r\n        var fillColor = composeRGBAString(style['fill-color'], style['fill-opacity']);\r\n        var transform = this.getTransform();\r\n\r\n        setAttributeToMarkupSvg(shape, 'd', path);\r\n        setAttributeToMarkupSvg(shape, 'stroke-width', strokeWidth);\r\n        setAttributeToMarkupSvg(shape, 'stroke', strokeColor);\r\n        setAttributeToMarkupSvg(shape, 'fill', fillColor);\r\n        setAttributeToMarkupSvg(shape, 'transform', transform);\r\n        updateMarkupPathSvgHitarea(shape, this.editor);\r\n    };\r\n\r\n    proto.setMetadata = function() {\r\n\r\n        var metadata = cloneStyle(this.style);\r\n\r\n        metadata.type = this.type;\r\n        metadata.position = [this.position.x, this.position.y].join(\" \");\r\n        metadata.size = [this.size.x, this.size.y].join(\" \");\r\n        metadata.rotation = String(this.rotation);\r\n\r\n        return this.addMarkupMetadata(this.shape, metadata);\r\n    };\r\n\r\n    proto.getPath = function() {\r\n\r\n        var strokeWidth = this.style['stroke-width'];\r\n\r\n        var w = this.size.x - strokeWidth;\r\n        var h = this.size.y - strokeWidth;\r\n        var x =-w * 0.5;\r\n        var y =-h * 0.5;\r\n\r\n        var path = [];\r\n        createRectanglePath(x, y, w, h, false, path);\r\n\r\n        return path;\r\n    };\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\nimport { MarkupRectangle } from '../MarkupRectangle'\r\nimport { cloneStyle } from '../StyleUtils'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param id\r\n     * @param position\r\n     * @param size\r\n     * @param rotation\r\n     * @param style\r\n     * @constructor\r\n     */\r\n    export function CreateRectangle(editor, id, position, size, rotation, style) {\r\n\r\n        EditAction.call(this, editor, 'CREATE-RECTANGLE', id);\r\n\r\n        this.selectOnExecution = false;\r\n        this.position = {x: position.x, y: position.y};\r\n        this.size = {x: size.x, y: size.y};\r\n        this.rotation = rotation;\r\n        this.style = cloneStyle(style);\r\n    }\r\n\r\n    CreateRectangle.prototype = Object.create(EditAction.prototype);\r\n    CreateRectangle.prototype.constructor = CreateRectangle;\r\n\r\n    var proto = CreateRectangle.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        var editor = this.editor;\r\n        var rectangle = new MarkupRectangle(this.targetId, editor);\r\n\r\n        editor.addMarkup(rectangle);\r\n\r\n        rectangle.set(this.position, this.size);\r\n        rectangle.setRotation(this.rotation);\r\n        rectangle.setStyle(this.style);\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        var markup = this.editor.getMarkup(this.targetId);\r\n        markup && this.editor.removeMarkup(markup);\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\nimport { CreateText } from './CreateText'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param text\r\n     * @constructor\r\n     */\r\n    export function DeleteText(editor, text) {\r\n\r\n        EditAction.call(this, editor, 'DELETE-TEXT', text.id);\r\n\r\n        var position = {x: text.position.x, y: text.position.y};\r\n        var size = {x: text.size.x, y: text.size.y};\r\n\r\n        this.createText = new CreateText(\r\n            editor,\r\n            text.id,\r\n            position,\r\n            size,\r\n            text.getText(),\r\n            text.getStyle());\r\n    }\r\n\r\n    DeleteText.prototype = Object.create(EditAction.prototype);\r\n    DeleteText.prototype.constructor = DeleteText;\r\n\r\n    var proto = DeleteText.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        this.createText.undo();\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        this.createText.redo();\r\n    };\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param markup\r\n     * @param position\r\n     * @param size\r\n     * @param text\r\n     * @constructor\r\n     */\r\n    export function SetCallout(editor, markup, position, size, text, isFrameUsed) {\r\n\r\n        EditAction.call(this, editor, 'SET-CALLOUT', markup.id);\r\n\r\n        this.newPosition = {x: position.x, y: position.y};\r\n        this.oldPosition = {x: markup.position.x, y: markup.position.y};\r\n        this.newSize = {x: size.x, y: size.y};\r\n        this.oldSize = {x: markup.size.x, y: markup.size.y};\r\n        this.newText = text;\r\n        this.oldText = markup.getText();\r\n        this.newIsFrameUsed = isFrameUsed;\r\n        this.oldIsFrameUsed = markup.isFrameUsed;\r\n    }\r\n\r\n    SetCallout.prototype = Object.create(EditAction.prototype);\r\n    SetCallout.prototype.constructor = SetCallout;\r\n\r\n    var proto = SetCallout.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        var callout = this.editor.getMarkup(this.targetId);\r\n        callout && callout.set(this.newPosition, this.newSize, this.newText, this.newIsFrameUsed);\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        var callout = this.editor.getMarkup(this.targetId);\r\n        callout && callout.set(this.oldPosition, this.oldSize, this.oldText, this.oldIsFrameUsed);\r\n    };\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param markup\r\n     * @param position\r\n     * @param width\r\n     * @param height\r\n     * @constructor\r\n     */\r\n    export function SetSize(editor, markup, position, width, height) {\r\n\r\n        EditAction.call(this, editor, 'SET-SIZE', markup.id);\r\n\r\n        this.newPosition = {x: position.x, y: position.y};\r\n        this.oldPosition = {x: markup.position.x, y: markup.position.y};\r\n        this.newWidth = width;\r\n        this.oldWidth = markup.size.x;\r\n        this.newHeight = height;\r\n        this.oldHeight = markup.size.y;\r\n    }\r\n\r\n    SetSize.prototype = Object.create(EditAction.prototype);\r\n    SetSize.prototype.constructor = SetSize;\r\n\r\n    var proto = SetSize.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        var markup = this.editor.getMarkup(this.targetId);\r\n        markup && markup.setSize(this.newPosition, this.newWidth, this.newHeight);\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        var markup = this.editor.getMarkup(this.targetId);\r\n        markup && markup.setSize(this.oldPosition, this.oldWidth, this.oldHeight);\r\n    };\r\n\r\n    proto.merge = function(action) {\r\n\r\n        if (this.targetId === action.targetId &&\r\n            this.type === action.type) {\r\n\r\n            this.newPosition = action.newPosition;\r\n            this.newWidth = action.newWidth;\r\n            this.newHeight = action.newHeight;\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * @returns {boolean}\r\n     */\r\n    proto.isIdentity = function() {\r\n\r\n        var identity =\r\n            this.newPosition.x === this.oldPosition.x &&\r\n            this.newPosition.y === this.oldPosition.y &&\r\n            this.newWidth === this.oldWidth &&\r\n            this.newHeight === this.oldHeight;\r\n\r\n        return identity;\r\n    };\r\n","\r\n'use strict';\r\n\r\n/*!\r\n    Based on Autosize 4.0.0\r\n    license: MIT\r\n    http://www.jacklmoore.com/autosize\r\n*/\r\nvar map = typeof Map === \"function\" ? new Map() : (function () {\r\n    var keys = [];\r\n    var values = [];\r\n\r\n    return {\r\n        has: function has(key) {\r\n            return keys.indexOf(key) > -1;\r\n        },\r\n        get: function get(key) {\r\n            return values[keys.indexOf(key)];\r\n        },\r\n        set: function set(key, value) {\r\n            if (keys.indexOf(key) === -1) {\r\n                keys.push(key);\r\n                values.push(value);\r\n            }\r\n        },\r\n        'delete': function _delete(key) {\r\n            var index = keys.indexOf(key);\r\n            if (index > -1) {\r\n                keys.splice(index, 1);\r\n                values.splice(index, 1);\r\n            }\r\n        }\r\n    };\r\n})();\r\n\r\nvar createEvent = function createEvent(name) {\r\n    return new Event(name, { bubbles: true });\r\n};\r\ntry {\r\n    new Event('test');\r\n} catch (e) {\r\n    // IE does not support `new Event()`\r\n    createEvent = function (name) {\r\n        const _document = Autodesk.Viewing.getGlobal().document;\r\n        var evt = _document.createEvent('Event');\r\n        evt.initEvent(name, true, false);\r\n        return evt;\r\n    };\r\n}\r\n\r\nfunction assign(ta) {\r\n    if (!ta || !ta.nodeName || ta.nodeName !== 'TEXTAREA' || map.has(ta)) return;\r\n\r\n    var heightOffset = null;\r\n    var clientWidth = ta.clientWidth;\r\n    var cachedHeight = null;\r\n\r\n    const self = this;\r\n    function init() {\r\n        const _window = self.getWindow();\r\n        var style = _window.getComputedStyle(ta, null);\r\n\r\n        if (style.resize === 'vertical') {\r\n            ta.style.resize = 'none';\r\n        } else if (style.resize === 'both') {\r\n            ta.style.resize = 'horizontal';\r\n        }\r\n\r\n        if (style.boxSizing === 'content-box') {\r\n            heightOffset = -(parseFloat(style.paddingTop) + parseFloat(style.paddingBottom));\r\n        } else {\r\n            heightOffset = parseFloat(style.borderTopWidth) + parseFloat(style.borderBottomWidth);\r\n        }\r\n        // Fix when a textarea is not on document body and heightOffset is Not a Number\r\n        if (isNaN(heightOffset)) {\r\n            heightOffset = 0;\r\n        }\r\n\r\n        update();\r\n    }\r\n\r\n    function changeOverflow(value) {\r\n        {\r\n            // Chrome/Safari-specific fix:\r\n            // When the textarea y-overflow is hidden, Chrome/Safari do not reflow the text to account for the space\r\n            // made available by removing the scrollbar. The following forces the necessary text reflow.\r\n            var width = ta.style.width;\r\n            ta.style.width = '0px';\r\n            // Force reflow:\r\n            /* jshint ignore:start */\r\n            ta.offsetWidth;\r\n            /* jshint ignore:end */\r\n            ta.style.width = width;\r\n        }\r\n\r\n        ta.style.overflow = value;\r\n    }\r\n\r\n    function getParentOverflows(el) {\r\n        var arr = [];\r\n\r\n        while (el && el.parentNode && el.parentNode instanceof Element) {\r\n            if (el.parentNode.scrollTop) {\r\n                arr.push({\r\n                    node: el.parentNode,\r\n                    scrollTop: el.parentNode.scrollTop\r\n                });\r\n            }\r\n            el = el.parentNode;\r\n        }\r\n\r\n        return arr;\r\n    }\r\n\r\n    function resize() {\r\n        var originalHeight = ta.style.height;\r\n        var overflows = getParentOverflows(ta);\r\n        const _document = self.getDocument();\r\n        var docTop = _document.documentElement && _document.documentElement.scrollTop; // Needed for Mobile IE (ticket #240)\r\n\r\n        ta.style.height = '';\r\n\r\n        var endHeight = ta.scrollHeight + heightOffset;\r\n\r\n        if (ta.scrollHeight === 0) {\r\n            // If the scrollHeight is 0, then the element probably has display:none or is detached from the DOM.\r\n            ta.style.height = originalHeight;\r\n            return;\r\n        }\r\n\r\n        ta.style.height = endHeight + 'px';\r\n\r\n        // used to check if an update is actually necessary on window.resize\r\n        clientWidth = ta.clientWidth;\r\n\r\n        // prevents scroll-position jumping\r\n        overflows.forEach(function (el) {\r\n            // This condition is necessary for iOS 11, where you can't assign value to body.scrollTop\r\n            if (el.node.scrollTop !== el.scrollTop) {\r\n                el.node.scrollTop = el.scrollTop;\r\n            }\r\n        });\r\n\r\n        if (docTop) {\r\n            _document.documentElement.scrollTop = docTop;\r\n        }\r\n    }\r\n\r\n    function update() {\r\n        resize();\r\n\r\n        const _window = self.getWindow();\r\n        var styleHeight = Math.round(parseFloat(ta.style.height));\r\n        var computed = _window.getComputedStyle(ta, null);\r\n\r\n        // Using offsetHeight as a replacement for computed.height in IE, because IE does not account use of border-box\r\n        var actualHeight = computed.boxSizing === 'content-box' ? Math.round(parseFloat(computed.height)) : ta.offsetHeight;\r\n\r\n        // The actual height not matching the style height (set via the resize method) indicates that\r\n        // the max-height has been exceeded, in which case the overflow should be allowed.\r\n        if (actualHeight !== styleHeight) {\r\n            if (computed.overflow === 'hidden') {\r\n                changeOverflow('scroll');\r\n                resize();\r\n                actualHeight = computed.boxSizing === 'content-box' ? Math.round(parseFloat(window.getComputedStyle(ta, null).height)) : ta.offsetHeight;\r\n            }\r\n        } else {\r\n            // Normally keep overflow set to hidden, to avoid flash of scrollbar as the textarea expands.\r\n            if (computed.overflow !== 'hidden') {\r\n                changeOverflow('hidden');\r\n                resize();\r\n                actualHeight = computed.boxSizing === 'content-box' ? Math.round(parseFloat(window.getComputedStyle(ta, null).height)) : ta.offsetHeight;\r\n            }\r\n        }\r\n\r\n        if (cachedHeight !== actualHeight) {\r\n            cachedHeight = actualHeight;\r\n            var evt = createEvent('autosize:resized');\r\n            try {\r\n                ta.dispatchEvent(evt);\r\n            } catch (err) {\r\n                // Firefox will throw an error on dispatchEvent for a detached element\r\n                // https://bugzilla.mozilla.org/show_bug.cgi?id=889376\r\n            }\r\n        }\r\n    }\r\n\r\n    var pageResize = function pageResize() {\r\n        if (ta.clientWidth !== clientWidth) {\r\n            update();\r\n        }\r\n    };\r\n\r\n    var destroy = (function (style) {\r\n        self.removeWindowEventListener('resize', pageResize, false);\r\n        ta.removeEventListener('input', update, false);\r\n        ta.removeEventListener('keyup', update, false);\r\n        ta.removeEventListener('autosize:destroy', destroy, false);\r\n        ta.removeEventListener('autosize:update', update, false);\r\n\r\n        Object.keys(style).forEach(function (key) {\r\n            ta.style[key] = style[key];\r\n        });\r\n\r\n        map['delete'](ta);\r\n    }).bind(ta, {\r\n        height: ta.style.height,\r\n        resize: ta.style.resize,\r\n        overflow: ta.style.overflow,\r\n        overflowX: ta.style.overflowX,\r\n        wordWrap: ta.style.wordWrap\r\n    });\r\n\r\n    ta.addEventListener('autosize:destroy', destroy, false);\r\n\r\n    // IE9 does not fire onpropertychange or oninput for deletions,\r\n    // so binding to onkeyup to catch most of those events.\r\n    // There is no way that I know of to detect something like 'cut' in IE9.\r\n    if ('onpropertychange' in ta && 'oninput' in ta) {\r\n        ta.addEventListener('keyup', update, false);\r\n    }\r\n\r\n    self.addWindowEventListener('resize', pageResize, false);\r\n    ta.addEventListener('input', update, false);\r\n    ta.addEventListener('autosize:update', update, false);\r\n    ta.style.overflowX = 'hidden';\r\n    ta.style.wordWrap = 'break-word';\r\n\r\n    map.set(ta, {\r\n        destroy: destroy,\r\n        update: update\r\n    });\r\n\r\n    init();\r\n}\r\n\r\nfunction destroy(ta) {\r\n    var methods = map.get(ta);\r\n    if (methods) {\r\n        methods.destroy();\r\n    }\r\n}\r\n\r\nfunction update(ta) {\r\n    var methods = map.get(ta);\r\n    if (methods) {\r\n        methods.update();\r\n    }\r\n}\r\n\r\nfunction isRuntimeSupported() {\r\n    // Don't support Node.js and IE8 (or lower)\r\n\r\n    if (typeof window === 'undefined' || typeof window.getComputedStyle !== 'function')\r\n        return false;\r\n    return true;\r\n}\r\n\r\nconst RUNTIME_SUPPORTED = isRuntimeSupported();\r\n\r\n\r\nexport var autosize = function(el, options) {\r\n    const self = this;\r\n    if (RUNTIME_SUPPORTED && el) {\r\n        Array.prototype.forEach.call(el.length ? el : [el], function (x) {\r\n            return assign.bind(self)(x, options);\r\n        });\r\n    } \r\n    return el;\r\n};\r\n\r\nautosize.destroy = function(el) {\r\n    if (RUNTIME_SUPPORTED && el) {\r\n        Array.prototype.forEach.call(el.length ? el : [el], destroy);\r\n    }\r\n    return el;\r\n}\r\n\r\nautosize.update = function(el) {\r\n    if (RUNTIME_SUPPORTED && el) {\r\n        Array.prototype.forEach.call(el.length ? el : [el], update);\r\n    }\r\n    return el;\r\n}\r\n","'use strict';\r\n\r\n    /**\r\n     * Curring object which generate a string that can be used\r\n     * as a Dom element's 'style' value.\r\n     *\r\n     * @constructor\r\n     */\r\n    export function DomElementStyle() {\r\n\r\n        this.reset();\r\n    }\r\n\r\n    /*\r\n     * Constants\r\n     */\r\n    var BROWSER_PREFIXES = ['-ms-', '-webkit-', '-moz-', '-o-'];\r\n\r\n    var proto = DomElementStyle.prototype;\r\n\r\n    proto.reset = function() {\r\n\r\n        this.attributes = {};\r\n        this.dirty = false;\r\n        this.styleString = '';\r\n\r\n        return this;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param {String} key\r\n     * @param {*} value\r\n     * @param {Object} [options]\r\n     * @param {Boolean} [options.allBrowsers] - Whether to add browser prefix to key\r\n     * @returns {Autodesk.Viewing.Extensions.Markups.Core.Utils.DomeElemStyle}\r\n     */\r\n    proto.setAttribute = function(key, value, options) {\r\n\r\n        this.attributes[key] = value;\r\n\r\n        if (options && options.allBrowsers) {\r\n            var that = this;\r\n            BROWSER_PREFIXES.forEach(function(prefix){\r\n                that.attributes[(prefix+key)] = value;\r\n            });\r\n        }\r\n        this.dirty = true; // Could be optimized\r\n        return this;\r\n    };\r\n\r\n    /**\r\n     * Removes one or more attributes\r\n     * @param {String|Array} key - Key or Keys to be removed\r\n     * @returns {Autodesk.Viewing.Extensions.Markups.Core.Utils.DomElemStyle} this\r\n     */\r\n    proto.removeAttribute = function(key) {\r\n\r\n        if (!Array.isArray(key)) {\r\n            key = [key];\r\n        }\r\n\r\n        var self = this;\r\n        key.forEach(function(k) {\r\n            if (k in self.attributes) {\r\n                delete self.attributes[k];\r\n                self.dirty = true;\r\n            }\r\n        });\r\n        return this;\r\n    };\r\n\r\n    /**\r\n     * Gets the String representation of this style object\r\n     * @returns {string}\r\n     */\r\n    proto.getStyleString = function() {\r\n\r\n        if (this.dirty) {\r\n            this.styleString = generateStyle(this.attributes);\r\n            this.dirty = false;\r\n        }\r\n        return this.styleString;\r\n    };\r\n\r\n    /**\r\n     * Clones the current Object\r\n     *\r\n     * @returns {Autodesk.Viewing.Extensions.Markups.Core.Utils.DomElemStyle}\r\n     */\r\n    proto.clone = function() {\r\n\r\n        var clone = new DomElementStyle();\r\n        var attributes = this.attributes;\r\n\r\n        for (var key in attributes) {\r\n            clone.setAttribute(key, attributes[key]);\r\n        }\r\n        return clone;\r\n    };\r\n\r\n    /**\r\n     * Generates the style value string. Non mutable function.\r\n     *\r\n     * @param {Object} attributes\r\n     * @private\r\n     */\r\n    function generateStyle(attributes) {\r\n\r\n        var elements = [];\r\n        for (var key in attributes) {\r\n            var val = attributes[key];\r\n            elements.push(key);\r\n            elements.push(':');\r\n            elements.push(val);\r\n            elements.push('; ');\r\n        }\r\n        return elements.join('');\r\n    }\r\n","'use strict';\r\n\r\nconst ResizeObserver = require('../../../thirdparty/resize-observer-polyfill/ResizeObserver.min.js'); // Required for Markup Text Input\r\nimport { autosize } from './EditorTextAutosize'\r\nimport { addTraitEventDispatcher } from '../MarkupsCoreUtils'\r\nimport { cloneStyle } from '../StyleUtils'\r\nimport { DomElementStyle } from '../DomElementStyle'\r\n\r\nconst av = Autodesk.Viewing;\r\n\r\n    /**\r\n     * Auxiliary class that handles all input for the Label Markup (MarkupText.js)\r\n     * It instantiates a TEXTAREA where the user can input text. When user input is\r\n     * disabled, the textarea gets hidden and further rendering is delegated to\r\n     * MarkupText.js\r\n     *\r\n     * @param {HTMLElement} parentDiv\r\n     * @param {Object} editor - Core Extension\r\n     * @constructor\r\n     */\r\n    export function EditorTextInput(parentDiv, editor, singleLine, defaultText, maxLength) {\r\n\r\n        this.parentDiv = parentDiv;\r\n        this.editor = editor;\r\n        this.setGlobalManager(editor.viewer.globalManager);\r\n\r\n        // Constants\r\n        this.EVENT_TEXT_CHANGE = 'EVENT_CO2_TEXT_CHANGE';\r\n        this.EVENT_TEXT_SET_ACTIVE = 'EVENT_CO2_TEXT_SET_ACTIVE';\r\n        this.EVENT_TEXT_SET_INACTIVE = 'EVENT_CO2_TEXT_SET_INACTIVE';\r\n\r\n        const _document = this.getDocument();\r\n        // The actual TextArea input\r\n        if (singleLine) {\r\n            this.textArea = _document.createElement('input');\r\n            this.textArea.setAttribute('type', 'text');\r\n        }\r\n        else {\r\n            this.textArea = _document.createElement('textarea');\r\n            this.textArea.rows = '1';\r\n            if (!Autodesk.Viewing.isIE11) { // auto parameter not available in IE11\r\n                this.textArea.dir = 'auto';\r\n            }\r\n        }\r\n\r\n        this.firstEdit = true;\r\n        this.defaultText = defaultText;\r\n        this.textArea.setAttribute('maxlength', maxLength); // TODO: Make constant? Change value?\r\n        this.textArea.setAttribute('data-i18n', defaultText);\r\n        this.startingHeight = 0;\r\n\r\n        autosize.bind(this)(this.textArea);\r\n\r\n        var ro = new ResizeObserver(function(entries, observer) {\r\n            this.setEditFrame();\r\n        }.bind(this));\r\n\r\n        ro.observe(this.textArea);\r\n\r\n        this.styleTextArea = new DomElementStyle(); // TODO: Move this to EditMode.\r\n        this.styleTextArea\r\n                .setAttribute('position', 'absolute')\r\n                .setAttribute('resize', 'none')\r\n                .setAttribute('box-sizing', 'border-box')\r\n                .setAttribute('-moz-box-sizing', 'border-box')\r\n                .setAttribute('-webkit-box-sizing', 'border-box')\r\n                .setAttribute('overflow', 'hidden')\r\n                .setAttribute('outline', 'none')\r\n                .setAttribute('border', 'none')\r\n                .setAttribute('z-index', '1')\r\n                .setAttribute('padding', '10px');\r\n\r\n        // Helper div to measure text width\r\n        this.measureDiv = _document.createElement('div');\r\n\r\n        // Become an event dispatcher\r\n        addTraitEventDispatcher(this);\r\n    }\r\n\r\n    av.GlobalManagerMixin.call(EditorTextInput.prototype);\r\n    var proto = EditorTextInput.prototype;\r\n\r\n    proto.destroy = function() {\r\n\r\n        this.setInactive();\r\n    };\r\n\r\n    /**\r\n     * Initializes itself given an Label Markup (textMarkup)\r\n     * @param {Object} textMarkup\r\n     * @param {Boolean} firstEdit - Whether the markup is being edited for the first time.\r\n     */\r\n    proto.setActive = function(textMarkup, firstEdit) {\r\n\r\n        if (this.textMarkup === textMarkup) {\r\n            return;\r\n        }\r\n\r\n        var placeholderText = Autodesk.Viewing.i18n.translate(this.defaultText);\r\n        this.textArea.setAttribute('placeholder', placeholderText);\r\n\r\n        this.setInactive();\r\n        this.parentDiv.appendChild(this.textArea);\r\n        this.textMarkup = textMarkup;\r\n        this.firstEdit = firstEdit || false;\r\n\r\n        this.constrainToCanvas = firstEdit;\r\n\r\n        this.initFromMarkup();\r\n\r\n        this.constrainToCanvas = false;\r\n\r\n        // On iOS this doesn't work quite well, the keyboard will dismiss after call focus programatically.\r\n        // http://stackoverflow.com/questions/32407185/wkwebview-cant-open-keyboard-for-input-field\r\n        if (!Autodesk.Viewing.isIOSDevice()) {\r\n          // Focus on next frame\r\n          var txtArea = this.textArea;\r\n          const _window = this.getWindow();\r\n          _window.requestAnimationFrame(function(){\r\n              txtArea.focus();\r\n          });\r\n        }\r\n\r\n        var dataBag = {\r\n            markup: this.textMarkup,\r\n            firstEdit: this.firstEdit,\r\n            isActive: true\r\n        };\r\n        this.dispatchEvent({ type: this.EVENT_TEXT_SET_ACTIVE, data: dataBag });\r\n    };\r\n\r\n    /**\r\n     * Closes the editor text input and goes back into normal markup edition mode.\r\n     */\r\n    proto.setInactive = function() {\r\n        var dataBag = {\r\n            markup: this.textMarkup,\r\n            isActive: false\r\n        };\r\n\r\n        // In iOS10, the keyboard always show on screen after tap screen out of text\r\n        // area or save markup to end text edit, call blur to make sure keyboard dismiss.\r\n        if (Autodesk.Viewing.isIOSDevice())\r\n        {\r\n            this.textArea.blur();\r\n        }\r\n\r\n        this.removeWindowEventListener('resize', this.onResizeBinded);\r\n\r\n        if (this.textMarkup) {\r\n            this.textMarkup = null;\r\n            this.parentDiv.removeChild(this.textArea);\r\n        }\r\n        this.style = null;\r\n\r\n        this.dispatchEvent({ type: this.EVENT_TEXT_SET_INACTIVE, data: dataBag });\r\n    };\r\n\r\n    proto.isActive = function() {\r\n\r\n        return !!this.textMarkup;\r\n    };\r\n\r\n    proto.setEditFrame = function() {\r\n        if (this.editor.editFrame.markup && this.textMarkup && this.editor.editFrame.markup === this.textMarkup) {\r\n            var frameWidth = parseFloat(this.textArea.style.width);\r\n            var frameHeight = parseFloat(this.textArea.style.height);\r\n\r\n            var position = this.textMarkup.getClientPosition();\r\n            var rotation = this.textMarkup.getRotation();\r\n\r\n            var xPos = position.x - (frameWidth / 2);\r\n            var yPos = position.y - (this.startingHeight / 2);\r\n\r\n            this.editor.editFrame.setSelection(xPos, yPos, frameWidth, frameHeight, rotation);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Applies Markup styles to TextArea used for editing.\r\n     * It also saves a copy of the style object.\r\n     * @private\r\n     */\r\n    proto.initFromMarkup = function(updateStyleFirst) {\r\n\r\n        var markup = this.textMarkup;\r\n        var position = markup.getClientPosition();\r\n        var size = markup.getClientSize();\r\n\r\n        // Text area padding is relative to the current font size\r\n        var padding = markup.getClientFontSize() / 2;\r\n\r\n        this.startingHeight = size.y;\r\n\r\n        var left = position.x - size.x * 0.5;\r\n        var top = position.y - size.y * 0.5;\r\n\r\n        var lineHeightPercentage = markup.lineHeight + \"%\";\r\n        this.styleTextArea.setAttribute('line-height', lineHeightPercentage);\r\n        this.styleTextArea.setAttribute('padding', padding + 'px');\r\n\r\n        this.setPosAndSize(left, top, size.x, size.y);\r\n        if (updateStyleFirst) {\r\n            this.setStyle(markup.getStyle());\r\n            this.textArea.value = markup.getText();\r\n        } else {\r\n            this.textArea.value = markup.getText();\r\n            this.setStyle(markup.getStyle());\r\n        }\r\n    };\r\n\r\n    proto.setPosAndSize = function(left, top, width, height) {\r\n        if (this.constrainToCanvas) {\r\n            // Check that it doesn't overflow out of the canvas\r\n            if (left + width >= this.editor.viewer.container.clientWidth) {\r\n                left = this.editor.viewer.container.clientWidth - (width + 10);\r\n            }\r\n            if (top + height >= this.editor.viewer.container.clientHeight) {\r\n                top = this.editor.viewer.container.clientHeight - (height + 10);\r\n            }\r\n\r\n            // Make sure text input left side always in the canvas area.\r\n            // Especially on iPhone6 & iPhone7\r\n            if (left < 5) {\r\n                left = 5;\r\n                width = this.editor.viewer.container.clientWidth - 10;\r\n            }\r\n        }\r\n\r\n        this.styleTextArea\r\n            // Size and position\r\n            .setAttribute('left', left + 'px')\r\n            .setAttribute('top', top + 'px')\r\n            .setAttribute('width', width + 'px')\r\n            .setAttribute('height', height + 'px');\r\n    };\r\n\r\n    proto.setStyle = function(style) {\r\n\r\n        if (this.style) {\r\n            // An already present style means that the user\r\n            // has changed the style using the UI buttons.\r\n            // We need to account for the user having changed the\r\n            // width/height of the TextArea. Since there is no event\r\n            // we can detect for it, we do it here.\r\n            var temp = {};\r\n            this.injectSizeValues(temp);\r\n            this.setPosAndSize(\r\n                temp.newPos.x - temp.width * 0.5,\r\n                temp.newPos.y - temp.height * 0.5,\r\n                temp.width, temp.height);\r\n        }\r\n        var fontHeight = this.editor.sizeFromMarkupsToClient(0, style['font-size']).y;\r\n        var strokeWidth = this.editor.sizeFromMarkupsToClient(0, style['stroke-width']).y;\r\n        var textAreaStyle = this.styleTextArea\r\n            // Visuals\r\n            .setAttribute('color', style['stroke-color'])\r\n            .setAttribute('outline', strokeWidth + 'px solid ' + style['stroke-color'])\r\n            .setAttribute('font-family', style['font-family'])\r\n            .setAttribute('font-size', fontHeight + 'px')\r\n            .setAttribute('font-weight', style['font-weight'])\r\n            .setAttribute('font-style', style['font-style'])\r\n            .getStyleString();\r\n        this.textArea.setAttribute('style', textAreaStyle);\r\n        this.style = cloneStyle(style);\r\n        autosize.update(this.textArea);\r\n    };\r\n\r\n    /**\r\n     * Helper function that, for a given markup with some text in it\r\n     * returns an Array of lines in it.\r\n     * @param {Object} markup\r\n     * @returns {{text, lines}|{text: String, lines: Array.<String>}}\r\n     */\r\n    proto.getTextValuesForMarkup = function(markup, sizeUpdateRequired) {\r\n        var active = this.isActive();\r\n        var activeMarkup = this.textMarkup;\r\n        var activeFirstEdit = this.firstEdit;\r\n\r\n        this.setActive(markup, false);\r\n        var textValues = this.getTextValues();\r\n\r\n        var dataBag = {\r\n            markup: markup,\r\n            textValues: textValues\r\n        };\r\n\r\n        if (active) {\r\n            this.setActive(activeMarkup, activeFirstEdit);\r\n        } else {\r\n            if (sizeUpdateRequired) {\r\n                this.injectSizeValues(dataBag);\r\n            }\r\n\r\n            this.setInactive();\r\n        }\r\n\r\n        return dataBag;\r\n    };\r\n\r\n    /**\r\n     * Returns the current text as one string and an array of lines\r\n     * of how the text is being rendered (1 string per line)\r\n     * @returns {{text: String, lines: Array.<String>}}\r\n     */\r\n    proto.getTextValues = function() {\r\n\r\n        var newText = this.textArea.value;\r\n        if (newText === this.defaultText) {\r\n            newText = '';\r\n        }\r\n        return {\r\n            text: newText,\r\n            lines: this.generateLines()\r\n        };\r\n    };\r\n\r\n    /**\r\n     * Function called by UI\r\n     */\r\n    proto.acceptAndExit = function() {\r\n\r\n        // If placeholder text, then remove.\r\n        var textValues = this.getTextValues();\r\n        var textMarkup = this.textMarkup;\r\n\r\n        var dataBag = {\r\n            markup: this.textMarkup,\r\n            style: this.style,\r\n            firstEdit: this.firstEdit,\r\n            newText: textValues.text,\r\n            newLines: textValues.lines\r\n        };\r\n        this.injectSizeValues(dataBag);\r\n\r\n        this.dispatchEvent({ type: this.EVENT_TEXT_CHANGE, data: dataBag });\r\n        this.setInactive();\r\n        textMarkup.updateStyle(true); // Hack: LMV-3628\r\n    };\r\n\r\n    /**\r\n     * Injects position, width and height of the textarea rect\r\n     * @param {Object} dataBag\r\n     * @private\r\n     */\r\n    proto.injectSizeValues = function(dataBag) {\r\n\r\n        // Explicit usage of parseFloat to remove the 'px' suffix.\r\n        var width = parseFloat(this.textArea.style.width);\r\n        var height = parseFloat(this.textArea.style.height);\r\n        var ox = parseFloat(this.textArea.style.left);\r\n        var oy = parseFloat(this.textArea.style.top);\r\n\r\n        dataBag.width = width;\r\n        dataBag.height = height;\r\n        dataBag.newPos = {\r\n            x: ox + (width * 0.5),\r\n            y: oy + (height * 0.5)\r\n        };\r\n    };\r\n\r\n    /**\r\n     * Handler for when the camera moves\r\n     * @param {Object} event - Camera moves event\r\n     * @private\r\n     */\r\n    proto.onCameraChanged = function(event) {\r\n        var str = this.textArea.value;\r\n        this.textMarkup.style = cloneStyle(this.style);\r\n        this.style = null; // TODO: Revisit this code because style changes are lost by doing this.\r\n        this.initFromMarkup(true);\r\n        this.textArea.value = str;\r\n        this.setEditFrame();\r\n    };\r\n\r\n    /**\r\n     * Grabs the text content of the textarea and returns\r\n     * an Array of lines.  Wrapped lines are returned as 2 lines.\r\n     */\r\n    proto.generateLines = function() {\r\n\r\n        // First, get lines separated by line breaks:\r\n        var textContent = this.textArea.value;\r\n        var linesBreaks = textContent.split(/\\r*\\n/);\r\n\r\n        var styleMeasureStr = this.styleTextArea.clone()\r\n            .removeAttribute(['top', 'left', 'width', 'height'])\r\n            .setAttribute('position','absolute')\r\n            .setAttribute('white-space','nowrap')\r\n            .setAttribute('float','left')\r\n            .setAttribute('visibility','hidden')\r\n            .getStyleString();\r\n        this.measureDiv.setAttribute('style', styleMeasureStr);\r\n        this.parentDiv.appendChild(this.measureDiv);\r\n\r\n        var maxLineLength = this.textArea.clientWidth - (2 * parseFloat(this.textArea.style.padding));\r\n\r\n        // Now check whether the lines are wrapped.\r\n        // If so, subdivide into other lines.\r\n        var linesOutput = [];\r\n\r\n        for (var i= 0, len = linesBreaks.length; i<len; ++i) {\r\n            var line = trimRight(linesBreaks[i]);\r\n\r\n            // Add a space in an empty line so it appears in the lines output\r\n            line = (line === '') ? ' ' : line;\r\n            this.splitLine(line, maxLineLength, linesOutput);\r\n        }\r\n\r\n        this.parentDiv.removeChild(this.measureDiv);\r\n        return linesOutput;\r\n    };\r\n\r\n    /**\r\n     * Given a String that represents one line of text that is\r\n     * longer than the max length a line is allowed, this method\r\n     * cuts text into several ones that are no longer than the max\r\n     * length.\r\n     *\r\n     * @param {String} text\r\n     * @param {Number} maxLength\r\n     * @param {Array} output\r\n     * @private\r\n     */\r\n    proto.splitLine = function(text, maxLength, output) {\r\n\r\n        // End condition\r\n        if (text === '') {\r\n            return;\r\n        }\r\n\r\n        var remaining = '';\r\n        var done = false;\r\n\r\n        while (!done){\r\n            this.measureDiv.innerText = text;\r\n            var lineLen = this.measureDiv.clientWidth - (2 * parseFloat(this.measureDiv.style.padding));\r\n            if (lineLen <= maxLength) {\r\n                output.push(text);\r\n                this.splitLine(trimLeft(remaining), maxLength, output);\r\n                done = true;\r\n            } else {\r\n                // Need to try with a shorter word!\r\n                var parts = this.getShorterLine(text);\r\n                if (parts.length === 1) {\r\n                    // text is only one word that is way too long.\r\n                    this.splitWord(text, remaining, maxLength, output);\r\n                    done = true;\r\n                } else {\r\n                    text = parts[0];\r\n                    remaining = parts[1] + remaining;\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Given a line of text such as \"hi there programmer\", it returns\r\n     * an array with 2 parts: [\"hi there\", \" programmer\"].\r\n     *\r\n     * It accounts for special cases with multi-spaces, such as for\r\n     * \"hi there  two-spaces\" returns [\"hi there\", \"  two-spaces\"]\r\n     *\r\n     * When there is only one word, it returns the whole word:\r\n     * \"JustOneWord\" returns [\"JustOneWord\"] (an array of 1 element)\r\n     *\r\n     * @param {String} line\r\n     * @returns {Array}\r\n     */\r\n    proto.getShorterLine = function(line) {\r\n\r\n        // TODO: Account for TABs\r\n        // Will probably never do unless a bug is reported.\r\n\r\n        var iLastSpace = line.lastIndexOf(' ');\r\n        if (iLastSpace === -1) {\r\n            return [line]; // This is a single word\r\n        }\r\n\r\n        // Else\r\n        // Iterate back removing additional spaces (multi spaces)\r\n        while (line.charAt(iLastSpace-1) === ' ') {\r\n            iLastSpace--\r\n        }\r\n\r\n        var trailingWord = line.substr(iLastSpace); // Contains the spaces\r\n        var shorterLine = line.substr(0,iLastSpace);\r\n        return [shorterLine, trailingWord];\r\n    };\r\n\r\n    /**\r\n     * Given a single word, splits it into multiple lines that fits in maxWidth\r\n     * @param {String} word\r\n     * @param {String} remaining\r\n     * @param {Number} maxLength\r\n     * @param {Array} output\r\n     */\r\n    proto.splitWord = function(word, remaining, maxLength, output) {\r\n\r\n        var lenSoFar = 1;\r\n        var fits = true;\r\n        while (fits) {\r\n\r\n            var part = word.substr(0,lenSoFar);\r\n            this.measureDiv.innerText = part;\r\n            var lineLen =  this.measureDiv.clientWidth - (2 * parseFloat(this.measureDiv.style.padding));\r\n\r\n            if (lineLen > maxLength) {\r\n\r\n                if (lenSoFar === 1) {\r\n                    // we can't split 1 character any longer.\r\n                    output.push(part);\r\n                    this.splitWord(word.substr(1), remaining, maxLength, output);\r\n                    return;\r\n                }\r\n\r\n                // It was fine until one less char //\r\n                var okayWord = word.substr(0,lenSoFar-1);\r\n                output.push(okayWord);\r\n                var extraWord = word.substr(lenSoFar-1);\r\n                this.splitLine(extraWord + remaining, maxLength, output);\r\n                return;\r\n            }\r\n\r\n            // Try one more character\r\n            lenSoFar++;\r\n\r\n            // Check if we are done with all characters\r\n            if (lenSoFar > word.length) {\r\n                // Okay it fits\r\n                output.push(word);\r\n                return;\r\n            }\r\n        }\r\n    };\r\n\r\n    function trimRight(text) {\r\n        if (text.length === 0) {\r\n            return \"\";\r\n        }\r\n        var lastNonSpace = text.length-1;\r\n        for (var i=lastNonSpace; i>=0; --i) {\r\n            if (text.charAt(i) !== ' ') {\r\n                lastNonSpace = i;\r\n                break;\r\n            }\r\n        }\r\n        return text.substr(0, lastNonSpace+1);\r\n    }\r\n\r\n    function trimLeft(text) {\r\n        if (text.length === 0) {\r\n            return \"\";\r\n        }\r\n        var firstNonSpace = 0;\r\n        for (var i=0; i<text.length; ++i) {\r\n            if (text.charAt(i) !== ' ') {\r\n                firstNonSpace = i;\r\n                break;\r\n            }\r\n        }\r\n        return text.substr(firstNonSpace);\r\n    }\r\n","'use strict';\r\n\r\nimport { EditMode } from './EditMode'\r\nimport { DeleteCallout } from '../edit-actions/DeleteCallout'\r\nimport { CreateCallout } from '../edit-actions/CreateCallout'\r\nimport { SetCallout } from '../edit-actions/SetCallout'\r\nimport { SetStyle } from '../edit-actions/SetStyle'\r\nimport { SetSize } from '../edit-actions/SetSize'\r\nimport * as MarkupTypes from '../MarkupTypes'\r\nimport * as MarkupEvents from '../MarkupEvents'\r\nimport { EditorTextInput } from './EditorTextInput'\r\n\r\n\r\n    var STARTING_WIDTH_FACTOR = 6;\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @constructor\r\n     */\r\n    export function EditModeCallout(editor) {\r\n\r\n        var styleAttributes = [\r\n            'font-size',\r\n            'stroke-width',\r\n            'stroke-color',\r\n            'stroke-opacity',\r\n            'fill-color',\r\n            'fill-opacity',\r\n            'font-family',\r\n            'font-style',\r\n            'font-weight'\r\n        ];\r\n        EditMode.call(this, editor, MarkupTypes.MARKUP_TYPE_CALLOUT, styleAttributes);\r\n\r\n        this.style['fill-opacity'] = 1.0;\r\n        this.style['fill-color'] = '#ffffff';\r\n\r\n        var helper = new EditorTextInput(this.viewer.container, this.editor, false, 'Text', 360);\r\n        helper.addEventListener(helper.EVENT_TEXT_CHANGE, this.onHelperTextChange.bind(this), false);\r\n        helper.addEventListener(helper.EVENT_TEXT_SET_ACTIVE, this.onHelperSetActive.bind(this), false);\r\n        helper.addEventListener(helper.EVENT_TEXT_SET_INACTIVE, this.onHelperSetActive.bind(this), false);\r\n\r\n        this.textInputHelper = helper;\r\n        this.onHistoryChangeBinded = this.onHistoryChange.bind(this);\r\n        this.minSize = 0; // No need to size it initially\r\n        this.creationMethod = this.CREATION_METHOD_CLICK;\r\n    }\r\n\r\n    EditModeCallout.prototype = Object.create(EditMode.prototype);\r\n    EditModeCallout.prototype.constructor = EditModeCallout;\r\n\r\n    var proto = EditModeCallout.prototype;\r\n\r\n    proto.deleteMarkup = function(markup, cantUndo) {\r\n\r\n        markup = markup || this.selectedMarkup;\r\n        if (markup && markup.type === this.type) {\r\n            var deleteCallout = new DeleteCallout(this.editor, markup);\r\n            deleteCallout.addToHistory = !cantUndo;\r\n            deleteCallout.execute();\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    proto.setStyle = function(style) {\r\n\r\n        if (this.textInputHelper && this.textInputHelper.isActive()) {\r\n\r\n            this.textInputHelper.setStyle(style);\r\n        } else {\r\n            EditMode.prototype.setStyle.call(this, style);\r\n        }\r\n    };\r\n\r\n    proto.notifyAllowNavigation = function(allows) {\r\n\r\n        if (allows && this.textInputHelper && this.textInputHelper.isActive()) {\r\n            this.textInputHelper.acceptAndExit();\r\n        }\r\n    };\r\n\r\n    proto.destroy = function() {\r\n\r\n        if (this.textInputHelper) {\r\n            if (this.textInputHelper.isActive()) {\r\n                this.textInputHelper.acceptAndExit();\r\n            }\r\n            this.textInputHelper.destroy();\r\n            this.textInputHelper = null;\r\n        }\r\n        EditMode.prototype.destroy.call(this);\r\n    };\r\n\r\n    /**\r\n     * Handler to mouse down events, used to start markups creation.\r\n     */\r\n    proto.onMouseDown = function() {\r\n\r\n        if (this.textInputHelper && this.textInputHelper.isActive()) {\r\n            this.textInputHelper.acceptAndExit();\r\n            return;\r\n        }\r\n\r\n        if (this.selectedMarkup) {\r\n            return;\r\n        }\r\n\r\n        var editor = this.editor;\r\n        var mousePosition = editor.getMousePosition();\r\n        var clientFontSize = editor.sizeFromMarkupsToClient(0, this.style['font-size']).y;\r\n        var initialWidth = clientFontSize * STARTING_WIDTH_FACTOR; // Find better way to initialize size.\r\n        var initialHeight = clientFontSize * 1;\r\n\r\n        // Center position.\r\n        var size = this.size = editor.sizeFromClientToMarkups(initialWidth, initialHeight);\r\n        var position = editor.positionFromClientToMarkups(\r\n            mousePosition.x + (initialWidth * 0.5),\r\n            mousePosition.y + (initialHeight * 0.5));\r\n\r\n        this.creationBegin();\r\n        editor.beginActionGroup();\r\n\r\n        // Given the initial width and font size, we assume that the text fits in one line.\r\n        var createCallout = new CreateCallout(\r\n            editor,\r\n            editor.getId(),\r\n            position,\r\n            size,\r\n            '',\r\n            this.style,\r\n            true);\r\n\r\n        createCallout.execute();\r\n        this.creationEnd();\r\n\r\n        this.selectedMarkup = editor.getMarkup(createCallout.targetId);\r\n        this.textInputHelper && this.textInputHelper.setActive(this.selectedMarkup, true);\r\n        this.editor.actionManager.addEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\r\n    };\r\n\r\n    proto.onMouseUp = function(event) {\r\n\r\n    };\r\n\r\n    proto.onMouseDoubleClick = function(markup) {\r\n\r\n        if (markup === this.selectedMarkup) {\r\n            this.editor.selectMarkup(markup);\r\n            this.editor.editFrame.setMarkup(markup);\r\n            this.textInputHelper && this.textInputHelper.setActive(markup, false);\r\n        }\r\n    };\r\n\r\n    proto.onHelperSetActive = function(event) {\r\n        var databag = event.data;\r\n        var markup = databag.markup;\r\n        if (markup) {\r\n            markup.setIsHelperTextActive(databag.isActive);\r\n            markup.setIsShapeVisible(!databag.isActive);\r\n        }\r\n    };\r\n\r\n    proto.onHelperTextChange = function(event) {\r\n\r\n        var dataBag = event.data;\r\n        var textMarkup = dataBag.markup;\r\n        var textStyle = dataBag.style;\r\n        var curSelection = this.selectedMarkup;\r\n\r\n        this.editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\r\n\r\n        // Deal with edge case first: Creating a Label without text\r\n        if (dataBag.newText === '') {\r\n            this.editor.cancelActionGroup();\r\n\r\n            var deleteCallout = new DeleteCallout(this.editor, textMarkup);\r\n            deleteCallout.execute();\r\n\r\n            if (textMarkup !== curSelection) {\r\n                this.editor.selectMarkup(curSelection);\r\n            }\r\n\r\n            return;\r\n        }\r\n\r\n        // When the text is created for the first time, an action group\r\n        // is already created and it includes the CreateCallout action.\r\n        // Thus, no need to begin another action group.\r\n        if (!dataBag.firstEdit) {\r\n            this.editor.beginActionGroup();\r\n        }\r\n\r\n        // Size change action //\r\n        var position = this.editor.positionFromClientToMarkups(\r\n            dataBag.newPos.x, dataBag.newPos.y\r\n        );\r\n        var size = this.editor.sizeFromClientToMarkups(\r\n            dataBag.width, dataBag.height\r\n        );\r\n        var setSize = new SetSize(\r\n            this.editor,\r\n            textMarkup,\r\n            position,\r\n            size.x,\r\n            size.y);\r\n        setSize.execute();\r\n\r\n        // Text change action //\r\n        var setCallout = new SetCallout(\r\n            this.editor,\r\n            textMarkup,\r\n            textMarkup.position,\r\n            textMarkup.size,\r\n            dataBag.newText,\r\n            textMarkup.isFrameUsed);\r\n        setCallout.execute();\r\n\r\n        var setStyle = new SetStyle(\r\n            this.editor,\r\n            textMarkup,\r\n            textStyle\r\n        );\r\n        setStyle.execute();\r\n\r\n        // However, we do need to close the action group at this point. For both cases.\r\n        this.editor.closeActionGroup();\r\n        this.editor.selectMarkup(curSelection);\r\n    };\r\n\r\n    /**\r\n     * We want to make sure that the Input Helper gets removed from the screen\r\n     * whenever the user attempts to perform an undo or redo action.\r\n     * @param {Event} event\r\n     * @private\r\n     */\r\n    proto.onHistoryChange = function(event) {\r\n\r\n        if (this.textInputHelper && this.textInputHelper.isActive()) {\r\n            this.editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\r\n            this.textInputHelper.setInactive();\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Notify the markup that the displayed markups are being saved so edit mode can finish current editions.\r\n     */\r\n    proto.onSave = function() {\r\n\r\n        EditMode.prototype.onSave.call(this);\r\n\r\n        // Close input helper if it's open.\r\n        if (this.textInputHelper && this.textInputHelper.isActive()) {\r\n            var firstEdit = this.textInputHelper.firstEdit;\r\n\r\n            this.editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\r\n            this.textInputHelper.setInactive();\r\n\r\n            // Close action group if open (first edit).\r\n            if (firstEdit) {\r\n                this.editor.cancelActionGroup();\r\n            }\r\n\r\n            this.editor.selectMarkup(null);\r\n            this.selectedMarkup = null;\r\n        }\r\n    };\r\n\r\n    proto.updateTextBoxStyle = function() {\r\n        if (this.isTextInputHelperActive()) {\r\n            this.textInputHelper.onCameraChanged();\r\n        }\r\n    };\r\n","'use strict';\r\n\r\nimport { Markup } from './Markup'\r\nimport * as MarkupTypes from './MarkupTypes'\r\nimport { createMarkupTextSvg, createMarkupPathSvg, createMarkupGroupSvg,\r\n    composeRGBAString, setAttributeToMarkupSvg, setMarkupTextSvgTransform,\r\n    updateMarkupTextSvgClipper, updateMarkupTextSvgHitarea, updateMarkupPathSvgHitarea,\r\n    createSvgElement, addMarkupMetadata, radiansToDegrees, createRectanglePath,\r\n    EDIT_FRAME_DEFAULT_MARGIN } from './MarkupsCoreUtils'\r\nimport { cloneStyle, copyStyle, isStyleEqual } from './StyleUtils'\r\nimport { EditModeCallout } from './edit-modes/EditModeCallout'\r\n\r\n    // LMV ViewerLMV-2170 [Markup] [PDF] Text markup missing/cutoff for normal sized text.\r\n    // If the font size of an SVG text is too small, the text is not rendered independently of its final screen size.\r\n    // To solve the issue we multiply font size by 100 and scale down the text in its transform.\r\n    var FONT_SIZE_SCALE = 100;\r\n\r\n    var STARTING_WIDTH_FACTOR = 6;\r\n\r\n    /**\r\n     * Callout Markup.\r\n     * @constructor\r\n     */\r\n    export function MarkupCallout(id, editor, size) {\r\n\r\n        var styleAttributes = [\r\n            'font-size',\r\n            'stroke-width',\r\n            'stroke-color',\r\n            'stroke-opacity',\r\n            'fill-color',\r\n            'fill-opacity',\r\n            'font-family',\r\n            'font-style',\r\n            'font-weight'\r\n        ];\r\n\r\n        Markup.call(this, id, editor, styleAttributes);\r\n\r\n        // bind to this to pass this.globalManager\r\n        this.addMarkupMetadata = addMarkupMetadata.bind(this);\r\n        this.createSvgElement = createSvgElement.bind(this);\r\n\r\n\r\n        this.type = MarkupTypes.MARKUP_TYPE_CALLOUT;\r\n        this.textShape = createMarkupTextSvg();\r\n        this.rectShape = createMarkupPathSvg();\r\n        this.shape = createMarkupGroupSvg([this.rectShape, this.textShape]);\r\n        this.isFrameUsed = true;\r\n        this.constraintRotation = true;\r\n        this.constraintHeight = true;\r\n        this.constraintWidth = false;\r\n        this.size.x = size.x;\r\n        this.size.y = size.y;\r\n        this.currentText = \"\";\r\n        this.currentTextLines = [\"\"];\r\n        this.prevHighlight = false;\r\n        this.isHelperTextActive = false;\r\n\r\n        // Note: We could have this property be a style property.\r\n        // However, there is no need for this property to be exposed to the user for alteration\r\n        // This value is a percentage of the font size used to offset vertically 2 text lines\r\n        // of the same paragraph.\r\n        // Notice that this value is used by EditorTextInput.js\r\n        this.lineHeight = 130;\r\n\r\n        this.minWidth = this.getClientFontSize() * STARTING_WIDTH_FACTOR;\r\n\r\n        this.bindDomEvents();\r\n    }\r\n\r\n    MarkupCallout.prototype = Object.create(Markup.prototype);\r\n    MarkupCallout.prototype.constructor = MarkupCallout;\r\n\r\n    var proto = MarkupCallout.prototype;\r\n\r\n    proto.getEditMode = function() {\r\n\r\n        return new EditModeCallout(this.editor);\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param {Object} position\r\n     * @param {Object} size\r\n     * @param {String} textString\r\n     */\r\n    proto.set = function(position, size, textString, isFrameUsed) {\r\n\r\n        this.position.x = position.x;\r\n        this.position.y = position.y;\r\n        this.size.x = size.x;\r\n        this.size.y = size.y;\r\n        this.setIsFilledFrameUsed(isFrameUsed);\r\n        this.setText(textString);\r\n    };\r\n\r\n    proto.setSize = function(position, width, height) {\r\n\r\n        this.position.x = position.x;\r\n        this.position.y = position.y;\r\n        this.size.x = width;\r\n        this.size.y = height;\r\n\r\n        var sizeUpdateRequired = true;\r\n\r\n        if (this.isHelperTextActive) {\r\n            this.updateTextBoxStyle();\r\n        } else {\r\n            this.updateStyle(sizeUpdateRequired);\r\n        }\r\n    };\r\n\r\n    proto.setPosition = function(x, y) {\r\n\r\n        this.position.x = x;\r\n        this.position.y = y;\r\n\r\n        if (this.isHelperTextActive) {\r\n            this.updateTextBoxStyle();\r\n        } else {\r\n            this.updateStyle();\r\n        }\r\n    };\r\n\r\n    proto.setStyle = function(style) {\r\n        var stylesEqual = isStyleEqual(style, this.style);\r\n\r\n        if (!stylesEqual) {\r\n            copyStyle(style, this.style);\r\n        }\r\n\r\n        this.updateStyle(!stylesEqual);\r\n    };\r\n\r\n    proto.setText = function(text) {\r\n\r\n        this.currentText = text;\r\n    };\r\n\r\n    /**\r\n     * Returns the raw string value\r\n     * @returns {String}\r\n     */\r\n    proto.getText = function() {\r\n\r\n        return this.currentText;\r\n    };\r\n\r\n    /**\r\n     * Returns a shallow copy of the text lines used for rendering SVG text\r\n     * @returns {Array.<String>}\r\n     */\r\n    proto.getTextLines = function() {\r\n\r\n        return this.currentTextLines.concat();\r\n    };\r\n\r\n    proto.highlightChanged = function() {\r\n\r\n        if (this.highlighted && this.highlighted !== this.prevHighlight) {\r\n            var rect = this.rectShape;\r\n            var text = this.textShape;\r\n            var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\r\n            setAttributeToMarkupSvg(text, 'fill', strokeColor);\r\n\r\n            if (this.isFrameUsed) {\r\n                setAttributeToMarkupSvg(rect, 'stroke', strokeColor);\r\n            }\r\n\r\n            this.prevHighlight = true;\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    proto.updateTextBoxStyle = function() {\r\n        var editMode = this.editor.duringEditMode && this.editor.editMode;\r\n\r\n        if (!editMode || editMode.type !== this.type) {\r\n            editMode = this.getEditMode();\r\n        }\r\n\r\n        editMode.updateTextBoxStyle();\r\n    };\r\n\r\n    proto.setIsHelperTextActive = function(isActive) {\r\n        this.isHelperTextActive = isActive;\r\n    };\r\n\r\n    /**\r\n     * Applies data values into DOM element style/attribute(s)\r\n     *\r\n     */\r\n    proto.updateStyle = function(sizeUpdateRequired) {\r\n\r\n        if (this.highlightChanged()) {\r\n            this.prevHighlight = false;\r\n            var style = this.style;\r\n            var rect = this.rectShape;\r\n            var text = this.textShape;\r\n            var fontSize = this.style['font-size'];\r\n            var fontFamily = this.style['font-family'];\r\n            var fontWeight = this.style['font-weight'];\r\n            var fontStyle =  this.style['font-style'];\r\n            var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\r\n            var strokeWidth = this.style['stroke-width'];\r\n\r\n            // FONT_SIZE_SCALE is used to scale up fontSize, but it is only needed in cases where the font size is too small\r\n            FONT_SIZE_SCALE = (fontSize > 1) ? 1 : 100;\r\n\r\n            this.rebuildTextSvg(sizeUpdateRequired);\r\n\r\n            var editor = this.editor;\r\n            var textContainerTransform = this.getTextContainerTransform();\r\n            var textTransform = this.getTextTransform();\r\n\r\n            setAttributeToMarkupSvg(text, 'font-family', fontFamily);\r\n            setAttributeToMarkupSvg(text, 'font-size', fontSize * FONT_SIZE_SCALE);\r\n            setAttributeToMarkupSvg(text, 'fill', strokeColor);\r\n            setAttributeToMarkupSvg(text, 'font-weight', fontWeight);\r\n            setAttributeToMarkupSvg(text, 'font-style', fontStyle);\r\n\r\n            setMarkupTextSvgTransform(text, textContainerTransform, textTransform);\r\n            updateMarkupTextSvgClipper(text, this.size.x, this.size.y);\r\n            updateMarkupTextSvgHitarea(text, this.size.x, this.size.y, editor);\r\n\r\n            var path = this.getPath().join(' ');\r\n            var transform = this.getTransform();\r\n            var fillColor = composeRGBAString(style['fill-color'], style['fill-opacity']);\r\n\r\n            setAttributeToMarkupSvg(rect, 'd', path);\r\n            setAttributeToMarkupSvg(rect, 'stroke-width', strokeWidth);\r\n            setAttributeToMarkupSvg(rect, 'stroke', strokeColor);\r\n            setAttributeToMarkupSvg(rect, 'transform', transform);\r\n            setAttributeToMarkupSvg(rect, 'fill', fillColor);\r\n            updateMarkupPathSvgHitarea(rect, editor);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Re-creates SVG tags that render SVG text.\r\n     * Each line is placed around tspan tags which are vertically offset to each other.\r\n     */\r\n    proto.rebuildTextSvg = function(sizeUpdateRequired) {\r\n\r\n        // TODO: Remove the need to get text values from an object in edit mode, should be a function.\r\n        // editMode needs to be set to load markups in view mode\r\n        var editMode = this.editor.duringEditMode && this.editor.editMode;\r\n\r\n        if (!editMode || editMode.type !== this.type) {\r\n            editMode = this.getEditMode();\r\n            editMode.textInputHelper.textArea.value = this.currentText;\r\n            editMode.textInputHelper.setStyle(this.style);\r\n        }\r\n\r\n        if (editMode.textInputHelper.textMarkup && editMode.textInputHelper.textMarkup !== this) {\r\n            return;\r\n        }\r\n\r\n        var style = cloneStyle(editMode.textInputHelper.style);\r\n        var text = editMode.textInputHelper.textArea.value;\r\n\r\n        var textHelperValues = editMode.textInputHelper.getTextValuesForMarkup(this, sizeUpdateRequired);\r\n\r\n        this.currentTextLines = textHelperValues.textValues.lines;\r\n\r\n        if (textHelperValues.newPos) {\r\n            var position = this.editor.positionFromClientToMarkups(textHelperValues.newPos.x, textHelperValues.newPos.y);\r\n            var size = this.editor.sizeFromClientToMarkups(textHelperValues.width, textHelperValues.height);\r\n\r\n            this.position.x = position.x;\r\n            this.position.y = position.y;\r\n            this.size.x = size.x;\r\n            this.size.y = size.y;\r\n        }\r\n\r\n        if (editMode.selectedMarkup !== this && !editMode.textInputHelper.firstEdit) {\r\n            editMode.textInputHelper.textArea.value = text;\r\n            editMode.textInputHelper.setStyle(style);\r\n        }\r\n\r\n        var markup = this.createSvgElement('text');\r\n        markup.setAttribute('id', 'markup');\r\n        markup.setAttribute('alignment-baseline', 'middle');\r\n\r\n        this.textShape.childNodes[0].removeChild(this.textShape.markup);\r\n        this.textShape.childNodes[0].appendChild(markup);\r\n        this.textShape.markup = markup;\r\n\r\n        // For each line, create a tspan, add as child and offset it vertically.\r\n        var yOffset = this.getLineHeight() * FONT_SIZE_SCALE * (this.lineHeight / 100);\r\n\r\n        var padding = (this.getLineHeight() * FONT_SIZE_SCALE) / 2;\r\n        var dx = padding;\r\n        var dy = padding;\r\n\r\n        this.currentTextLines.forEach(function(line){\r\n\r\n            var tspan = this.createSvgElement('tspan');\r\n\r\n            tspan.setAttribute('x', dx);\r\n            tspan.setAttribute('y', dy);\r\n            tspan.textContent = line;\r\n\r\n            markup.appendChild(tspan);\r\n            dy += yOffset;\r\n        }.bind(this));\r\n    };\r\n\r\n    proto.setIsFilledFrameUsed = function(isFrameUsed) {\r\n\r\n        this.isFrameUsed = isFrameUsed;\r\n\r\n        var hasRectShape = this.rectShape.parentNode === this.shape;\r\n        if (isFrameUsed && !hasRectShape) {\r\n            this.shape.insertBefore(this.rectShape, this.shape.firstChild);\r\n        } else if (!isFrameUsed && hasRectShape) {\r\n            this.shape.removeChild(this.rectShape);\r\n        }\r\n    };\r\n\r\n    proto.setIsFilledFrameVisible = function(isVisible) {\r\n\r\n        this.rectShape.markup.style.display = (isVisible && this.isFrameUsed) ? 'block' : 'none';\r\n    };\r\n\r\n    proto.setIsShapeVisible = function(isVisible) {\r\n\r\n        this.shape.style.display = (isVisible) ? 'block' : 'none';\r\n    };\r\n\r\n    proto.setMetadata = function() {\r\n        var metadata = cloneStyle(this.style);\r\n\r\n        metadata.type = this.type;\r\n        metadata.position = [this.position.x, this.position.y].join(\" \");\r\n        metadata.size = [this.size.x, this.size.y].join(\" \");\r\n        metadata.text = String(this.currentText);\r\n        metadata.isframeused = this.isFrameUsed ? 1 : 0;\r\n\r\n        return this.addMarkupMetadata(this.shape, metadata);\r\n    };\r\n\r\n    /**\r\n     * Helper method that returns the font size in client space coords.\r\n     * @returns {Number}\r\n     */\r\n    proto.getClientFontSize = function() {\r\n\r\n        return this.editor.sizeFromMarkupsToClient(0, this.style['font-size']).y;\r\n    };\r\n\r\n    proto.getLineHeight = function() {\r\n        return this.style['font-size'];\r\n    };\r\n\r\n    proto.getTextContainerTransform = function() {\r\n\r\n        var x = this.position.x - this.size.x * 0.5;\r\n        var y = this.position.y + this.size.y * 0.5;\r\n\r\n        return [\r\n            'translate(', x, ',', y, ')',\r\n            'rotate(', radiansToDegrees(-this.rotation), ')',\r\n            'scale(1,-1)'\r\n        ].join(' ');\r\n    };\r\n\r\n    proto.getTextTransform = function() {\r\n\r\n        var lineHeight = this.getLineHeight();\r\n\r\n        var x = this.position.x - this.size.x * 0.5;\r\n        var y = this.position.y + this.size.y * 0.5 - lineHeight;\r\n\r\n        return [\r\n            'translate(', x, ',', y, ')',\r\n            'rotate(', radiansToDegrees(-this.rotation), ')',\r\n            'scale(' + (1/FONT_SIZE_SCALE) + ',' + (-1/FONT_SIZE_SCALE) + ')'\r\n        ].join(' ');\r\n    };\r\n\r\n    proto.cloneShape = function(clone) {\r\n\r\n        clone.textShape = createMarkupTextSvg();\r\n        clone.rectShape = createMarkupPathSvg();\r\n        clone.shape = createMarkupGroupSvg([clone.rectShape, clone.textShape]);\r\n        clone.bindDomEvents();\r\n    };\r\n\r\n    proto.getPath = function() {\r\n        var strokeWidth = this.style['stroke-width'];\r\n\r\n        var w = this.size.x + strokeWidth;\r\n        var h = this.size.y + strokeWidth;\r\n        var x = -w * 0.5;\r\n        var y = -h * 0.5;\r\n\r\n        var path = [];\r\n        createRectanglePath(x, y, w, h, false, path);\r\n\r\n        return path;\r\n    };\r\n\r\n    proto.getBoundingRect = function() {\r\n\r\n        var pos = this.getClientPosition();\r\n        var size = this.getClientSize();\r\n        var strokeWidth = this.style['stroke-width'];\r\n        var width = this.editor.sizeFromMarkupsToClient(strokeWidth, 0).x;\r\n        var margin = width + EDIT_FRAME_DEFAULT_MARGIN;\r\n\r\n        return {\r\n            x: pos.x - size.x / 2,\r\n            y: pos.y - size.y / 2,\r\n            width: size.x,\r\n            height: size.y,\r\n            margin: margin\r\n        }\r\n    };\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\nimport { MarkupCallout } from '../MarkupCallout'\r\nimport { cloneStyle } from '../StyleUtils'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param id\r\n     * @param position\r\n     * @param size\r\n     * @param text\r\n     * @param style\r\n     * @constructor\r\n     */\r\n    export function CreateCallout(editor, id, position, size, text, style, isFrameUsed) {\r\n\r\n        EditAction.call(this, editor, 'CREATE-CALLOUT', id);\r\n\r\n        this.text = text;\r\n        this.position = {x: position.x, y: position.y};\r\n        this.size = {x: size.x, y: size.y};\r\n        this.style = cloneStyle(style);\r\n        this.isFrameUsed = isFrameUsed;\r\n    }\r\n\r\n    CreateCallout.prototype = Object.create(EditAction.prototype);\r\n    CreateCallout.prototype.constructor = CreateCallout;\r\n\r\n    var proto = CreateCallout.prototype;\r\n\r\n    proto.redo = function () {\r\n\r\n        var editor = this.editor;\r\n        var position = this.position;\r\n        var size = this.size;\r\n\r\n        var callout = new MarkupCallout(this.targetId, editor, size);\r\n\r\n        editor.addMarkup(callout);\r\n\r\n        callout.setIsFilledFrameUsed(this.isFrameUsed);\r\n        callout.setText(this.text);\r\n        callout.setSize(position, size.x, size.y);\r\n        callout.setStyle(this.style);\r\n    };\r\n\r\n    proto.undo = function () {\r\n\r\n        var markup = this.editor.getMarkup(this.targetId);\r\n        if (markup) {\r\n            this.editor.removeMarkup(markup);\r\n            markup.destroy();\r\n        }\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\nimport { CreateCallout } from './CreateCallout'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param text\r\n     * @constructor\r\n     */\r\n    export function DeleteCallout(editor, callout) {\r\n\r\n        EditAction.call(this, editor, 'DELETE-CALLOUT', callout.id);\r\n\r\n        var position = {x: callout.position.x, y: callout.position.y};\r\n        var size = {x: callout.size.x, y: callout.size.y};\r\n\r\n        this.createCallout = new CreateCallout(\r\n            editor,\r\n            callout.id,\r\n            position,\r\n            size,\r\n            callout.getText(),\r\n            callout.getStyle(),\r\n            callout.isFrameUsed);\r\n    }\r\n\r\n    DeleteCallout.prototype = Object.create(EditAction.prototype);\r\n    DeleteCallout.prototype.constructor = DeleteCallout;\r\n\r\n    var proto = DeleteCallout.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        this.createCallout.undo();\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        this.createCallout.redo();\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param markup\r\n     * @param position\r\n     * @param size\r\n     * @param text\r\n     * @constructor\r\n     */\r\n    export function SetText(editor, markup, position, size, text) {\r\n\r\n        EditAction.call(this, editor, 'SET-TEXT', markup.id);\r\n\r\n        this.newPosition = {x: position.x, y: position.y};\r\n        this.oldPosition = {x: markup.position.x, y: markup.position.y};\r\n        this.newSize = {x: size.x, y: size.y};\r\n        this.oldSize = {x: markup.size.x, y: markup.size.y};\r\n        this.newText = text;\r\n        this.oldText = markup.getText();\r\n    }\r\n\r\n    SetText.prototype = Object.create(EditAction.prototype);\r\n    SetText.prototype.constructor = SetText;\r\n\r\n    var proto = SetText.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        var text = this.editor.getMarkup(this.targetId);\r\n        text && text.set(this.newPosition, this.newSize, this.newText);\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        var text = this.editor.getMarkup(this.targetId);\r\n        text && text.set(this.oldPosition, this.oldSize, this.oldText);\r\n    };\r\n","'use strict';\r\n\r\nimport { EditMode } from './EditMode'\r\nimport { DeleteText } from '../edit-actions/DeleteText'\r\nimport { DeleteCallout } from '../edit-actions/DeleteCallout'\r\nimport { CreateText } from '../edit-actions/CreateText'\r\nimport { SetText } from '../edit-actions/SetText'\r\nimport { SetSize } from '../edit-actions/SetSize'\r\nimport { SetStyle } from '../edit-actions/SetStyle'\r\nimport * as MarkupTypes from '../MarkupTypes'\r\nimport * as MarkupEvents from '../MarkupEvents'\r\nimport { EditorTextInput } from './EditorTextInput'\r\n\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @constructor\r\n     */\r\n    export function EditModeText(editor) {\r\n\r\n        var styleAttributes = [\r\n            'font-size',\r\n            'stroke-color',\r\n            'stroke-opacity',\r\n            'fill-color',\r\n            'fill-opacity',\r\n            'font-family',\r\n            'font-style',\r\n            'font-weight'\r\n        ];\r\n        EditMode.call(this, editor, MarkupTypes.MARKUP_TYPE_TEXT, styleAttributes);\r\n\r\n        var helper = new EditorTextInput(this.viewer.container, this.editor, false, 'Text', 260);\r\n        helper.addEventListener(helper.EVENT_TEXT_CHANGE, this.onHelperTextChange.bind(this), false);\r\n        helper.addEventListener(helper.EVENT_TEXT_SET_ACTIVE, this.onHelperSetActive.bind(this), false);\r\n        helper.addEventListener(helper.EVENT_TEXT_SET_INACTIVE, this.onHelperSetActive.bind(this), false);\r\n\r\n        this.textInputHelper = helper;\r\n        this.onHistoryChangeBinded = this.onHistoryChange.bind(this);\r\n        this.minSize = 0; // No need to size it initially\r\n        this.creationMethod = this.CREATION_METHOD_CLICK;\r\n    }\r\n\r\n    EditModeText.prototype = Object.create(EditMode.prototype);\r\n    EditModeText.prototype.constructor = EditModeText;\r\n\r\n    var proto = EditModeText.prototype;\r\n\r\n    proto.deleteMarkup = function(markup, cantUndo) {\r\n\r\n        markup = markup || this.selectedMarkup;\r\n        if (markup && markup.type == this.type) {\r\n            var deleteText = new DeleteText(this.editor, markup);\r\n            deleteText.addToHistory = !cantUndo;\r\n            deleteText.execute();\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param style\r\n     */\r\n    proto.setStyle = function(style) {\r\n\r\n        if (this.textInputHelper && this.textInputHelper.isActive()) {\r\n\r\n            this.textInputHelper.setStyle(style);\r\n        } else {\r\n            EditMode.prototype.setStyle.call(this, style);\r\n        }\r\n    };\r\n\r\n    proto.notifyAllowNavigation = function(allows) {\r\n\r\n        if (allows && this.textInputHelper && this.textInputHelper.isActive()) {\r\n            this.textInputHelper.acceptAndExit();\r\n        }\r\n    };\r\n\r\n    proto.destroy = function() {\r\n\r\n        if (this.textInputHelper) {\r\n            if (this.textInputHelper.isActive()) {\r\n                this.textInputHelper.acceptAndExit();\r\n            }\r\n            this.textInputHelper.destroy();\r\n            this.textInputHelper = null;\r\n        }\r\n        EditMode.prototype.destroy.call(this);\r\n    };\r\n\r\n    /**\r\n     * Handler to mouse down events, used to start markups creation.\r\n     */\r\n    proto.onMouseDown = function() {\r\n\r\n        if (this.textInputHelper && this.textInputHelper.isActive()) {\r\n            this.textInputHelper.acceptAndExit();\r\n            return;\r\n        }\r\n\r\n        if (this.selectedMarkup) {\r\n            return;\r\n        }\r\n\r\n        var editor = this.editor;\r\n        var mousePosition = editor.getMousePosition();\r\n        var clientFontSize = editor.sizeFromMarkupsToClient(0, this.style['font-size']).y;\r\n        var initialWidth = clientFontSize * 15; // Find better way to initialize size.\r\n        var initialHeight = clientFontSize * 1;\r\n\r\n        // Center position.\r\n        var size = this.size = editor.sizeFromClientToMarkups(initialWidth, initialHeight);\r\n        var position = editor.positionFromClientToMarkups(\r\n            mousePosition.x + (initialWidth * 0.5),\r\n            mousePosition.y + (initialHeight * 0.5));\r\n\r\n        this.creationBegin();\r\n        editor.beginActionGroup();\r\n\r\n        // Given the initial width and font size, we assume that the text fits in one line.\r\n        var createText = new CreateText(\r\n            editor,\r\n            editor.getId(),\r\n            position,\r\n            size,\r\n            '',\r\n            this.style);\r\n\r\n        createText.execute();\r\n        this.creationEnd();\r\n\r\n        this.selectedMarkup = editor.getMarkup(createText.targetId);\r\n        this.textInputHelper && this.textInputHelper.setActive(this.selectedMarkup, true);\r\n        this.editor.actionManager.addEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\r\n    };\r\n\r\n    proto.updateTextBoxStyle = function() {\r\n        if (this.isTextInputHelperActive()) {\r\n            this.textInputHelper.onCameraChanged();\r\n        }\r\n    };\r\n\r\n    proto.onMouseUp = function(event) {\r\n\r\n    };\r\n\r\n    proto.onMouseDoubleClick = function(markup) {\r\n\r\n        if (markup === this.selectedMarkup) {\r\n            this.editor.selectMarkup(markup);\r\n            this.editor.editFrame.setMarkup(markup);\r\n            this.textInputHelper && this.textInputHelper.setActive(markup, false);\r\n        }\r\n    };\r\n\r\n    proto.onHelperSetActive = function(event) {\r\n        var databag = event.data;\r\n        var markup = databag.markup;\r\n        if (markup) {\r\n            markup.setIsHelperTextActive(databag.isActive);\r\n            markup.setIsShapeVisible(!databag.isActive);\r\n        }\r\n    };\r\n\r\n    proto.onHelperTextChange = function(event) {\r\n\r\n        var dataBag = event.data;\r\n        var textMarkup = dataBag.markup;\r\n        var textStyle = dataBag.style;\r\n        var curSelection = this.selectedMarkup;\r\n\r\n        this.editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\r\n\r\n        // Deal with edge case first: Creating a Label without text\r\n        if (dataBag.newText === '') {\r\n            this.editor.cancelActionGroup();\r\n\r\n            var deleteCallout = new DeleteCallout(this.editor, textMarkup);\r\n            deleteCallout.execute();\r\n\r\n            if (textMarkup !== curSelection) {\r\n                this.editor.selectMarkup(curSelection);\r\n            }\r\n\r\n            return;\r\n        }\r\n\r\n        // When the text is created for the first time, an action group\r\n        // is already created and it includes the CreateText action.\r\n        // Thus, no need to begin another action group.\r\n        if (!dataBag.firstEdit) {\r\n            this.editor.beginActionGroup();\r\n        }\r\n\r\n        // Size change action //\r\n        var position = this.editor.positionFromClientToMarkups(\r\n            dataBag.newPos.x, dataBag.newPos.y\r\n        );\r\n        var size = this.editor.sizeFromClientToMarkups(\r\n            dataBag.width, dataBag.height\r\n        );\r\n        var setSize = new SetSize(\r\n            this.editor,\r\n            textMarkup,\r\n            position,\r\n            size.x,\r\n            size.y);\r\n        setSize.execute();\r\n\r\n        // Text change action //\r\n        var setText = new SetText(\r\n            this.editor,\r\n            textMarkup,\r\n            textMarkup.position,\r\n            textMarkup.size,\r\n            dataBag.newText);\r\n        setText.execute();\r\n\r\n        var setStyle = new SetStyle(\r\n            this.editor,\r\n            textMarkup,\r\n            textStyle\r\n        );\r\n        setStyle.execute();\r\n\r\n        // However, we do need to close the action group at this point. For both cases.\r\n        this.editor.closeActionGroup();\r\n        this.editor.selectMarkup(curSelection);\r\n    };\r\n\r\n    /**\r\n     * We want to make sure that the Input Helper gets removed from the screen\r\n     * whenever the user attempts to perform an undo or redo action.\r\n     * @param {Event} event\r\n     * @private\r\n     */\r\n    proto.onHistoryChange = function(event) {\r\n\r\n        if (this.textInputHelper && this.textInputHelper.isActive()) {\r\n            this.editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\r\n            this.textInputHelper.setInactive();\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Notify the markup that the displayed markups are being saved so edit mode can finish current editions.\r\n     */\r\n    proto.onSave = function() {\r\n\r\n        EditMode.prototype.onSave.call(this);\r\n\r\n        // Close input helper if it's open.\r\n        if (this.textInputHelper && this.textInputHelper.isActive()) {\r\n            var firstEdit = this.textInputHelper.firstEdit;\r\n\r\n            this.editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\r\n            this.textInputHelper.setInactive();\r\n\r\n            // Close action group if open (first edit).s\r\n            if (firstEdit) {\r\n                this.editor.cancelActionGroup();\r\n            }\r\n\r\n            this.editor.selectMarkup(null);\r\n            this.selectedMarkup = null;\r\n        }\r\n    };\r\n\r\n    proto.updateTextBoxStyle = function() {\r\n        if (this.isTextInputHelperActive()) {\r\n            this.textInputHelper.onCameraChanged();\r\n        }\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { Markup } from './Markup'\r\nimport * as MarkupTypes from './MarkupTypes'\r\nimport { composeRGBAString, setAttributeToMarkupSvg, addMarkupMetadata, radiansToDegrees,\r\n    createMarkupTextSvg, setMarkupTextSvgTransform, updateMarkupTextSvgBackground,\r\n    updateMarkupTextSvgClipper, updateMarkupTextSvgHitarea, createSvgElement } from './MarkupsCoreUtils'\r\nimport { cloneStyle, isStyleEqual, copyStyle } from './StyleUtils'\r\nimport { EditModeText } from './edit-modes/EditModeText'\r\n\r\n    // LMV ViewerLMV-2170 [Markup] [PDF] Text markup missing/cutoff for normal sized text.\r\n    // If the font size of an SVG text is too small, the text is not rendered independently of its final screen size.\r\n    // To solve the issue we multiply font size by 100 and scale down the text in its transform.\r\n    var FONT_SIZE_SCALE = 100;\r\n\r\n    var STARTING_WIDTH_FACTOR = 6;\r\n\r\n    /**\r\n     * Text Markup.\r\n     * @constructor\r\n     */\r\n    export function MarkupText(id, editor, size) {\r\n\r\n        var styleAttributes = [\r\n            'font-size',\r\n            'stroke-color',\r\n            'stroke-opacity',\r\n            'fill-color',\r\n            'fill-opacity',\r\n            'font-family',\r\n            'font-style',\r\n            'font-weight'\r\n        ];\r\n\r\n        Markup.call(this, id, editor, styleAttributes);\r\n\r\n        // Bind to this to pass globalManager\r\n        this.createSvgElement = createSvgElement.bind(this);\r\n        this.addMarkupMetadata = addMarkupMetadata.bind(this);\r\n\r\n        this.type = MarkupTypes.MARKUP_TYPE_TEXT;\r\n        this.shape = createMarkupTextSvg();\r\n        this.constraintRotation = true;\r\n        this.constraintHeight = true;\r\n        this.constraintWidth = false;\r\n        this.size.x = size.x;\r\n        this.size.y = size.y;\r\n        this.currentText = \"\";\r\n        this.currentTextLines = [\"\"];\r\n        this.textDirty = true;\r\n        this.textSize = {x: 0, y: 0};\r\n        this.prevHighlight = false;\r\n        this.isHelperTextActive = false;\r\n\r\n        // Note: We could have this property be a style property.\r\n        // However, there is no need for this property to be exposed to the user for alteration\r\n        // This value is a percentage of the font size used to offset vertically 2 text lines\r\n        // of the same paragraph.\r\n        // Notice that this value is used by EditorTextInput.js\r\n        this.lineHeight = 130;\r\n\r\n        this.minWidth = this.getClientFontSize() * STARTING_WIDTH_FACTOR;\r\n\r\n        this.bindDomEvents();\r\n    }\r\n\r\n    MarkupText.prototype = Object.create(Markup.prototype);\r\n    MarkupText.prototype.constructor = MarkupText;\r\n\r\n    var proto = MarkupText.prototype;\r\n\r\n    proto.getEditMode = function() {\r\n\r\n        return new EditModeText(this.editor);\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param {String} position\r\n     * @param {String} size\r\n     * @param {String} textString\r\n     */\r\n    proto.set = function(position, size, textString) {\r\n\r\n        this.position.x = position.x;\r\n        this.position.y = position.y;\r\n        this.size.x = size.x;\r\n        this.size.y = size.y;\r\n\r\n        this.setText(textString);\r\n    };\r\n\r\n    proto.setSize = function(position, width, height) {\r\n\r\n        this.position.x = position.x;\r\n        this.position.y = position.y;\r\n        this.size.x = width;\r\n        this.size.y = height;\r\n\r\n        var sizeUpdateRequired = true;\r\n\r\n        if (this.isHelperTextActive) {\r\n            this.updateTextBoxStyle();\r\n        } else {\r\n            this.updateStyle(sizeUpdateRequired);\r\n        }\r\n    };\r\n\r\n    proto.setPosition = function(x, y) {\r\n\r\n        this.position.x = x;\r\n        this.position.y = y;\r\n\r\n        if (this.isHelperTextActive) {\r\n            this.updateTextBoxStyle();\r\n        } else {\r\n            this.updateStyle();\r\n        }\r\n    };\r\n\r\n    proto.setStyle = function(style) {\r\n\r\n        var stylesEqual = isStyleEqual(style, this.style);\r\n\r\n        if (!stylesEqual) {\r\n            copyStyle(style, this.style);\r\n        }\r\n\r\n        this.updateStyle(!stylesEqual);\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param {String} text\r\n     */\r\n    proto.setText = function(text) {\r\n\r\n        this.currentText = text;\r\n    };\r\n\r\n    /**\r\n     * Returns the raw string value\r\n     * @returns {String}\r\n     */\r\n    proto.getText = function() {\r\n\r\n        return this.currentText;\r\n    };\r\n\r\n    /**\r\n     * Returns a shallow copy of the text lines used for rendering SVG text\r\n     * @returns {Array.<String>}\r\n     */\r\n    proto.getTextLines = function() {\r\n\r\n        return this.currentTextLines.concat();\r\n    };\r\n\r\n    proto.highlightChanged = function() {\r\n\r\n        if (this.highlighted && this.highlighted !== this.prevHighlight) {\r\n            var shape = this.shape;\r\n            var strokeColor = this.highlightColor;\r\n            setAttributeToMarkupSvg(shape, 'fill', strokeColor);\r\n\r\n            this.prevHighlight = true;\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    proto.updateTextBoxStyle = function() {\r\n        var editMode = this.editor.duringEditMode && this.editor.editMode;\r\n\r\n        if (!editMode || editMode.type !== this.type) {\r\n            editMode = this.getEditMode();\r\n        }\r\n\r\n        editMode.updateTextBoxStyle();\r\n    };\r\n\r\n    proto.setIsHelperTextActive = function(isActive) {\r\n        this.isHelperTextActive = isActive;\r\n    };\r\n\r\n    /**\r\n     * Applies data values into DOM element style/attribute(s)\r\n     *\r\n     */\r\n    proto.updateStyle = function(sizeUpdateRequired) {\r\n\r\n        if (this.highlightChanged()) {\r\n            this.prevHighlight = false;\r\n            var style = this.style;\r\n            var shape = this.shape;\r\n            var fontSize = this.style['font-size'];\r\n            var fontFamily = this.style['font-family'];\r\n            var fontWeight = this.style['font-weight'];\r\n            var fontStyle = this.style['font-style'];\r\n            var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\r\n            var fillColor = composeRGBAString(style['fill-color'], style['fill-opacity']);\r\n\r\n            // FONT_SIZE_SCALE is used to scale up fontSize, but it is only needed in cases where the font size is too small\r\n            FONT_SIZE_SCALE = (fontSize > 1) ? 1 : 100;\r\n\r\n            this.rebuildTextSvg(sizeUpdateRequired);\r\n\r\n            setAttributeToMarkupSvg(shape, 'font-family', fontFamily);\r\n            setAttributeToMarkupSvg(shape, 'font-size', fontSize * FONT_SIZE_SCALE);\r\n            setAttributeToMarkupSvg(shape, 'fill', strokeColor);\r\n            setAttributeToMarkupSvg(shape, 'font-weight', fontWeight);\r\n            setAttributeToMarkupSvg(shape, 'font-style', fontStyle);\r\n\r\n            var editor = this.editor;\r\n            var transform = this.getTransform();\r\n            var textTransform = this.getTextTransform();\r\n\r\n            setMarkupTextSvgTransform(shape, transform, textTransform);\r\n            updateMarkupTextSvgBackground(shape, this.size.x, this.size.y, fillColor);\r\n            updateMarkupTextSvgClipper(shape, this.size.x, this.size.y);\r\n            updateMarkupTextSvgHitarea(shape, this.size.x, this.size.y, editor);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Re-creates SVG tags that render SVG text.\r\n     * Each line is placed around tspan tags which are vertically offset to each other.\r\n     */\r\n    proto.rebuildTextSvg = function(sizeUpdateRequired) {\r\n\r\n        // TODO: Remove the need to get text values from an object in edit mode, should be a function.\r\n        // editMode needs to be set to load markups in view mode\r\n        var editMode = this.editor.duringEditMode && this.editor.editMode;\r\n\r\n        if (!editMode || editMode.type !== this.type) {\r\n            editMode = this.getEditMode();\r\n            editMode.textInputHelper.textArea.value = this.currentText;\r\n            editMode.textInputHelper.setStyle(this.style);\r\n        }\r\n\r\n        if (editMode.textInputHelper.textMarkup && editMode.textInputHelper.textMarkup !== this) {\r\n            return;\r\n        }\r\n\r\n        var style = cloneStyle(editMode.textInputHelper.style);\r\n        var text = editMode.textInputHelper.textArea.value;\r\n\r\n        var textHelperValues = editMode.textInputHelper.getTextValuesForMarkup(this, sizeUpdateRequired);\r\n\r\n        this.currentTextLines = textHelperValues.textValues.lines;\r\n\r\n        if (textHelperValues.newPos) {\r\n            var position = this.editor.positionFromClientToMarkups(textHelperValues.newPos.x, textHelperValues.newPos.y);\r\n            var size = this.editor.sizeFromClientToMarkups(textHelperValues.width, textHelperValues.height);\r\n\r\n            this.position.x = position.x;\r\n            this.position.y = position.y;\r\n            this.size.x = size.x;\r\n            this.size.y = size.y;\r\n        }\r\n\r\n        if (editMode.selectedMarkup !== this && !editMode.textInputHelper.firstEdit) {\r\n            editMode.textInputHelper.textArea.value = text;\r\n            editMode.textInputHelper.setStyle(style);\r\n        }\r\n\r\n        var markup = this.createSvgElement('text');\r\n        markup.setAttribute('id', 'markup');\r\n        markup.setAttribute('alignment-baseline', 'middle');\r\n\r\n        this.shape.childNodes[0].removeChild(this.shape.markup);\r\n        this.shape.childNodes[0].appendChild(markup);\r\n        this.shape.markup = markup;\r\n\r\n        // For each line, create a tspan, add as child and offset it vertically.\r\n        var yOffset = this.getLineHeight() * FONT_SIZE_SCALE * (this.lineHeight / 100);\r\n\r\n        var padding = (this.getLineHeight() * FONT_SIZE_SCALE) / 2;\r\n        var dx = padding;\r\n        var dy = padding;\r\n\r\n        this.currentTextLines.forEach(function(line){\r\n\r\n            var tspan = this.createSvgElement('tspan');\r\n\r\n            tspan.setAttribute('x', dx);\r\n            tspan.setAttribute('y', dy);\r\n            tspan.textContent = line;\r\n\r\n            markup.appendChild(tspan);\r\n            dy += yOffset;\r\n        }.bind(this));\r\n    };\r\n\r\n    proto.setIsShapeVisible = function(isVisible) {\r\n\r\n        this.shape.style.display = (isVisible) ? 'block' : 'none';\r\n    };\r\n\r\n    proto.setMetadata = function() {\r\n\r\n        var metadata = cloneStyle(this.style);\r\n\r\n        metadata.type = this.type;\r\n        metadata.position = [this.position.x, this.position.y].join(\" \");\r\n        metadata.size = [this.size.x, this.size.y].join(\" \");\r\n        metadata.text = String(this.currentText);\r\n\r\n        return this.addMarkupMetadata(this.shape, metadata);\r\n    };\r\n\r\n    /**\r\n     * Helper method that returns the font size in client space coords.\r\n     * @returns {Number}\r\n     */\r\n    proto.getClientFontSize = function() {\r\n\r\n        return this.editor.sizeFromMarkupsToClient(0, this.style['font-size']).y;\r\n    };\r\n\r\n    proto.getLineHeight = function() {\r\n\r\n        return this.style['font-size'];\r\n    };\r\n\r\n    proto.getTransform = function() {\r\n\r\n        var x = this.position.x - this.size.x * 0.5;\r\n        var y = this.position.y + this.size.y * 0.5;\r\n\r\n        return [\r\n            'translate(', x, ',', y, ')',\r\n            'rotate(', radiansToDegrees(-this.rotation), ')',\r\n            'scale(1,-1)'\r\n        ].join(' ');\r\n    };\r\n\r\n    proto.getTextTransform = function() {\r\n\r\n        var lineHeight = this.getLineHeight();\r\n\r\n        var x = this.position.x - this.size.x * 0.5;\r\n        var y = this.position.y + this.size.y * 0.5 - lineHeight;\r\n\r\n        return [\r\n            'translate(', x, ',', y, ')',\r\n            'rotate(', radiansToDegrees(-this.rotation), ')',\r\n            'scale(' + (1/FONT_SIZE_SCALE) + ',' + (-1/FONT_SIZE_SCALE) + ')'\r\n        ].join(' ');\r\n    };\r\n\r\n    proto.cloneShape = function(clone) {\r\n\r\n        clone.shape = createMarkupTextSvg();\r\n        clone.bindDomEvents();\r\n    };\r\n\r\n    proto.getBoundingRect = function() {\r\n        var pos = this.getClientPosition();\r\n        var size = this.getClientSize();\r\n        return {\r\n            x: pos.x - size.x / 2,\r\n            y: pos.y - size.y / 2,\r\n            width: size.x,\r\n            height: size.y\r\n        }\r\n    };\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\nimport { MarkupText } from '../MarkupText'\r\nimport { cloneStyle } from '../StyleUtils'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param id\r\n     * @param position\r\n     * @param size\r\n     * @param text\r\n     * @param style\r\n     * @constructor\r\n     */\r\n    export function CreateText(editor, id, position, size, text, style ) {\r\n\r\n        EditAction.call(this, editor, 'CREATE-TEXT', id);\r\n\r\n        this.text = text;\r\n        this.position = {x: position.x, y: position.y};\r\n        this.size = {x: size.x, y: size.y};\r\n        this.style = cloneStyle(style);\r\n    }\r\n\r\n    CreateText.prototype = Object.create(EditAction.prototype);\r\n    CreateText.prototype.constructor = CreateText;\r\n\r\n    var proto = CreateText.prototype;\r\n\r\n    proto.redo = function () {\r\n\r\n        var editor = this.editor;\r\n        var position = this.position;\r\n        var size = this.size;\r\n\r\n        var text = new MarkupText(this.targetId, editor, size);\r\n\r\n        editor.addMarkup(text);\r\n\r\n        text.set(position, size, this.text);\r\n        text.setStyle(this.style);\r\n    };\r\n\r\n    proto.undo = function () {\r\n\r\n        var markup = this.editor.getMarkup(this.targetId);\r\n        if (markup) {\r\n            this.editor.removeMarkup(markup);\r\n            markup.destroy();\r\n        }\r\n    };\r\n\r\n\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\nimport { CreateCircle } from './CreateCircle'\r\n\r\n    /**\r\n     * Markup delete circle action.\r\n     * \r\n     * Implements an {@link Autodesk.Viewing.Extensions.Markups.Core.EditAction|EditAction}\r\n     * for deleting a Circle {@link Autodesk.Viewing.Extensions.Markups.Core.Markup|Markup}.\r\n     * Included in documentation as an example of how to create\r\n     * a specific EditAction that deals with Markup deletion.\r\n     * Developers are encourage to look into this class's source code and copy\r\n     * as much code as they need. Find link to source code below.\r\n     *\r\n     * @tutorial feature_markup\r\n     * @constructor\r\n     * @memberof Autodesk.Viewing.Extensions.Markups.Core\r\n     * @extends Autodesk.Viewing.Extensions.Markups.Core.EditAction\r\n     *\r\n     * @param editor\r\n     * @param circle\r\n     */\r\n    export function DeleteCircle(editor, circle) {\r\n\r\n        EditAction.call(this, editor, 'DELETE-CIRCLE', circle.id);\r\n        this.createCircle = new CreateCircle(\r\n            editor,\r\n            circle.id,\r\n            circle.position,\r\n            circle.size,\r\n            circle.rotation,\r\n            circle.getStyle());\r\n    }\r\n\r\n    DeleteCircle.prototype = Object.create(EditAction.prototype);\r\n    DeleteCircle.prototype.constructor = DeleteCircle;\r\n\r\n    var proto = DeleteCircle.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        this.createCircle.undo();\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        this.createCircle.redo();\r\n    };\r\n\r\n\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\n\r\n    /**\r\n     * Markup set circle action.\r\n     *\r\n     * Implements an {@link Autodesk.Viewing.Extensions.Markups.Core.EditAction|EditAction}\r\n     * for editing properties of a Circle {@link Autodesk.Viewing.Extensions.Markups.Core.Markup|Markup}.\r\n     * Included in documentation as an example of how to create\r\n     * a specific EditAction that deals with Markup edition.\r\n     * Developers are encourage to look into this class's source code and copy\r\n     * as much code as they need. Find link to source code below.\r\n     *\r\n     * @tutorial feature_markup\r\n     * @constructor\r\n     * @memberof Autodesk.Viewing.Extensions.Markups.Core\r\n     * @extends Autodesk.Viewing.Extensions.Markups.Core.EditAction\r\n     *\r\n     * @param editor\r\n     * @param circle\r\n     * @param position\r\n     * @param size\r\n     */\r\n    export function SetCircle(editor, circle, position, size) {\r\n\r\n        EditAction.call(this, editor, 'SET-CIRCLE', circle.id);\r\n\r\n        this.newPosition = {x: position.x, y: position.y};\r\n        this.newSize = {x: size.x, y: size.y};\r\n        this.oldPosition = {x: circle.position.x, y: circle.position.y};\r\n        this.oldSize = {x: circle.size.x, y: circle.size.y};\r\n    }\r\n\r\n    SetCircle.prototype = Object.create(EditAction.prototype);\r\n    SetCircle.prototype.constructor = SetCircle;\r\n\r\n    var proto = SetCircle.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        this.applyState(this.targetId, this.newPosition, this.newSize);\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        this.applyState(this.targetId, this.oldPosition, this.oldSize);\r\n    };\r\n\r\n    proto.merge = function(action) {\r\n\r\n        if (this.targetId === action.targetId &&\r\n            this.type === action.type) {\r\n\r\n            this.newPosition = action.newPosition;\r\n            this.newSize = action.newSize;\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @private\r\n     */\r\n    proto.applyState = function(targetId, position, size) {\r\n\r\n        var circle = this.editor.getMarkup(targetId);\r\n        if(!circle) {\r\n            return;\r\n        }\r\n\r\n        // Different stroke widths make positions differ at sub-pixel level.\r\n        var epsilon = 0.0001;\r\n\r\n        if (Math.abs(circle.position.x - position.x) > epsilon || Math.abs(circle.size.y - size.y) > epsilon ||\r\n            Math.abs(circle.position.y - position.y) > epsilon || Math.abs(circle.size.y - size.y) > epsilon) {\r\n\r\n            circle.set(position, size);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * @returns {boolean}\r\n     */\r\n    proto.isIdentity = function() {\r\n\r\n        return (\r\n            this.newPosition.x === this.oldPosition.x &&\r\n            this.newPosition.y === this.oldPosition.y &&\r\n            this.newSize.x === this.oldSize.x &&\r\n            this.newSize.y === this.oldSize.y);\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { EditMode } from './EditMode'\r\nimport { DeleteCircle } from '../edit-actions/DeleteCircle'\r\nimport { CreateCircle } from '../edit-actions/CreateCircle'\r\nimport { SetCircle } from '../edit-actions/SetCircle'\r\nimport * as MarkupTypes from '../MarkupTypes'\r\n\r\n    /**\r\n     * Markup circle edit mode.\r\n     *\r\n     * Implements a Circle {@link Autodesk.Viewing.Extensions.Markups.Core.EditMode|EditMode}.\r\n     * Included in documentation as an example of how to create\r\n     * an EditMode for a specific markup type. Developers are encourage to look into this class's source code and copy\r\n     * as much code as they need. Find link to source code below.\r\n     *\r\n     * @tutorial feature_markup\r\n     * @constructor\r\n     * @memberof Autodesk.Viewing.Extensions.Markups.Core\r\n     * @extends Autodesk.Viewing.Extensions.Markups.Core.EditMode\r\n     * @param {Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore} editor\r\n     */\r\n    export function EditModeCircle(editor) {\r\n\r\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity', 'fill-color', 'fill-opacity'];\r\n        EditMode.call(this, editor, MarkupTypes.MARKUP_TYPE_CIRCLE, styleAttributes);\r\n    }\r\n\r\n    EditModeCircle.prototype = Object.create(EditMode.prototype);\r\n    EditModeCircle.prototype.constructor = EditModeCircle;\r\n\r\n    var proto = EditModeCircle.prototype;\r\n\r\n    proto.deleteMarkup = function(markup, cantUndo) {\r\n\r\n        markup = markup || this.selectedMarkup;\r\n        if (markup && markup.type == this.type) {\r\n            var deleteCircle = new DeleteCircle(this.editor, markup);\r\n            deleteCircle.addToHistory = !cantUndo;\r\n            deleteCircle.execute();\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * Handler to mouse move events, used to create markups.\r\n     * @param {MouseEvent} event Mouse event.\r\n     * @private\r\n     */\r\n    proto.onMouseMove = function(event) {\r\n\r\n        if (!EditMode.prototype.onMouseMove.call( this, event )) {\r\n            return false;\r\n        }\r\n\r\n        var selectedMarkup = this.selectedMarkup;\r\n\r\n        var editor = this.editor;\r\n\r\n        var final = this.getFinalMouseDraggingPosition();\r\n        final = editor.clientToMarkups(final.x, final.y);\r\n\r\n        var sizeX = Math.abs(this.firstPosition.x - final.x);\r\n        var sizeY = Math.abs(this.firstPosition.y - final.y);\r\n\r\n        var position = {x: (this.firstPosition.x + final.x) * 0.5, y: (this.firstPosition.y + final.y) * 0.5};\r\n        var size = this.size = {x: sizeX, y: sizeY};\r\n\r\n        var setCircle = new SetCircle(\r\n            editor,\r\n            selectedMarkup,\r\n            position,\r\n            size);\r\n\r\n        setCircle.execute();\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Handler to mouse down events, used to start markups creation.\r\n     * @private\r\n     */\r\n    proto.onMouseDown = function() {\r\n\r\n        EditMode.prototype.onMouseDown.call(this);\r\n\r\n        if (this.selectedMarkup) {\r\n            return;\r\n        }\r\n\r\n        var editor = this.editor;\r\n        var mousePosition = editor.getMousePosition();\r\n\r\n        this.initialX = mousePosition.x;\r\n        this.initialY = mousePosition.y;\r\n\r\n        // Calculate center and size.\r\n        var position = this.firstPosition = editor.clientToMarkups(this.initialX, this.initialY);\r\n        var size = this.size = editor.sizeFromClientToMarkups(1, 1);\r\n\r\n        // Create circle.\r\n        editor.beginActionGroup();\r\n\r\n        var markupId = editor.getId();\r\n        var create = new CreateCircle(\r\n            editor,\r\n            markupId,\r\n            position,\r\n            size,\r\n            0,\r\n            this.style);\r\n        create.execute();\r\n\r\n        this.selectedMarkup = editor.getMarkup(markupId);\r\n        this.creationBegin();\r\n    };\r\n","'use strict';\r\n\r\nimport { Markup } from './Markup'\r\nimport * as MarkupTypes from './MarkupTypes'\r\nimport { createMarkupPathSvg, composeRGBAString, setAttributeToMarkupSvg, \r\n        updateMarkupPathSvgHitarea, addMarkupMetadata, createEllipsePath } from './MarkupsCoreUtils'\r\nimport { cloneStyle } from './StyleUtils'\r\nimport { EditModeCircle } from './edit-modes/EditModeCircle'\r\n\r\n    /**\r\n     *\r\n     * @param id\r\n     * @param editor\r\n     * @constructor\r\n     */\r\n    export function MarkupCircle(id, editor) {\r\n\r\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity', 'fill-color', 'fill-opacity'];\r\n        Markup.call(this, id, editor, styleAttributes);\r\n\r\n        // bind to this to pass this.globalManager\r\n        this.addMarkupMetadata = addMarkupMetadata.bind(this);\r\n\r\n        this.type = MarkupTypes.MARKUP_TYPE_CIRCLE;\r\n        this.shape = createMarkupPathSvg();\r\n\r\n        this.bindDomEvents();\r\n    }\r\n\r\n    MarkupCircle.prototype = Object.create(Markup.prototype);\r\n    MarkupCircle.prototype.constructor = MarkupCircle;\r\n\r\n    var proto = MarkupCircle.prototype;\r\n\r\n    proto.getEditMode = function() {\r\n\r\n        return new EditModeCircle(this.editor);\r\n    };\r\n\r\n    proto.set = function(position, size) {\r\n\r\n        this.setSize(position, size.x, size.y);\r\n    };\r\n\r\n    /**\r\n     * Applies data values into DOM element style/attribute(s)\r\n     *\r\n     */\r\n    proto.updateStyle = function() {\r\n\r\n        var style = this.style;\r\n        var shape = this.shape;\r\n        var path = this.getPath().join(' ');\r\n\r\n        var strokeWidth = this.style['stroke-width'];\r\n        var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\r\n        var fillColor = composeRGBAString(style['fill-color'], style['fill-opacity']);\r\n        var transform = this.getTransform();\r\n\r\n        setAttributeToMarkupSvg(shape, 'd', path);\r\n        setAttributeToMarkupSvg(shape, 'stroke-width', strokeWidth);\r\n        setAttributeToMarkupSvg(shape, 'stroke', strokeColor);\r\n        setAttributeToMarkupSvg(shape, 'fill', fillColor);\r\n        setAttributeToMarkupSvg(shape, 'transform', transform);\r\n        updateMarkupPathSvgHitarea(shape, this.editor);\r\n    };\r\n\r\n    proto.setMetadata = function() {\r\n\r\n        var metadata = cloneStyle(this.style);\r\n\r\n        metadata.type = this.type;\r\n        metadata.position = [this.position.x, this.position.y].join(\" \");\r\n        metadata.size = [this.size.x, this.size.y].join(\" \");\r\n        metadata.rotation = String(this.rotation);\r\n\r\n        return this.addMarkupMetadata(this.shape, metadata);\r\n    };\r\n\r\n    proto.getPath = function() {\r\n\r\n        var size = this.size;\r\n        if (size.x === 1 || size.y === 1) {\r\n            return [''];\r\n        }\r\n\r\n        var strokeWidth = this.style['stroke-width'];\r\n\r\n        var ellipseW = size.x - strokeWidth;\r\n        var ellipseH = size.y - strokeWidth;\r\n\r\n        var ellipseX = -0.5*ellipseW;\r\n        var ellipseY = 0;\r\n\r\n        var path = [];\r\n        createEllipsePath(ellipseX, ellipseY, ellipseW, ellipseH, false, path);\r\n\r\n        return path;\r\n    };\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\nimport { MarkupCircle } from '../MarkupCircle'\r\nimport { cloneStyle } from '../StyleUtils'\r\n\r\n    /**\r\n     * Markup create circle action.\r\n     *\r\n     * Implements an {@link Autodesk.Viewing.Extensions.Markups.Core.EditAction|EditAction}\r\n     * for creating a Circle {@link Autodesk.Viewing.Extensions.Markups.Core.Markup|Markup}.\r\n     * Included in documentation as an example of how to create\r\n     * a specific EditAction that deals with Markup creation.\r\n     * Developers are encourage to look into this class's source code and copy\r\n     * as much code as they need. Find link to source code below.\r\n     *\r\n     * @tutorial feature_markup\r\n     * @constructor\r\n     * @memberof Autodesk.Viewing.Extensions.Markups.Core\r\n     * @extends Autodesk.Viewing.Extensions.Markups.Core.EditAction\r\n     *\r\n     * @param editor\r\n     * @param id\r\n     * @param position\r\n     * @param size\r\n     * @param rotation\r\n     * @param style\r\n     */\r\n    export function CreateCircle(editor, id, position, size, rotation, style) {\r\n\r\n        EditAction.call(this, editor, 'CREATE-CIRCLE', id);\r\n\r\n        this.selectOnExecution = false;\r\n        this.position = {x: position.x, y: position.y};\r\n        this.size = {x: size.x, y: size.y};\r\n        this.rotation = rotation;\r\n        this.style = cloneStyle(style);\r\n    }\r\n\r\n    CreateCircle.prototype = Object.create(EditAction.prototype);\r\n    CreateCircle.prototype.constructor = CreateCircle;\r\n\r\n    var proto = CreateCircle.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        var editor = this.editor;\r\n        var circle = new MarkupCircle(this.targetId, editor);\r\n\r\n        editor.addMarkup(circle);\r\n\r\n        circle.setSize(this.position, this.size.x, this.size.y);\r\n        circle.setRotation(this.rotation);\r\n        circle.setStyle(this.style);\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        var markup = this.editor.getMarkup(this.targetId);\r\n        markup && this.editor.removeMarkup(markup);\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\nimport { CreateCloud } from './CreateCloud'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param cloud\r\n     * @constructor\r\n     */\r\n    export function DeleteCloud(editor, cloud) {\r\n\r\n        EditAction.call(this, editor, 'DELETE-CLOUD', cloud.id);\r\n        this.createCloud = new CreateCloud(\r\n            editor,\r\n            cloud.id,\r\n            cloud.position,\r\n            cloud.size,\r\n            cloud.rotation,\r\n            cloud.getStyle());\r\n    }\r\n\r\n    DeleteCloud.prototype = Object.create(EditAction.prototype);\r\n    DeleteCloud.prototype.constructor = DeleteCloud;\r\n\r\n    var proto = DeleteCloud.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        this.createCloud.undo();\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        this.createCloud.redo();\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param cloud\r\n     * @param position\r\n     * @param size\r\n     * @constructor\r\n     */\r\n    export function SetCloud(editor, cloud, position, size) {\r\n\r\n        EditAction.call(this, editor, 'SET-CLOUD', cloud.id);\r\n\r\n        this.newPosition = {x: position.x, y: position.y};\r\n        this.newSize = {x: size.x, y: size.y};\r\n        this.oldPosition = {x: cloud.position.x, y: cloud.position.y};\r\n        this.oldSize = {x: cloud.size.x, y: cloud.size.y};\r\n    }\r\n\r\n    SetCloud.prototype = Object.create(EditAction.prototype);\r\n    SetCloud.prototype.constructor = SetCloud;\r\n\r\n    var proto = SetCloud.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        this.applyState(this.targetId, this.newPosition, this.newSize, this.newStrokeWidth, this.newColor);\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        this.applyState(this.targetId, this.oldPosition, this.oldSize, this.oldStrokeWidth, this.oldColor);\r\n    };\r\n\r\n    proto.merge = function(action) {\r\n\r\n        if (this.targetId === action.targetId &&\r\n            this.type === action.type) {\r\n\r\n            this.newPosition = action.newPosition;\r\n            this.newSize = action.newSize;\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @private\r\n     */\r\n    proto.applyState = function(targetId, position, size) {\r\n\r\n        var cloud = this.editor.getMarkup(targetId);\r\n        if(!cloud) {\r\n            return;\r\n        }\r\n\r\n        // Different stroke widths make positions differ at sub-pixel level.\r\n        var epsilon = 0.0001;\r\n\r\n        if (Math.abs(cloud.position.x - position.x) > epsilon || Math.abs(cloud.size.y - size.y) > epsilon ||\r\n            Math.abs(cloud.position.y - position.y) > epsilon || Math.abs(cloud.size.y - size.y) > epsilon) {\r\n\r\n            cloud.set(position, size);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * @returns {boolean}\r\n     */\r\n    proto.isIdentity = function() {\r\n\r\n        return (\r\n            this.newPosition.x === this.oldPosition.x &&\r\n            this.newPosition.y === this.oldPosition.y &&\r\n            this.newSize.x === this.oldSize.x &&\r\n            this.newSize.y === this.oldSize.y);\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { EditMode } from './EditMode'\r\nimport { DeleteCloud } from '../edit-actions/DeleteCloud'\r\nimport { CreateCloud } from '../edit-actions/CreateCloud'\r\nimport { SetCloud } from '../edit-actions/SetCloud'\r\nimport * as MarkupTypes from '../MarkupTypes'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @constructor\r\n     */\r\n    export function EditModeCloud(editor) {\r\n\r\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity', 'fill-color', 'fill-opacity'];\r\n        EditMode.call(this, editor, MarkupTypes.MARKUP_TYPE_CLOUD, styleAttributes);\r\n    }\r\n\r\n    EditModeCloud.prototype = Object.create(EditMode.prototype);\r\n    EditModeCloud.prototype.constructor = EditModeCloud;\r\n\r\n    var proto = EditModeCloud.prototype;\r\n\r\n    proto.deleteMarkup = function(markup, cantUndo) {\r\n\r\n        markup = markup || this.selectedMarkup;\r\n        if (markup && markup.type == this.type) {\r\n            var deleteCloud = new DeleteCloud(this.editor, markup);\r\n            deleteCloud.addToHistory = !cantUndo;\r\n            deleteCloud.execute();\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * Handler to mouse move events, used to create markups.\r\n     * @param {MouseEvent} event Mouse event.\r\n     * @private\r\n     */\r\n    proto.onMouseMove = function(event) {\r\n\r\n        if (!EditMode.prototype.onMouseMove.call( this, event )) {\r\n            return false;\r\n        }\r\n\r\n        var selectedMarkup = this.selectedMarkup;\r\n\r\n        var editor = this.editor;\r\n\r\n        var pos = this.getFinalMouseDraggingPosition();\r\n        var final = editor.clientToMarkups(pos.x, pos.y);\r\n        var position = { x: (this.firstPosition.x + final.x) / 2, y: (this.firstPosition.y + final.y) / 2 };\r\n        var size = this.size = { x: Math.abs(final.x - this.firstPosition.x), y: Math.abs(final.y - this.firstPosition.y) };\r\n        var setCloud = new SetCloud(\r\n            editor,\r\n            selectedMarkup,\r\n            position,\r\n            size);\r\n\r\n        setCloud.execute();\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Handler to mouse down events, used to start markups creation.\r\n     * @private\r\n     */\r\n    proto.onMouseDown = function() {\r\n\r\n        EditMode.prototype.onMouseDown.call(this);\r\n\r\n        if (this.selectedMarkup) {\r\n            return;\r\n        }\r\n\r\n        var editor = this.editor;\r\n        var mousePosition = editor.getMousePosition();\r\n\r\n        this.initialX = mousePosition.x;\r\n        this.initialY = mousePosition.y;\r\n\r\n        // Calculate center and size.\r\n        var position = this.firstPosition = editor.clientToMarkups(this.initialX, this.initialY);\r\n        var size = this.size = editor.sizeFromClientToMarkups(1, 1);\r\n\r\n        // Create Cloud.\r\n        editor.beginActionGroup();\r\n\r\n        var markupId = editor.getId();\r\n        var create = new CreateCloud(\r\n            editor,\r\n            markupId,\r\n            position,\r\n            size,\r\n            0,\r\n            this.style);\r\n\r\n        create.execute();\r\n\r\n        this.selectedMarkup = editor.getMarkup(markupId);\r\n        this.creationBegin();\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { Markup } from './Markup'\r\nimport * as MarkupTypes from './MarkupTypes'\r\nimport { createMarkupPathSvg, composeRGBAString, setAttributeToMarkupSvg,\r\n    updateMarkupPathSvgHitarea, addMarkupMetadata, createEllipsePath } from './MarkupsCoreUtils'\r\nimport { cloneStyle } from './StyleUtils'\r\nimport { EditModeCloud } from './edit-modes/EditModeCloud'\r\n\r\n    /**\r\n     *\r\n     * @param id\r\n     * @param editor\r\n     * @constructor\r\n     */\r\n    export function MarkupCloud(id, editor) {\r\n\r\n        var styleAttributes = ['stroke-width', 'stroke-linejoin', 'stroke-color', 'stroke-opacity', 'fill-color', 'fill-opacity'];\r\n        Markup.call(this, id, editor, styleAttributes);\r\n\r\n        // bind to this to pass this.globalManager\r\n        this.addMarkupMetadata = addMarkupMetadata.bind(this);\r\n\r\n        this.type = MarkupTypes.MARKUP_TYPE_CLOUD;\r\n        this.shape = createMarkupPathSvg();\r\n\r\n        this.bindDomEvents();\r\n    }\r\n\r\n    MarkupCloud.prototype = Object.create(Markup.prototype);\r\n    MarkupCloud.prototype.constructor = MarkupCloud;\r\n\r\n    var proto = MarkupCloud.prototype;\r\n\r\n    proto.getEditMode = function() {\r\n\r\n        return new EditModeCloud(this.editor);\r\n    };\r\n\r\n    /**\r\n     * Sets position and size in markup space coordinates.\r\n     * @param {Object} position\r\n     * @param {Object} size\r\n     */\r\n    proto.set = function(position, size) {\r\n\r\n        this.setSize(position, size.x, size.y);\r\n    };\r\n\r\n    /**\r\n     * Applies data values into DOM element style/attribute(s)\r\n     *\r\n     */\r\n    proto.updateStyle = function() {\r\n\r\n        var style = this.style;\r\n        var shape = this.shape;\r\n        var path = this.getPath().join(' ');\r\n\r\n        var strokeWidth = this.style['stroke-width'];\r\n        var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\r\n        var fillColor = composeRGBAString(style['fill-color'], style['fill-opacity']);\r\n        var transform = this.getTransform();\r\n\r\n        setAttributeToMarkupSvg(shape, 'd', path);\r\n        setAttributeToMarkupSvg(shape, 'stroke-width', strokeWidth);\r\n        setAttributeToMarkupSvg(shape, 'stroke', strokeColor);\r\n        setAttributeToMarkupSvg(shape, 'fill', fillColor);\r\n        setAttributeToMarkupSvg(shape, 'transform', transform);\r\n        updateMarkupPathSvgHitarea(shape, this.editor);\r\n    };\r\n\r\n    proto.setMetadata = function() {\r\n\r\n        var metadata = cloneStyle(this.style);\r\n\r\n        metadata.type = this.type;\r\n        metadata.position = [this.position.x, this.position.y].join(\" \");\r\n        metadata.size = [this.size.x, this.size.y].join(\" \");\r\n        metadata.rotation = String(this.rotation);\r\n\r\n        return this.addMarkupMetadata(this.shape, metadata);\r\n    };\r\n\r\n    /**\r\n     * Helper function that creates intermediate points given the\r\n     * current position and size.\r\n     * @returns {Array}\r\n     */\r\n    proto.getPath = function() {\r\n\r\n        var position = this.position;\r\n        var size = this.size;\r\n        var strokeWidth = this.style['stroke-width'];\r\n        var radius = strokeWidth * 2;\r\n\r\n        function createArcTo(x, y, xRadius, yRadius, path) {\r\n\r\n            path.push('a');\r\n            path.push(xRadius);\r\n            path.push(yRadius);\r\n            path.push(0);\r\n            path.push(1);\r\n            path.push(1);\r\n            path.push(x);\r\n            path.push(y);\r\n\r\n            return path;\r\n        }\r\n\r\n        function createCorner(corner, xRadius, yRadius, strokeWidth, path) {\r\n\r\n            switch(corner) {\r\n\r\n                case 'LT':\r\n                    return createArcTo( xRadius,-yRadius, xRadius, yRadius, path);\r\n\r\n                case 'RT':\r\n                    return createArcTo( xRadius, yRadius, xRadius, yRadius, path);\r\n\r\n                case 'RB':\r\n                    return createArcTo(-xRadius, yRadius, xRadius, yRadius, path);\r\n\r\n                case 'LB':\r\n                    return createArcTo(-xRadius,-yRadius, xRadius, yRadius, path);\r\n            }\r\n        }\r\n\r\n        function getSideParameters(x1, x2, radius, strokeWidth) {\r\n\r\n            var diameter = radius * 2;\r\n            var length = Math.abs(x2 - x1 - strokeWidth);\r\n            var count = Math.round(length / diameter);\r\n\r\n            diameter += (length - diameter * count) / count;\r\n            radius = diameter * 0.5;\r\n\r\n            var xValueInset = diameter * 0.05;\r\n            var yValueOffset = radius * 3.5 / 3.0;\r\n\r\n            return {\r\n                count: count,\r\n                radius: radius,\r\n                diameter: diameter,\r\n                p1: {x: xValueInset, y: -yValueOffset },\r\n                p2: {x: diameter - xValueInset, y: -yValueOffset},\r\n                p3: {x: diameter, y: 0}\r\n            };\r\n        }\r\n\r\n        function createTSide(hSidesParameters, path){\r\n\r\n            var sp = hSidesParameters;\r\n            for(var i = 0; i < sp.count; ++i) {\r\n\r\n                path.push('c');\r\n                path.push(sp.p1.x);\r\n                path.push(sp.p1.y);\r\n                path.push(sp.p2.x);\r\n                path.push(sp.p2.y);\r\n                path.push(sp.p3.x);\r\n                path.push(sp.p3.y);\r\n            }\r\n\r\n            return path;\r\n        }\r\n\r\n        function createRSide(vSidesParameters, path){\r\n\r\n            var sp = vSidesParameters;\r\n            for(var i = 0; i < sp.count; ++i) {\r\n                path.push('c');\r\n                path.push(-sp.p1.y);\r\n                path.push(sp.p1.x);\r\n                path.push(-sp.p2.y);\r\n                path.push(sp.p2.x);\r\n                path.push(-sp.p3.y);\r\n                path.push(sp.p3.x);\r\n            }\r\n\r\n            return path;\r\n        }\r\n\r\n        function createBSide(hSidesParameters, path){\r\n\r\n            var sp = hSidesParameters;\r\n            for(var i = 0; i < sp.count; ++i) {\r\n                path.push('c');\r\n                path.push(-sp.p1.x);\r\n                path.push(-sp.p1.y);\r\n                path.push(-sp.p2.x);\r\n                path.push(-sp.p2.y);\r\n                path.push(-sp.p3.x);\r\n                path.push(-sp.p3.y);\r\n            }\r\n\r\n            return path;\r\n        }\r\n\r\n        function createLSide(vSidesParameters, path){\r\n\r\n            var sp = vSidesParameters;\r\n            for(var i = 0; i < sp.count; ++i) {\r\n                path.push('c');\r\n                path.push(sp.p1.y);\r\n                path.push(-sp.p1.x);\r\n                path.push(sp.p2.y);\r\n                path.push(-sp.p2.x);\r\n                path.push(sp.p3.y);\r\n                path.push(-sp.p3.x);\r\n            }\r\n\r\n            return path;\r\n        }\r\n\r\n        var l = position.x;\r\n        var t = position.y;\r\n        var r = position.x + size.x;\r\n        var b = position.y + size.y;\r\n\r\n        var minSize = radius * 5;\r\n        var path = [];\r\n\r\n        if (size.x < minSize || size.y < minSize) {\r\n\r\n            var w = size.x - strokeWidth;\r\n            var h = size.y - strokeWidth;\r\n            var x = -w * 0.5;\r\n            var y = 0;\r\n\r\n            createEllipsePath(x, y, w, h, false, path);\r\n        } else {\r\n\r\n            var hSidesParameters = getSideParameters(l, r, radius, strokeWidth);\r\n            var vSidesParameters = getSideParameters(t, b, radius, strokeWidth);\r\n\r\n            var cornerSizeX = hSidesParameters.diameter;\r\n            var cornerSizeY = vSidesParameters.diameter;\r\n            var cornerRadiusX = hSidesParameters.radius;\r\n            var cornerRadiusY = vSidesParameters.radius;\r\n\r\n            hSidesParameters = getSideParameters(l + cornerSizeX, r - cornerSizeX, radius, strokeWidth);\r\n            vSidesParameters = getSideParameters(t + cornerSizeY, b - cornerSizeY, radius, strokeWidth);\r\n\r\n            var halfStrokeWidth = strokeWidth * 0.5;\r\n            let x =-size.x * 0.5 + halfStrokeWidth + cornerRadiusX;\r\n            let y =-size.y * 0.5 + halfStrokeWidth + cornerRadiusY * 2;\r\n\r\n            path.push('M');\r\n            path.push(x);\r\n            path.push(y);\r\n\r\n            createCorner('LT', cornerRadiusX, cornerRadiusY, strokeWidth, path);\r\n            createTSide(hSidesParameters, path);\r\n            createCorner('RT', cornerRadiusX, cornerRadiusY, strokeWidth, path);\r\n            createRSide(vSidesParameters, path);\r\n            createCorner('RB', cornerRadiusX, cornerRadiusY, strokeWidth, path);\r\n            createBSide(hSidesParameters, path);\r\n            createCorner('LB', cornerRadiusX, cornerRadiusY, strokeWidth, path);\r\n            createLSide(vSidesParameters, path);\r\n        }\r\n\r\n        path.push('z');\r\n        return path;\r\n    };\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\nimport { MarkupCloud } from '../MarkupCloud'\r\nimport { cloneStyle } from '../StyleUtils'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param id\r\n     * @param position\r\n     * @param size\r\n     * @param rotation\r\n     * @param style\r\n     * @constructor\r\n     */\r\n    export function CreateCloud(editor, id, position, size, rotation, style) {\r\n\r\n        EditAction.call(this, editor, 'CREATE-CLOUD', id);\r\n\r\n        this.selectOnExecution = false;\r\n        this.position = {x: position.x, y: position.y};\r\n        this.size = {x: size.x, y: size.y};\r\n        this.rotation = rotation;\r\n        this.style = cloneStyle(style);\r\n    }\r\n\r\n    CreateCloud.prototype = Object.create(EditAction.prototype);\r\n    CreateCloud.prototype.constructor = CreateCloud;\r\n\r\n    var proto = CreateCloud.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        var editor = this.editor;\r\n        var cloud = new MarkupCloud(this.targetId, editor);\r\n\r\n        editor.addMarkup(cloud);\r\n\r\n        cloud.set(this.position, this.size);\r\n        cloud.setRotation(this.rotation);\r\n        cloud.setStyle(this.style);\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        var markup = this.editor.getMarkup(this.targetId);\r\n        markup && this.editor.removeMarkup(markup);\r\n    };\r\n","'use strict';\r\n\r\nimport { Markup } from './Markup'\r\nimport { createMarkupPathSvg, setAttributeToMarkupSvg, updateMarkupPathSvgHitarea,\r\n    composeRGBAString, addMarkupMetadata } from './MarkupsCoreUtils'\r\nimport { cloneStyle } from './StyleUtils'\r\n\r\n    /**\r\n     * Base class for Pen Markup rendering (currently freehand and highlighter)\r\n     *\r\n     * Derived classes must implement getEditMode()\r\n     * @param id\r\n     * @param editor\r\n     * @constructor\r\n     */\r\n    export function MarkupPen(id, editor) {\r\n\r\n        var styleAttributes = ['stroke-width', 'stroke-color','stroke-opacity'];\r\n        Markup.call(this, id, editor, styleAttributes);\r\n\r\n        // bind to this to pass this.globalManager\r\n        this.addMarkupMetadata = addMarkupMetadata.bind(this);\r\n\r\n        this.shape = createMarkupPathSvg();\r\n\r\n        this.bindDomEvents();\r\n    }\r\n\r\n    MarkupPen.prototype = Object.create(Markup.prototype);\r\n    MarkupPen.prototype.constructor = MarkupPen;\r\n\r\n    var proto = MarkupPen.prototype;\r\n\r\n    /**\r\n     * Sets top-left and bottom-right values in client space coordinates (2d).\r\n     *\r\n     * @param position\r\n     * @param size\r\n     * @param locations\r\n     */\r\n    proto.set = function(position, size, locations, isAbsoluteCoords) {\r\n\r\n        this.rotation = 0; // Reset angle //\r\n        this.isAbsoluteCoords = isAbsoluteCoords;\r\n        if (this.isAbsoluteCoords) {\r\n            this.updatePath(locations);\r\n        } else {\r\n            this.locations = locations.slice(0);\r\n\r\n            this.size.x = (size.x === 0) ? 1 : size.x;\r\n            this.size.y = (size.y === 0) ? 1 : size.y;\r\n\r\n            this.setSize(position, size.x, size.y);\r\n            this.updateStyle();\r\n        }\r\n    };\r\n\r\n    proto.setPosition = function(x,y) {\r\n\r\n        this.position.x = x;\r\n        this.position.y = y;\r\n\r\n        var shape = this.shape;\r\n        var transform = this.getTransform();\r\n\r\n        setAttributeToMarkupSvg(shape, 'transform', transform);\r\n        updateMarkupPathSvgHitarea(shape, this.editor);\r\n    };\r\n\r\n    /**\r\n     * Applies data values into DOM element style/attribute(s)\r\n     *\r\n     */\r\n    proto.updateStyle = function() {\r\n\r\n        var style = this.style;\r\n        var shape = this.shape;\r\n        var path = this.getPath().join(' ');\r\n\r\n        var strokeWidth = this.style['stroke-width'];\r\n        var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\r\n        var fillColor = 'none';\r\n\r\n        setAttributeToMarkupSvg(shape, 'stroke-width', strokeWidth);\r\n        setAttributeToMarkupSvg(shape, 'stroke-linejoin', 'round');\r\n        setAttributeToMarkupSvg(shape, 'stroke-linecap', 'round');\r\n        setAttributeToMarkupSvg(shape, 'stroke', strokeColor);\r\n        setAttributeToMarkupSvg(shape, 'fill', fillColor);\r\n\r\n        this.updatePath(path);\r\n        updateMarkupPathSvgHitarea(shape, this.editor);\r\n    };\r\n\r\n    proto.updatePath = function(path) {\r\n        var shape = this.shape;\r\n        var transform = this.isAbsoluteCoords ? 'scale(1)' : this.getTransform();\r\n\r\n        setAttributeToMarkupSvg(shape, 'transform', transform);\r\n        setAttributeToMarkupSvg(shape, 'd', path);\r\n    };\r\n\r\n    /**\r\n     * Changes the position and size of the markup.\r\n     * This gets called by the Autodesk.Viewing.Extensions.Markups.Core.SetSize edit action\r\n     * @param {{x: Number, y: Number}} position\r\n     * @param {Number} width\r\n     * @param {Number} height\r\n     */\r\n    proto.setSize = function (position, width, height) {\r\n\r\n        width = (width === 0 ? 1 : width);\r\n        height = (height === 0 ? 1 : height);\r\n\r\n        var locations = this.locations;\r\n        var locationsCount = locations.length;\r\n\r\n        var scaleX = width / this.size.x;\r\n        var scaleY = height / this.size.y;\r\n\r\n        for(var i = 0; i < locationsCount; ++i) {\r\n\r\n            var point = locations[i];\r\n\r\n            point.x *= scaleX;\r\n            point.y *= scaleY;\r\n        }\r\n\r\n        this.position.x = position.x;\r\n        this.position.y = position.y;\r\n\r\n        this.size.x = width;\r\n        this.size.y = height;\r\n\r\n        this.updateStyle();\r\n    };\r\n\r\n    proto.setMetadata = function() {\r\n\r\n        var metadata = cloneStyle(this.style);\r\n\r\n        metadata.type = this.type;\r\n        metadata.position = [this.position.x, this.position.y].join(\" \");\r\n        metadata.size = [this.size.x, this.size.y].join(\" \");\r\n        metadata.rotation = String(this.rotation);\r\n        metadata.locations = this.locations.map(function(point){\r\n            return [point.x, point.y].join(\" \");\r\n        }).join(\" \");\r\n\r\n        return this.addMarkupMetadata(this.shape, metadata);\r\n    };\r\n\r\n    proto.getPath = function() {\r\n\r\n        var path = [];\r\n        var locations = this.locations;\r\n        var locationsCount = locations.length;\r\n\r\n        if (locationsCount > 1) {\r\n\r\n            path.push('M');\r\n            path.push(+(locations[0].x).toFixed(6));\r\n            path.push(+(locations[0].y).toFixed(6));\r\n\r\n            for (var i = 1; i < locationsCount; ++i) {\r\n\r\n                var locationA = locations[i - 1];\r\n                var locationB = locations[i];\r\n\r\n                path.push('l');\r\n                path.push(+(locationB.x - locationA.x).toFixed(6));\r\n                path.push(+(locationB.y - locationA.y).toFixed(6));\r\n            }\r\n        }\r\n\r\n        return path;\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { EditMode } from './EditMode'\r\nimport { simplify } from '../MarkupsCoreUtils'\r\n\r\n    /**\r\n     * Base class for editing Pen tools (currently freehand and highlighter)\r\n     *\r\n     * Any class extending EditModePen should contain at least the following methods:\r\n     * - createPen()\r\n     * - deletePen()\r\n     * - setPen()\r\n     *\r\n     * @param editor\r\n     * @constructor\r\n     */\r\n    export function EditModePen(editor, type, styleAttributes) {\r\n        EditMode.call(this, editor, type, styleAttributes);\r\n\r\n        this.smoothen = true;\r\n        this.bufferSize = 8;\r\n    }\r\n\r\n    EditModePen.prototype = Object.create(EditMode.prototype);\r\n\r\n    var proto = EditModePen.prototype;\r\n\r\n    proto.deleteMarkup = function(markup, cantUndo) {\r\n\r\n        markup = markup || this.selectedMarkup;\r\n        if (markup && markup.type === this.type) {\r\n            var deleteMarkup = this.deletePen(markup);\r\n            deleteMarkup.addToHistory = !cantUndo;\r\n            deleteMarkup.execute();\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * Handler to mouse move events, used to create markups.\r\n     * @param {MouseEvent} event Mouse event.\r\n     * @private\r\n     */\r\n    proto.onMouseMove = function(event) {\r\n\r\n        if (!EditMode.prototype.onMouseMove.call( this, event )) {\r\n            return false;\r\n        }\r\n\r\n        var editor = this.editor;\r\n        var mousePosition = editor.getMousePosition();\r\n        var movements = this.movements;\r\n\r\n        var location = editor.clientToMarkups(mousePosition.x, mousePosition.y);\r\n        if (this.smoothen) {\r\n            this.appendToBuffer(location);\r\n            this.amendPath();\r\n        } else {\r\n            var dx = this.lastX - mousePosition.x;\r\n            var dy = this.lastY - mousePosition.y;\r\n            var moveTol = 25; // 5^2, compare to square to avoid using square root of distance\r\n\r\n            if (movements.length > 1 && (dx*dx + dy*dy) < moveTol) {\r\n                movements[movements.length - 1] = location;\r\n                this.removeFromAbsolutePath(1);\r\n            } else {\r\n                movements.push(location);\r\n                this.lastX = mousePosition.x;\r\n                this.lastY = mousePosition.y;\r\n            }\r\n\r\n            this.addToAbsolutePath([location]);\r\n        }\r\n\r\n        var setPen = this.setPen(this.position, this.size, this.absolutePath, true);\r\n        setPen.execute();\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Handler to mouse down events, used to start markups creation.\r\n     * @private\r\n     */\r\n    proto.onMouseDown = function() {\r\n\r\n        EditMode.prototype.onMouseDown.call(this);\r\n\r\n        if (this.selectedMarkup) {\r\n            return;\r\n        }\r\n\r\n        var editor = this.editor;\r\n\r\n        editor.snapper && editor.snapper.clearSnapped();\r\n        var mousePosition = editor.getMousePosition();\r\n\r\n        this.lastX = this.initialX = mousePosition.x;\r\n        this.lastY = this.initialY = mousePosition.y;\r\n\r\n        //set the starting point\r\n        var position = this.position = editor.clientToMarkups(this.initialX, this.initialY);\r\n        this.movements = [position];\r\n        if (this.smoothen) {\r\n            this.buffer = []; // Reset buffer\r\n            this.movementsLastIndex = null;\r\n            this.appendToBuffer(position);\r\n        }\r\n\r\n        var size = this.size = editor.sizeFromClientToMarkups(1, 1);\r\n\r\n        // Create pen.\r\n        editor.beginActionGroup();\r\n\r\n        var markupId = editor.getId();\r\n        var create = this.createPen(markupId, position, size, 0, [{x: 0, y: 0 }]);\r\n\r\n        create.execute();\r\n\r\n        this.createAbsolutePath(position);\r\n\r\n        this.selectedMarkup = editor.getMarkup(markupId);\r\n        this.creationBegin();\r\n    };\r\n\r\n    proto.onMouseUp = function() {\r\n\r\n        if (!this.creating) {\r\n            EditMode.prototype.onMouseUp.call(this);\r\n            return;\r\n        }\r\n\r\n        var movements = this.movements;\r\n        var cameraWidth = this.viewer.impl.camera.right - this.viewer.impl.camera.left;\r\n        var cameraHeight = this.viewer.impl.camera.top - this.viewer.impl.camera.bottom;\r\n        var cameraDiagSq = cameraWidth*cameraWidth + cameraHeight*cameraHeight;\r\n\r\n        movements = simplify(movements, cameraDiagSq * 0.00000001, true);\r\n\r\n        var xs = movements.map(function(item) { return item.x });\r\n        var ys = movements.map(function(item) { return item.y });\r\n\r\n        var l = Math.min.apply(null, xs);\r\n        var t = Math.min.apply(null, ys);\r\n        var r = Math.max.apply(null, xs);\r\n        var b = Math.max.apply(null, ys);\r\n\r\n        var width = r - l;  // Already in markup coords space\r\n        var height = b - t; // Already in markup coords space\r\n\r\n        var position = {\r\n            x: l + width * 0.5,\r\n            y: t + height * 0.5\r\n        };\r\n        var size = this.size = {x: width, y: height};\r\n\r\n        // Adjust points to relate from the shape's center\r\n        var locations = movements.map(function(point){\r\n            return {\r\n                x: point.x - position.x,\r\n                y: point.y - position.y\r\n            };\r\n        });\r\n\r\n        var setPen = this.setPen(position, size, locations, false);\r\n        setPen.execute();\r\n\r\n        EditMode.prototype.onMouseUp.call(this);\r\n    };\r\n\r\n    proto.createPen = function() {\r\n        console.error('createPen not implemented');\r\n    };\r\n\r\n    proto.deletePen = function() {\r\n        console.error('deletePen not implemented');\r\n    };\r\n\r\n    proto.setPen = function() {\r\n        console.error('setPen not implemented');\r\n    };\r\n\r\n    proto.useWithSnapping = function () {\r\n        return false;\r\n    };\r\n\r\n    proto.createAbsolutePath = function(point) {\r\n\r\n        this.absolutePath = 'M' + +(point.x).toFixed(6) + ' ' + +(point.y).toFixed(6);\r\n        this.absolutePathIndexes = [0];\r\n    };\r\n\r\n    proto.removeFromAbsolutePath = function(numToRemove) {\r\n\r\n        numToRemove = Math.min(numToRemove, this.absolutePathIndexes.length);\r\n        if (numToRemove > 0) {\r\n            this.absolutePath = this.absolutePath.slice(0, this.absolutePathIndexes[this.absolutePathIndexes.length - numToRemove]);\r\n            this.absolutePathIndexes.splice(this.absolutePathIndexes.length - numToRemove);\r\n        }\r\n    };\r\n\r\n    proto.addToAbsolutePath = function(points) {\r\n\r\n       for (var i = 0; i < points.length; i++) {\r\n            this.absolutePathIndexes.push(this.absolutePath.length);\r\n            this.absolutePath += ' L' + +(points[i].x).toFixed(6) + ' ' + +(points[i].y).toFixed(6);\r\n        }\r\n    };\r\n\r\n    proto.appendToBuffer = function(point) {\r\n\r\n        this.buffer.push(point);\r\n        while (this.buffer.length > this.bufferSize) {\r\n            this.buffer.shift();\r\n        }\r\n    };\r\n\r\n    proto.amendPath = function() {\r\n\r\n        var point = this.getAveragePoint(0);\r\n        if (point) {\r\n            if (this.movementsLastIndex) {\r\n                this.removeFromAbsolutePath(this.movements.length - this.movementsLastIndex);\r\n                this.movements.splice(this.movementsLastIndex);\r\n            }\r\n\r\n            // Add the smoothed part of the path that will not change\r\n            var tmpBuffer = [point];\r\n            this.movementsLastIndex = this.movements.length + 1;\r\n\r\n            // Get the last part of the path (close to the current mouse position)\r\n            // This part will change if the mouse moves again\r\n            for (var offset = 2; offset < this.buffer.length; offset += 2) {\r\n                var pt = this.getAveragePoint(offset);\r\n                tmpBuffer.push(pt);\r\n            }\r\n\r\n            this.addToAbsolutePath(tmpBuffer);\r\n\r\n            // Set the complete current path coordinates\r\n            this.movements.push.apply(this.movements, tmpBuffer);\r\n\r\n        }\r\n    };\r\n\r\n    // Calculate the average point, starting at offset in the buffer\r\n    proto.getAveragePoint = function(offset) {\r\n\r\n        var len = this.buffer.length;\r\n        if (len % 2 === 1 || len >= this.bufferSize) {\r\n            var totalX = 0;\r\n            var totalY = 0;\r\n            var pt;\r\n            var count = 0;\r\n            for (var i = offset; i < len; i++) {\r\n                count++;\r\n                pt = this.buffer[i];\r\n                totalX += pt.x;\r\n                totalY += pt.y;\r\n            }\r\n            return {\r\n                x: totalX / count,\r\n                y: totalY / count\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\nimport { CreateFreehand } from './CreateFreehand'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param freehand\r\n     * @constructor\r\n     */\r\n    export function DeleteFreehand(editor, freehand) {\r\n        EditAction.call(this, editor, 'DELETE-FREEHAND', freehand.id);\r\n        this.createFreehand = new CreateFreehand(\r\n            editor,\r\n            freehand.id,\r\n            freehand.position,\r\n            freehand.size,\r\n            freehand.rotation,\r\n            freehand.locations,\r\n            freehand.getStyle());\r\n    }\r\n\r\n    DeleteFreehand.prototype = Object.create(EditAction.prototype);\r\n    DeleteFreehand.prototype.constructor = DeleteFreehand;\r\n\r\n    var proto = DeleteFreehand.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        this.createFreehand.undo();\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        this.createFreehand.redo();\r\n    };\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param freehand\r\n     * @param position\r\n     * @param size\r\n     * @param locations\r\n     * @constructor\r\n     */\r\n    export function SetFreehand(editor, freehand, position, size, locations, isAbsoluteCoords) {\r\n\r\n        EditAction.call(this, editor, 'SET-FREEHAND', freehand.id);\r\n\r\n        this.position = position;\r\n        this.size = size;\r\n        this.locations = isAbsoluteCoords ? locations : locations.slice(0);\r\n        this.isAbsoluteCoords = isAbsoluteCoords;\r\n\r\n        // No need to save old data\r\n    }\r\n\r\n    SetFreehand.prototype = Object.create(EditAction.prototype);\r\n    SetFreehand.prototype.constructor = SetFreehand;\r\n\r\n    var proto = SetFreehand.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        var freehand = this.editor.getMarkup(this.targetId);\r\n        if (!freehand) {\r\n            return;\r\n        }\r\n\r\n        freehand.set(this.position, this.size, this.locations, this.isAbsoluteCoords);\r\n    };\r\n\r\n    proto.undo = function() {\r\n        // No need for undo.\r\n    };\r\n\r\n    proto.merge = function(action) {\r\n\r\n        if (this.targetId === action.targetId &&\r\n            this.type === action.type) {\r\n\r\n            this.locations = action.isAbsoluteCoords ? action.locations : action.locations.slice(0);\r\n            this.position = action.position;\r\n            this.size = action.size;\r\n            this.isAbsoluteCoords = action.isAbsoluteCoords;\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * @returns {boolean}\r\n     */\r\n    proto.isIdentity = function() {\r\n\r\n        return false; // No need to optimize, always false.\r\n    };\r\n","'use strict';\r\n\r\nimport { EditModePen } from './EditModePen'\r\nimport { DeleteFreehand } from '../edit-actions/DeleteFreehand'\r\nimport { CreateFreehand } from '../edit-actions/CreateFreehand'\r\nimport { SetFreehand } from '../edit-actions/SetFreehand'\r\nimport * as MarkupTypes from '../MarkupTypes'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @constructor\r\n     */\r\n    export function EditModeFreehand(editor) {\r\n\r\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity'];\r\n        EditModePen.call(this, editor, MarkupTypes.MARKUP_TYPE_FREEHAND, styleAttributes);\r\n    }\r\n\r\n    EditModeFreehand.prototype = Object.create(EditModePen.prototype);\r\n    EditModeFreehand.prototype.constructor = EditModeFreehand;\r\n\r\n    var proto = EditModeFreehand.prototype;\r\n\r\n    proto.createPen = function(markupId, position, size, rotation, locations) {\r\n        return new CreateFreehand(this.editor,\r\n            markupId,\r\n            position,\r\n            size,\r\n            rotation,\r\n            locations,\r\n            this.style);\r\n    };\r\n\r\n    proto.deletePen = function(markup) {\r\n        return new DeleteFreehand(this.editor, markup);\r\n    };\r\n\r\n    proto.setPen = function(position, size, locations, isAbsoluteCoords) {\r\n        return new SetFreehand(this.editor,\r\n            this.selectedMarkup,\r\n            position,\r\n            size,\r\n            locations,\r\n            isAbsoluteCoords);\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { MarkupPen } from './MarkupPen'\r\nimport * as MarkupTypes from './MarkupTypes'\r\nimport { EditModeFreehand } from './edit-modes/EditModeFreehand'\r\n\r\n\r\n    /**\r\n     *\r\n     * @param id\r\n     * @param editor\r\n     * @constructor\r\n     */\r\n    export function MarkupFreehand(id, editor) {\r\n\r\n        MarkupPen.call(this, id, editor);\r\n        this.type = MarkupTypes.MARKUP_TYPE_FREEHAND;\r\n    }\r\n\r\n    MarkupFreehand.prototype = Object.create(MarkupPen.prototype);\r\n    MarkupFreehand.prototype.constructor = MarkupFreehand;\r\n\r\n    var proto = MarkupFreehand.prototype;\r\n\r\n    proto.getEditMode = function() {\r\n\r\n        return new EditModeFreehand(this.editor);\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\nimport { MarkupFreehand } from '../MarkupFreehand'\r\nimport { cloneStyle } from '../StyleUtils'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param id\r\n     * @param position\r\n     * @param size\r\n     * @param rotation\r\n     * @param locations\r\n     * @param style\r\n     * @constructor\r\n     */\r\n    export function CreateFreehand(editor, id, position, size, rotation, locations, style) {\r\n\r\n        EditAction.call(this, editor, 'CREATE-FREEHAND', id);\r\n\r\n        this.selectOnExecution = false;\r\n        this.position = position;\r\n        this.size = size;\r\n        this.rotation = rotation;\r\n        this.movements = locations.slice(0);\r\n        this.style = cloneStyle(style);\r\n    }\r\n\r\n    CreateFreehand.prototype = Object.create(EditAction.prototype);\r\n    CreateFreehand.prototype.constructor = CreateFreehand;\r\n\r\n    var proto = CreateFreehand.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        var editor = this.editor;\r\n        var freehand = new MarkupFreehand(this.targetId, editor);\r\n\r\n        editor.addMarkup(freehand);\r\n\r\n        freehand.set(this.position, this.size, this.movements, false);\r\n        freehand.setRotation(this.rotation);\r\n        freehand.setStyle(this.style);\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        var markup = this.editor.getMarkup(this.targetId);\r\n        markup && this.editor.removeMarkup(markup);\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\nimport { CreatePolyline } from './CreatePolyline'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param polyline\r\n     * @constructor\r\n     */\r\n    export function DeletePolyline(editor, polyline) {\r\n\r\n        EditAction.call(this, editor, 'DELETE-POLYLINE', polyline.id);\r\n        this.createPolyline = new CreatePolyline(\r\n            editor,\r\n            polyline.id,\r\n            polyline.position,\r\n            polyline.size,\r\n            polyline.rotation,\r\n            polyline.locations,\r\n            polyline.getStyle(),\r\n            polyline.closed);\r\n    }\r\n\r\n    DeletePolyline.prototype = Object.create(EditAction.prototype);\r\n    DeletePolyline.prototype.constructor = DeletePolyline;\r\n\r\n    var proto =  DeletePolyline.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        this.createPolyline.undo();\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        this.createPolyline.redo();\r\n    };\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param polyline\r\n     * @param position\r\n     * @param size\r\n     * @param locations\r\n     * @param closed\r\n     * @constructor\r\n     */\r\n    export function SetPolyline(editor, polyline, position, size, locations, closed) {\r\n\r\n        EditAction.call(this, editor, 'SET-POLYLINE', polyline.id);\r\n\r\n        this.position = position;\r\n        this.size = size;\r\n        this.locations = locations.concat();\r\n        this.closed = closed;\r\n\r\n        // No need to save old data\r\n    }\r\n\r\n    SetPolyline.prototype = Object.create(EditAction.prototype);\r\n    SetPolyline.prototype.constructor = SetPolyline;\r\n\r\n    var proto = SetPolyline.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        var polyline = this.editor.getMarkup(this.targetId);\r\n        if(!polyline) {\r\n            return;\r\n        }\r\n\r\n        polyline.set(this.position, this.size, this.locations, this.closed);\r\n    };\r\n\r\n    proto.undo = function() {\r\n        // No need for undo.\r\n    };\r\n\r\n    proto.merge = function(action) {\r\n\r\n        if (this.targetId === action.targetId &&\r\n            this.type === action.type) {\r\n\r\n            this.locations = action.locations.concat();\r\n            this.position = action.position;\r\n            this.size = action.size;\r\n            this.closed = action.closed;\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * @returns {boolean}\r\n     */\r\n    proto.isIdentity = function() {\r\n\r\n        return false; // No need to optimize, always false.\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { EditMode } from './EditMode'\r\nimport { DeletePolyline } from '../edit-actions/DeletePolyline'\r\nimport { CreatePolyline } from '../edit-actions/CreatePolyline'\r\nimport { SetPolyline } from '../edit-actions/SetPolyline'\r\nimport * as MarkupTypes from '../MarkupTypes'\r\nimport { areMarkupsPointsInClientRange } from '../MarkupsCoreUtils'\r\n\r\n    var SNAP_RANGE = 25;\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @constructor\r\n     */\r\n    export function EditModePolyline(editor) {\r\n\r\n        var styleAttributes = ['stroke-width', 'stroke-color','stroke-opacity', 'fill-color', 'fill-opacity'];\r\n        EditMode.call(this, editor, MarkupTypes.MARKUP_TYPE_POLYLINE, styleAttributes);\r\n\r\n        this.creationMethod = this.CREATION_METHOD_CLICKS;\r\n        this.movements = [];\r\n    }\r\n\r\n    EditModePolyline.prototype = Object.create(EditMode.prototype);\r\n    EditModePolyline.prototype.constructor = EditModePolyline;\r\n\r\n    var proto = EditModePolyline.prototype;\r\n\r\n    proto.deleteMarkup = function(markup, cantUndo) {\r\n\r\n        markup = markup || this.selectedMarkup;\r\n        if (markup && markup.type == this.type) {\r\n            var movements = this.movements;\r\n            if (this.creating && movements.length >= 2) {\r\n                movements.pop();\r\n                movements.pop();\r\n                var lastIndex = movements.length - 1;\r\n                if (lastIndex >= 0) {\r\n                    // duplicate last location\r\n                    var lastMove = movements[lastIndex];\r\n                    movements.push(lastMove);\r\n                    var locations = setPositionAndSize(movements, this);\r\n                    var setPolyline = new SetPolyline(\r\n                        this.editor,\r\n                        markup,\r\n                        this.position,\r\n                        this.size,\r\n                        locations);\r\n\r\n                    setPolyline.execute();\r\n                }\r\n            }\r\n            else {\r\n                var deletePolyline = new DeletePolyline(this.editor, markup);\r\n                deletePolyline.addToHistory = !cantUndo;\r\n                deletePolyline.execute();\r\n                this.creationEnd();\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * Handler to mouse move events, used to create markups.\r\n     * @param {MouseEvent} event Mouse event.\r\n     * @private\r\n     */\r\n    proto.onMouseMove = function(event) {\r\n\r\n        if (!EditMode.prototype.onMouseMove.call(this, event)) {\r\n            return false;\r\n        }\r\n\r\n        var selectedMarkup = this.selectedMarkup;\r\n\r\n        var editor = this.editor;\r\n\r\n        this.dragging = true;\r\n\r\n        var movements = this.movements;\r\n        movements.splice(movements.length-1, 1);\r\n\r\n        var mousePosition = editor.getMousePosition();\r\n        mousePosition = editor.clientToMarkups(mousePosition.x, mousePosition.y);\r\n\r\n        // Close polyline if user clicks close to initial point.\r\n        if (movements.length >= 2 &&\r\n            areMarkupsPointsInClientRange(movements[0], mousePosition, SNAP_RANGE, this.editor)) {\r\n            mousePosition = movements[0]; // Snap!\r\n        }\r\n\r\n        movements.push(mousePosition);\r\n\r\n        var locations = setPositionAndSize(movements, this);\r\n        var setPolyline = new SetPolyline(\r\n            editor,\r\n            selectedMarkup,\r\n            this.position,\r\n            this.size,\r\n            locations);\r\n\r\n        setPolyline.execute();\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Handler to mouse down events, used to start markups creation.\r\n     * @private\r\n     */\r\n    proto.onMouseDown = function(event) {\r\n\r\n        EditMode.prototype.onMouseDown.call(this);\r\n\r\n        // User selected an already created markup.\r\n        if (this.selectedMarkup && !this.creating) {\r\n            return;\r\n        }\r\n\r\n        if (this.creating) {\r\n            return;\r\n        }\r\n\r\n        // Creation process.\r\n        var editor = this.editor;\r\n        var mousePosition = editor.getMousePosition();\r\n\r\n        mousePosition = editor.clientToMarkups(mousePosition.x, mousePosition.y);\r\n\r\n        var size = this.size = editor.sizeFromClientToMarkups(1, 1);\r\n        this.movements = [mousePosition, mousePosition];\r\n\r\n        editor.beginActionGroup();\r\n\r\n        var markupId = editor.getId();\r\n        var create = new CreatePolyline(\r\n            editor,\r\n            markupId,\r\n            mousePosition,\r\n            size,\r\n            0,\r\n            [{x:0, y:0}],\r\n            this.style);\r\n\r\n        create.execute();\r\n\r\n        this.selectedMarkup = editor.getMarkup(markupId);\r\n        this.creationBegin();\r\n    };\r\n\r\n    /**\r\n     * Handler to mouse down events, used to start markups creation.\r\n     * @private\r\n     */\r\n    proto.onMouseUp = function() {\r\n\r\n        EditMode.prototype.onMouseUp.call(this);\r\n\r\n        if(!this.creating) {\r\n            return;\r\n        }\r\n\r\n        this.dragging = false;\r\n\r\n        // Creation process.\r\n        var editor = this.editor;\r\n        var mousePosition = editor.getMousePosition();\r\n        var movements = this.movements;\r\n        var closed = false;\r\n\r\n        mousePosition = editor.clientToMarkups(mousePosition.x, mousePosition.y);\r\n\r\n        if (movements.length > 1 &&\r\n            areMarkupsPointsInClientRange(movements[movements.length-2], mousePosition, SNAP_RANGE, this.editor)) {\r\n            return;\r\n        }\r\n\r\n        // Close polyline if user clicks close to initial point.\r\n        if (movements.length > 2 &&\r\n            areMarkupsPointsInClientRange(movements[0], mousePosition, SNAP_RANGE, this.editor)) {\r\n            mousePosition = movements[0]; // Snap!\r\n            closed = true;\r\n        }\r\n\r\n        movements.splice(movements.length-1, 1);\r\n\r\n        if (!closed) {\r\n            movements.push(mousePosition);\r\n            movements.push(mousePosition);\r\n        }\r\n\r\n        var polyline = this.selectedMarkup;\r\n        var locations = setPositionAndSize(movements, polyline);\r\n        var setPolyline = new SetPolyline(\r\n            editor,\r\n            polyline,\r\n            polyline.position,\r\n            polyline.size,\r\n            locations,\r\n            closed);\r\n\r\n        setPolyline.execute();\r\n\r\n        if (closed) {\r\n            this.creationEnd();\r\n        }\r\n    };\r\n\r\n    proto.destroy = function() {\r\n        this.onMouseDoubleClick();\r\n        EditMode.prototype.creationEnd.call(this);\r\n        EditMode.prototype.destroy.call(this);\r\n    };\r\n\r\n    proto.creationEnd = function() {\r\n\r\n        // To pass isMinSizeValid,\r\n        // probably that test should be done with the markup size (not the recorded by the edit mode).\r\n        if (this.selectedMarkup) {\r\n            this.size.x = this.selectedMarkup.size.x;\r\n            this.size.y = this.selectedMarkup.size.y;\r\n        }\r\n\r\n        EditMode.prototype.creationEnd.call(this);\r\n\r\n        this.closed = false;\r\n        this.movements = [];\r\n        this.dragging = false;\r\n        this.creating = false;\r\n    };\r\n\r\n    proto.creationCancel = function() {\r\n\r\n        EditMode.prototype.creationCancel.call(this);\r\n\r\n        this.closed = false;\r\n        this.movements = [];\r\n        this.dragging = false;\r\n        this.creating = false;\r\n    };\r\n\r\n\r\n    proto.onMouseDoubleClick = function(event) {\r\n\r\n        if(!this.creating) {\r\n           return;\r\n        }\r\n\r\n        var movements = this.movements;\r\n        movements.splice(Math.max(0, movements.length-1));\r\n\r\n        if (movements.length < 2 ) {\r\n\r\n            this.creationCancel();\r\n        } else {\r\n\r\n            var polyline = this.selectedMarkup;\r\n            var locations = setPositionAndSize(movements, polyline);\r\n            var setPolyline = new SetPolyline(\r\n                this.editor,\r\n                polyline,\r\n                polyline.position,\r\n                polyline.size,\r\n                locations,\r\n                this.closed);\r\n\r\n            setPolyline.execute();\r\n            this.creationEnd();\r\n        }\r\n    };\r\n\r\n    function setPositionAndSize(locations, markup) {\r\n\r\n        // determine the position of the top-left and bottom-right points\r\n        var minFn = function(collection, key){\r\n            var targets = collection.map(function(item){\r\n                return item[key];\r\n            });\r\n            return Math.min.apply(null, targets);\r\n        };\r\n\r\n        var maxFn = function(collection, key){\r\n            var targets = collection.map(function(item){\r\n                return item[key];\r\n            });\r\n            return Math.max.apply(null, targets);\r\n        };\r\n\r\n        var l = minFn(locations, 'x');\r\n        var t = minFn(locations, 'y');\r\n        var r = maxFn(locations, 'x');\r\n        var b = maxFn(locations, 'y');\r\n        var w = r - l;\r\n        var h = b - t;\r\n\r\n        markup.size = {x: w, y: h};\r\n        markup.position = {x: l + w * 0.5, y: t + h * 0.5};\r\n\r\n        // Adjust points to relate from the shape's center\r\n        var position = markup.position;\r\n        return locations.map(function(point){\r\n            return {\r\n                x: point.x - position.x,\r\n                y: point.y - position.y\r\n            };\r\n        });\r\n    }\r\n\r\n","'use strict';\r\n\r\nimport { Markup } from './Markup'\r\nimport * as MarkupTypes from './MarkupTypes'\r\nimport { createMarkupPathSvg, composeRGBAString,\r\n    setAttributeToMarkupSvg, updateMarkupPathSvgHitarea, addMarkupMetadata } from './MarkupsCoreUtils'\r\nimport { cloneStyle } from './StyleUtils'\r\nimport { EditModePolyline } from './edit-modes/EditModePolyline'\r\n\r\n    /**\r\n     *\r\n     * @param id\r\n     * @param editor\r\n     * @constructor\r\n     */\r\n    export function MarkupPolyline(id, editor) {\r\n\r\n        var styleAttributes = ['stroke-width', 'stroke-color','stroke-opacity', 'fill-color', 'fill-opacity'];\r\n        Markup.call(this, id, editor, styleAttributes);\r\n\r\n        // bind to this to pass this.globalManager\r\n        this.addMarkupMetadata = addMarkupMetadata.bind(this);\r\n\r\n        this.type = MarkupTypes.MARKUP_TYPE_POLYLINE;\r\n        this.shape = createMarkupPathSvg('path');\r\n\r\n        this.bindDomEvents();\r\n    }\r\n\r\n    MarkupPolyline.prototype = Object.create(Markup.prototype);\r\n    MarkupPolyline.prototype.constructor = MarkupPolyline;\r\n\r\n    var proto = MarkupPolyline.prototype;\r\n\r\n    proto.getEditMode = function() {\r\n\r\n        return new EditModePolyline(this.editor);\r\n    };\r\n\r\n    /**\r\n     * Sets top-left and bottom-right values in client space coordinates (2d).\r\n     *\r\n     * @param position\r\n     * @param size\r\n     * @param locations\r\n     * @param closed\r\n     */\r\n    proto.set = function(position, size, locations, closed) {\r\n\r\n        this.rotation = 0; // Reset angle //\r\n        this.locations = locations.concat();\r\n\r\n        this.size.x = (size.x === 0) ? 1 : size.x;\r\n        this.size.y = (size.y === 0) ? 1 : size.y;\r\n\r\n        this.closed = closed;\r\n\r\n        this.setSize(position, size.x, size.y);\r\n        this.updateStyle();\r\n    };\r\n\r\n\r\n    /**\r\n     * Applies data values into DOM element style/attribute(s)\r\n     *\r\n     */\r\n    proto.updateStyle = function() {\r\n\r\n        var style = this.style;\r\n        var shape = this.shape;\r\n\r\n        var strokeWidth = this.style['stroke-width'];\r\n        var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\r\n        var fillColor = this.closed ? composeRGBAString(style['fill-color'], style['fill-opacity']) : 'none';\r\n        var transform = this.getTransform();\r\n\r\n        setAttributeToMarkupSvg(shape, 'd',  this.getPath().join(' '));\r\n        setAttributeToMarkupSvg(shape, 'stroke-width', strokeWidth);\r\n        setAttributeToMarkupSvg(shape, 'stroke', strokeColor);\r\n        setAttributeToMarkupSvg(shape, 'fill', fillColor);\r\n        setAttributeToMarkupSvg(shape, 'transform', transform);\r\n        updateMarkupPathSvgHitarea(shape, this.editor);\r\n    };\r\n\r\n    /**\r\n     * Changes the position and size of the markup.\r\n     * This gets called by the Autodesk.Viewing.Extensions.Markups.Core.SetSize edit action\r\n     * @param {{x: Number, y: Number}} position\r\n     * @param {Number} width\r\n     * @param {Number} height\r\n     */\r\n    proto.setSize = function (position, width, height) {\r\n\r\n        width = (width === 0 ? 1 : width);\r\n        height = (height === 0 ? 1 : height);\r\n\r\n        var locations = this.locations;\r\n        var locationsCount = locations.length;\r\n\r\n        var scaleX = width / this.size.x;\r\n        var scaleY = height / this.size.y;\r\n\r\n        for(var i = 0; i < locationsCount; ++i) {\r\n\r\n            var point = locations[i];\r\n\r\n            point.x *= scaleX;\r\n            point.y *= scaleY;\r\n        }\r\n\r\n        this.position.x = position.x;\r\n        this.position.y = position.y;\r\n\r\n        this.size.x = width;\r\n        this.size.y = height;\r\n\r\n        this.updateStyle();\r\n    };\r\n\r\n    proto.setMetadata = function() {\r\n\r\n        var metadata = cloneStyle(this.style);\r\n\r\n        metadata.type = this.type;\r\n        metadata.position = [this.position.x, this.position.y].join(\" \");\r\n        metadata.size = [this.size.x, this.size.y].join(\" \");\r\n        metadata.rotation = String(this.rotation);\r\n        metadata.locations = this.locations.map(function(point){\r\n            return [point.x, point.y].join(\" \");\r\n        }).join(\" \");\r\n\r\n        return this.addMarkupMetadata(this.shape, metadata);\r\n    };\r\n\r\n    proto.getPath = function() {\r\n\r\n        var path = [];\r\n        var locations = this.locations;\r\n        var locationsCount = locations.length;\r\n\r\n        if (locationsCount === 0) {\r\n            return ' ';\r\n        }\r\n\r\n        path.push('M');\r\n        path.push(locations[0].x);\r\n        path.push(locations[0].y);\r\n\r\n        for (var i = 1; i < locationsCount; ++i) {\r\n\r\n            var locationA = locations[i - 1];\r\n            var locationB = locations[i];\r\n\r\n            path.push('l');\r\n            path.push(locationB.x - locationA.x);\r\n            path.push(locationB.y - locationA.y);\r\n        }\r\n\r\n        this.closed && path.push('z');\r\n        return path;\r\n    };\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\nimport { MarkupPolyline } from '../MarkupPolyLine'\r\nimport { cloneStyle } from '../StyleUtils'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param id\r\n     * @param position\r\n     * @param size\r\n     * @param rotation\r\n     * @param locations\r\n     * @param closed\r\n     * @param style\r\n     * @constructor\r\n     */\r\n    export function CreatePolyline(editor, id, position, size, rotation, locations, style, closed) {\r\n\r\n        EditAction.call(this, editor, 'CREATE-POLYLINE', id);\r\n\r\n        this.selectOnExecution = false;\r\n        this.position = position;\r\n        this.size = size;\r\n        this.rotation = rotation;\r\n        this.movements = locations.concat();\r\n        this.closed = closed;\r\n        this.style = cloneStyle(style);\r\n    }\r\n\r\n    CreatePolyline.prototype = Object.create(EditAction.prototype);\r\n    CreatePolyline.prototype.constructor = CreatePolyline;\r\n\r\n    var proto = CreatePolyline.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        var editor = this.editor;\r\n        var polyline = new MarkupPolyline(this.targetId, editor);\r\n\r\n        editor.addMarkup(polyline);\r\n\r\n        polyline.set(this.position, this.size, this.movements, this.closed);\r\n        polyline.setRotation(this.rotation);\r\n        polyline.setStyle(this.style);\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        var markup = this.editor.getMarkup(this.targetId);\r\n        markup && this.editor.removeMarkup(markup);\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\nimport { CreatePolycloud } from './CreatePolycloud'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param polycloud\r\n     * @constructor\r\n     */\r\n    export function DeletePolycloud(editor, polycloud) {\r\n\r\n        EditAction.call(this, editor, 'DELETE-POLYCLOUD', polycloud.id);\r\n        this.createPolycloud = new CreatePolycloud(\r\n            editor,\r\n            polycloud.id,\r\n            polycloud.position,\r\n            polycloud.size,\r\n            polycloud.rotation,\r\n            polycloud.locations,\r\n            polycloud.getStyle(),\r\n            polycloud.closed);\r\n    }\r\n\r\n    DeletePolycloud.prototype = Object.create(EditAction.prototype);\r\n    DeletePolycloud.prototype.constructor = DeletePolycloud;\r\n\r\n    var proto =  DeletePolycloud.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        this.createPolycloud.undo();\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        this.createPolycloud.redo();\r\n    };\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param polycloud\r\n     * @param position\r\n     * @param size\r\n     * @param locations\r\n     * @param closed\r\n     * @constructor\r\n     */\r\n    export function SetPolycloud(editor, polycloud, position, size, locations, closed) {\r\n\r\n        EditAction.call(this, editor, 'SET-POLYCLOUD', polycloud.id);\r\n\r\n        this.position = position;\r\n        this.size = size;\r\n        this.locations = locations.concat();\r\n        this.closed = closed;\r\n\r\n        // No need to save old data\r\n    }\r\n\r\n    SetPolycloud.prototype = Object.create(EditAction.prototype);\r\n    SetPolycloud.prototype.constructor = SetPolycloud;\r\n\r\n    var proto = SetPolycloud.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        var polycloud = this.editor.getMarkup(this.targetId);\r\n        if(!polycloud) {\r\n            return;\r\n        }\r\n\r\n        polycloud.set(this.position, this.size, this.locations, this.closed);\r\n    };\r\n\r\n    proto.undo = function() {\r\n        // No need for undo.\r\n    };\r\n\r\n    proto.merge = function(action) {\r\n\r\n        if (this.targetId === action.targetId &&\r\n            this.type === action.type) {\r\n\r\n            this.locations = action.locations.concat();\r\n            this.position = action.position;\r\n            this.size = action.size;\r\n            this.closed = action.closed;\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * @returns {boolean}\r\n     */\r\n    proto.isIdentity = function() {\r\n\r\n        return false; // No need to optimize, always false.\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { EditMode } from './EditMode'\r\nimport { DeletePolycloud } from '../edit-actions/DeletePolycloud'\r\nimport { CreatePolycloud } from '../edit-actions/CreatePolycloud'\r\nimport { SetPolycloud } from '../edit-actions/SetPolycloud'\r\nimport * as MarkupTypes from '../MarkupTypes'\r\nimport { areMarkupsPointsInClientRange } from '../MarkupsCoreUtils'\r\n\r\n    var SNAP_RANGE = 25;\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @constructor\r\n     */\r\n    export function EditModePolycloud(editor) {\r\n\r\n        var styleAttributes = ['stroke-width', 'stroke-color','stroke-opacity', 'fill-color', 'fill-opacity'];\r\n        EditMode.call(this, editor, MarkupTypes.MARKUP_TYPE_POLYCLOUD, styleAttributes);\r\n\r\n        this.creationMethod = this.CREATION_METHOD_CLICKS;\r\n        this.movements = [];\r\n    }\r\n\r\n    EditModePolycloud.prototype = Object.create(EditMode.prototype);\r\n    EditModePolycloud.prototype.constructor = EditModePolycloud;\r\n\r\n    var proto = EditModePolycloud.prototype;\r\n\r\n    proto.deleteMarkup = function(markup, cantUndo) {\r\n\r\n        markup = markup || this.selectedMarkup;\r\n        if (markup && markup.type == this.type) {\r\n            var movements = this.movements;\r\n            if (this.creating && movements.length >= 2) {\r\n                movements.pop();\r\n                movements.pop();\r\n                var lastIndex = movements.length - 1;\r\n                if (lastIndex >= 0) {\r\n                    // duplicate last location\r\n                    var lastMove = movements[lastIndex];\r\n                    movements.push(lastMove);\r\n                    var locations = setPositionAndSize(movements, this);\r\n                    var setPolycloud = new SetPolycloud(\r\n                        this.editor,\r\n                        markup,\r\n                        this.position,\r\n                        this.size,\r\n                        locations);\r\n\r\n                    setPolycloud.execute();\r\n                }\r\n            }\r\n            else {\r\n                var deletePolycloud = new DeletePolycloud(this.editor, markup);\r\n                deletePolycloud.addToHistory = !cantUndo;\r\n                deletePolycloud.execute();\r\n                this.creationEnd();\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * Handler to mouse move events, used to create markups.\r\n     * @param {MouseEvent} event Mouse event.\r\n     * @private\r\n     */\r\n    proto.onMouseMove = function(event) {\r\n\r\n        if (!EditMode.prototype.onMouseMove.call(this, event)) {\r\n            return false;\r\n        }\r\n\r\n        var selectedMarkup = this.selectedMarkup;\r\n\r\n        var editor = this.editor;\r\n\r\n        this.dragging = true;\r\n\r\n        var movements = this.movements;\r\n        movements.splice(movements.length-1, 1);\r\n\r\n        var mousePosition = editor.getMousePosition();\r\n        mousePosition = editor.clientToMarkups(mousePosition.x, mousePosition.y);\r\n\r\n        // Close polycloud if user clicks close to initial point.\r\n        if (movements.length >= 2 &&\r\n            areMarkupsPointsInClientRange(movements[0], mousePosition, SNAP_RANGE, this.editor)) {\r\n            mousePosition = movements[0]; // Snap!\r\n        }\r\n\r\n        movements.push(mousePosition);\r\n\r\n        var locations = setPositionAndSize(movements, this);\r\n        var setPolycloud = new SetPolycloud(\r\n            editor,\r\n            selectedMarkup,\r\n            this.position,\r\n            this.size,\r\n            locations);\r\n\r\n        setPolycloud.execute();\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Handler to mouse down events, used to start markups creation.\r\n     * @private\r\n     */\r\n    proto.onMouseDown = function() {\r\n\r\n        EditMode.prototype.onMouseDown.call(this);\r\n\r\n        // User selected an already created markup.\r\n        if (this.selectedMarkup && !this.creating) {\r\n            return;\r\n        }\r\n\r\n        if (this.creating) {\r\n            return;\r\n        }\r\n\r\n        // Creation process.\r\n        var editor = this.editor;\r\n        var mousePosition = editor.getMousePosition();\r\n\r\n        mousePosition = editor.clientToMarkups(mousePosition.x, mousePosition.y);\r\n\r\n        var size = this.size = editor.sizeFromClientToMarkups(1, 1);\r\n        this.movements = [mousePosition, mousePosition];\r\n\r\n        editor.beginActionGroup();\r\n\r\n        var markupId = editor.getId();\r\n        var create = new CreatePolycloud(\r\n            editor,\r\n            markupId,\r\n            mousePosition,\r\n            size,\r\n            0,\r\n            [{x: 0, y: 0 }],\r\n            this.style);\r\n\r\n        create.execute();\r\n\r\n        this.selectedMarkup = editor.getMarkup(markupId);\r\n        this.creationBegin();\r\n    };\r\n\r\n    /**\r\n     * Handler to mouse down events, used to start markups creation.\r\n     * @private\r\n     */\r\n    proto.onMouseUp = function(event) {\r\n\r\n        EditMode.prototype.onMouseUp.call(this);\r\n\r\n        if(!this.creating) {\r\n            return;\r\n        }\r\n\r\n        this.dragging = false;\r\n\r\n        // Creation process.\r\n        var editor = this.editor;\r\n        var mousePosition = editor.getMousePosition();\r\n        var movements = this.movements;\r\n        var closed = false;\r\n\r\n        mousePosition = editor.clientToMarkups(mousePosition.x, mousePosition.y);\r\n\r\n        if (movements.length > 1 &&\r\n            areMarkupsPointsInClientRange(movements[movements.length-2], mousePosition, SNAP_RANGE, this.editor)) {\r\n            return;\r\n        }\r\n\r\n        // Close polycloud if user clicks close to initial point.\r\n        if (movements.length > 2 &&\r\n            areMarkupsPointsInClientRange(movements[0], mousePosition, SNAP_RANGE, this.editor)) {\r\n            mousePosition = movements[0]; // Snap!\r\n            closed = true;\r\n        }\r\n\r\n        movements.splice(movements.length-1, 1);\r\n\r\n        if (!closed) {\r\n            movements.push(mousePosition);\r\n            movements.push(mousePosition);\r\n        }\r\n\r\n        var polycloud = this.selectedMarkup;\r\n        var locations = setPositionAndSize(movements, polycloud);\r\n        var setPolycloud = new SetPolycloud(\r\n            editor,\r\n            polycloud,\r\n            polycloud.position,\r\n            polycloud.size,\r\n            locations,\r\n            closed);\r\n\r\n        setPolycloud.execute();\r\n\r\n        if (closed) {\r\n            this.creationEnd();\r\n        }\r\n    };\r\n\r\n    proto.onMouseDoubleClick = function(event) {\r\n\r\n        if(!this.creating) {\r\n            return;\r\n        }\r\n\r\n        var movements = this.movements;\r\n        movements.splice(Math.max(0, movements.length-1));\r\n\r\n        if (movements.length < 2 ) {\r\n\r\n            this.creationCancel();\r\n        } else {\r\n\r\n            var polycloud = this.selectedMarkup;\r\n            var locations = setPositionAndSize(movements, polycloud);\r\n            var setPolycloud = new SetPolycloud(\r\n                this.editor,\r\n                polycloud,\r\n                polycloud.position,\r\n                polycloud.size,\r\n                locations,\r\n                true);\r\n\r\n            setPolycloud.execute();\r\n            this.creationEnd();\r\n        }\r\n    };\r\n\r\n    proto.destroy = function() {\r\n        this.onMouseDoubleClick();\r\n        EditMode.prototype.creationEnd.call(this);\r\n        EditMode.prototype.destroy.call(this);\r\n    };\r\n\r\n    proto.creationEnd = function() {\r\n\r\n        // To pass isMinSizeValid,\r\n        // probably that test should be done with the markup size (not the recorded by the edit mode).\r\n        if (this.selectedMarkup) {\r\n            this.size.x = this.selectedMarkup.size.x;\r\n            this.size.y = this.selectedMarkup.size.y;\r\n        }\r\n        \r\n        EditMode.prototype.creationEnd.call(this);\r\n\r\n        this.closed = false;\r\n        this.movements = [];\r\n        this.dragging = false;\r\n        this.creating = false;\r\n    };\r\n\r\n    proto.creationCancel = function() {\r\n\r\n        EditMode.prototype.creationCancel.call(this);\r\n\r\n        this.closed = false;\r\n        this.movements = [];\r\n        this.dragging = false;\r\n        this.creating = false;\r\n    };\r\n\r\n    function setPositionAndSize(locations, markup) {\r\n\r\n        // determine the position of the top-left and bottom-right points\r\n        var minFn = function(collection, key){\r\n            var targets = collection.map(function(item){\r\n                return item[key];\r\n            });\r\n            return Math.min.apply(null, targets);\r\n        };\r\n\r\n        var maxFn = function(collection, key){\r\n            var targets = collection.map(function(item){\r\n                return item[key];\r\n            });\r\n            return Math.max.apply(null, targets);\r\n        };\r\n\r\n        var strokeWidth = markup.style['stroke-width'];\r\n        var radius = strokeWidth * 2 + strokeWidth * 0.5;\r\n\r\n        var l = minFn(locations, 'x') - radius;\r\n        var t = minFn(locations, 'y') - radius;\r\n        var r = maxFn(locations, 'x') + radius;\r\n        var b = maxFn(locations, 'y') + radius;\r\n        var w = r - l;\r\n        var h = b - t;\r\n\r\n        markup.size = {x: w, y: h};\r\n        markup.position = {x: l + w * 0.5, y: t + h * 0.5};\r\n\r\n        // Adjust points to relate from the shape's center\r\n        var position = markup.position;\r\n        return locations.map(function(point){\r\n            return {\r\n                x: point.x - position.x,\r\n                y: point.y - position.y\r\n            };\r\n        });\r\n    }\r\n","'use strict';\r\n\r\nimport { Markup } from './Markup'\r\nimport * as MarkupTypes from './MarkupTypes'\r\nimport { createMarkupPathSvg, composeRGBAString, setAttributeToMarkupSvg,\r\n    updateMarkupPathSvgHitarea, addMarkupMetadata } from './MarkupsCoreUtils'\r\nimport { cloneStyle } from './StyleUtils'\r\nimport { EditModePolycloud } from './edit-modes/EditModePolycloud'\r\n\r\n    /**\r\n     *\r\n     * @param id\r\n     * @param editor\r\n     * @constructor\r\n     */\r\n    export function MarkupPolycloud(id, editor) {\r\n\r\n        var styleAttributes = ['stroke-width', 'stroke-color','stroke-opacity', 'fill-color', 'fill-opacity'];\r\n        Markup.call(this, id, editor, styleAttributes);\r\n\r\n        // bind to this to pass this.globalManager\r\n        this.addMarkupMetadata = addMarkupMetadata.bind(this);\r\n\r\n        this.type = MarkupTypes.MARKUP_TYPE_POLYCLOUD;\r\n        this.locations = [];\r\n        this.shape = createMarkupPathSvg();\r\n\r\n        this.bindDomEvents();\r\n    }\r\n\r\n    MarkupPolycloud.prototype = Object.create(Markup.prototype);\r\n    MarkupPolycloud.prototype.constructor = MarkupPolycloud;\r\n\r\n    var proto = MarkupPolycloud.prototype;\r\n\r\n    proto.getEditMode = function() {\r\n\r\n        return new EditModePolycloud(this.editor);\r\n    };\r\n\r\n    /**\r\n     *\r\n     * Sets top-left and bottom-right values in client space coordinates (2d).\r\n     * @param position\r\n     * @param size\r\n     * @param locations\r\n     * @param closed\r\n     */\r\n    proto.set = function(position, size, locations, closed) {\r\n\r\n        this.rotation = 0; // Reset angle //\r\n        this.locations = locations.concat();\r\n\r\n        this.size.x = (size.x === 0) ? 1 : size.x;\r\n        this.size.y = (size.y === 0) ? 1 : size.y;\r\n\r\n        this.closed = closed;\r\n\r\n        this.setSize(position, size.x, size.y);\r\n        this.updateStyle();\r\n    };\r\n\r\n    /**\r\n     * Applies data values into DOM element style/attribute(s)\r\n     *\r\n     */\r\n    proto.updateStyle = function() {\r\n\r\n        var style = this.style;\r\n        var shape = this.shape;\r\n        var path = this.getPath().join(' ');\r\n\r\n        var strokeWidth = this.style['stroke-width'];\r\n        var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\r\n        var fillColor = this.closed ? composeRGBAString(style['fill-color'], style['fill-opacity']) : 'none';\r\n        var transform = this.getTransform();\r\n\r\n        setAttributeToMarkupSvg(shape, 'd', path);\r\n        setAttributeToMarkupSvg(shape, 'stroke-width', strokeWidth);\r\n        setAttributeToMarkupSvg(shape, 'stroke', strokeColor);\r\n        setAttributeToMarkupSvg(shape, 'fill', fillColor);\r\n        setAttributeToMarkupSvg(shape, 'transform', transform);\r\n        updateMarkupPathSvgHitarea(shape, this.editor);\r\n    };\r\n\r\n    /**\r\n     * Changes the position and size of the markup.\r\n     * This gets called by the Autodesk.Viewing.Extensions.Markups.Core.SetSize edit action\r\n     * @param {{x: Number, y: Number}} position\r\n     * @param {Number} width\r\n     * @param {Number} height\r\n     */\r\n    proto.setSize = function (position, width, height) {\r\n\r\n        width = (width === 0 ? 1 : width);\r\n        height = (height === 0 ? 1 : height);\r\n\r\n        var locations = this.locations;\r\n        var locationsCount = locations.length;\r\n\r\n        var scaleX = width / this.size.x;\r\n        var scaleY = height / this.size.y;\r\n\r\n        for(var i = 0; i < locationsCount; ++i) {\r\n\r\n            var point = locations[i];\r\n\r\n            point.x *= scaleX;\r\n            point.y *= scaleY;\r\n        }\r\n\r\n        this.position.x = position.x;\r\n        this.position.y = position.y;\r\n\r\n        this.size.x = width;\r\n        this.size.y = height;\r\n\r\n        this.updateStyle();\r\n    };\r\n\r\n    proto.setMetadata = function() {\r\n\r\n        var metadata = cloneStyle(this.style);\r\n\r\n        metadata.type = this.type;\r\n        metadata.position = [this.position.x, this.position.y].join(\" \");\r\n        metadata.size = [this.size.x, this.size.y].join(\" \");\r\n        metadata.rotation = String(this.rotation);\r\n        metadata.locations = this.locations.map(function(point){\r\n            return [point.x, point.y].join(\" \");\r\n        }).join(\" \");\r\n\r\n        return this.addMarkupMetadata(this.shape, metadata);\r\n    };\r\n\r\n    proto.getPath = function() {\r\n\r\n        function getOrientation(locations) {\r\n\r\n            switch (locations.length) {\r\n\r\n                case 0:\r\n                case 1:\r\n                    return 1;\r\n                case 2:\r\n\r\n                    var fstPoint = locations[0];\r\n                    var sndPoint = locations[1];\r\n\r\n                    return fstPoint.y > sndPoint.y ? 1 : -1;\r\n                default:\r\n\r\n                    var pointA = locations[0];\r\n                    var pointB = locations[1];\r\n                    var pointC = locations[2];\r\n\r\n                    var orientation =\r\n                        (pointB.x - pointA.x) * (pointB.y + pointA.y) +\r\n                        (pointC.x - pointB.x) * (pointC.y + pointB.y);\r\n\r\n                    return orientation < 0 ? 1 : -1;\r\n            }\r\n        }\r\n\r\n        function getSides(locations, closed) {\r\n\r\n            var locationsCount = locations.length;\r\n\r\n            var sides = [];\r\n            var sidesCount = locationsCount - (closed ? 0 : 1);\r\n\r\n            for(var i = 0; i < sidesCount; ++i) {\r\n\r\n                var locationA = locations[i];\r\n                var locationB = locations[(i+1)%locationsCount];\r\n\r\n                var dx = locationB.x - locationA.x;\r\n                var dy = locationB.y - locationA.y;\r\n\r\n                var length = Math.sqrt(dx * dx + dy * dy);\r\n\r\n                sides.push({\r\n                    index: i,\r\n                    pointA: new THREE.Vector3(locationA.x, locationA.y, 0),\r\n                    pointB: new THREE.Vector3(locationB.x, locationB.y, 0),\r\n                    vecAB:  new THREE.Vector3(dx / length, dy / length, 0),\r\n                    vecBA:  new THREE.Vector3(-dx / length, -dy / length, 0),\r\n                    length: length\r\n                });\r\n            }\r\n\r\n            return sides;\r\n        }\r\n\r\n        function updateCorners(side, cornerA, cornerB, orientation) {\r\n            var rA = cornerA.radius;\r\n            var rB = cornerB.radius;\r\n            var D = side.length;\r\n\r\n            if (rA > 0 && rB > 0 && rA + rB > D && Math.abs(rA - rB) < D) {\r\n                // Corner arcs overlap, so correct them by finding the circle-circle intersection\r\n                var a = side.pointA.x;\r\n                var b = side.pointA.y;\r\n                var c = side.pointB.x;\r\n                var d = side.pointB.y;\r\n\r\n                var delta = 0.25 * Math.sqrt((D + rA + rB) * (D + rA - rB) * (D - rA + rB) * (-D + rA + rB));\r\n                var xS = (a + c) / 2 + (c - a) * (rA*rA - rB*rB) / (2*D*D);\r\n                var xT = 2*(b - d) / (D*D) * delta;\r\n                var yS = (b + d) / 2 + (d - b) * (rA*rA - rB*rB) / (2*D*D);\r\n                var yT = 2*(a - c) / (D*D) * delta;\r\n                var x1 = xS + xT;\r\n                var x2 = xS - xT;\r\n                var y1 = yS - yT;\r\n                var y2 = yS + yT;\r\n                var testPointOnCircle = Math.abs((x1 - a) * (x1 - a) + (y1 - b) * (y1 - b) - rA * rA);\r\n                if (testPointOnCircle > 0.0000001) {\r\n                    var tmp = y1;\r\n                    y1 = y2;\r\n                    y2 = tmp;\r\n                }\r\n\r\n                var intersec = new THREE.Vector3(x1, y1, 0);\r\n                var intersecSide = Math.sign(intersec.clone().sub(side.pointA).cross(side.vecAB).z);\r\n                if (intersecSide !== orientation) {\r\n                    intersec.set(x2, y2, 0);\r\n                }\r\n\r\n                cornerA.pointB = intersec.clone();\r\n                cornerB.pointA = intersec.clone();\r\n\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        }\r\n\r\n        function updateSides(sides, corners, radius, orientation) {\r\n\r\n            var diameter = radius * 2;\r\n            var sidesCount = sides.length;\r\n\r\n            for(var i = 0; i < sidesCount; ++i) {\r\n\r\n                var side = sides[i];\r\n                var cornerA = corners[i];\r\n                var cornerB = corners[(i+1)%sidesCount];\r\n\r\n                side.bodyA = side.vecAB.clone().multiplyScalar(cornerA.radius).add(side.pointA);\r\n                side.bodyB = side.vecBA.clone().multiplyScalar(cornerB.radius).add(side.pointB);\r\n\r\n                if (updateCorners(side, cornerA, cornerB, orientation)) {\r\n                    side.body = 0;\r\n                    side.bodyDiameter = side.bodyCount = 0;\r\n                } else {\r\n                    side.body = side.bodyB.clone().sub(side.bodyA).length();\r\n                    side.bodyCount = Math.round(side.body / diameter);\r\n                    if (side.bodyCount === 0 && side.body > 0.5*radius) {\r\n                        side.bodyCount = 1;\r\n                    }\r\n                    side.bodyDiameter = diameter + (side.body - diameter * side.bodyCount) / side.bodyCount;\r\n                }\r\n\r\n                side.bodyRadius = side.bodyDiameter * 0.5;\r\n            }\r\n        }\r\n\r\n        function getCorners(sides, radius, closed) {\r\n\r\n            var corners = [];\r\n            var sidesCount = sides.length;\r\n\r\n            for(var i = 0; i < sidesCount; ++i) {\r\n\r\n                var sideA = sides[i !== 0 ? i-1 : sidesCount-1];\r\n                var sideB = sides[i];\r\n                var large = sideA.vecBA.clone().cross(sideB.vecAB).z < 0;\r\n\r\n                var sidesTooShort = sideA.length < radius || sideB.length < radius;\r\n                if (sidesTooShort || (i === 0 && !closed)) {\r\n\r\n                    corners.push({\r\n                        pointA: sideB.pointA.clone(),\r\n                        pointB: sideB.pointA.clone(),\r\n                        radius: 0,\r\n                        large: false\r\n                    });\r\n                } else {\r\n\r\n                    corners.push({\r\n                        pointA: sideB.pointA.clone().add(sideA.vecBA.clone().multiplyScalar(radius)),\r\n                        pointB: sideB.pointA.clone().add(sideB.vecAB.clone().multiplyScalar(radius)),\r\n                        radius: radius,\r\n                        large: large\r\n                    });\r\n                }\r\n            }\r\n\r\n            return corners;\r\n        }\r\n\r\n        function createSidePath(side, orientation, path) {\r\n\r\n            var count = side.bodyCount;\r\n            if (count === 0) {\r\n                return;\r\n            }\r\n\r\n            var radius = side.bodyRadius;\r\n            var diameter = side.bodyDiameter;\r\n\r\n            var xValueInset = diameter * 0.05;\r\n            var yValueOffset = radius * 3.5 / 3.0;\r\n\r\n            var p1 = new THREE.Vector3(xValueInset, orientation * -yValueOffset);\r\n            var p2 = new THREE.Vector3(diameter - xValueInset, orientation * -yValueOffset);\r\n            var p3 = new THREE.Vector3(diameter, 0);\r\n\r\n            var angle = Math.acos(side.vecAB.x) * (side.vecAB.y < 0 ? -1 : 1);\r\n            var rotation = new THREE.Matrix4().makeRotationZ(angle);\r\n\r\n            p1.applyMatrix4(rotation);\r\n            p2.applyMatrix4(rotation);\r\n            p3.applyMatrix4(rotation);\r\n\r\n            for (var i = 0; i < count; ++i) {\r\n\r\n                path.push('c');\r\n                path.push(p1.x);\r\n                path.push(p1.y);\r\n                path.push(p2.x);\r\n                path.push(p2.y);\r\n                path.push(p3.x);\r\n                path.push(p3.y);\r\n            }\r\n        }\r\n\r\n        function createCornerPath(corner, first, orientation, path) {\r\n\r\n            if (first) {\r\n\r\n                path.push('M');\r\n                path.push(corner.pointA.x);\r\n                path.push(corner.pointA.y);\r\n            }\r\n\r\n            var large = orientation === 1 ? corner.large : !corner.large;\r\n\r\n            if (corner.radius !== 0) {\r\n\r\n                path.push('a');\r\n                path.push(corner.radius);\r\n                path.push(corner.radius);\r\n                path.push(0);\r\n                path.push(large ? 1 : 0);\r\n                path.push(orientation === 1 ? 1 : 0);\r\n                path.push(corner.pointB.x - corner.pointA.x);\r\n                path.push(corner.pointB.y - corner.pointA.y);\r\n            }\r\n            return path;\r\n        }\r\n\r\n\r\n        var strokeWidth = this.style['stroke-width'];\r\n        var radius = strokeWidth * 2;\r\n        var orientation = getOrientation(this.locations);\r\n        var closed = this.closed;\r\n        var path = [];\r\n\r\n        var sides = getSides(this.locations, closed);\r\n        var corners = getCorners(sides, radius, closed);\r\n        var cornersCount = corners.length;\r\n\r\n        updateSides(sides, corners, radius, orientation);\r\n\r\n        for(var i = 0; i < cornersCount; ++i) {\r\n\r\n            createCornerPath(corners[i], i === 0, orientation, path);\r\n            createSidePath(sides[i], orientation, path);\r\n        }\r\n\r\n        closed && path.push('z');\r\n        return path;\r\n    };\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\nimport { MarkupPolycloud } from '../MarkupPolycloud'\r\nimport { cloneStyle } from '../StyleUtils'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param id\r\n     * @param position\r\n     * @param size\r\n     * @param rotation\r\n     * @param locations\r\n     * @param closed\r\n     * @param style\r\n     * @constructor\r\n     */\r\n    export function CreatePolycloud(editor, id, position, size, rotation, locations, style, closed) {\r\n\r\n        EditAction.call(this, editor, 'CREATE-POLYCLOUD', id);\r\n\r\n        this.selectOnExecution = false;\r\n        this.position = position;\r\n        this.size = size;\r\n        this.rotation = rotation;\r\n        this.movements = locations.concat();\r\n        this.style = cloneStyle(style);\r\n        this.closed = closed;\r\n    }\r\n\r\n    CreatePolycloud.prototype = Object.create(EditAction.prototype);\r\n    CreatePolycloud.prototype.constructor = CreatePolycloud;\r\n\r\n    var proto = CreatePolycloud.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        var editor = this.editor;\r\n        var polyline = new MarkupPolycloud(this.targetId, editor);\r\n\r\n        editor.addMarkup(polyline);\r\n\r\n        polyline.set(this.position, this.size, this.movements, this.closed);\r\n        polyline.setRotation(this.rotation);\r\n        polyline.setStyle(this.style);\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        var markup = this.editor.getMarkup(this.targetId);\r\n        markup && this.editor.removeMarkup(markup);\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\nimport { CreateHighlight } from './CreateHighlight'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param highlight\r\n     * @constructor\r\n     */\r\n    export function DeleteHighlight(editor, highlight) {\r\n        EditAction.call(this, editor, 'DELETE-HIGHLIGHT', highlight.id);\r\n        this.createHighlight = new CreateHighlight(\r\n            editor,\r\n            highlight.id,\r\n            highlight.position,\r\n            highlight.size,\r\n            highlight.rotation,\r\n            highlight.locations,\r\n            highlight.getStyle());\r\n    }\r\n\r\n    DeleteHighlight.prototype = Object.create(EditAction.prototype);\r\n    DeleteHighlight.prototype.constructor = DeleteHighlight;\r\n\r\n    var proto = DeleteHighlight.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        this.createHighlight.undo();\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        this.createHighlight.redo();\r\n    };\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param highlight\r\n     * @param position\r\n     * @param size\r\n     * @param locations\r\n     * @constructor\r\n     */\r\n    export function SetHighlight(editor, highlight, position, size, locations, isAbsoluteCoords) {\r\n\r\n        EditAction.call(this, editor, 'SET-HIGHLIGHT', highlight.id);\r\n\r\n        this.position = position;\r\n        this.size = size;\r\n        this.locations = isAbsoluteCoords ? locations : locations.slice(0);\r\n        this.isAbsoluteCoords = isAbsoluteCoords;\r\n\r\n        // No need to save old data\r\n    }\r\n\r\n    SetHighlight.prototype = Object.create(EditAction.prototype);\r\n    SetHighlight.prototype.constructor = SetHighlight;\r\n\r\n    var proto = SetHighlight.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        var highlight = this.editor.getMarkup(this.targetId);\r\n        if (!highlight) {\r\n            return;\r\n        }\r\n\r\n        highlight.set(this.position, this.size, this.locations, this.isAbsoluteCoords);\r\n    };\r\n\r\n    proto.undo = function() {\r\n        // No need for undo.\r\n    };\r\n\r\n    proto.merge = function(action) {\r\n\r\n        if (this.targetId === action.targetId &&\r\n            this.type === action.type) {\r\n\r\n            this.locations = action.isAbsoluteCoords ? action.locations : action.locations.slice(0);\r\n            this.position = action.position;\r\n            this.size = action.size;\r\n            this.isAbsoluteCoords = action.isAbsoluteCoords;\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * @returns {boolean}\r\n     */\r\n    proto.isIdentity = function() {\r\n\r\n        return false; // No need to optimize, always false.\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { EditModePen } from './EditModePen'\r\nimport { DeleteHighlight } from '../edit-actions/DeleteHighlight'\r\nimport { CreateHighlight } from '../edit-actions/CreateHighlight'\r\nimport { SetHighlight } from '../edit-actions/SetHighlight'\r\nimport * as MarkupTypes from '../MarkupTypes'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @constructor\r\n     */\r\n    export function EditModeHighlight(editor) {\r\n\r\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity'];\r\n        EditModePen.call(this, editor, MarkupTypes.MARKUP_TYPE_HIGHLIGHT, styleAttributes);\r\n\r\n        var normaStrokeWidth = editor.getStrokeWidth();\r\n        this.style['stroke-opacity'] = 0.50;\r\n        this.style['stroke-color'] = '#ffff00';\r\n        this.style['stroke-width'] = 4 * normaStrokeWidth; // Very Thick\r\n    }\r\n\r\n    EditModeHighlight.prototype = Object.create(EditModePen.prototype);\r\n    EditModeHighlight.prototype.constructor = EditModeHighlight;\r\n\r\n    var proto = EditModeHighlight.prototype;\r\n\r\n    proto.createPen = function(markupId, position, size, rotation, locations) {\r\n        return new CreateHighlight(this.editor,\r\n            markupId,\r\n            position,\r\n            size,\r\n            rotation,\r\n            locations,\r\n            this.style);\r\n    };\r\n\r\n    proto.deletePen = function(markup) {\r\n        return new DeleteHighlight(this.editor, markup);\r\n    };\r\n\r\n    proto.setPen = function(position, size, locations, isAbsoluteCoords) {\r\n        return new SetHighlight(this.editor,\r\n            this.selectedMarkup,\r\n            position,\r\n            size,\r\n            locations,\r\n            isAbsoluteCoords);\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { MarkupPen } from './MarkupPen'\r\nimport * as MarkupTypes from './MarkupTypes'\r\nimport { EditModeHighlight } from './edit-modes/EditModeHighlight'\r\n\r\n    /**\r\n     *\r\n     * @param id\r\n     * @param editor\r\n     * @constructor\r\n     */\r\n    export function MarkupHighlight(id, editor) {\r\n\r\n        MarkupPen.call(this, id, editor);\r\n        this.type = MarkupTypes.MARKUP_TYPE_HIGHLIGHT;\r\n    }\r\n\r\n    MarkupHighlight.prototype = Object.create(MarkupPen.prototype);\r\n    MarkupHighlight.prototype.constructor = MarkupHighlight;\r\n\r\n    var proto = MarkupHighlight.prototype;\r\n\r\n    proto.getEditMode = function() {\r\n\r\n        return new EditModeHighlight(this.editor);\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\nimport { MarkupHighlight } from '../MarkupHighlight'\r\nimport { cloneStyle } from '../StyleUtils'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param id\r\n     * @param position\r\n     * @param size\r\n     * @param rotation\r\n     * @param locations\r\n     * @param style\r\n     * @constructor\r\n     */\r\n    export function CreateHighlight(editor, id, position, size, rotation, locations, style) {\r\n\r\n        EditAction.call(this, editor, 'CREATE-HIGHLIGHT', id);\r\n\r\n        this.selectOnExecution = false;\r\n        this.position = position;\r\n        this.size = size;\r\n        this.rotation = rotation;\r\n        this.movements = locations.slice(0);\r\n        this.style = cloneStyle(style);\r\n    }\r\n\r\n    CreateHighlight.prototype = Object.create(EditAction.prototype);\r\n    CreateHighlight.prototype.constructor = CreateHighlight;\r\n\r\n    var proto = CreateHighlight.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        var editor = this.editor;\r\n        var highlight = new MarkupHighlight(this.targetId, editor);\r\n\r\n        editor.addMarkup(highlight);\r\n\r\n        highlight.set(this.position, this.size, this.movements, false);\r\n        highlight.setRotation(this.rotation);\r\n        highlight.setStyle(this.style);\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        var markup = this.editor.getMarkup(this.targetId);\r\n        markup && this.editor.removeMarkup(markup);\r\n    };\r\n\r\n\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\nimport { CreateDimension } from './CreateDimension'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param dimension\r\n     * @constructor\r\n     */\r\n    export function DeleteDimension(editor, dimension) {\r\n\r\n        // Confusing naming here. Dimension.secondAnchor is the starting point of the dimension,\r\n        // and dimension.firstAnchor is the final point. In CreateDimension the firstAnchor argument\r\n        // is the first point of the dimension and the secondAnchor argument is the second\r\n        // point of the argument. So construct CreateDimension with the secondAnchor before\r\n        // the firstAnchor. \r\n        EditAction.call(this, editor, 'DELETE-DIMENSION', dimension.id);\r\n        this.createDimension = new CreateDimension(\r\n            editor,\r\n            dimension.id,\r\n            dimension.secondAnchor,\r\n            dimension.firstAnchor,\r\n            dimension.currentText,\r\n            dimension.getStyle());\r\n    }\r\n\r\n    DeleteDimension.prototype = Object.create(EditAction.prototype);\r\n    DeleteDimension.prototype.constructor = DeleteDimension;\r\n\r\n    var proto = DeleteDimension.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        this.createDimension.undo();\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        this.createDimension.redo();\r\n    };\r\n\r\n\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param dimension\r\n     * @param firstAnchor\r\n     * @param secondAnchor\r\n     * @constructor\r\n     */\r\n    export function SetDimension(editor, dimension, firstAnchor, secondAnchor, text) {\r\n\r\n        EditAction.call(this, editor, 'SET-DIMENSION', dimension.id);\r\n\r\n        this.newFirstAnchor = {x: firstAnchor.x, y: firstAnchor.y};\r\n        this.newSecondAnchor = {x: secondAnchor.x, y: secondAnchor.y};   \r\n        this.oldFirstAnchor = {x: dimension.firstAnchor.x, y: dimension.firstAnchor.y};\r\n        this.oldSecondAnchor = {x: dimension.secondAnchor.x, y: dimension.secondAnchor.y}; \r\n        this.newText = text;\r\n        this.oldText = dimension.currentText;\r\n    }\r\n\r\n    SetDimension.prototype = Object.create(EditAction.prototype);\r\n    SetDimension.prototype.constructor = SetDimension;\r\n\r\n    var proto = SetDimension.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        this.applyState(this.newFirstAnchor, this.newSecondAnchor, this.newText);    \r\n\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        this.applyState(this.oldFirstAnchor, this.oldSecondAnchor, this.oldText);\r\n\r\n    };\r\n\r\n    proto.merge = function(action) {\r\n\r\n        if (this.targetId === action.targetId &&\r\n            this.type === action.type) {\r\n\r\n            this.newFirstAnchor = action.newFirstAnchor;\r\n            this.newSecondAnchor = action.newSecondAnchor;\r\n            this.newText = action.newText;\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @private\r\n     */\r\n    proto.applyState = function(firstAnchor, secondAnchor, text) {\r\n\r\n        var dimension = this.editor.getMarkup(this.targetId);\r\n\r\n        if(!dimension) {\r\n            return;\r\n        }\r\n\r\n        dimension.set(firstAnchor.x, firstAnchor.y, secondAnchor.x, secondAnchor.y, text);\r\n\r\n    };\r\n\r\n    /**\r\n     * @returns {boolean}\r\n     */\r\n    proto.isIdentity = function() {\r\n\r\n        return ((this.newText === this.oldText) && (\r\n            !this.newFirstAnchor || !this.newSecondAnchor ||\r\n            this.newFirstAnchor.x === this.oldFirstAnchor.x &&\r\n            this.newFirstAnchor.y === this.oldFirstAnchor.y &&\r\n            this.newSecondAnchor.x === this.oldSecondAnchor.x &&\r\n            this.newSecondAnchor.y === this.oldSecondAnchor.y));\r\n    };\r\n","'use strict';\r\n\r\nimport { EditMode } from './EditMode'\r\nimport { DeleteDimension } from '../edit-actions/DeleteDimension'\r\nimport { CreateDimension } from '../edit-actions/CreateDimension'\r\nimport { SetDimension } from '../edit-actions/SetDimension'\r\nimport { SetStyle } from '../edit-actions/SetStyle'\r\nimport * as MarkupTypes from '../MarkupTypes'\r\nimport * as MarkupEvents from '../MarkupEvents'\r\nimport { EditorTextInput } from './EditorTextInput'\r\nimport { measureTextLines, radiansToDegrees } from '../MarkupsCoreUtils'\r\n\r\n    var MeasureCommon = Autodesk.Viewing.MeasureCommon;\r\n    \r\n    var MAX_LETTERS = 15;\r\n    var SPACE = '\\u00A0'; // Non-breaking space\r\n    var _cursorPosition;\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @constructor\r\n     */\r\n    export function EditModeDimension(editor) {\r\n\r\n        var self = this;\r\n\r\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity', 'font-size', 'font-family', 'font-style', 'font-weight'];\r\n        EditMode.call(this, editor, MarkupTypes.MARKUP_TYPE_DIMENSION, styleAttributes);\r\n\r\n        this.onHistoryChangeBinded = this.onHistoryChange.bind(this);\r\n\r\n        this.measurement = new MeasureCommon.Measurement(MeasureCommon.MeasurementTypes.MEASUREMENT_DISTANCE);\r\n        var viewer = this.viewer;\r\n        var measureExt = viewer.getExtension('Autodesk.Measure');\r\n        \r\n        function abortDimensionMarkup() {\r\n            self.cancelEditModeChange = true;\r\n            editor.enterEditMode(); // Selects default edit mode.\r\n        }\r\n\r\n        if (!measureExt) {\r\n            console.error('Demension markup cant work without measure extension. Please load measure extension first');\r\n            abortDimensionMarkup();\r\n        }\r\n\r\n        this.sharedMeasureConfig = measureExt.sharedMeasureConfig;\r\n        \r\n        // If PDF, force calibration\r\n        if ((measureExt.forceCalibrate || viewer.model.getData().isLeaflet || viewer.model.getData().isPdf) && !measureExt.calibrationTool.isCalibrated()) {\r\n            measureExt.openCalibrationRequiredDialog('dimension');\r\n            abortDimensionMarkup();\r\n        }\r\n    }\r\n\r\n    EditModeDimension.prototype = Object.create(EditMode.prototype);\r\n    EditModeDimension.prototype.constructor = EditModeDimension;\r\n\r\n    var proto = EditModeDimension.prototype;\r\n\r\n    proto.deleteMarkup = function(markup, cantUndo) {\r\n\r\n        markup = markup || this.selectedMarkup;\r\n        if (markup && markup.type == this.type) {\r\n            var deleteDimension = new DeleteDimension(this.editor, markup);\r\n            deleteDimension.addToHistory = !cantUndo;\r\n            deleteDimension.execute();\r\n            this.creating = false;\r\n            this.dragging = false;\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    proto.updateTextBoxStyle = function(style) {\r\n        if (this.isTextInputHelperActive()) {\r\n            if (!style) {\r\n                style = this.textInputHelper.textMarkup.getStyle();\r\n            }\r\n\r\n            this.textInputHelper.setStyle(style);\r\n            this.updateTextBox(this.textInputHelper.textMarkup);\r\n        }\r\n    };\r\n\r\n    proto.setStyle = function(style) {\r\n\r\n        EditMode.prototype.setStyle.call(this, style);\r\n        this.updateTextBoxStyle(style);\r\n\r\n    };\r\n\r\n    proto.notifyAllowNavigation = function(allows) {\r\n\r\n        if (allows && this.isTextInputHelperActive()) {\r\n            this.textInputHelper.acceptAndExit();\r\n        }\r\n    };\r\n\r\n    proto.creationBegin = function() {\r\n        EditMode.prototype.creationBegin.call(this);\r\n    };\r\n\r\n    proto.creationEnd = function() {\r\n\r\n        this.dragging = false;\r\n        EditMode.prototype.creationEnd.call(this);\r\n    };\r\n\r\n    proto.isMinSizeValid = function() {\r\n\r\n        if (this.minSize !== 0) {\r\n            var tmp = this.editor.sizeFromMarkupsToClient(this.selectedMarkup.size.x, this.selectedMarkup.size.y);\r\n            return (tmp.x*tmp.x) >= (this.minSize * this.minSize);\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    proto.creationCancel = function() {\r\n\r\n        EditMode.prototype.creationCancel.call(this);\r\n\r\n        this.creating = false;\r\n        this.dragging = false;\r\n\r\n    };\r\n\r\n    proto.destroy = function() {\r\n\r\n        if (this.textInputHelper) {\r\n\r\n            if (this.textInputHelper.isActive()) {\r\n                this.textInputHelper.acceptAndExit();\r\n            }\r\n\r\n            this.editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\r\n\r\n            this.textInputHelper.destroy();\r\n            this.textInputHelper = null;\r\n        }\r\n\r\n        this.updateViewportId();\r\n\r\n        EditMode.prototype.destroy.call(this);\r\n    };\r\n\r\n    proto.getDistance = function() {\r\n\r\n        var distance = null;\r\n\r\n        this.measurement.computeResult(this.measurement.picks, this.viewer);\r\n\r\n        if (this.viewer.model && this.measurement.distanceXYZ) {\r\n            var d = Autodesk.Viewing.Private.convertUnits(this.viewer.model.getUnitString(), this.sharedMeasureConfig.units, this.sharedMeasureConfig.calibrationFactor, this.measurement.distanceXYZ);\r\n            return Autodesk.Viewing.Private.formatValueWithUnits(d, this.sharedMeasureConfig.units, 3, this.sharedMeasureConfig.precision);\r\n        }\r\n\r\n        return distance;\r\n    };\r\n\r\n    proto.updateMeasurement = function(measurementNumber) {\r\n        var editor = this.editor;\r\n\r\n        var pick = this.measurement.getPick(measurementNumber);\r\n        \r\n        if (_cursorPosition) {\r\n            pick.geomType = MeasureCommon.SnapType.SNAP_VERTEX;\r\n            pick.geomVertex = _cursorPosition;\r\n            pick.intersectPoint = _cursorPosition;\r\n        } else {\r\n            editor.snapper.copyResults(pick);\r\n        }\r\n\r\n        return pick;\r\n    };\r\n\r\n    proto.updateViewportId = function(viewportId) {\r\n        if (this.viewer.model && this.viewer.model.is2d()) {\r\n            if (!viewportId) {\r\n                this.viewer.impl.updateViewportId(0);\r\n                this.editor.snapper.setViewportId(null);\r\n            }\r\n            else {\r\n                // Pass viewport Id to LineShader to make all other geometries with different viewport transparent\r\n                this.viewer.impl.updateViewportId(viewportId);\r\n                this.editor.snapper.setViewportId(viewportId);  \r\n            \r\n            }\r\n        }\r\n    };\r\n\r\n    proto.pickFirstAnchor = function() {\r\n        var editor = this.editor;\r\n        this.measurement.clearAllPicks();\r\n        var mousePosition = editor.getMousePosition();\r\n\r\n        this.initialX = mousePosition.x;\r\n        this.initialY = mousePosition.y;\r\n\r\n        this.firstAnchor = editor.positionFromClientToMarkups(this.initialX, this.initialY);\r\n\r\n        editor.beginActionGroup();\r\n\r\n        var dimensionId = editor.getId();\r\n        var create = new CreateDimension(editor, dimensionId, this.firstAnchor, null, this.currentText, this.style);\r\n        create.execute();\r\n\r\n        this.selectedMarkup = editor.getMarkup(dimensionId);\r\n        this.creationBegin();\r\n        \r\n        var pick = this.updateMeasurement(1);\r\n        this.updateViewportId(pick.viewportIndex2d);\r\n    };\r\n\r\n    proto.pickSecondAnchor = function(mouseDown) {\r\n\r\n        var editor = this.editor;\r\n        var selectedMarkup = this.selectedMarkup;\r\n\r\n        this.secondAnchor = this.getFinalMouseDraggingPosition();\r\n\r\n        this.updateMeasurement(2);\r\n\r\n        // Correct Perpendicular\r\n        if (MeasureCommon.correctPerpendicularPicks(this.measurement.getPick(1), this.measurement.getPick(2), this.viewer, editor.snapper)){\r\n            var newPos = MeasureCommon.getSnapResultPosition(this.measurement.getPick(2), this.viewer);\r\n            this.secondAnchor = editor.project(newPos);\r\n            editor.snapper.indicator.render();\r\n        }\r\n\r\n        var secondAnchor = editor.positionFromClientToMarkups(this.secondAnchor.x, this.secondAnchor.y);\r\n\r\n        this.size.x = selectedMarkup.size.x;\r\n        this.size.y = selectedMarkup.size.y;\r\n\r\n        selectedMarkup.currentText = this.getDistance();         \r\n\r\n        var setDimension = new SetDimension(editor, selectedMarkup, this.firstAnchor, secondAnchor, selectedMarkup.currentText);\r\n        setDimension.execute();\r\n\r\n        var setStyle = new SetStyle(editor, selectedMarkup, this.style);\r\n        setStyle.execute();\r\n\r\n        // Open 'Add Length' textbox if no measurement has being taken.\r\n        if (mouseDown && !selectedMarkup.currentText && this.isMinSizeValid()) {\r\n            selectedMarkup.currentText = '';\r\n            this.editor.selectMarkup(null);\r\n            this.updateTextBox(selectedMarkup);\r\n        } \r\n    };\r\n\r\n\r\n    /**\r\n     * Handler to mouse down events, used to start markups creation.\r\n     * @private\r\n     */\r\n    proto.onMouseDown = function(event) {\r\n\r\n        // Right click - do nothing.\r\n        if (Autodesk.Viewing.Private.isRightClick(event, this.viewer.navigation)) {\r\n            return;\r\n        }\r\n\r\n        _cursorPosition = null;\r\n\r\n        // Textbox is open.\r\n        if (this.isTextInputHelperActive()) {\r\n            this.textInputHelper.acceptAndExit();\r\n            return;\r\n        }\r\n\r\n        EditMode.prototype.onMouseDown.call(this);\r\n\r\n        // User selected an already created markup.\r\n        if (this.selectedMarkup && !this.creating) {\r\n            return;\r\n        }\r\n        \r\n        var isSnapped = this.editor.snapper.isSnapped();\r\n\r\n        // Picked first point.\r\n        if (!this.selectedMarkup && !this.creating && isSnapped) {\r\n            this.pickFirstAnchor();\r\n        }\r\n\r\n        // Picked second point.\r\n        else if (this.selectedMarkup && this.creating) {\r\n\r\n            if (isSnapped) {\r\n                this.pickSecondAnchor(true);   \r\n            } else {\r\n                this.deleteMarkup(this.selectedMarkup, true);\r\n                this.creating = true;\r\n            }\r\n\r\n            this.updateViewportId();\r\n            this.creationEnd();\r\n        }\r\n    };\r\n\r\n    proto.onMouseUp = function(event) {\r\n\r\n        if (this.dragging) {\r\n            this.onMouseDown(event);   \r\n            this.dragging = false; \r\n        }\r\n    };\r\n\r\n\r\n    /**\r\n     * Handler to mouse move events, used to create markups.\r\n     * @param {MouseEvent} event Mouse event.\r\n     * @private\r\n     */\r\n    proto.onMouseMove = function(event) {\r\n\r\n        _cursorPosition = null;\r\n\r\n        if(!this.selectedMarkup || !this.creating) {\r\n            return;\r\n        }\r\n\r\n        this.dragging = true;\r\n        this.pickSecondAnchor(false);\r\n    };\r\n\r\n    proto.getFinalMouseDraggingPosition = function() {\r\n\r\n        var editor = this.editor;\r\n        var bounds = editor.getBounds();\r\n        var mousePosition = editor.getMousePosition();\r\n\r\n        if (!editor.snapper.isSnapped()) {\r\n            if (editor.viewer.model && editor.viewer.model.is2d()) {\r\n                _cursorPosition = MeasureCommon.inverseProject(mousePosition, editor.viewer);\r\n            }\r\n        }\r\n\r\n        var initialX = this.initialX;\r\n        var initialY = this.initialY;\r\n\r\n        var finalX = Math.min(Math.max(bounds.x, mousePosition.x), bounds.x + bounds.width);\r\n        var finalY = Math.min(Math.max(bounds.y, mousePosition.y), bounds.y + bounds.height);\r\n\r\n        if (finalX == initialX &&\r\n            finalY == initialY) {\r\n            finalX++;\r\n            finalY++;\r\n        }\r\n\r\n        // Make straight line when shift key is down.\r\n        if (editor.input.constrainAxis && editor.viewer.model.is2d()) {\r\n            var dx = Math.abs(finalX - initialX);\r\n            var dy = Math.abs(finalY - initialY);\r\n\r\n            if (dx > dy) {\r\n                finalY = initialY;\r\n            } \r\n            else {\r\n                finalX = initialX;\r\n            }\r\n\r\n            editor.snapper.onMouseMove({ x:finalX, y:finalY });\r\n            \r\n            if (editor.snapper.isSnapped()) {\r\n                editor.snapper.copyResults(this.measurement.getPick(2));\r\n                _cursorPosition = null;\r\n            } else {\r\n                _cursorPosition = MeasureCommon.inverseProject({ x:finalX, y:finalY }, editor.viewer);\r\n            }\r\n        }\r\n\r\n        return { x:finalX, y:finalY };\r\n    };\r\n\r\n    proto.isVisibleChar = function(keyCode) {\r\n\r\n    return  ((keyCode > 47 && keyCode < 58)  || // number keys\r\n            (keyCode == 32)                  || // spacebar\r\n            (keyCode > 64 && keyCode < 91)   || // letter keys\r\n            (keyCode > 95 && keyCode < 112)  || // numpad keys\r\n            (keyCode > 185 && keyCode < 193) || // ;=,-./` (in order)\r\n            (keyCode > 218 && keyCode < 223));   // [\\]' (in order)\r\n    };\r\n\r\n    proto.measureTextLine = function(text, markup, editor) {\r\n\r\n        text = text.replace(new RegExp(' ', 'g'), SPACE);\r\n        text = text.length === 0 ? markup.initialText : text;\r\n        return measureTextLines([text + '|'], this.style, editor)[0];\r\n\r\n    };\r\n\r\n    proto.handleKeyDown = function (e) {\r\n        var textInputHelper = this.textInputHelper;\r\n        \r\n        if (e.keyCode === Autodesk.Viewing.KeyCode.ENTER) {\r\n            return;\r\n        }\r\n\r\n        var markup = textInputHelper.textMarkup;\r\n        var text = textInputHelper.textArea.value;\r\n\r\n        if (e.keyCode === Autodesk.Viewing.KeyCode.BACKSPACE) {\r\n            text = text.substring(0, text.length-1);\r\n        }\r\n\r\n        if (text.length < MAX_LETTERS && this.isVisibleChar(e.keyCode)) {\r\n            text = text + e.key;            \r\n        }\r\n\r\n        var size = this.measureTextLine(text, markup, this.editor);\r\n                \r\n        this.updateTextBox(markup, size);\r\n    };\r\n\r\n    proto.updateTextBox = function(markup, size) {\r\n\r\n        if (!this.textInputHelper) {\r\n            this.textInputHelper = new EditorTextInput(this.viewer.container, this.editor, true, markup.initialText, MAX_LETTERS);\r\n            this.textInputHelper.addEventListener(this.textInputHelper.EVENT_TEXT_CHANGE, this.onHelperTextChange.bind(this), false);\r\n            this.handleKeyDownBinded = this.handleKeyDown.bind(this);\r\n        }\r\n\r\n        markup.text.style.display = 'none';\r\n        \r\n        if (!size) {\r\n            size = this.measureTextLine(this.textInputHelper.textArea.value, markup, this.editor);\r\n        }\r\n\r\n        var transform = this.getTextAreaTransform(markup, size);\r\n\r\n        this.textInputHelper.styleTextArea.setAttribute('text-align', 'center');\r\n        \r\n        this.textInputHelper.setActive(markup, false);\r\n\r\n        \r\n        // Override textArea attributes\r\n        this.textInputHelper.textArea.style.position = 'static';\r\n        this.textInputHelper.textArea.style.padding = '0';\r\n        this.textInputHelper.textArea.style.width = size.width + 'px';\r\n        this.textInputHelper.textArea.style.height = size.height + 'px';\r\n        this.textInputHelper.textArea.style.transform = transform; // Maybe need to add 'allBrowsers' support\r\n\r\n        this.editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\r\n        this.editor.actionManager.addEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);    \r\n        this.textInputHelper.textArea.removeEventListener('keydown', this.handleKeyDownBinded);\r\n        this.textInputHelper.textArea.addEventListener('keydown', this.handleKeyDownBinded);    \r\n        \r\n    };\r\n\r\n    proto.getTextAreaTransform = function(markup, size) {\r\n\r\n        var position = markup.getClientPosition();\r\n        var rotation = radiansToDegrees(markup.rotation) % 360;\r\n\r\n        if (rotation > 90 && rotation <= 270 && markup.shouldFlip()) {\r\n            rotation = 180 + rotation;\r\n        }\r\n    \r\n        return [\r\n            'translate(', (position.x - (size.width/2)) + 'px,',(position.y - this.viewer.container.clientHeight - size.height) + 'px)',\r\n            'rotate(', rotation + 'deg)',\r\n            'translate(0px,', size.height +'px)'\r\n        ].join(' ');\r\n    };\r\n\r\n    proto.onMouseDoubleClick = function(markup) {\r\n\r\n        if (markup === this.selectedMarkup) {\r\n            this.editor.selectMarkup(null);\r\n            this.updateTextBox(markup);\r\n        }\r\n    };\r\n\r\n    proto.onHelperTextChange = function(event) {\r\n\r\n        var dataBag = event.data;\r\n        var markup = dataBag.markup;\r\n        var textStyle = dataBag.style;\r\n        var editor = this.editor;\r\n\r\n        markup.text.style.display = 'block';\r\n\r\n        if (dataBag.newText === '') {\r\n            dataBag.newText = markup.initialText;\r\n        }\r\n\r\n        // When the text is created for the first time, an action group\r\n        // is already created and it includes the CreateText action.\r\n        // Thus, no need to begin another action group.\r\n        if (!dataBag.firstEdit) {\r\n            editor.beginActionGroup();\r\n        }\r\n\r\n        var setStyle = new SetStyle(editor, markup, textStyle);\r\n        setStyle.execute();\r\n\r\n        var setDimension = new SetDimension(editor, markup, markup.firstAnchor, markup.secondAnchor, dataBag.newText);\r\n        setDimension.execute();\r\n\r\n        editor.closeActionGroup();\r\n        editor.selectMarkup(null);\r\n    };\r\n\r\n    /**\r\n     * We want to make sure that the Input Helper gets removed from the screen\r\n     * whenever the user attempts to perform an undo or redo action.\r\n     * @param {Event} event\r\n     * @private\r\n     */\r\n    proto.onHistoryChange = function(event) {\r\n        if (this.isTextInputHelperActive()) {\r\n            this.textInputHelper.textMarkup.text.style.display = 'block';\r\n            this.editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\r\n            this.textInputHelper.setInactive();\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Notify the markup that the displayed markups are being saved so edit mode can finish current editions.\r\n     */\r\n    proto.onSave = function() {\r\n\r\n        EditMode.prototype.onSave.call(this);\r\n\r\n        // Close input helper if it's open.\r\n        if (this.isTextInputHelperActive()) {\r\n            var editor = this.editor;\r\n            editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\r\n            var markup = this.textInputHelper.textMarkup;\r\n            this.textInputHelper.acceptAndExit();\r\n            markup.text.style.display = 'block';\r\n        }\r\n    };\r\n\r\n    proto.useWithSnapping = function () {\r\n        return true;\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { Markup } from './Markup'\r\nimport * as MarkupTypes from './MarkupTypes'\r\nimport { createMarkupPathSvg, createMarkupTextSvg, composeRGBAString, addMarkupMetadata,\r\n    radiansToDegrees, degreesToRadians, measureTextLines, setMarkupTextSvgTransform,\r\n    setAttributeToMarkupSvg, updateMarkupPathSvgHitarea, createSvgElement, checkLineSegment,\r\n    updateMarkupTextSvgBackground, updateMarkupTextSvgClipper, updateMarkupTextSvgHitarea \r\n} from './MarkupsCoreUtils'\r\nimport { cloneStyle } from './StyleUtils'\r\nimport { EditModeDimension } from './edit-modes/EditModeDimension'\r\n\r\n    var DIMENSION_MARKUP_HEIGHT = 10;\r\n    var TEXT_OFFSET = 2;\r\n    var DEFAULT_TEXT = 'Add Length';\r\n    var BACKGROUND_COLOR = 'none';//'#ffffff';\r\n\r\n    /**\r\n     *\r\n     * @param id\r\n     * @param editor\r\n     * @constructor\r\n     */\r\n    export function MarkupDimension(id, editor) {\r\n\r\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity', 'font-size', 'font-family', 'font-style', 'font-weight'];\r\n        Markup.call(this, id, editor, styleAttributes);\r\n\r\n        this.type = MarkupTypes.MARKUP_TYPE_DIMENSION;\r\n        this.constraintHeight = true;\r\n        this.constraintWidth = true;\r\n\r\n        // bind to this to pass this.globalManager\r\n        this.addMarkupMetadata = addMarkupMetadata.bind(this);\r\n        this.createSvgElement = createSvgElement.bind(this);\r\n        this.checkLineSegment = checkLineSegment.bind(this);\r\n        this.measureTextLines = measureTextLines.bind(this);\r\n\r\n        \r\n        this.firstAnchor = new THREE.Vector3();\r\n        this.secondAnchor = new THREE.Vector3();\r\n        this.shape = createMarkupPathSvg();\r\n        this.text = createMarkupTextSvg();\r\n        this.shape.appendChild(this.text);\r\n        this.textSize = {x: 0, y: 0};\r\n        this.initialText = DEFAULT_TEXT;\r\n        this.currentText = ' ';\r\n\r\n        if (!this.viewer.model.is2d()) {\r\n            this.preventReposition = true;\r\n            this.constraintRotation = true;\r\n        }\r\n\r\n        this.bindDomEvents();\r\n    }\r\n\r\n    MarkupDimension.prototype = Object.create(Markup.prototype);\r\n    MarkupDimension.prototype.constructor = MarkupDimension;\r\n\r\n    var proto = MarkupDimension.prototype;\r\n\r\n    proto.getEditMode = function() {\r\n\r\n        return new EditModeDimension(this.editor);\r\n    };\r\n\r\n    /**\r\n     * Sets top-left and bottom-right values in client space coordinates (2d).\r\n     * Notice that for the Dimension, the top left is the \"secondAnchor\" of the Dimension and\r\n     * the bottom right is the \"firstAnchor\" of it.\r\n     *\r\n     * @param {Number} xO - secondAnchor\r\n     * @param {Number} yO - secondAnchor\r\n     * @param {Number} xF - firstAnchor\r\n     * @param {Number} yF - firstAnchor\r\n     */\r\n    proto.set = function(xO, yO, xF, yF, text) {\r\n\r\n        var vO = new THREE.Vector2(xO, yO);\r\n        var vF = new THREE.Vector2(xF, yF);\r\n        var vDir = vF.clone().sub(vO).normalize();\r\n\r\n        this.size.x = vO.distanceTo(vF); // TODO: Clamp min length\r\n        this.rotation = Math.acos(vDir.dot(new THREE.Vector2(1,0)));\r\n        this.rotation = yF > yO ? (Math.PI*2)-this.rotation : this.rotation;\r\n\r\n        var firstAnchor = this.firstAnchor;\r\n        var secondAnchor = this.secondAnchor;\r\n\r\n        firstAnchor.set(xF, yF, 0);\r\n        secondAnchor.set(xO, yO, 0);\r\n\r\n        this.position.x = secondAnchor.x + (firstAnchor.x - secondAnchor.x) * 0.5;\r\n        this.position.y = secondAnchor.y + (firstAnchor.y - secondAnchor.y) * 0.5;\r\n\r\n        this.currentText = text;\r\n        this.updateStyle();\r\n    };\r\n\r\n    /**\r\n     * Changes the rotation of the markup to the given angle.\r\n     * This gets called by the Autodesk.Viewing.Extensions.Markups.Core.SetRotation edit action\r\n     *\r\n     * @param {Number} angle\r\n     */\r\n    proto.setRotation = function(angle) {\r\n\r\n        if (radiansToDegrees(angle) === 90) {\r\n            angle = degreesToRadians(-90);\r\n        }\r\n\r\n        this.rotation = angle;\r\n\r\n        var xF = Math.cos(-angle);\r\n        var yF = Math.sin(-angle);\r\n        var vFDir = new THREE.Vector2(xF, yF); // already normalized\r\n        vFDir.multiplyScalar(this.size.x*0.5);\r\n\r\n        var vCenter = new THREE.Vector2(this.position.x, this.position.y);\r\n        var vO = vCenter.clone().sub(vFDir);\r\n        var vF = vCenter.clone().add(vFDir);\r\n\r\n        this.firstAnchor.set(vF.x, vF.y, 0);\r\n        this.secondAnchor.set(vO.x, vO.y, 0);\r\n\r\n        this.updateStyle();\r\n    };\r\n\r\n    /**\r\n     * Changes the position and size of the markup.\r\n     * This gets called by the namespace.SetSize edit action\r\n     * @param {{x: Number, y: Number}} position - Dimension's center\r\n     * @param {Number} width - Dimension's length\r\n     * @param {Number} height - We ignore this one because we use the Dimension's stroke width instead\r\n     */\r\n    proto.setSize = function(position, width, height) {\r\n\r\n        var xF = Math.cos(-this.rotation);\r\n        var yF = Math.sin(-this.rotation);\r\n        var vFDir = new THREE.Vector2(xF, yF); // already normalized\r\n        vFDir.multiplyScalar(width*0.5);\r\n\r\n        var vCenter = new THREE.Vector2(position.x, position.y);\r\n        var vO = vCenter.clone().sub(vFDir);\r\n        var vF = vCenter.clone().add(vFDir);\r\n\r\n        this.firstAnchor.set(vF.x, vF.y, 0);\r\n        this.secondAnchor.set(vO.x, vO.y, 0);\r\n\r\n        this.position.x = position.x;\r\n        this.position.y = position.y;\r\n        this.size.x = width;\r\n\r\n        this.updateStyle();\r\n    };\r\n\r\n    /**\r\n     * Helper method that returns the font size in client space coords.\r\n     * @returns {Number}\r\n     */\r\n    proto.getClientFontSize = function() {\r\n\r\n        return this.editor.sizeFromMarkupsToClient(0, this.style['font-size']).y;\r\n    };\r\n\r\n    proto.updateStyle = function() {\r\n\r\n        var style = this.style;\r\n        var shape = this.shape;\r\n        var strokeWidth = style['stroke-width'];\r\n        var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\r\n        var transform = this.getTransform();\r\n\r\n        this.rebuildTextSvg(this.currentText);\r\n\r\n        setAttributeToMarkupSvg(shape, 'd', this.getPath().join(' '));\r\n        setAttributeToMarkupSvg(shape, 'stroke-width', strokeWidth / 2);\r\n        setAttributeToMarkupSvg(shape, 'stroke', strokeColor);\r\n        setAttributeToMarkupSvg(shape, 'fill', strokeColor);\r\n        setAttributeToMarkupSvg(shape, 'transform', transform);\r\n        updateMarkupPathSvgHitarea(shape, this.editor);\r\n    };\r\n\r\n    proto.rebuildTextSvg = function(value) {\r\n        var style = this.style;\r\n        var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\r\n        var strokeWidth = style['stroke-width'];\r\n        var backgroundColor = (value === ' ') ? 'none' : BACKGROUND_COLOR;\r\n\r\n        var markup = this.createSvgElement('text');\r\n        markup.setAttribute('id', 'markup');\r\n        markup.setAttribute('alignment-baseline', 'middle');\r\n\r\n        var text = this.text;\r\n        var editor = this.editor;\r\n\r\n        text.childNodes[0].removeChild(text.markup);\r\n        text.childNodes[0].appendChild(markup);\r\n        text.markup = markup;\r\n\r\n        var tspan = this.createSvgElement('tspan');\r\n        tspan.textContent = value;\r\n        markup.appendChild(tspan);\r\n\r\n        var lineSize = this.measureTextLines([value], style, editor)[0]; // Only one line for measurement\r\n        var textSize = this.textSize = editor.sizeFromClientToMarkups(lineSize.width, lineSize.height);\r\n        \r\n        var edgeH = DIMENSION_MARKUP_HEIGHT * strokeWidth / 2;\r\n        var textOffset = TEXT_OFFSET * strokeWidth / 2;\r\n        var offset = (textSize.x + (2 * strokeWidth) >= this.size.x) ? textOffset + edgeH / 2 : textOffset; // If the line is too short for the given text, put it under.\r\n\r\n        this.size.y = edgeH + textSize.y + offset;\r\n\r\n        var textTransform = this.getTextTransform((4/5 * textSize.y) +  offset, true); // Text height is Always 4/5 of the entire label height.\r\n        var backgroundTransform = this.getTextTransform(textSize.y + offset, false);\r\n\r\n        setAttributeToMarkupSvg(text, 'font-family', style['font-family']);\r\n        setAttributeToMarkupSvg(text, 'font-size', style['font-size']);\r\n        setAttributeToMarkupSvg(text, 'font-weight', style['font-weight']);\r\n        setAttributeToMarkupSvg(text, 'font-style', style['font-style']);\r\n        setAttributeToMarkupSvg(text, 'text-rendering', 'auto');\r\n        setAttributeToMarkupSvg(text, 'fill', strokeColor);\r\n        setMarkupTextSvgTransform(text, backgroundTransform, textTransform); \r\n        updateMarkupTextSvgBackground(text, textSize.x, textSize.y, backgroundColor);\r\n        updateMarkupTextSvgClipper(text, textSize.x, textSize.y);\r\n        updateMarkupTextSvgHitarea(text, textSize.x, textSize.y, editor);\r\n    };\r\n\r\n    proto.shouldFlip = function(){\r\n        return (this.firstAnchor.x < this.secondAnchor.x);\r\n    };\r\n\r\n    proto.getTextTransform = function(offset, inverse) {\r\n\r\n        var flip = this.shouldFlip() ? -1 : 1;\r\n\r\n        inverse = inverse ? -1 : 1;\r\n\r\n        if (radiansToDegrees(this.rotation) === 90) {\r\n            this.rotation = degreesToRadians(-90);\r\n        }\r\n\r\n        return [\r\n            'translate(', this.position.x , ',', this.position.y, ')',\r\n            'rotate(', radiansToDegrees(-this.rotation), ')',\r\n            'translate(', -flip * this.textSize.x / 2, ',', -flip*offset, ')',\r\n            'scale(' + flip + ',' + flip*inverse + ')'\r\n        ].join(' ');\r\n    };\r\n\r\n    /**\r\n     * Used by the EditFrame to move the markup in Client Space coordinates\r\n     * @param {Number} x - New X location for the markup. Notice that markups are centered on this value.\r\n     * @param {Number} y - New Y location for the markup. Notice that markups are centered on this value.\r\n     */\r\n    proto.setPosition = function (x, y) {\r\n\r\n        var firstAnchor = this.firstAnchor;\r\n        var secondAnchor = this.secondAnchor;\r\n\r\n        var dx = firstAnchor.x - secondAnchor.x;\r\n        var dy = firstAnchor.y - secondAnchor.y;\r\n\r\n        var xo = x + dx * 0.5;\r\n        var yo = y + dy * 0.5;\r\n\r\n        firstAnchor.x = xo;\r\n        firstAnchor.y = yo;\r\n\r\n        secondAnchor.x = xo - dx;\r\n        secondAnchor.y = yo - dy;\r\n\r\n        this.position.x = secondAnchor.x + (firstAnchor.x - secondAnchor.x) * 0.5;\r\n        this.position.y = secondAnchor.y + (firstAnchor.y - secondAnchor.y) * 0.5;\r\n\r\n        this.updateStyle();\r\n    };\r\n\r\n    proto.generatePoint3d = function(idTarget) {\r\n\r\n        var firstAnchor = this.editor.positionFromMarkupsToClient(this.firstAnchor.x, this.firstAnchor.y);\r\n        var secondAnchor = this.editor.positionFromMarkupsToClient(this.secondAnchor.x, this.secondAnchor.y);\r\n\r\n        var direction = firstAnchor.clone().sub(secondAnchor).normalize();\r\n\r\n        var point2d = this.checkLineSegment(firstAnchor.x, firstAnchor.y, firstAnchor.x + direction.x * 200, firstAnchor.y + direction.y * 200, idTarget);\r\n        var point3d = point2d && this.viewer.clientToWorld(point2d.x, point2d.y);\r\n\r\n        return point3d && point3d.point;\r\n    };\r\n\r\n    proto.setMetadata = function() {\r\n\r\n        this.text.setAttribute('pointer-events', 'none');\r\n\r\n        var metadata = cloneStyle(this.style);\r\n\r\n        metadata.type = this.type;\r\n        metadata.firstAnchor = [this.firstAnchor.x, this.firstAnchor.y].join(\" \");\r\n        metadata.secondAnchor = [this.secondAnchor.x, this.secondAnchor.y].join(\" \");\r\n        metadata.text = String(this.currentText);\r\n\r\n        return this.addMarkupMetadata(this.shape, metadata);\r\n    };\r\n\r\n\r\n    /**\r\n     * Returns the raw string value\r\n     * @returns {String}\r\n     */\r\n    proto.getText = function() {\r\n\r\n        // if the current text is 'Add Length', you want the textbox will be empty when the user open it.\r\n        return (this.currentText === this.initialText) ? '' : this.currentText;\r\n    };\r\n\r\n    proto.getPath = function() {\r\n\r\n        //   1_                            _4\r\n        //   | |                          | |\r\n        //   | |2                        3| |\r\n        //  0|  --------------------------  |\r\n        //   |  --------------------------  |\r\n        //   | |7                       6 | |\r\n        //   |_|          TEXT            |_|\r\n        //   8                             5\r\n        \r\n        var strokeWidth = this.style['stroke-width'];\r\n        var segmentLength = this.size.x - strokeWidth / 2; // segment length (p2 to p3 length)\r\n        var edgeH = DIMENSION_MARKUP_HEIGHT * strokeWidth / 2; // Edge height (p1 to p8 length)\r\n\r\n        return [\r\n            'M', -segmentLength * 0.5           ,    0              ,   // 0\r\n            'l', 0                              ,    edgeH / 2      ,   // 1\r\n            'l', 0                              ,    -edgeH / 2     ,   // 2\r\n            'l', segmentLength                  ,    0              ,   // 3\r\n            'l', 0                              ,    edgeH / 2      ,   // 4\r\n            'l', 0                              ,    -edgeH         ,   // 5\r\n            'l', 0                              ,    edgeH / 2      ,   // 6\r\n            'l', -segmentLength                 ,    0              ,   // 7\r\n            'l', 0                              ,    -edgeH / 2     ,   // 8\r\n            'z'\r\n        ];\r\n    };\r\n\r\n    proto.cloneShape = function(clone) {\r\n        \r\n        clone.shape = createMarkupPathSvg();\r\n        clone.text = createMarkupTextSvg();\r\n        clone.shape.appendChild(clone.text);\r\n        clone.bindDomEvents();\r\n    };\r\n\r\n    proto.getBoundingRect = function() {\r\n        var pos = this.getClientPosition();\r\n        var size = this.getClientSize();\r\n        return {\r\n            x: pos.x - size.x / 2,\r\n            y: pos.y - size.y / 2,\r\n            width: size.x,\r\n            height: size.y\r\n        }\r\n    };\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\nimport { MarkupDimension } from '../MarkupDimension'\r\nimport { cloneStyle } from '../StyleUtils'\r\n\r\n    /**\r\n     * @constructor\r\n     */\r\n    export function CreateDimension(editor, id, firstAnchor, secondAnchor, text, style) {\r\n\r\n        EditAction.call(this, editor, 'CREATE-DIMENSION', id);\r\n\r\n        this.selectOnExecution = false;\r\n        this.secondAnchor = secondAnchor;\r\n        this.firstAnchor = firstAnchor;\r\n        this.text = text;\r\n        this.style = cloneStyle(style);\r\n    }\r\n\r\n    CreateDimension.prototype = Object.create(EditAction.prototype);\r\n    CreateDimension.prototype.constructor = CreateDimension;\r\n\r\n    var proto = CreateDimension.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        var editor = this.editor;\r\n        var dimension = new MarkupDimension(this.targetId, editor);\r\n\r\n        editor.addMarkup(dimension);\r\n\r\n        // Don't display the dimension markup when there is only one Anchor (First click, before mouse move).\r\n        if (this.secondAnchor) {\r\n            dimension.set(this.firstAnchor.x, this.firstAnchor.y, this.secondAnchor.x, this.secondAnchor.y, this.text);\r\n            dimension.setStyle(this.style);\r\n        }        \r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        var markup = this.editor.getMarkup(this.targetId);\r\n        markup && this.editor.removeMarkup(markup);\r\n    };\r\n\r\n\r\n","\"use strict\";\r\n\r\nimport { EditAction } from './EditAction'\r\nimport { CreateStamp } from './CreateStamp'\r\n\r\n    export var DeleteStamp = function(editor, stamp) {\r\n\r\n        EditAction.call(this, editor, 'DELETE-STAMP', stamp.id);\r\n\r\n        this.createStamp = new CreateStamp(\r\n            editor,\r\n            stamp.id,\r\n            stamp.position,\r\n            stamp.size,\r\n            stamp.rotation,\r\n            stamp.getStyle());\r\n\r\n    };\r\n\r\n    DeleteStamp.prototype = Object.create(EditAction.prototype);\r\n    DeleteStamp.prototype.constructor = DeleteStamp;\r\n\r\n    var proto = DeleteStamp.prototype;\r\n\r\n    proto.redo = function() {\r\n        this.createStamp.undo();\r\n    };\r\n\r\n    proto.undo = function() {\r\n        this.createStamp.redo();\r\n    };\r\n","\"use strict\";\r\n\r\nimport { EditAction } from './EditAction'\r\n\r\n    export function SetStamp(editor, stamp, position, size) {\r\n    \r\n        EditAction.call(this, editor, 'SET-STAMP', stamp.id);\r\n\r\n        this.newPosition = { x: position.x, y: position.y };\r\n        this.newSize = { x: size.x, y: size.y };\r\n        this.oldPosition = { x: stamp.position.x, y: stamp.position.y };\r\n        this.oldSize = { x: stamp.size.x, y: stamp.size.y };\r\n    };\r\n\r\n    SetStamp.prototype = Object.create(EditAction.prototype);\r\n    SetStamp.prototype.constructor = SetStamp;\r\n\r\n    var proto = SetStamp.prototype;\r\n\r\n    proto.redo = function() {\r\n        this.applyState(this.targetId, this.newPosition, this.newSize);\r\n    };\r\n\r\n    proto.undo = function() {\r\n        this.applyState(this.targetId, this.oldPosition, this.oldSize);\r\n    };\r\n\r\n    proto.merge = function(action) {\r\n        if (this.targetId === action.targetId && this.type === action.type) {\r\n        this.newPosition = action.newPosition;\r\n        this.newSize = action.newSize;\r\n        return true;\r\n        }\r\n\r\n        return false;\r\n    };\r\n\r\n    proto.applyState = function(targetId, position, size) {\r\n        const stamp = this.editor.getMarkup(targetId);\r\n        if (!stamp) {\r\n        return;\r\n        }\r\n\r\n        // Different stroke widths make positions differ at sub-pixel level.\r\n        const epsilon = 0.0001;\r\n        if (\r\n        Math.abs(stamp.position.x - position.x) > epsilon ||\r\n        Math.abs(stamp.position.y - position.y) > epsilon ||\r\n        Math.abs(stamp.size.x - size.x) > epsilon ||\r\n        Math.abs(stamp.size.y - size.y) > epsilon)\r\n        {\r\n        stamp.set(position, size);\r\n        }\r\n    };\r\n\r\n    proto.isIdentity = function() {\r\n        return (\r\n        this.newPosition.x === this.oldPosition.x &&\r\n        this.newPosition.y === this.oldPosition.y &&\r\n        this.newSize.x === this.oldSize.x &&\r\n        this.newSize.y === this.newSize.y);\r\n\r\n    };\r\n","\"use strict\";\r\n\r\nimport { EditMode } from './EditMode'\r\nimport { DeleteStamp } from '../edit-actions/DeleteStamp'\r\nimport { CreateStamp } from '../edit-actions/CreateStamp'\r\nimport { SetStamp } from '../edit-actions/SetStamp'\r\nimport * as MarkupTypes from '../MarkupTypes'\r\n\r\n\r\n    export function EditModeStamp(editor, svgData) {\r\n        var styleAttributes = [\r\n        'text-data'];\r\n\r\n        EditMode.call(this, editor, MarkupTypes.MARKUP_TYPE_STAMP, styleAttributes);\r\n        this.svgData = svgData;\r\n    }\r\n\r\n    EditModeStamp.prototype = Object.create(EditMode.prototype);\r\n    EditModeStamp.prototype.constructor = EditModeStamp;\r\n\r\n    var proto = EditModeStamp.prototype;\r\n\r\n    proto.deleteMarkup = function(markup, cantUndo) {\r\n        markup = markup || this.selectedMarkup;\r\n        if (markup && markup.type == this.type) {\r\n        var deleteStamp = new DeleteStamp(this.editor, markup);\r\n        deleteStamp.addToHistory = !cantUndo;\r\n        deleteStamp.execute();\r\n        return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    proto.onMouseMove = function(event) {\r\n        if (!EditMode.prototype.onMouseMove.call(this, event)) {\r\n            return false;\r\n        }\r\n\r\n        const { selectedMarkup, editor } = this;\r\n\r\n        let final = this.getFinalMouseDraggingPosition();\r\n        final = editor.clientToMarkups(final.x, final.y);\r\n        let position = {\r\n        x: (this.firstPosition.x + final.x) / 2,\r\n        y: (this.firstPosition.y + final.y) / 2 };\r\n\r\n        let size = this.size = {\r\n        x: Math.abs(final.x - this.firstPosition.x),\r\n        y: Math.abs(final.y - this.firstPosition.y) };\r\n\r\n\r\n        const action = new SetStamp(editor, selectedMarkup, position, size);\r\n        action.execute();\r\n        return true;\r\n    };\r\n\r\n    proto.onMouseDown = function() {\r\n        EditMode.prototype.onMouseDown.call(this);\r\n\r\n        if (this.selectedMarkup) {\r\n        return;\r\n        }\r\n\r\n        const editor = this.editor;\r\n        let mousePosition = editor.getMousePosition();\r\n\r\n        this.initialX = mousePosition.x;\r\n        this.initialY = mousePosition.y;\r\n        this.firstPosition = editor.clientToMarkups(this.initialX, this.initialY);\r\n        this.size = editor.sizeFromClientToMarkups(1, 1);\r\n\r\n        editor.beginActionGroup();\r\n        const markupId = editor.getId();\r\n        const action = new CreateStamp(editor, markupId, this.firstPosition, this.size, 0, this.style, this.svgData);\r\n        action.execute();\r\n\r\n        // maybe this isn't being called right, that would explain it\r\n        this.selectedMarkup = editor.getMarkup(markupId);\r\n        this.creationBegin();\r\n    };\r\n","\"use strict\";\r\n\r\nimport { Markup } from './Markup'\r\nimport * as MarkupTypes from './MarkupTypes'\r\nimport { composeRGBAString,\r\n    createSvgElement, addMarkupMetadata, stringToSvgNode } from './MarkupsCoreUtils'\r\nimport { cloneStyle, copyStyle, isStyleEqual } from './StyleUtils'\r\nimport { EditModeStamp } from './edit-modes/EditModeStamp'\r\n\r\n  /** \r\n   * @param id \r\n   * @param editor\r\n   * @constructor\r\n   */\r\n    export function MarkupStamp(id, editor, svgData) {\r\n        const styleAttributes = [\r\n        'text-data'];\r\n\r\n        Markup.call(this, id, editor, styleAttributes);\r\n        this.type = MarkupTypes.MARKUP_TYPE_STAMP;\r\n        this.addMarkupMetadata = addMarkupMetadata.bind(this);\r\n\r\n        this.createShapeGroup();\r\n\r\n        this.scriptSvgData = svgData;\r\n        this.loadSvgData();\r\n\r\n        this.bindDomEvents();\r\n    }\r\n\r\n    MarkupStamp.prototype = Object.create(Markup.prototype);\r\n    MarkupStamp.prototype.constructor = MarkupStamp;\r\n\r\n    var proto = MarkupStamp.prototype;\r\n\r\n    proto.createShapeGroup = function () {\r\n        /* \r\n        * shape\r\n        *    group\r\n        *      customSvg\r\n        *    hitarea (aka markup)\r\n        */\r\n        this.shape = createSvgElement('g');\r\n        this.shape.group = createSvgElement('g');\r\n        this.shape.appendChild(this.shape.group);\r\n\r\n        let hitarea = createSvgElement('path');\r\n        hitarea.setAttribute('id', \"hitarea\");\r\n        hitarea.setAttribute('fill', \"none\");\r\n        this.shape.appendChild(hitarea);\r\n\r\n        this.shape.hitarea = hitarea;\r\n        this.shape.markup = hitarea;\r\n    };\r\n\r\n    proto.loadSvgData = function () {\r\n        let svgString = this.scriptSvgData || this.style['text-data'];\r\n        let svgNode = stringToSvgNode(svgString);\r\n\r\n        // null if parsing fails, so exit\r\n        if (svgNode === null) {\r\n        console.warn(\"SVG data \" + svgString + \" is invalid, skipping shape update\");\r\n        return;\r\n        }\r\n\r\n        let [width, height] = this.getDimensions(svgNode);\r\n\r\n        // update the bounding box when the SVG is changed\r\n        let path = \"M 0 0 l \".concat(width, \" 0 l 0 \").concat(height, \" l \").concat(-width, \" 0 z\");\r\n        this.shape.hitarea.setAttribute('d', path);\r\n\r\n        this.shape.group.innerHTML = svgNode.innerHTML;\r\n\r\n        // This is to standardize things:\r\n        // width and height are 1 unit\r\n        // position is in the centre\r\n        // have to flip things because of y axis going upwards\r\n        this.shape.group.setAttribute('transform', \"translate( -0.5 , 0.5 ) scale( \".concat(1 / width, \" , \").concat(-1 / height, \" )\"));\r\n        // then copy to the hitarea because it's outside the SVG\r\n        this.shape.hitarea.setAttribute('transform', this.shape.group.getAttribute('transform'));\r\n    };\r\n\r\n    proto.getEditMode = function () {\r\n        return new EditModeStamp(this.editor);\r\n    };\r\n\r\n    proto.set = function (position, size) {\r\n        this.setSize(position, size.x, size.y);\r\n        this.updateStyle();\r\n    };\r\n\r\n    proto.updateStyle = function (styleChanged) {\r\n        const strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(this.style['stroke-color'], this.style['stroke-opacity']);\r\n        this.shape.hitarea.setAttribute('stroke', strokeColor);\r\n\r\n        // This only provides translation and rotation, not scale\r\n        const transform = this.getTransform() + \" scale( \".concat(this.size.x, \" , \").concat(this.size.y, \" )\");\r\n        this.shape.setAttribute('transform', transform);\r\n\r\n        if (styleChanged) {\r\n        this.loadSvgData();\r\n        }\r\n    };\r\n\r\n    proto.getDimensions = function (customSvg) {\r\n        let vb = customSvg.getAttribute('viewBox');\r\n        if (!vb) {\r\n        // if no viewbox is specified, check for width and height\r\n        let width = customSvg.getAttribute('width') || 100;\r\n        let height = customSvg.getAttribute('height') || 100;\r\n        return [width, height];\r\n        }\r\n        let strings = vb.split(' ');\r\n        let width = parseInt(strings[2]);\r\n        let height = parseInt(strings[3]);\r\n\r\n        return [width, height];\r\n    };\r\n\r\n    proto.setMetadata = function () {\r\n\r\n        var metadata = cloneStyle(this.style);\r\n\r\n        metadata.type = this.type;\r\n        metadata.position = [this.position.x, this.position.y].join(\" \");\r\n        metadata.size = [this.size.x, this.size.y].join(\" \");\r\n        metadata.rotation = String(this.rotation);\r\n\r\n        return this.addMarkupMetadata(this.shape, metadata);\r\n    };\r\n\r\n    proto.setStyle = function (style) {\r\n        let stylesEqual = isStyleEqual(style, this.style);\r\n        if (!stylesEqual) {\r\n            copyStyle(style, this.style);\r\n        }\r\n\r\n        this.updateStyle(!stylesEqual);\r\n    };","\"use strict\";\r\n\r\nimport { EditAction } from './EditAction'\r\nimport { MarkupStamp } from '../MarkupStamp'\r\nimport { cloneStyle } from '../StyleUtils'\r\n\r\n    /**\r\n     * @constructor\r\n     * \r\n     * @param editor \r\n     * @param id \r\n     * @param position \r\n     * @param size \r\n     * @param style \r\n     * @param {string} svg\r\n     */\r\n    export function CreateStamp(editor, id, position, size, rotation, style, svgData) {\r\n\r\n        EditAction.call(this, editor, 'CREATE-STAMP', id);\r\n\r\n        this.selectOnExecution = false;\r\n        this.position = { x: position.x, y: position.y };\r\n        this.size = { x: size.x, y: size.y };\r\n        this.rotation = rotation;\r\n        this.style = cloneStyle(style);\r\n        this.svgData = svgData;\r\n    }\r\n\r\n    CreateStamp.prototype = Object.create(EditAction.prototype);\r\n    CreateStamp.prototype.constructor = CreateStamp;\r\n\r\n    var proto = CreateStamp.prototype;    \r\n\r\n    proto.redo = function() {\r\n        const stamp = new MarkupStamp(this.targetId, this.editor, this.svgData);\r\n\r\n        this.editor.addMarkup(stamp);\r\n\r\n        stamp.setSize(this.position, this.size.x, this.size.y);\r\n        stamp.setRotation(this.rotation);\r\n        stamp.setStyle(this.style);\r\n    };\r\n\r\n    proto.undo = function() {\r\n        const markup = this.editor.getMarkup(this.targetId);\r\n        this.editor.removeMarkup(markup);\r\n    };\r\n","const canvg = require('../../thirdparty/canvg/canvg.js'); // Required for Markup Thumbnails\r\nimport * as MarkupType from '../core/MarkupTypes'\r\nimport { CreateArrow } from './edit-actions/CreateArrow'\r\nimport { CreateRectangle } from './edit-actions/CreateRectangle'\r\nimport { CreateText } from './edit-actions/CreateText'\r\nimport { CreateCallout } from './edit-actions/CreateCallout'\r\nimport { CreateCircle } from './edit-actions/CreateCircle'\r\nimport { CreateCloud } from './edit-actions/CreateCloud'\r\nimport { CreateFreehand } from './edit-actions/CreateFreehand'\r\nimport { CreatePolyline } from './edit-actions/CreatePolyline'\r\nimport { CreatePolycloud } from './edit-actions/CreatePolycloud'\r\nimport { CreateHighlight } from './edit-actions/CreateHighlight'\r\nimport { CreateDimension } from './edit-actions/CreateDimension'\r\nimport { DomElementStyle } from './DomElementStyle'\r\nimport { CreateStamp } from './edit-actions/CreateStamp'\r\n\r\n\r\n    var av = Autodesk.Viewing;\r\n    var avp = Autodesk.Viewing.Private;\r\n\r\n    const _gWindow = av.getGlobal();\r\n    const _gDocument = _gWindow.document;\r\n\r\n    // Change these constants to alter the default sizes in pixels of strokes and fonts.\r\n    export var MARKUP_DEFAULT_STROKE_WIDTH_IN_PIXELS = 1;\r\n    export var MARKUP_DEFAULT_FONT_WIDTH_IN_PIXELS = 10;\r\n    export var MARKUP_DEFAULT_HITAREAS_MARGIN_IN_PIXELS = 15;\r\n    export var EDIT_FRAME_DEFAULT_MARGIN = 7;\r\n\r\n    /**\r\n     * // isTouchDevice is an LMV function. Hammer is included by LMV as well\r\n     * @returns {boolean}\r\n     */\r\n    export var isTouchDevice = function() {\r\n        // isTouchDevice() is an LMV function.\r\n        // Hammer (a touch detection lib) is packaged with LMV as well\r\n        if (av.isTouchDevice && typeof Hammer === \"function\") {\r\n            return av.isTouchDevice();\r\n        }\r\n        return false;\r\n    };\r\n\r\n    //// SVG  //////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n    /**\r\n     *\r\n     * @param type\r\n     * @returns {Element}\r\n     */\r\n    export var createSvgElement = function(type) {\r\n\r\n        const _document = (this && this.getDocument && this.getDocument()) || _gDocument;\r\n        // See https://developer.mozilla.org/en-US/docs/Web/API/Document/createElementNS\r\n        var namespace = 'http://www.w3.org/2000/svg';\r\n        return  _document.createElementNS(namespace, type);\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param {Element} svg - an SVGElement\r\n     * @returns {Element} svg param is returned back\r\n     */\r\n    export var setSvgParentAttributes = function(svg) {\r\n\r\n        // See: https://developer.mozilla.org/en-US/docs/Web/SVG/Namespaces_Crash_Course\r\n        svg.setAttribute('version', '1.1'); // Notice that this is the SVG version, not the \"MARKUP DATA VERSION\"!\r\n        svg.setAttribute('baseProfile', 'full');\r\n        svg.setAttribute('layer-order-id', 'markups-svg');\r\n        return svg;\r\n    };\r\n\r\n    export var createMarkupGroupSvg = function(children) {\r\n        children = children || [];\r\n        var svg = createSvgElement('g');\r\n        svg.setAttribute('cursor', 'default');\r\n        svg.setAttribute('pointer-events', 'none');\r\n\r\n        for (var i = 0; i < children.length; i++) {\r\n            svg.appendChild(children[i]);\r\n        }\r\n\r\n        return svg;\r\n    };\r\n\r\n    export var createMarkupPathSvg = function() {\r\n\r\n        var svg = createSvgElement('g');\r\n        svg.setAttribute('cursor', 'inherit');\r\n        svg.setAttribute('pointer-events', 'none');\r\n\r\n        var markup = createSvgElement('path');\r\n        markup.setAttribute('id', 'markup');\r\n\r\n        var hitarea = createSvgElement('path');\r\n        hitarea.setAttribute('id', 'hitarea');\r\n        hitarea.setAttribute('fill', 'transparent');\r\n        hitarea.setAttribute('stroke', 'transparent');\r\n\r\n        svg.markup = markup;\r\n        svg.hitarea = hitarea;\r\n\r\n        svg.appendChild(markup);\r\n        svg.appendChild(hitarea);\r\n\r\n        return svg;\r\n    };\r\n\r\n    export var setAttributeToMarkupSvg = function(svg, attribute, value) {\r\n\r\n        svg.markup.setAttribute(attribute, value);\r\n    };\r\n\r\n    export var updateMarkupPathSvgHitarea = function(svg, editor) {\r\n\r\n        var markup = svg.markup;\r\n        var hitarea = svg.hitarea;\r\n\r\n        var hitareaMargin = editor.sizeFromClientToMarkups(0, MARKUP_DEFAULT_HITAREAS_MARGIN_IN_PIXELS).y;\r\n        hitareaMargin += parseFloat(markup.getAttribute('stroke-width')) + hitareaMargin;\r\n\r\n        var markupFill = markup.getAttribute('fill');\r\n        var markupStroke = markup.getAttribute('stroke');\r\n        var strokeEnabled = markupStroke !== '' && markupStroke !== 'none';\r\n        var fillEnabled = markupFill !== '' && markupFill !== 'none';\r\n\r\n        hitarea.setAttribute('d', markup.getAttribute('d'));\r\n        hitarea.setAttribute('stroke-width', hitareaMargin);\r\n        hitarea.setAttribute('transform', markup.getAttribute('transform'));\r\n\r\n        if (editor.duringEditMode && !editor.navigating) {\r\n            if (strokeEnabled && fillEnabled) {\r\n                svg.setAttribute('pointer-events', 'painted');\r\n                return;\r\n            }\r\n\r\n            if (strokeEnabled) {\r\n                svg.setAttribute('pointer-events', 'stroke');\r\n                return;\r\n            }\r\n\r\n            if (fillEnabled) {\r\n                svg.setAttribute('pointer-events', 'fill');\r\n                return;\r\n            }\r\n        }\r\n\r\n        svg.setAttribute('pointer-events', 'none');\r\n    };\r\n    \r\n    export var createMarkupTextSvg = function() {\r\n\r\n        var svg = createSvgElement('g');\r\n        svg.setAttribute('cursor', 'default');\r\n\r\n        var clipperId = 'markup-clipper-' + getUniqueID();\r\n        var clipperUrl = 'url(#' + clipperId + ')';\r\n\r\n        var clipper = createSvgElement('clipPath');\r\n        clipper.setAttribute('id', clipperId);\r\n        clipper.removeAttribute('pointer-events');\r\n        clipper.rect = createSvgElement('rect');\r\n        clipper.appendChild(clipper.rect);\r\n\r\n        var background = createSvgElement('rect');\r\n        background.setAttribute('id', 'markup-background');\r\n        background.removeAttribute('pointer-events');\r\n\r\n        var markup = createSvgElement('text');\r\n        markup.setAttribute('id', 'markup');\r\n\r\n        var hitarea = createSvgElement('rect');\r\n        hitarea.setAttribute('id', 'hitarea');\r\n        hitarea.setAttribute('fill', 'transparent');\r\n        hitarea.setAttribute('stroke', 'none');\r\n        hitarea.setAttribute('stroke-width', '0');\r\n\r\n        var clippedArea = createSvgElement('g');\r\n        clippedArea.setAttribute('clip-path', clipperUrl);\r\n        clippedArea.appendChild(clipper);\r\n        clippedArea.appendChild(background);\r\n        clippedArea.appendChild(markup);\r\n\r\n        svg.appendChild(clippedArea);\r\n        svg.appendChild(hitarea);\r\n\r\n        svg.clipper = clipper;\r\n        svg.background = background;\r\n        svg.markup = markup;\r\n        svg.hitarea = hitarea;\r\n\r\n        return svg;\r\n    };\r\n\r\n    export var setMarkupTextSvgTransform = function(svg, transform, textTransform) {\r\n\r\n        svg.clipper.rect.setAttribute('transform', transform);\r\n        svg.background.setAttribute('transform', transform);\r\n        svg.markup.setAttribute('transform', textTransform);\r\n        svg.hitarea.setAttribute('transform', transform);\r\n    };\r\n\r\n    export var updateMarkupTextSvgHitarea = function(svg, w, h, editor) {\r\n\r\n        var hitarea = svg.hitarea;\r\n        var hitareaMargin = editor.sizeFromClientToMarkups(0, MARKUP_DEFAULT_HITAREAS_MARGIN_IN_PIXELS).y;\r\n\r\n        hitarea.setAttribute('x', -hitareaMargin);\r\n        hitarea.setAttribute('y', -hitareaMargin);\r\n        hitarea.setAttribute('width', w + hitareaMargin * 2);\r\n        hitarea.setAttribute('height', h + hitareaMargin * 2);\r\n        svg.setAttribute(\"pointer-events\", editor.navigating ? \"none\" : \"painted\");\r\n    };\r\n\r\n    export var updateMarkupTextSvgBackground = function(svg, w, h, color) {\r\n\r\n        var background = svg.background;\r\n\r\n        background.setAttribute('x', 0);\r\n        background.setAttribute('y', 0);\r\n        background.setAttribute('width', w);\r\n        background.setAttribute('height', h);\r\n        background.setAttribute('fill', color);\r\n    };\r\n\r\n    export var updateMarkupTextSvgClipper = function(svg, w, h) {\r\n\r\n        var clipper = svg.clipper;\r\n\r\n        clipper.rect.setAttribute('x', 0);\r\n        clipper.rect.setAttribute('y', 0);\r\n        clipper.rect.setAttribute('width', w);\r\n        clipper.rect.setAttribute('height', h);\r\n    };\r\n\r\n    /**\r\n     * Helper function that injects metadata for the whole Markup document.\r\n     * Metadata includes: version.\r\n     * @param {Element} svg - an SVGElement\r\n     * @param {Object} metadata - Dictionary with attributes\r\n     */\r\n    export var addSvgMetadata = function(svg ,metadata) {\r\n\r\n        const _document = (this && this.getDocument && this.getDocument()) || _gDocument;\r\n\r\n        var metadataNode = _document.createElementNS('http://www.w3.org/2000/svg', 'metadata');\r\n        var dataVersionNode = _document.createElement('markup_document');\r\n\r\n        metadataNode.appendChild(dataVersionNode);\r\n\r\n        // NOTE: We could iterate over the properties, but we don't because these are the only ones supported\r\n        dataVersionNode.setAttribute(\"data-model-version\", metadata[\"data-model-version\"]); // Version. For example: \"1\"\r\n\r\n        svg.insertBefore(metadataNode, svg.firstChild);\r\n        return metadataNode;\r\n    };\r\n\r\n    /**\r\n     * Helper function that injects metadata for specific markup svg nodes.\r\n     * @param {Element} markupNode - an SVGElement for the markup\r\n     * @param {Object} metadata - Dictionary where all key/value pairs are added as metadata entries.\r\n     * @returns {Element}\r\n     */\r\n    export var addMarkupMetadata = function(markupNode, metadata) {\r\n\r\n        const _document = (this && this.getDocument && this.getDocument()) || _gDocument;\r\n\r\n        var metadataNode = _document.createElementNS('http://www.w3.org/2000/svg', 'metadata');\r\n        var dataVersionNode = _document.createElement('markup_element');\r\n\r\n        metadataNode.appendChild(dataVersionNode);\r\n        for (var key in metadata) {\r\n            if (metadata.hasOwnProperty(key)) {\r\n                dataVersionNode.setAttribute(key, metadata[key]);\r\n            }\r\n        }\r\n\r\n        markupNode.insertBefore(metadataNode, markupNode.firstChild);\r\n        return metadataNode;\r\n    };\r\n\r\n    /**\r\n     * Removes al metadata nodes from an Svg node structure.\r\n     * Method will remove all metadata nodes from children nodes as well.\r\n     * @param svgNode\r\n     */\r\n    export var removeAllMetadata = function(svgNode) {\r\n\r\n        if (svgNode.getElementsByTagName) {\r\n            var nodes = svgNode.getElementsByTagName(\"metadata\");\r\n            for (var i=0; i<nodes.length; ++i) {\r\n                var metadataNode = nodes[i];\r\n                metadataNode.parentNode && metadataNode.parentNode.removeChild(metadataNode);\r\n            }\r\n        }\r\n\r\n        // Transverse children nodes\r\n        var svgChildren = svgNode.children || svgNode.childNodes;\r\n        if (svgChildren) {\r\n            for (i=0; i<svgChildren.length; ++i) {\r\n                removeAllMetadata(svgChildren[i]);\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Utility function that transfers children from an Html/Svg node into another one.\r\n     * @param nodeFrom - The node instance from where children will be taken.\r\n     * @param nodeInto - The node that's going to parent the transferred children.\r\n     */\r\n    export var transferChildNodes = function(nodeFrom, nodeInto) {\r\n\r\n        var svgChildren = nodeFrom.children || nodeFrom.childNodes;\r\n        var tmpArray = [];\r\n        for (var i=0; i<svgChildren.length; ++i){\r\n            tmpArray.push(svgChildren[i]); // Avoid appendChild\r\n        }\r\n        tmpArray.forEach(function(node){\r\n            nodeInto.appendChild(node);\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Generate a unique id.\r\n     * @returns {string}\r\n     */\r\n    export var getUniqueID = function() {\r\n        return THREE.Math.generateUUID();\r\n    };\r\n\r\n\r\n    /**\r\n     * Serializes an SVG node into a String.\r\n     * @param domNode\r\n     * @returns {string}\r\n     */\r\n    export var svgNodeToString = function(domNode){\r\n\r\n        function removeHitareas(svg, hitareas) {\r\n\r\n            var hitarea = svg.hitarea;\r\n            var hitareaParent = hitarea && hitarea.parentNode;\r\n\r\n            if (hitareaParent) {\r\n\r\n                hitareas.push({hitarea: hitarea, parent: hitareaParent});\r\n                hitareaParent.removeChild(hitarea);\r\n            }\r\n\r\n            var children = svg.childNodes;\r\n            var childrenCount = children.length;\r\n\r\n            for(var i = 0; i < childrenCount; ++i) {\r\n                removeHitareas(children.item(i), hitareas);\r\n            }\r\n        }\r\n\r\n        function addHitareas(hitareas) {\r\n\r\n            var hitareasCount = hitareas.length;\r\n            for(var i = 0; i < hitareasCount; ++i) {\r\n\r\n                var hitarea = hitareas[i];\r\n                hitarea.parent.appendChild(hitarea.hitarea);\r\n            }\r\n        }\r\n\r\n        var result;\r\n        try {\r\n            var hitareas = [];\r\n            removeHitareas(domNode, hitareas);\r\n\r\n            var xmlSerializer = new XMLSerializer();\r\n            result = xmlSerializer.serializeToString(domNode);\r\n\r\n            addHitareas(hitareas);\r\n\r\n        } catch (err) {\r\n            result = '';\r\n            console.warn('svgNodeToString failed to generate string representation of domNode.');\r\n        }\r\n        return result;\r\n    };\r\n\r\n    export var stringToSvgNode = function(stringNode){\r\n\r\n        var node = null;\r\n        try {\r\n            var domParser = new DOMParser();\r\n            var doc = domParser.parseFromString(stringNode, \"text/xml\");\r\n            node = doc.firstChild; // We should only be getting 1 child anyway.\r\n        } catch (err) {\r\n            node = null;\r\n            console.warn('stringToSvgNode failed to generate an HTMLElement from its string representation.');\r\n        }\r\n        return node;\r\n    };\r\n\r\n    /**\r\n     * Injects functions and members to a client object which will\r\n     * receive the ability to dispatch events.\r\n     * Mechanism is the same as in Autodesk.Viewing.Viewer.\r\n     *\r\n     * Note: All of the code here comes from Autodesk.Viewing.Viewer\r\n     *\r\n     * @param {Object} client - Object that will become an event dispatcher.\r\n     */\r\n    export var addTraitEventDispatcher = function(client) {\r\n\r\n        // Inject member variable\r\n        client.listeners = {};\r\n\r\n        // Inject functions\r\n        client.addEventListener = function(type, listener) {\r\n            if (typeof this.listeners[type] == \"undefined\"){\r\n                this.listeners[type] = [];\r\n            }\r\n            this.listeners[type].push(listener);\r\n        };\r\n        client.hasEventListener = function (type, listener) {\r\n            if (this.listeners === undefined) return false;\r\n            var listeners = this.listeners;\r\n            if (listeners[ type ] !== undefined && listeners[ type ].indexOf(listener) !== -1) {\r\n                return true;\r\n            }\r\n            return false;\r\n        };\r\n        client.removeEventListener = function(type, listener) {\r\n            if (this.listeners[type] instanceof Array){\r\n                var li = this.listeners[type];\r\n                for (var i=0, len=li.length; i < len; i++){\r\n                    if (li[i] === listener){\r\n                        li.splice(i, 1);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        };\r\n        client.dispatchEvent = function(event) {\r\n            if (typeof event == \"string\"){\r\n                event = { type: event };\r\n            }\r\n            if (!event.target){\r\n                event.target = this;\r\n            }\r\n\r\n            if (!event.type){\r\n                throw new Error(\"event type unknown.\");\r\n            }\r\n\r\n            if (this.listeners[event.type] instanceof Array) {\r\n                var typeListeners = this.listeners[event.type].slice();\r\n                for (var i=0; i < typeListeners.length; i++) {\r\n                    typeListeners[i].call(this, event);\r\n                }\r\n            }\r\n        };\r\n    };\r\n\r\n    /**\r\n     * Removes the EventDispatcher trait\r\n     *\r\n     * @param {Object} client\r\n     */\r\n    export var removeTraitEventDispatcher = function(client) {\r\n\r\n        try {\r\n            delete client.listeners;\r\n            delete client.addEventListener;\r\n            delete client.hasEventListener;\r\n            delete client.removeEventListener;\r\n            delete client.dispatchEvent;\r\n        } catch (e) {\r\n            // nothing\r\n        }\r\n    };\r\n\r\n    //// Math  /////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n    /**\r\n     * Calculates the pixel position in client space coordinates of a point in world space.\r\n     * @param {THREE.Vector3} point Point in world space coordinates.\r\n     * @param viewer\r\n     * @param snap Round values to closest pixel center.\r\n     * @returns {THREE.Vector3} Point transformed and projected into client space coordinates.\r\n     */\r\n    export var worldToClient = function(point, viewer, snap) {\r\n\r\n        var p = worldToViewport(point, viewer);\r\n        var result = viewportToClient(p.x, p.y, viewer);\r\n        result.z = 0;\r\n\r\n        // snap to the center of the\r\n        if (snap) {\r\n            result.x = Math.floor(result.x) + 0.5;\r\n            result.y = Math.floor(result.y) + 0.5;\r\n        }\r\n\r\n        return result;\r\n    };\r\n\r\n    export var clientToWorld = function(clientX, clientY, depth, viewer) {\r\n\r\n        var point = clientToViewport(clientX, clientY, viewer);\r\n        point.z = depth;\r\n\r\n        point.unproject(viewer.impl.camera);\r\n        return point;\r\n    };\r\n\r\n    export var clientToViewport = function(clientX, clientY, viewer) {\r\n\r\n        return viewer.impl.clientToViewport(clientX, clientY);\r\n    };\r\n\r\n    export var viewportToClient = function(viewportX, viewportY, viewer) {\r\n\r\n        return viewer.impl.viewportToClient(viewportX, viewportY);\r\n    };\r\n\r\n    /**\r\n     * Calculates the world position of a point in client space coordinates.\r\n     * @param {Object} point - { x:Number, y:Number, z:Number }\r\n     * @param {Object} viewer - LMV instance\r\n     * @returns {THREE.Vector3}\r\n     */\r\n    export var worldToViewport = function(point, viewer) {\r\n\r\n        var p = new THREE.Vector3();\r\n\r\n        p.x = point.x;\r\n        p.y = point.y;\r\n        p.z = point.z;\r\n\r\n        p.project(viewer.impl.camera);\r\n        return p;\r\n    };\r\n\r\n    export var metersToModel = function(meters, viewer) {\r\n\r\n        var modelToMeter = viewer.model.getUnitScale();\r\n        var meterToModel = 1 / modelToMeter;\r\n\r\n        return meterToModel * meters;\r\n    };\r\n\r\n    export var radiansToDegrees = function (radians) {\r\n\r\n        return radians * (180 / Math.PI);\r\n    };\r\n\r\n    export var degreesToRadians = function(degrees) {\r\n\r\n        return degrees * (Math.PI / 180);\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param value\r\n     * @returns {number}\r\n     */\r\n    export var sign = function (value) {\r\n\r\n        return (value >= 0) ? 1 : -1;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param pointA\r\n     * @param pointB\r\n     * @param range\r\n     * @param editor\r\n     * @returns {boolean}\r\n     */\r\n    export var areMarkupsPointsInClientRange = function(pointA, pointB, range, editor){\r\n\r\n        range = editor.sizeFromClientToMarkups(0, range).y;\r\n\r\n        var dx = pointA.x - pointB.x;\r\n        var dy = pointA.y - pointB.y;\r\n\r\n        return range * range >= dx * dx + dy * dy;\r\n    };\r\n\r\n    //// LMV ui ////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n    export var hideLmvUi = function(viewer) {\r\n\r\n        // If the viewer is no gui, then there is nothing to hide\r\n        if(!viewer.toolbar) {\r\n            return;\r\n        }\r\n\r\n        // Exit other tools and hide HudMessages.\r\n        viewer.setActiveNavigationTool();\r\n\r\n        dismissLmvHudMessage();\r\n        hideLmvPanels(true, viewer);\r\n        hideLmvToolsAndPanels(viewer);\r\n    };\r\n\r\n    export var restoreLmvUi = function(viewer) {\r\n\r\n        // If the viewer is no gui, then there is nothing to hide\r\n        if(!viewer.toolbar) {\r\n            return;\r\n        }\r\n\r\n        dismissLmvHudMessage();\r\n        hideLmvPanels(false, viewer);\r\n        showLmvToolsAndPanels(viewer);\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param hide\r\n     * @param viewer\r\n     */\r\n    export var hideLmvPanels = function(hide, viewer) {\r\n\r\n        var dockingPanels = viewer.dockingPanels;\r\n\r\n        // Panels may not be present when dealing with an instance of Viewer3D.js\r\n        // (as opposed to an instance of GuiViewer3D.js)\r\n        if (!dockingPanels) return;\r\n\r\n        for (var i = 0; i < dockingPanels.length; ++i) {\r\n\r\n            var panel = dockingPanels[i];\r\n            var panelContainer = panel.container;\r\n\r\n            if (panelContainer.classList.contains(\"dockingPanelVisible\")) {\r\n                panelContainer.style.display = hide ? \"none\" : \"block\";\r\n\r\n                // Call the visibility changed notification if any additional\r\n                // stuff needs to be done (update the date i.e. PropertyPanel, etc).\r\n                panel.visibilityChanged();\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Shows panels and tools in the viewer.\r\n     * @param viewer\r\n     */\r\n    export var showLmvToolsAndPanels = function(viewer) {\r\n\r\n        // Restore view cube.\r\n        if(viewer && viewer.model && !viewer.model.is2d()) {\r\n            viewer.getExtension(\"Autodesk.ViewCubeUi\", function(ext) {\r\n                ext.displayViewCube(true, false);\r\n                ext.displayHomeButton(true);\r\n            }); \r\n        }\r\n\r\n        // TODO: Find or ask for a better way to restore this buttons.\r\n        const _document = viewer.getDocument();\r\n        var anim = _document.getElementsByClassName('toolbar-animation-subtoolbar');\r\n\r\n        if (anim.length > 0) {\r\n            anim[0].style.display = '';\r\n        }\r\n\r\n        // toolbar is absent when dealing with an instance of Viewer3D (instead of GuiViewer3D)\r\n        if (viewer.toolbar) {\r\n            var viewerContainer = viewer.toolbar.container;\r\n            var viewerContainerChildrenCount = viewerContainer.children.length;\r\n            for(var i = 0; i < viewerContainerChildrenCount; ++i) {\r\n                viewerContainer.children[i].style.display = \"\";\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Hides panels and tools in the viewer.\r\n     * @param viewer\r\n     */\r\n    export var hideLmvToolsAndPanels = function(viewer) {\r\n\r\n        // Hide Panels and tools.\r\n        if (viewer && viewer.model && !viewer.model.is2d()) {\r\n            viewer.getExtension(\"Autodesk.ViewCubeUi\", function(ext) {\r\n                ext.displayViewCube(false, false);\r\n                ext.displayHomeButton(false);\r\n            });\r\n            \r\n        }\r\n\r\n        const _document = viewer.getDocument();\r\n        // TODO: Find or ask for a better way to hide this buttons.\r\n        var anim = _document.getElementsByClassName('toolbar-animation-subtoolbar');\r\n\r\n        if (anim.length > 0) {\r\n            anim[0].style.display = 'none';\r\n\r\n            var animator = viewer.impl.keyFrameAnimator;\r\n            if (animator && !animator.isPaused) {\r\n                animator.pauseCameraAnimations();\r\n                animator.pause();\r\n\r\n                var playButton = viewer.modelTools.getControl('toolbar-animationPlay');\r\n                if (playButton) {\r\n                    playButton.setIcon('toolbar-animation-pause-icon');\r\n                    playButton.setToolTip('Pause');\r\n                }\r\n            }\r\n        }\r\n\r\n        // toolbar is absent when dealing with an instance of Viewer3D (instead of GuiViewer3D)\r\n        if (viewer.toolbar) {\r\n            var viewerContainer = viewer.toolbar.container;\r\n            var viewerContainerChildrenCount = viewerContainer.children.length;\r\n            for(var i = 0; i < viewerContainerChildrenCount; ++i) {\r\n                viewerContainer.children[i].style.display = \"none\";\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Dismisses all LMV HudMessages\r\n     */\r\n    export var dismissLmvHudMessage = function() {\r\n\r\n        // Using try/catch block since we are accessing the Private namespace of LMV.\r\n        try {\r\n            var keepDismissing = true;\r\n            while (keepDismissing) {\r\n                keepDismissing = Autodesk.Viewing.Private.HudMessage.dismiss();\r\n            }\r\n        } catch (ignore) {\r\n            // Failing to show the message is an okay fallback scenario\r\n            console.warn(\"[CO2]Failed to dismiss LMV HudMessage\");\r\n        }\r\n    };\r\n\r\n    //// Styles ////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n    export var getStrokeWidth = function(widthInPixels, editor) {\r\n\r\n        var size = editor.sizeFromClientToMarkups(0, widthInPixels);\r\n        return size.y;\r\n    };\r\n\r\n    /**\r\n     * Creates markups from a parsed svg string child\r\n     * @param child - child of a parsed SVG string\r\n     * @param editor - MarkupsCore\r\n     * @returns {*} Markup Object\r\n     */\r\n    export var createMarkupFromSVG = function(child, editor) {\r\n        // var self = this;\r\n        if (!child.childNodes[0]) {\r\n            return null;\r\n        }\r\n\r\n        var meta = child.childNodes[0].childNodes[0] || '';\r\n\r\n        var getCurrentStyle = function(editor, metadata) {\r\n\r\n            var source = ['stroke-width', 'stroke-color', 'stroke-opacity', 'fill-color', 'fill-opacity',\r\n                'font-family', 'font-size','font-style','font-weight','stroke-linejoin'];\r\n            var style = {};\r\n            for (var i=0; i < source.length; i++) {\r\n                var value = metadata.getAttribute(source[i]);\r\n                if(value == null) {\r\n                    continue;\r\n                }\r\n                switch (source[i]) {\r\n                    case 'font-size':\r\n                    case 'stroke-width':\r\n                    case 'stroke-opacity':\r\n                    case 'fill-opacity':\r\n                        style[source[i]] = parseFloat(value);\r\n                        break;\r\n                    case 'stroke-linejoin':\r\n                        break;\r\n                    case 'font-family':\r\n                    case 'font-style':\r\n                    case 'font-weight':\r\n                    case 'stroke-color':\r\n                    case 'text-data':\r\n                    case 'fill-color':\r\n                        style[source[i]] = value;\r\n                        break;\r\n                    default:\r\n                        avp.logger.warn('Style not recognized.');\r\n                        break;\r\n                }\r\n            }\r\n            return style;\r\n        };\r\n\r\n        var isClosed = function() {\r\n            var path = child.childNodes[1] || '';\r\n            var closed = false;\r\n            if (typeof path !== 'string'){\r\n                var d = path.getAttribute('d').split(' ');\r\n                if (d[d.length-1].toLowerCase() === 'z'){\r\n                    closed = true;\r\n                }\r\n            }\r\n            return closed;\r\n        };\r\n\r\n        var getLocations = function() {\r\n            var locations = [];\r\n            var locStr = meta.getAttribute('locations').split(\" \") || '';\r\n\r\n            for(var i=0; i< locStr.length; i+=2) {\r\n                var pointPair = {x:parseFloat(locStr[i]), y:parseFloat(locStr[i+1])};\r\n                locations.push( pointPair )\r\n            }\r\n            return locations;\r\n        };\r\n\r\n        var getAttributeVector = function(attribute) {\r\n            var posVec = new THREE.Vector3();\r\n            var value = meta.getAttribute(attribute) || meta.getAttribute(attribute.toLowerCase());\r\n            var strPos = value.split(\" \");\r\n            posVec.x = parseFloat(strPos[0]);\r\n            posVec.y = parseFloat(strPos[1]);\r\n            return posVec;\r\n        };\r\n\r\n        var getPosition = function() {\r\n            return getAttributeVector('position');\r\n        };\r\n\r\n        var getSize = function() {\r\n            return getAttributeVector('size');\r\n        };\r\n\r\n        var getRotation = function() {\r\n            var strRot = meta.getAttribute('rotation') || '';\r\n            return parseFloat(strRot);\r\n        };\r\n\r\n        var getText = function() {\r\n            return meta.getAttribute('text') || '';\r\n        };\r\n\r\n        var getIsFrameUsed = function() {\r\n            return !!parseInt(meta.getAttribute('isframeused'));\r\n        };\r\n\r\n        if (typeof meta !== 'string') {\r\n            // get the type of the child\r\n            var position, size, rotation, locations, tail, head, closed, text, firstAnchor, secondAnchor;\r\n            var id = editor.getId();\r\n            var style = getCurrentStyle(editor, meta);\r\n            var type = meta.getAttribute('type') || '';\r\n            var createMarkup;\r\n            switch(type) {\r\n                case MarkupType.MARKUP_TYPE_ARROW:\r\n                    tail = getAttributeVector('tail');\r\n                    head = getAttributeVector('head');\r\n                    createMarkup = new CreateArrow(editor, id, tail, head, style);\r\n                    break;\r\n\r\n                case MarkupType.MARKUP_TYPE_RECTANGLE:\r\n                    position = getPosition();\r\n                    size = getSize();\r\n                    rotation = getRotation();\r\n                    createMarkup = new CreateRectangle(editor, id, position, size, rotation, style);\r\n                    break;\r\n\r\n                case MarkupType.MARKUP_TYPE_TEXT:\r\n                    position = getPosition();\r\n                    size = getSize();\r\n                    text = getText();\r\n                    createMarkup = new CreateText(editor, id, position, size, text, style );\r\n                    break;\r\n\r\n                case MarkupType.MARKUP_TYPE_CALLOUT:\r\n                    position = getPosition();\r\n                    size = getSize();\r\n                    text = getText();\r\n                    var isFrameUsed = getIsFrameUsed();\r\n                    createMarkup = new CreateCallout(editor, id, position, size, text, style, isFrameUsed);\r\n                    break;\r\n\r\n                case MarkupType.MARKUP_TYPE_CIRCLE:\r\n                    position = getPosition();\r\n                    size = getSize();\r\n                    rotation = getRotation();\r\n                    createMarkup = new CreateCircle(editor, id, position, size, rotation, style);\r\n                    break;\r\n\r\n                case MarkupType.MARKUP_TYPE_CLOUD:\r\n                    position = getPosition();\r\n                    size = getSize();\r\n                    rotation = getRotation();\r\n                    createMarkup = new CreateCloud(editor, id, position, size, rotation, style);\r\n                    break;\r\n\r\n                case MarkupType.MARKUP_TYPE_FREEHAND:\r\n                    position = getPosition();\r\n                    size = getSize();\r\n                    rotation = getRotation();\r\n                    locations = getLocations();\r\n                    createMarkup = new CreateFreehand(editor, id, position, size, rotation, locations, style);\r\n                    break;\r\n\r\n                case MarkupType.MARKUP_TYPE_POLYLINE:\r\n                    position = getPosition();\r\n                    size = getSize();\r\n                    rotation = getRotation();\r\n                    locations = getLocations();\r\n                    closed = isClosed();\r\n                    createMarkup = new CreatePolyline(editor, id, position, size, rotation, locations, style, closed);\r\n                    break;\r\n\r\n                case MarkupType.MARKUP_TYPE_POLYCLOUD:\r\n                    position = getPosition();\r\n                    size = getSize();\r\n                    rotation = getRotation();\r\n                    locations = getLocations();\r\n                    closed = isClosed();\r\n                    createMarkup = new CreatePolycloud(editor, id, position, size, rotation, locations, style, closed);\r\n                    break;\r\n\r\n                case MarkupType.MARKUP_TYPE_HIGHLIGHT:\r\n                    position = getPosition();\r\n                    size = getSize();\r\n                    rotation = getRotation();\r\n                    locations = getLocations();\r\n                    createMarkup = new CreateHighlight(editor, id, position, size, rotation, locations, style);\r\n                    break;\r\n\r\n                case MarkupType.MARKUP_TYPE_DIMENSION:\r\n                    firstAnchor = getAttributeVector('firstAnchor');\r\n                    secondAnchor = getAttributeVector('secondAnchor');\r\n                    text = getText();\r\n                    createMarkup = new CreateDimension(editor, id, firstAnchor, secondAnchor, text, style);\r\n                    break;\r\n\r\n                case MarkupType.MARKUP_TYPE_STAMP:\r\n                    position = getPosition();\r\n                    size = getSize();\r\n                    rotation = getRotation();\r\n                    createMarkup = new CreateStamp(editor, id, position, size, rotation, style, child);\r\n                    break;\r\n\r\n                default:\r\n                    createMarkup = null;\r\n                    break;\r\n            }\r\n            if (createMarkup){\r\n                createMarkup.addToHistory = false;\r\n                createMarkup.execute();\r\n                var markupList = editor.svgLayersMap[editor.activeLayer].markups;\r\n\r\n                for(var i = 0; i < markupList.length; ++i) {\r\n                    if (markupList[i].id === id) {\r\n                        return markupList[i];\r\n                    }\r\n                }\r\n            }\r\n            return null;\r\n        }\r\n    };\r\n    \r\n\r\n    export var composeRGBAString = function(hexRGBString, opacity) {\r\n\r\n        if(!hexRGBString || !opacity || opacity <= 0) {\r\n            return 'none';\r\n        }\r\n\r\n        return ['rgba(' +\r\n            parseInt('0x' + hexRGBString.substr(1,2)), ',',\r\n            parseInt('0x' + hexRGBString.substr(3,2)), ',',\r\n            parseInt('0x' + hexRGBString.substr(5,2)), ',', opacity, ')'].join('');\r\n    };\r\n\r\n    //// Id Target Collision ///////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n    /**\r\n     *\r\n     * @param x0\r\n     * @param y0\r\n     * @param x1\r\n     * @param y1\r\n     * @param idTarget\r\n     */\r\n    export var checkLineSegment = function(x0, y0, x1, y1, idTarget) {\r\n\r\n        const _window = (this && this.getWindow && this.getWindow()) || _gWindow;\r\n        var deviceRatio = _window.devicePixelRatio || 1;\r\n\r\n        x0 *= deviceRatio;\r\n        y0 *= deviceRatio;\r\n        x1 *= deviceRatio;\r\n        y1 *= deviceRatio;\r\n\r\n        var idTargetWidth = idTarget.width;\r\n        var idTargetHeight = idTarget.height;\r\n        var idTargetBuffer = idTarget.buffer;\r\n\r\n        x0 = Math.round(x0);\r\n        x1 = Math.round(x1);\r\n        y0 = Math.round(idTargetHeight - y0);\r\n        y1 = Math.round(idTargetHeight - y1);\r\n\r\n        function point(x, y) {\r\n\r\n            x = Math.round(x);\r\n            y = Math.round(y);\r\n\r\n            var dx = 0;\r\n            var dy = 0;\r\n\r\n            for(var j = -deviceRatio; j <= deviceRatio; j+=deviceRatio*2){\r\n                dy += check(x,y+j) ? j : 0;\r\n            }\r\n\r\n            for(var i = -deviceRatio; i <= deviceRatio; i+=deviceRatio*2){\r\n                dx += check(x+i,y) ? i : 0;\r\n            }\r\n\r\n            return {\r\n                x: Math.round(x / deviceRatio + dx),\r\n                y: Math.round((idTargetHeight - y) / deviceRatio - dy)};\r\n        }\r\n\r\n        function check(x, y) {\r\n\r\n            // Probably better to clip line at the beginning.\r\n            if (x < 0 || x >= idTargetWidth ||\r\n                y < 0 || y >= idTargetHeight) {\r\n                return false;\r\n            }\r\n\r\n            var index = (y * idTargetWidth + x) *4;\r\n            return (\r\n                idTargetBuffer[index  ] !== 0xFF ||\r\n                idTargetBuffer[index+1] !== 0xFF ||\r\n                idTargetBuffer[index+2] !== 0xFF);\r\n        }\r\n\r\n        // DDA Line algorithm\r\n        var dx = (x1 - x0);\r\n        var dy = (y1 - y0);\r\n\r\n        var m = dx !== 0 ? dy / dx : 1;\r\n        var x = x0;\r\n        var y = y0;\r\n\r\n        if (dx !== 0 && Math.abs(m) <= 1) {\r\n\r\n            if (x0 <= x1) {\r\n                for (; x <= x1; ++x, y += m) {\r\n                    if (check(x, Math.round(y))) {\r\n                        return point(x, y);\r\n                    }\r\n                }\r\n            } else {\r\n                for (; x >= x1; --x, y -= m) {\r\n                    if (check(x, Math.round(y))) {\r\n                        return point(x, y);\r\n                    }\r\n                }\r\n            }\r\n        } else {\r\n\r\n            m = dx !== 0 ? 1/m : 0;\r\n            if (y0 <= y1) {\r\n                for (; y <= y1; ++y, x += m) {\r\n                    if (check(Math.round(x), y)) {\r\n                        return point(x, y);\r\n                    }\r\n                }\r\n            } else {\r\n                for (; y >= y1; --y, x -= m) {\r\n                    if (check(Math.round(x), y)) {\r\n                        return point(x, y);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param polygon\r\n     * @param idTarget\r\n     */\r\n    export var checkPolygon = function(polygon, idTarget) {\r\n\r\n        // Return if incorrect parameters.\r\n        if(!polygon || polygon.verxtexCount < 3 || !idTarget) {\r\n            return null;\r\n        }\r\n\r\n        const _window = (this && this.getWindow && this.getWindow()) || _gWindow;\r\n        var deviceRatio = _window.devicePixelRatio || 1;\r\n\r\n        var idTargetWidth = idTarget.width;\r\n        var idTargetHeight = idTarget.height;\r\n        var idTargetBuffer = idTarget.buffer;\r\n\r\n        var vertexCount = polygon.vertexCount;\r\n        var xVertices = Float32Array.from(polygon.xVertices); // Clone to scale by device pixel ratio and to\r\n        var yVertices = Float32Array.from(polygon.yVertices); // change y coordinates to OpenGL style.\r\n\r\n        function point(x, y) {\r\n\r\n            var dx = 0;\r\n            var dy = 0;\r\n\r\n            for(var j = -deviceRatio; j <= deviceRatio; j+=deviceRatio*2){\r\n                dy += check(x,y+j) ? j : 0;\r\n            }\r\n\r\n            for(var i = -deviceRatio; i <= deviceRatio; i+=deviceRatio*2){\r\n                dx += check(x+i,y) ? i : 0;\r\n            }\r\n\r\n            return {\r\n                x: Math.round(x / deviceRatio) + dx,\r\n                y: Math.round((idTargetHeight - y) / deviceRatio - dy)};\r\n        }\r\n\r\n        function check(x, y) {\r\n\r\n            if (x < 0 || x >= idTargetWidth ||\r\n                y < 0 || y >= idTargetHeight) {\r\n                return false;\r\n            }\r\n\r\n            var index = (y * idTargetWidth + x) * 4;\r\n            return (\r\n                idTargetBuffer[index  ] !== 0xFF ||\r\n                idTargetBuffer[index+1] !== 0xFF ||\r\n                idTargetBuffer[index+2] !== 0xFF) && isInsidePolygon(x, y);\r\n        }\r\n\r\n        function isInsidePolygon(x, y) {\r\n\r\n            var result = false;\r\n            var vertexCount = polygon.vertexCount;\r\n            for(var i = 0, j = vertexCount-1; i < vertexCount; j = i++) {\r\n\r\n                if (((yVertices[i] > y) != (yVertices[j] > y)) &&\r\n                     (x < (xVertices[j] - xVertices[i]) * (y - yVertices[i]) / (yVertices[j] - yVertices[i]) + xVertices[i]) ) {\r\n                    result = !result;\r\n                }\r\n            }\r\n            return result;\r\n        }\r\n\r\n        // Change coordinates to OpenGL style and calculate polygon's bounding box.\r\n        var bbX0 = Number.POSITIVE_INFINITY;\r\n        var bbY0 = Number.POSITIVE_INFINITY;\r\n        var bbX1 = Number.NEGATIVE_INFINITY;\r\n        var bbY1 = Number.NEGATIVE_INFINITY;\r\n\r\n        for(var i = 0; i < vertexCount; ++i) {\r\n\r\n            var bbX = xVertices[i] = xVertices[i] * deviceRatio;\r\n            var bbY = yVertices[i] = idTargetHeight - yVertices[i] * deviceRatio;\r\n\r\n            bbX0 = Math.min(bbX0, bbX);\r\n            bbY0 = Math.min(bbY0, bbY);\r\n            bbX1 = Math.max(bbX1, bbX);\r\n            bbY1 = Math.max(bbY1, bbY);\r\n        }\r\n\r\n        if (bbX1 < 0 || bbX0 > idTargetWidth ||\r\n            bbY1 < 0 || bbY0 > idTargetHeight) {\r\n            return null;\r\n        }\r\n\r\n        var bbW = Math.round(bbX1 - bbX0);\r\n        var bbH = Math.round(bbY1 - bbY0);\r\n\r\n        var bbCenterX = Math.round((bbX0 + bbX1)*0.5);\r\n        var bbCenterY = Math.round((bbY0 + bbY1)*0.5);\r\n\r\n        // Check\r\n        var x = bbCenterX;\r\n        var y = bbCenterY;\r\n\r\n        var w = 1;\r\n        var h = 1;\r\n\r\n        do {\r\n\r\n            var endX = x + w;\r\n            var endY = y + h;\r\n\r\n            for(; x < endX; ++x) {\r\n                if (check(x,y)) {\r\n                    return point(x,y);\r\n                }\r\n            }\r\n\r\n            for(; y < endY; ++y) {\r\n                if (check(x,y)) {\r\n                    return point(x,y);\r\n                }\r\n            }\r\n\r\n            if (w < bbW) {\r\n                endX = x - ++w; ++w;\r\n            } else {\r\n                endX = x - w;\r\n            }\r\n\r\n            if (h < bbH) {\r\n                endY = y - ++h; ++h;\r\n            } else {\r\n                endY = y - h;\r\n            }\r\n\r\n            for(; x > endX; --x) {\r\n                if (check(x,y)) {\r\n                    return point(x,y);\r\n                }\r\n            }\r\n\r\n            for(; y > endY; --y) {\r\n                if (check(x,y)) {\r\n                    return point(x,y);\r\n                }\r\n            }\r\n        } while(w < bbW || h < bbH);\r\n     };\r\n\r\n    //// CSS ///////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n    /**\r\n     *\r\n     * @returns {*}\r\n     */\r\n    export var createStyleSheet = function() {\r\n\r\n        const _document = (this && this.getDocument && this.getDocument()) || _gDocument;\r\n        var style = _document.createElement(\"style\");\r\n\r\n        // This is WebKit hack.\r\n        style.appendChild(_document.createTextNode(\"\"));\r\n        _document.head.appendChild(style);\r\n\r\n        return style.sheet;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param styleSheet\r\n     * @param selector\r\n     * @param styles\r\n     * @param index\r\n     */\r\n    export var addRuleToStyleSheet = function(styleSheet, selector, styles, index) {\r\n\r\n        if(\"insertRule\" in styleSheet) {\r\n            styleSheet.insertRule(selector + \"{\" + styles + \"}\", index);\r\n        }\r\n        else if(\"addRule\" in styleSheet) {\r\n            styleSheet.addRule(selector, styles, index);\r\n        }\r\n    };\r\n\r\n    //// SVG ///////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n    /**\r\n     *\r\n     * @param lines\r\n     * @param style\r\n     * @param editor\r\n     */\r\n    export var measureTextLines = function(lines, style, editor) {\r\n\r\n        // Measure div style is line style with some custom layout properties.\r\n        var fontSize = editor.sizeFromMarkupsToClient(0, style['font-size']).y;\r\n\r\n        var measureStyle = new DomElementStyle()\r\n            .setAttribute('font-family', style['font-family'])\r\n            .setAttribute('font-size', fontSize + 'px')\r\n            .setAttribute('font-weight', style['font-weight'] ? 'bold' : '')\r\n            .setAttribute('font-style', style['font-style'] ? 'italic' : '')\r\n\r\n            .removeAttribute(['top', 'left', 'width', 'height', 'overflow-y'])\r\n            .setAttribute('position','absolute')\r\n            .setAttribute('white-space','nowrap')\r\n            .setAttribute('float','left')\r\n            .setAttribute('visibility','hidden')\r\n            .getStyleString();\r\n\r\n        const _document = (this && this.getDocument && this.getDocument()) || _gDocument;\r\n        // Create measure div.\r\n        var measure = _document.createElement('div');\r\n\r\n        measure.setAttribute('style', measureStyle);\r\n        editor.viewer.container.appendChild(measure);\r\n\r\n        // Measure.\r\n        var result = [];\r\n\r\n        var linesCount = lines.length;\r\n        for(var i = 0; i < linesCount; ++i) {\r\n\r\n            measure.innerText = lines[i];\r\n            result.push({\r\n                line: lines[i],\r\n                width: measure.clientWidth,\r\n                height: measure.clientHeight\r\n            });\r\n        }\r\n\r\n        // Remove measure div and return result.\r\n        editor.viewer.container.removeChild(measure);\r\n        return result;\r\n    };\r\n\r\n    export var createArcTo = function(x, y, xRadius, yRadius, relative, path) {\r\n\r\n        path.push(relative ? 'a' : 'A');\r\n        path.push(xRadius);\r\n        path.push(yRadius);\r\n        path.push(0);\r\n        path.push(1);\r\n        path.push(1);\r\n        path.push(x);\r\n        path.push(y);\r\n\r\n        return path;\r\n    };\r\n\r\n    export var createEllipsePath = function (x, y, w, h, relative, path) {\r\n\r\n        var halfW = w * 0.5;\r\n        var halfH = h * 0.5;\r\n\r\n        path.push(relative ? 'm' : 'M');\r\n        path.push(x);\r\n        path.push(y);\r\n\r\n        createArcTo(w, 0, halfW, halfH, true, path);\r\n        createArcTo(-w, 0, halfW, halfH, true, path);\r\n\r\n        path.push('z');\r\n    };\r\n\r\n    export var createRectanglePath = function (x, y, w, h, relative, path) {\r\n\r\n        path.push(relative ? 'm' : 'M');\r\n        path.push(x);\r\n        path.push(y);\r\n        path.push('l');\r\n        path.push(w);\r\n        path.push(0);\r\n        path.push('l');\r\n        path.push(0);\r\n        path.push(h);\r\n        path.push('l');\r\n        path.push(-w);\r\n        path.push(0);\r\n        path.push('z');\r\n    };\r\n\r\n    export var renderToCanvas = function(svg, viewBox, width, height, ctx, callback) {\r\n\r\n        // Creating a new svg element, that will be drawn into the canvas.\r\n        var tmpSvg = createSvgElement('svg');\r\n        \r\n        if (!av.isIE11) {\r\n            tmpSvg.setAttribute('xmlns','http://www.w3.org/2000/svg');    \r\n        }\r\n\r\n        tmpSvg.setAttribute('width',width);\r\n        tmpSvg.setAttribute('height',height);\r\n        tmpSvg.setAttribute('viewBox',viewBox);\r\n\r\n        if (!av.isSafari())\r\n            tmpSvg.setAttribute('transform', 'scale(1, -1)');\r\n        \r\n        var markupGroup = svg.parentNode.cloneNode(true);\r\n        if (av.isSafari())\r\n            markupGroup.setAttribute('transform', 'scale(1, -1)');\r\n\r\n        // Adding the markup itself to the temp SVG\r\n        tmpSvg.appendChild(markupGroup);\r\n        \r\n        const _window = (this && this.getWindow && this.getWindow()) || _gWindow;\r\n        const _document = (this && this.getDocument && this.getDocument()) || _gDocument;\r\n        // Get the SVG as string\r\n        var temp = _document.createElement('div');\r\n        var node = tmpSvg.cloneNode(true);\r\n        temp.appendChild(node);\r\n        var data = temp.innerHTML;\r\n        \r\n        tmpSvg = temp = node = null;\r\n\r\n        var img = new Image();\r\n\r\n        img.onload = function() {\r\n            ctx.drawImage(img, 0, 0);\r\n            callback();\r\n        };\r\n\r\n        img.src = 'data:image/svg+xml;base64,' + _window.btoa(unescape( encodeURIComponent( data )));\r\n        \r\n    };\r\n\r\n    /*\r\n     Taken from Simplify.js, a high-performance JS polyline simplification library\r\n     (c) 2013, Vladimir Agafonkin\r\n     mourner.github.io/simplify-js\r\n    */\r\n   export var simplify = function(points, tolerance, highestQuality) {\r\n\r\n        if (points.length <= 2) return points;\r\n\r\n        // square distance between 2 points\r\n        function getSqDist(p1, p2) {\r\n\r\n            var dx = p1.x - p2.x,\r\n                dy = p1.y - p2.y;\r\n\r\n            return dx * dx + dy * dy;\r\n        }\r\n\r\n        // square distance from a point to a segment\r\n        function getSqSegDist(p, p1, p2) {\r\n\r\n            var x = p1.x,\r\n                y = p1.y,\r\n                dx = p2.x - x,\r\n                dy = p2.y - y;\r\n\r\n            if (dx !== 0 || dy !== 0) {\r\n\r\n                var t = ((p.x - x) * dx + (p.y - y) * dy) / (dx * dx + dy * dy);\r\n\r\n                if (t > 1) {\r\n                    x = p2.x;\r\n                    y = p2.y;\r\n\r\n                } else if (t > 0) {\r\n                    x += dx * t;\r\n                    y += dy * t;\r\n                }\r\n            }\r\n\r\n            dx = p.x - x;\r\n            dy = p.y - y;\r\n\r\n            return dx * dx + dy * dy;\r\n        }\r\n        // rest of the code doesn't care about point format\r\n\r\n        // basic distance-based simplification\r\n        function simplifyRadialDist(points, sqTolerance) {\r\n\r\n            var prevPoint = points[0],\r\n                newPoints = [prevPoint],\r\n                point;\r\n\r\n            for (var i = 1, len = points.length; i < len; i++) {\r\n                point = points[i];\r\n\r\n                if (getSqDist(point, prevPoint) > sqTolerance) {\r\n                    newPoints.push(point);\r\n                    prevPoint = point;\r\n                }\r\n            }\r\n\r\n            if (prevPoint !== point) newPoints.push(point);\r\n\r\n            return newPoints;\r\n        }\r\n\r\n        function simplifyDPStep(points, first, last, sqTolerance, simplified) {\r\n            var maxSqDist = sqTolerance,\r\n                index;\r\n\r\n            for (var i = first + 1; i < last; i++) {\r\n                var sqDist = getSqSegDist(points[i], points[first], points[last]);\r\n\r\n                if (sqDist > maxSqDist) {\r\n                    index = i;\r\n                    maxSqDist = sqDist;\r\n                }\r\n            }\r\n\r\n            if (maxSqDist > sqTolerance) {\r\n                if (index - first > 1) simplifyDPStep(points, first, index, sqTolerance, simplified);\r\n                simplified.push(points[index]);\r\n                if (last - index > 1) simplifyDPStep(points, index, last, sqTolerance, simplified);\r\n            }\r\n        }\r\n\r\n        // simplification using Ramer-Douglas-Peucker algorithm\r\n        function simplifyDouglasPeucker(points, sqTolerance) {\r\n            var last = points.length - 1;\r\n\r\n            var simplified = [points[0]];\r\n            simplifyDPStep(points, 0, last, sqTolerance, simplified);\r\n            simplified.push(points[last]);\r\n\r\n            return simplified;\r\n        }\r\n\r\n        // both algorithms combined for awesome performance\r\n        var sqTolerance = tolerance !== undefined ? tolerance * tolerance : 1;\r\n\r\n        points = highestQuality ? points : simplifyRadialDist(points, sqTolerance);\r\n        points = simplifyDouglasPeucker(points, sqTolerance);\r\n\r\n        return points;\r\n    }\r\n\r\n","'use strict';\r\n\r\n    /**\r\n     * This class will group actions edit actions that should be executed as a whole.\r\n     * When a group is open actions can be added to it, similar actions will be merged into one during this process.\r\n     * This class is not intended to be used by users, it's a helper class of EditActionManager.\r\n     * @constructor\r\n     */\r\n    export function EditActionGroup() {\r\n\r\n        this.actions = [];\r\n        this.closed = true;\r\n    }\r\n\r\n    var proto = EditActionGroup.prototype;\r\n\r\n    /**\r\n     *\r\n     * @returns {boolean}\r\n     */\r\n    proto.open = function() {\r\n\r\n        if(!this.closed) {\r\n            return false;\r\n        }\r\n\r\n        this.closed = false;\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @returns {boolean}\r\n     */\r\n    proto.close = function() {\r\n\r\n        if (this.closed) {\r\n            return false;\r\n        }\r\n\r\n        this.closed = true;\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @returns {number} targetId\r\n     */\r\n    proto.undo = function() {\r\n\r\n        var actions = this.actions;\r\n        var actionsMaxIndex = actions.length - 1;\r\n\r\n        var targetId = -1;\r\n        for(var i = actionsMaxIndex; i >= 0; --i) {\r\n\r\n            var action =  actions[i];\r\n            action.undo();\r\n\r\n            if (action.targetId !== -1) {\r\n                targetId = action.targetId;\r\n            }\r\n        }\r\n\r\n        return targetId;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @returns {number} targetId\r\n     */\r\n    proto.redo = function() {\r\n\r\n        var actions = this.actions;\r\n        var actionsCount = actions.length;\r\n\r\n        var targetId = -1;\r\n        for(var i = 0; i < actionsCount; ++i) {\r\n\r\n            var action =  actions[i];\r\n            action.redo();\r\n\r\n            if (action.targetId !== -1) {\r\n                targetId = action.targetId;\r\n            }\r\n        }\r\n\r\n        return targetId;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @returns {boolean}\r\n     */\r\n    proto.isOpen = function() {\r\n\r\n        return !this.closed;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @returns {boolean}\r\n     */\r\n    proto.isClosed = function() {\r\n\r\n        return this.closed;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @returns {boolean}\r\n     */\r\n    proto.isEmpty = function() {\r\n\r\n        return this.actions.length === 0;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param {EditAction} action\r\n     */\r\n    proto.addAction = function(action) {\r\n\r\n        if (this.closed) {\r\n            return false;\r\n        }\r\n\r\n        this.actions.push(action);\r\n        this.compact();\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    proto.compact = function() {\r\n\r\n        var actions = this.actions;\r\n        var actionsCount = actions.length;\r\n\r\n        for(var i = 0; i < actionsCount; ++i) {\r\n\r\n            // If an action does nothing, remove it.\r\n            var actionA = actions[i];\r\n            if (actionA.isIdentity()) {\r\n                actions.splice(i, 1);\r\n                --actionsCount;\r\n                --i;\r\n                continue;\r\n            }\r\n\r\n            // If an action can be merged, merge it.\r\n            for (var j = i + 1; j < actionsCount; ++j) {\r\n\r\n                var actionB = actions[j];\r\n                if (actionA.type === actionB.type &&\r\n                    actionA.merge(actionB)) {\r\n                    actions.splice(j, 1);\r\n                    --actionsCount;\r\n                    --i;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    proto.getTargetId = function() {\r\n      var actions = this.actions;\r\n      var actionsCount = actions.length;\r\n      var targetId = -1;\r\n      for(var i = 0; i < actionsCount; ++i) {\r\n        var action =  actions[i];\r\n        if (action.targetId !== -1) {\r\n          targetId = action.targetId;\r\n        }\r\n      }\r\n      return targetId;\r\n    }","'use strict';\r\n\r\nimport { addTraitEventDispatcher } from '../MarkupsCoreUtils'\r\nimport * as MarkupEvents from '../MarkupEvents'\r\nimport { EditActionGroup } from './EditActionGroup'\r\n\r\n    /**\r\n     *\r\n     * @param historySize\r\n     * @constructor\r\n     */\r\n    export function EditActionManager(historySize) {\r\n\r\n        this.historySize = historySize;\r\n\r\n        this.undoStack = [];\r\n        this.redoStack = [];\r\n\r\n        addTraitEventDispatcher(this);\r\n    }\r\n\r\n    var proto = EditActionManager.prototype;\r\n\r\n    /**\r\n     *\r\n     * @param action\r\n     */\r\n    proto.execute = function(action) {\r\n\r\n        var redoStack = this.redoStack;\r\n        var undoStack = this.undoStack;\r\n\r\n        redoStack.splice(0, redoStack.length);\r\n\r\n        action.redo();\r\n\r\n        var group = this.getEditActionGroup();\r\n        if (group.isOpen()) {\r\n            group.addAction(action);\r\n        } else {\r\n            group.open();\r\n            group.addAction(action);\r\n            group.close();\r\n        }\r\n\r\n        if (undoStack.length > this.historySize) {\r\n            undoStack.splice(0,1);\r\n        }\r\n\r\n        var targetId = action.selectOnExecution ? action.targetId : -1;\r\n        this.dispatchEvent(\r\n            {type: MarkupEvents.EVENT_HISTORY_CHANGED, data: {action: 'execute', targetId: targetId}});\r\n    };\r\n\r\n    proto.beginActionGroup = function() {\r\n\r\n        var undoStack = this.undoStack;\r\n        var undoStackCount = undoStack.length;\r\n        var group = null;\r\n\r\n        if (undoStackCount === 0 || undoStack[undoStackCount-1].isClosed()) {\r\n\r\n            group = this.getEditActionGroup();\r\n            group.open();\r\n        } else {\r\n            console.warn('Markups - Undo/Redo - Action edit group already open.');\r\n        }\r\n    };\r\n\r\n    proto.closeActionGroup = function() {\r\n\r\n        var undoStack = this.undoStack;\r\n        var undoStackCount = undoStack.length;\r\n\r\n        if (undoStackCount === 0) {\r\n\r\n            console.warn('Markups - Undo/Redo - There is no action edit group to close.');\r\n            return;\r\n        }\r\n\r\n        var group = undoStack[undoStackCount-1];\r\n        if(!group.close()) {\r\n            console.warn('Markups - Undo/Redo - Action edit group already closed.');\r\n        }\r\n\r\n        if (group.isEmpty()) {\r\n            undoStack.pop();\r\n        }\r\n    };\r\n\r\n    proto.cancelActionGroup = function() {\r\n\r\n        var undoStack = this.undoStack;\r\n        var undoStackCount = undoStack.length;\r\n\r\n        if (undoStackCount === 0) {\r\n\r\n            console.warn('Markups - Undo/Redo - There is no action edit group to close.');\r\n            return;\r\n        }\r\n\r\n        var group = undoStack[undoStackCount-1];\r\n        if(!group.close()) {\r\n            console.warn('Markups - Undo/Redo - Action edit group already closed.');\r\n            return;\r\n        }\r\n\r\n        group.undo();\r\n        undoStack.pop();\r\n\r\n        this.dispatchEvent(\r\n            {type: MarkupEvents.EVENT_HISTORY_CHANGED, data: {action: 'cancel', targetId: -1}});\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        var undoStack = this.undoStack;\r\n        var redoStack = this.redoStack;\r\n\r\n        if (undoStack.length === 0) {\r\n            return;\r\n        }\r\n\r\n        var group = undoStack.pop();\r\n        var targetId = group.undo();\r\n\r\n        redoStack.push(group);\r\n\r\n        this.dispatchEvent(\r\n            {type: MarkupEvents.EVENT_HISTORY_CHANGED, data: {action:'undo', targetId: targetId}});\r\n    };\r\n\r\n    proto.redo = function() {\r\n\r\n        var undoStack = this.undoStack;\r\n        var redoStack = this.redoStack;\r\n\r\n        if (redoStack.length === 0) {\r\n            return;\r\n        }\r\n\r\n        var group = redoStack.pop();\r\n        var targetId = group.redo();\r\n\r\n        undoStack.push(group);\r\n\r\n        this.dispatchEvent(\r\n            {type: MarkupEvents.EVENT_HISTORY_CHANGED, data: {action:'redo', targetId: targetId}});\r\n    };\r\n\r\n    proto.clear = function() {\r\n\r\n        this.undoStack.splice(0, this.undoStack.length);\r\n        this.redoStack.splice(0, this.redoStack.length);\r\n\r\n        this.dispatchEvent(\r\n            {type: MarkupEvents.EVENT_HISTORY_CHANGED, data: {action:'clear', targetId: -1}});\r\n    };\r\n\r\n    proto.isUndoStackEmpty = function() {\r\n\r\n        return this.undoStack.length === 0;\r\n    };\r\n\r\n    proto.isRedoStackEmpty = function() {\r\n\r\n        return this.redoStack.length === 0;\r\n    };\r\n\r\n    proto.getLastElementInUndoStack = function() {\r\n\r\n        var undoStack = this.undoStack;\r\n        var undoStackCount = undoStack.length;\r\n        return undoStack[undoStackCount-1];\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @return action\r\n     * @private\r\n     */\r\n    proto.getEditActionGroup = function() {\r\n\r\n        var undoStack = this.undoStack;\r\n        var undoStackCount = this.undoStack.length;\r\n\r\n        var group = null;\r\n\r\n        if (undoStackCount === 0 || undoStack[undoStackCount-1].isClosed()) {\r\n            group = new EditActionGroup();\r\n            undoStack.push(group);\r\n        } else {\r\n            group = undoStack[undoStackCount-1];\r\n        }\r\n\r\n        return group;\r\n    };\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param id\r\n     * @param markup\r\n     * @param position\r\n     * @constructor\r\n     */\r\n    export function CloneMarkup(editor, id, markup, position) {\r\n\r\n        EditAction.call(this, editor, 'CLONE-MARKUP', id);\r\n\r\n        this.clone = markup.clone();\r\n        this.clone.id = id;\r\n        this.position = {x: position.x, y: position.y};\r\n    }\r\n\r\n    CloneMarkup.prototype = Object.create(EditAction.prototype);\r\n    CloneMarkup.prototype.constructor = CloneMarkup;\r\n\r\n    var proto = CloneMarkup.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        var editor = this.editor;\r\n        var clone = this.clone;\r\n        var position = this.position;\r\n\r\n        if (editor.getMarkup(this.targetId)) {\r\n            return;\r\n        }\r\n\r\n        var markup = clone.clone();\r\n        markup.setPosition(position.x, position.y);\r\n\r\n        editor.addMarkup(markup);\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        var markup = this.editor.getMarkup(this.targetId);\r\n        markup && this.editor.removeMarkup(markup);\r\n    };\r\n\r\n\r\n","'use strict';\r\n\r\nimport { CloneMarkup } from '../edit-actions/CloneMarkup'\r\nimport { addTraitEventDispatcher } from '../MarkupsCoreUtils'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @constructor\r\n     */\r\n    export function Clipboard(editor) {\r\n\r\n        this.editor = editor;\r\n        this.content = null;\r\n        this.pastePosition = {x:0, y: 0};\r\n\r\n        addTraitEventDispatcher(this);\r\n    }\r\n\r\n    var proto = Clipboard.prototype;\r\n\r\n    proto.copy = function() {\r\n\r\n        var selectedMarkup = this.editor.getSelection();\r\n        if(!selectedMarkup) {\r\n            return;\r\n        }\r\n\r\n        this.content = selectedMarkup.clone();\r\n        this.pastePosition.x = selectedMarkup.position.x;\r\n        this.pastePosition.y = selectedMarkup.position.y;\r\n    };\r\n\r\n    proto.cut = function() {\r\n\r\n        var selectedMarkup = this.editor.getSelection();\r\n        if(!selectedMarkup) {\r\n            return;\r\n        }\r\n\r\n        this.copy();\r\n        this.editor.deleteMarkup(selectedMarkup);\r\n    };\r\n\r\n    proto.paste = function() {\r\n\r\n        var content = this.content;\r\n        if(!content) {\r\n            return;\r\n        }\r\n\r\n        var editor = this.editor;\r\n        var position = this.pastePosition;\r\n        var delta = editor.sizeFromClientToMarkups(20, 20);\r\n\r\n        position.x += delta.x;\r\n        position.y -= delta.y;\r\n\r\n        var cloneMarkup = new CloneMarkup(editor, editor.getId(), content, position);\r\n        cloneMarkup.execute();\r\n    };\r\n","'use strict';\r\n\r\nimport { isTouchDevice } from '../MarkupsCoreUtils'\r\n\r\n    var av = Autodesk.Viewing;\r\n    var avp = av.Private;\r\n\r\n    var _mouseEnabled = false;\r\n    var _mousePrevValue = false;\r\n    var _lock = false;\r\n\r\n    export function InputHandler() {\r\n\r\n        this.editor = null;\r\n        this.mousePosition = {x:0, y:0};\r\n        this.makeSameXY = false; // TODO: FIND a better way to name and communicate these.\r\n        this.snapRotations = false;\r\n        this.keepAspectRatio = false;\r\n        this.constrainAxis = false;\r\n        this.duringEditMode = false;\r\n\r\n        this.onWheelBinded = this.onWheel.bind(this);\r\n        this.onTouchDragBinded = this.onTouchDrag.bind(this);\r\n        this.onTouchPanBinded = this.onTouchPan.bind(this);\r\n        this.onTouchPinchBinded = this.onTouchPinch.bind(this);\r\n        this.onSingleTapBinded = this.onSingleTap.bind(this);\r\n        this.onDoubleTapBinded = this.onDoubleTap.bind(this);\r\n        this.onMouseMoveBinded = this.onMouseMove.bind(this);\r\n        this.onMouseUpBinded = this.onMouseUp.bind(this);\r\n        this.onMouseDownBinded = this.onMouseDown.bind(this);\r\n        this.onMouseDoubleClickBinded = this.onMouseDoubleClick.bind(this);\r\n        this.onHammerInputBinded = this.onHammerInput.bind(this);\r\n        this.isMouseDown = false;\r\n    }\r\n\r\n    av.GlobalManagerMixin.call(InputHandler.prototype);\r\n    var proto = InputHandler.prototype;\r\n\r\n    proto.attachTo = function(editor) {\r\n\r\n        this.editor && this.detachFrom(this.editor);\r\n        this.editor = editor;\r\n\r\n        if (isTouchDevice()) {\r\n\r\n            this.hammer = new av.Hammer.Manager(editor.svg, {\r\n                recognizers: [\r\n                    av.GestureRecognizers.drag,\r\n                    av.GestureRecognizers.doubletap,\r\n                    av.GestureRecognizers.doubletap2,\r\n                    av.GestureRecognizers.singletap,\r\n                    av.GestureRecognizers.singletap2,\r\n                    av.GestureRecognizers.press,\r\n                    av.GestureRecognizers.pan,\r\n                    av.GestureRecognizers.pinch\r\n                ],\r\n                handlePointerEventMouse: false,\r\n                inputClass: av.isIE11 ? av.Hammer.PointerEventInput : av.Hammer.TouchInput\r\n            });\r\n\r\n            this.hammer.get('doubletap2').recognizeWith('doubletap');\r\n            this.hammer.get('singletap2').recognizeWith('singletap');\r\n            this.hammer.get('singletap').requireFailure('doubletap');\r\n        }\r\n    };\r\n\r\n    proto.onHammerInput = function(event) {\r\n\r\n        this.setMouseDisabledWhenTouching(event);\r\n    };\r\n\r\n    proto.setMouseDisabledWhenTouching = function(event) {\r\n\r\n        if (event.isFirst && !_lock) {\r\n            this.enableMouseButtons(false);\r\n            _lock = true;\r\n        } else if (event.isFinal) {\r\n            var _this = this;\r\n            setTimeout(function() {\r\n                _this.enableMouseButtons(_mousePrevValue);\r\n                _lock = false;\r\n            }, 10);\r\n        }\r\n    };\r\n\r\n    proto.enableMouseButtons = function(state) {\r\n\r\n        if (state && !_mouseEnabled)\r\n        {\r\n            this.editor.svg.addEventListener('mousedown', this.onMouseDownBinded);\r\n            this.editor.svg.addEventListener('dblclick', this.onMouseDoubleClickBinded);\r\n            this.editor.svg.addEventListener('wheel', this.onWheelBinded);\r\n            this.editor.svg.addEventListener('DOMMouseScroll', this.onWheelBinded); // Firefox\r\n\r\n            // The mouseup and mousemove listeners are at the document level to handle the case where\r\n            // mouse was held inside the canvas and released outside. \r\n            // When this happens, we don't want the editing to be in a hung state and cancel it\r\n            this.addDocumentEventListener('mousemove', this.onMouseMoveBinded);\r\n            this.addDocumentEventListener('mouseup', this.onMouseUpBinded);\r\n        }\r\n        else if (!state && _mouseEnabled)\r\n        {\r\n            this.editor.svg.removeEventListener('mousedown', this.onMouseDownBinded);\r\n            this.editor.svg.removeEventListener('dblclick', this.onMouseDoubleClickBinded);\r\n            this.editor.svg.removeEventListener('wheel', this.onWheelBinded);\r\n            this.editor.svg.removeEventListener('DOMMouseScroll', this.onWheelBinded);\r\n            this.removeDocumentEventListener('mousemove', this.onMouseMoveBinded);\r\n            this.removeDocumentEventListener('mouseup', this.onMouseUpBinded);\r\n\r\n        }\r\n\r\n        _mousePrevValue = _mouseEnabled;\r\n        _mouseEnabled = state;\r\n    };\r\n\r\n    proto.detachFrom = function(editor) {\r\n\r\n        this.hammer && this.hammer.destroy();\r\n\r\n        this.removeDocumentEventListener('mousemove', this.onMouseMoveBinded);\r\n        this.removeDocumentEventListener('mouseup', this.onMouseUpBinded);\r\n\r\n        if (this.editor) {\r\n            this.editor.svg.removeEventListener('mousedown', this.onMouseDownBinded);\r\n            this.editor.svg.removeEventListener('dblclick', this.onMouseDoubleClickBinded);\r\n        }\r\n\r\n        this.editor = editor;\r\n    };\r\n\r\n    proto.enterEditMode = function() {\r\n        if (this.duringEditMode) {\r\n            return;\r\n        }\r\n\r\n        if (this.hammer) {\r\n            this.hammer.on('dragstart dragmove dragend', this.onTouchDragBinded);\r\n            this.hammer.on('panstart panmove panend', this.onTouchPanBinded);\r\n            this.hammer.on('pinchstart pinchmove pinchend', this.onTouchPinchBinded);\r\n            this.hammer.on('singletap', this.onSingleTapBinded);\r\n            this.hammer.on('singletap2', this.onSingleTapBinded);\r\n            this.hammer.on('doubletap', this.onDoubleTapBinded);\r\n            this.hammer.on('doubletap2', this.onDoubleTapBinded);\r\n            this.hammer.on('hammer.input', this.onHammerInputBinded);\r\n\r\n\t\t\tthis.hammer.get('drag').requireFailure('pinch');\r\n            this.hammer.get('drag').requireFailure('pan');\r\n        }\r\n\r\n        if (!av.isMobileDevice()) {\r\n            this.enableMouseButtons(true);\r\n        }\r\n\r\n        this.duringEditMode = true;\r\n    };\r\n\r\n    proto.leaveEditMode = function() {\r\n        if (!this.duringEditMode) {\r\n            return;\r\n        }\r\n\r\n        if (this.hammer) {\r\n            this.hammer.off('dragstart dragmove dragend', this.onTouchDragBinded);\r\n\t\t\tthis.hammer.off('panstart panmove panend', this.onTouchPanBinded);\r\n            this.hammer.off('pinchstart pinchmove pinchend', this.onTouchPinchBinded);\r\n            this.hammer.off('singletap', this.onSingleTapBinded);\r\n            this.hammer.off('singletap2', this.onSingleTapBinded);\r\n            this.hammer.off('doubletap', this.onDoubleTapBinded);\r\n            this.hammer.off('doubletap2', this.onDoubleTapBinded);\r\n            this.hammer.off('hammer.input', this.onHammerInputBinded);\r\n        }\r\n\r\n        if (!av.isMobileDevice()) {\r\n            this.enableMouseButtons(false);\r\n        }\r\n\r\n        this.duringEditMode = false;\r\n    };\r\n\r\n    proto.enterViewMode = function() {\r\n\r\n    };\r\n\r\n    proto.leaveViewMode = function() {\r\n\r\n    };\r\n\r\n    proto.getMousePosition = function() {\r\n\r\n        return {x: this.mousePosition.x, y: this.mousePosition.y};\r\n    };\r\n\r\n    proto.onWheel = function(event) {\r\n\r\n        if (!av.isMobileDevice()) {\r\n            this.editor.viewer.toolController.mousewheel(event);\r\n        }\r\n\r\n        event.preventDefault();\r\n    };\r\n\r\n    proto.onMouseMove = function(event) {\r\n\r\n        processMouseEvent(this, event);\r\n\r\n        if (!av.isMobileDevice() && this.editor.viewer.container.contains(event.target)) {\r\n            this.editor.viewer.toolController.mousemove(event);\r\n        }\r\n\r\n        if (this.editor.onMouseMove(event)) {\r\n            // editor handled the event\r\n            event.preventDefault();\r\n        }\r\n    };\r\n\r\n\r\n    proto.onMouseDownRightClick = function(event) {\r\n\r\n        const _document = this.getDocument();\r\n        // Don't do blur in full screen (IE issue)\r\n        if (!(av.isIE11 && av.inFullscreen(_document))) {\r\n            _document.activeElement && _document.activeElement.blur && _document.activeElement.blur();\r\n        }\r\n\r\n        var controller = this.editor.viewer.toolController;\r\n        controller.__clientToCanvasCoords(event);\r\n\r\n        this.editor.markupTool.handleButtonDown(event, 2);\r\n    };\r\n\r\n    proto.onMouseUpRightClick = function(event) {\r\n\r\n        var controller = this.editor.viewer.toolController;\r\n        controller.__clientToCanvasCoords(event);\r\n\r\n        this.editor.markupTool.handleButtonUp(event, 2);\r\n    };\r\n\r\n    proto.onMouseDown = function(event) {\r\n\r\n        processMouseEvent(this, event);\r\n\r\n        // Panning when right clicking\r\n        if (!av.isMobileDevice() && (avp.isRightClick(event, this.editor.viewer.navigation) || avp.isMiddleClick(event))) {\r\n            this.onMouseDownRightClick(event);\r\n            return;\r\n        }\r\n        \r\n        this.isMouseDown = true;\r\n        this.editor.onMouseDown(event);\r\n        event.preventDefault();\r\n    };\r\n\r\n    proto.onMouseUp = function(event) {\r\n\r\n        processMouseEvent(this, event);\r\n\r\n        if (!av.isMobileDevice() && this.editor.viewer.container.contains(event.target) && (\r\n            avp.isRightClick(event, this.editor.viewer.navigation) || avp.isMiddleClick(event)))\r\n        {\r\n            this.onMouseUpRightClick(event);\r\n            return;\r\n        }\r\n\r\n        this.isMouseDown = false;\r\n        if (this.editor.onMouseUp(event)) {\r\n            // editor handled the event\r\n            event.preventDefault();\r\n        }\r\n    };\r\n\r\n    proto.onMouseDoubleClick = function(event) {\r\n\r\n        processMouseEvent(this, event);\r\n        this.editor.onMouseDoubleClick(event);\r\n        event.preventDefault();\r\n    };\r\n\r\n    proto.onTouchDrag = function(event) {\r\n\r\n        convertEventHammerToMouse(event);\r\n        switch (event.type) {\r\n          case 'dragstart':\r\n                this.onMouseDown(event);\r\n                break;\r\n            case 'dragmove':\r\n                this.onMouseMove(event);\r\n                break;\r\n           case 'dragend':\r\n                this.onMouseUp(event);\r\n                break;\r\n        }\r\n        event.preventDefault();\r\n    };\r\n\r\n    proto.onTouchPan = function(event) {\r\n\r\n        var gestureHandler = this.editor.viewer.toolController.getTool(\"gestures\");\r\n        gestureHandler.distributeGesture(event);\r\n        event.preventDefault();\r\n    };\r\n\r\n    proto.onTouchPinch = function(event) {\r\n\r\n        processMouseEvent(this, event);\r\n\r\n        var gestureHandler = this.editor.viewer.toolController.getTool(\"gestures\");\r\n        gestureHandler.distributeGesture(event);\r\n        \r\n        this.mousePosition.x = this.mousePosition.y = null;\r\n        this.editor.callSnapperMouseMove();\r\n\r\n        event.preventDefault();\r\n    };\r\n\r\n    proto.onSingleTap = function(event) {\r\n\r\n        convertEventHammerToMouse(event);\r\n\r\n        this.onMouseDown(event);\r\n        this.onMouseUp(event);\r\n        event.preventDefault();\r\n    };\r\n\r\n    proto.onDoubleTap = function(event) {\r\n\r\n        convertEventHammerToMouse(event);\r\n        this.onMouseDoubleClick(event);\r\n        event.preventDefault();\r\n    };\r\n\r\n    function processMouseEvent(input, event) {\r\n\r\n        var rect = input.editor.svg.getBoundingClientRect();\r\n\r\n        input.makeSameXY = event.shiftKey;\r\n        input.snapRotations = event.shiftKey;\r\n        input.keepAspectRatio = event.shiftKey;\r\n        input.constrainAxis = event.shiftKey;\r\n\r\n        input.mousePosition.x = event.clientX - rect.left;\r\n        input.mousePosition.y = event.clientY - rect.top;\r\n    }\r\n\r\n    function convertEventHammerToMouse(event) {\r\n\r\n        // Convert Hammer touch-event X,Y into mouse-event X,Y.\r\n        event.shiftKey = false;\r\n        event.clientX = event.pointers[0].clientX;\r\n        event.clientY = event.pointers[0].clientY;\r\n    }\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\n\r\n    export function SetPosition(editor, markup, position) {\r\n\r\n        EditAction.call(this, editor, 'SET-POSITION', markup.id);\r\n\r\n        this.newPosition = {x: position.x, y: position.y};\r\n        this.oldPosition = {x: markup.position.x, y: markup.position.y};\r\n    }\r\n\r\n    SetPosition.prototype = Object.create(EditAction.prototype);\r\n    SetPosition.prototype.constructor = SetPosition;\r\n\r\n    var proto = SetPosition.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        var markup = this.editor.getMarkup(this.targetId);\r\n        markup && markup.setPosition(this.newPosition.x, this.newPosition.y);\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        var markup = this.editor.getMarkup(this.targetId);\r\n        markup && markup.setPosition(this.oldPosition.x, this.oldPosition.y);\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param action\r\n     * @returns {boolean}\r\n     */\r\n    proto.merge = function(action) {\r\n\r\n        if (this.targetId === action.targetId &&\r\n            this.type === action.type) {\r\n\r\n            this.newPosition = action.newPosition;\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * @returns {boolean}\r\n     */\r\n    proto.isIdentity = function() {\r\n\r\n        var newPosition = this.newPosition;\r\n        var oldPosition = this.oldPosition;\r\n\r\n        return newPosition.x === oldPosition.x && newPosition.y === oldPosition.y;\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param markup\r\n     * @param angle\r\n     * @constructor\r\n     */\r\n    export function SetRotation(editor, markup, angle) {\r\n\r\n        EditAction.call(this, editor, 'SET-ROTATION', markup.id);\r\n\r\n        var curAngle = markup.getRotation();\r\n\r\n        this.newRotation = {angle: angle};\r\n        this.oldRotation = {angle: curAngle};\r\n    }\r\n\r\n    SetRotation.prototype = Object.create(EditAction.prototype);\r\n    SetRotation.prototype.constructor = SetRotation;\r\n\r\n    var proto = SetRotation.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        var markup = this.editor.getMarkup(this.targetId);\r\n        markup && markup.setRotation(this.newRotation.angle);\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        var markup = this.editor.getMarkup(this.targetId);\r\n        markup && markup.setRotation(this.oldRotation.angle);\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param action\r\n     * @returns {boolean}\r\n     */\r\n    proto.merge = function(action) {\r\n\r\n        if (this.targetId === action.targetId &&\r\n            this.type === action.type) {\r\n\r\n            this.newRotation = action.newRotation;\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * @returns {boolean}\r\n     */\r\n    proto.isIdentity = function() {\r\n\r\n        return this.newRotation.angle === this.oldRotation.angle;\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { EDIT_FRAME_DEFAULT_MARGIN, \r\n         addTraitEventDispatcher, isTouchDevice, degreesToRadians } from './MarkupsCoreUtils'\r\nimport * as MarkupEvents from './MarkupEvents'\r\nimport { CloneMarkup } from './edit-actions/CloneMarkup'\r\nimport { SetPosition } from './edit-actions/SetPosition'\r\nimport { SetSize } from './edit-actions/SetSize'\r\nimport { SetRotation } from './edit-actions/SetRotation'\r\n\r\n     var av = Autodesk.Viewing;\r\n     var avp = Autodesk.Viewing.Private;\r\n\r\n    /**\r\n     * A component to handle the selection of markups.\r\n     *\r\n     *\r\n     *      Sample\r\n     *\r\n     *      var containingDiv = document.getElementById('containingDiv3d-app-wrapper');\r\n     *      var selectionComponent = new EditFrame(containingDiv);\r\n     *      selectionComponent.setSelection(100, 100, 300, 150, 0);\r\n     *\r\n     * @param {HTMLElement} containingDiv The container where the selection layer will live.\r\n     * @param {Object} editor\r\n     * @constructor\r\n     */\r\n    export function EditFrame(containingDiv, editor) {\r\n\r\n        this.containingDiv = containingDiv;\r\n        this.editor = editor;\r\n        this.setGlobalManager(this.editor.viewer.globalManager);\r\n        this.selectionLayer = createSelectionLayer.bind(this)();\r\n\r\n        this.frameMargin = EDIT_FRAME_DEFAULT_MARGIN;\r\n\r\n        this.selection = {\r\n            x: 0,\r\n            y: 0,\r\n            width: 0,\r\n            height: 0,\r\n            rotation: 0,\r\n            element: null,\r\n            active: false,\r\n            dragging: false,\r\n            resizing: false,\r\n            //a dictionary of all the drag points\r\n            //the key for each drag point will be its cardinal/ordinal direction\r\n            handle: {}\r\n        };\r\n\r\n        createSelectorBox.bind(this)();\r\n\r\n        if (isTouchDevice()) {\r\n            this.hammer = new av.Hammer.Manager(this.selectionLayer, {\r\n                recognizers: [\r\n                    av.GestureRecognizers.drag,\r\n                    av.GestureRecognizers.doubletap,\r\n                    av.GestureRecognizers.doubletap2,\r\n                    av.GestureRecognizers.pan,\r\n                    av.GestureRecognizers.pinch\r\n                ],\r\n                handlePointerEventMouse: false,\r\n                inputClass: av.isIE11 ? av.Hammer.PointerEventInput : av.Hammer.TouchInput\r\n            });\r\n\r\n            this.onHammerDragBinded = this.onHammerDrag.bind(this);\r\n            this.onHammerDoubleTapBinded = this.onHammerDoubleTap.bind(this);\r\n            this.onTouchPanBinded = this.onTouchPan.bind(this);\r\n            this.onTouchPinchBinded = this.onTouchPinch.bind(this);\r\n\r\n            this.hammer.on(\"dragstart dragmove dragend\", this.onHammerDragBinded);\r\n            this.hammer.on(\"doubletap\", this.onHammerDoubleTapBinded);\r\n            this.hammer.on(\"doubletap2\", this.onHammerDoubleTapBinded);\r\n            this.hammer.on(\"panstart panmove panend\", this.onTouchPanBinded);\r\n            this.hammer.on(\"pinchstart pinchmove pinchend\", this.onTouchPinchBinded);\r\n\r\n            this.hammer.get('drag').requireFailure('pinch');\r\n            this.hammer.get('drag').requireFailure('pan');\r\n        }\r\n\r\n        handleSelectionBoxDragging.bind(this)();\r\n        handleSelectionBoxResizing.bind(this)();\r\n        handleSelectionDoubleClick.bind(this)();\r\n        handleSelectionBoxRotating.bind(this)();\r\n\r\n        //add the selection into the container given to us\r\n        this.containingDiv.appendChild(this.selectionLayer);\r\n\r\n        addTraitEventDispatcher(this);\r\n    }\r\n\r\n    av.GlobalManagerMixin.call(EditFrame.prototype);\r\n    var proto = EditFrame.prototype;\r\n\r\n    proto.unload = function() {\r\n\r\n        this.containingDiv.removeChild(this.selectionLayer);\r\n        this.selectionLayer = null;\r\n    };\r\n    /**\r\n     * Draws a selection box with the given attributes\r\n     *\r\n     * @param {number} x - The x coordinate to place the selection box\r\n     * @param {number} y - The y coordinate to place the selection box\r\n     * @param {number} width - The width of the selection box\r\n     * @param {number} height - The height of the selection box\r\n     * @param {number} rotation - The amount of degrees to rotate the selection box\r\n     */\r\n    proto.setSelection = function (x, y, width, height, rotation) {\r\n\r\n        var margin = this.frameMargin;\r\n        var doubleMargin = margin * 2;\r\n\r\n        updateSelectorBoxDimensions.bind(this)(width + doubleMargin, height + doubleMargin);\r\n        updateSelectorBoxPosition.bind(this)(x - margin, y - margin, rotation);\r\n        updateSelectionBoxState.bind(this)(true); //activate the selection box\r\n        this.selectionLayer.style.visibility = 'visible';\r\n    };\r\n\r\n    /**\r\n     * Displays the selection box based on the position, dimension, and rotation of a given markup\r\n     *\r\n     * @param {Autodesk.Viewing.Extensions.Markups.Core.Markup} markup - the markup that should appear as selected\r\n     */\r\n    proto.setMarkup = function (markup) {\r\n\r\n        this.hammer && this.hammer.set({enable: markup !== null});\r\n        this.markup = markup;\r\n\r\n        updateSelectionBoxState.bind(this)(false);\r\n\r\n        if (markup) {\r\n            var boundingBox = markup.getBoundingRect();\r\n            var rotation = markup.getRotation();\r\n            this.frameMargin = boundingBox.margin !== undefined ? boundingBox.margin : EDIT_FRAME_DEFAULT_MARGIN;\r\n\r\n            this.setSelection(boundingBox.x, boundingBox.y, boundingBox.width, boundingBox.height, rotation);\r\n\r\n            this.enableResizeHandles();\r\n            this.enableRotationHandle();\r\n\r\n            if (markup.preventReposition) {\r\n                this.selectionLayer.firstChild.style.cursor = '';\r\n            }\r\n            else {\r\n                this.selectionLayer.firstChild.style.cursor = 'move';\r\n            }\r\n        }\r\n    };\r\n\r\n    proto.startDrag = function (event) {\r\n\r\n        if (this.markup && this.markup.preventReposition) return;\r\n\r\n        this.onMouseMove = this._onRepositionMouseMove.bind(this);\r\n        this.onMouseUp = this._onRepositionMouseUp.bind(this);\r\n        this._onRepositionMouseDown(event, this.editor.getMousePosition());\r\n    };\r\n\r\n     proto.isActive = function() {\r\n        return this.selection.active;\r\n     };\r\n\r\n    proto.isDragging = function () {\r\n\r\n        return this.selection.dragging;\r\n    };\r\n\r\n    proto.isResizing = function () {\r\n\r\n        return this.selection.resizing;\r\n    };\r\n\r\n    proto.isRotating = function () {\r\n\r\n        return this.selection.rotating;\r\n    };\r\n\r\n    proto.onMouseMove = function (event) {\r\n\r\n        //dummy fn\r\n    };\r\n\r\n    proto.onMouseUp = function (event) {\r\n        //dummy fn\r\n    };\r\n\r\n    proto.onWheel = function (event) {\r\n        this.editor.viewer.toolController.mousewheel(event);\r\n    };\r\n\r\n    proto.onTouchPan = function(event) {\r\n        var gestureHandler = this.editor.viewer.toolController.getTool(\"gestures\");\r\n        gestureHandler.distributeGesture(event);\r\n        event.preventDefault();\r\n    };\r\n\r\n    proto.onTouchPinch = function(event) {\r\n        var gestureHandler = this.editor.viewer.toolController.getTool(\"gestures\");\r\n        gestureHandler.distributeGesture(event);\r\n        event.preventDefault();\r\n    };\r\n\r\n     proto.onHammerDrag = function(event) {\r\n\r\n         function updateEditorInput(input, parent, event) {\r\n\r\n             //TODO: Change this when refactoring input in edit frame.\r\n             var rect = parent.getBoundingClientRect();\r\n             input.mousePosition.x = event.pageX - rect.left;\r\n             input.mousePosition.y = event.pageY - rect.top;\r\n         }\r\n\r\n        //console.log('EditFrame drag ' + event.type);\r\n         convertEventHammerToMouse(event);\r\n         switch (event.type) {\r\n             case 'dragstart':\r\n                 updateEditorInput(this.editor.input, this.editor.svg, event);\r\n                 this.editor.callSnapperMouseDown();\r\n                 // Check whether to translate, rotate or resize\r\n                 if (isRotatePoint(event.target)) {\r\n                     // Rotate\r\n                     this._onRotationMouseDown(event);\r\n                 } else if (isDragPoint(event.target)) {\r\n                     // Resize\r\n                     this._onResizeMouseDown(event);\r\n                 } else {\r\n                     this.startDrag(event);\r\n                 }\r\n                 event.preventDefault();\r\n                 break;\r\n             case 'dragmove':\r\n                 updateEditorInput(this.editor.input, this.editor.svg, event);\r\n                 this.editor.callSnapperMouseMove();\r\n                 this.onMouseMove(event);\r\n                 event.preventDefault();\r\n                 break;\r\n             case 'dragend':\r\n                 updateEditorInput(this.editor.input, this.editor.svg, event);\r\n                 this.onMouseUp(event);\r\n                 event.preventDefault();\r\n                 break;\r\n         }\r\n     };\r\n\r\n    proto.onHammerDoubleTap = function(event) {\r\n\r\n        function updateEditorInput(input, parent, event) {\r\n\r\n            //TODO: Change this when refactoring input in edit frame.\r\n            var rect = parent.getBoundingClientRect();\r\n            input.mousePosition.x = event.pageX - rect.left;\r\n            input.mousePosition.y = event.pageY - rect.top;\r\n        }\r\n\r\n        convertEventHammerToMouse(event);\r\n        updateEditorInput(this.editor.input, this.editor.svg, event);\r\n\r\n        this.selection.dragging = false;\r\n        this.editor.editMode && this.editor.editMode.onMouseDoubleClick(this.markup);\r\n    };\r\n\r\n    proto.enableResizeHandles = function () {\r\n\r\n        var markup = this.markup;\r\n        var handle;\r\n\r\n        if (markup.isHeightConstrained() || markup.isWidthConstrained()) {\r\n            //hide all the handles\r\n            for (var direction in this.selection.handle) {\r\n                handle = this.selection.handle[direction];\r\n                if(handle) handle.style.display = 'none';\r\n            }\r\n\r\n            //show only the resize points that are allowed\r\n            if (!markup.isHeightConstrained()) {\r\n                this.selection.handle['n'].style.display = 'block';\r\n                this.selection.handle['s'].style.display = 'block';\r\n            }\r\n            if (!markup.isWidthConstrained()) {\r\n                this.selection.handle['w'].style.display = 'block';\r\n                this.selection.handle['e'].style.display = 'block';\r\n            }\r\n        } else {\r\n            //no constraints, show all resize handles\r\n            for (let direction in this.selection.handle) {\r\n                handle = this.selection.handle[direction];\r\n                if(handle) handle.style.display = 'block';\r\n            }\r\n        }\r\n    };\r\n\r\n    proto.enableRotationHandle = function () {\r\n\r\n        var markup = this.markup;\r\n        var display = markup.isRotationConstrained() ? 'none' : 'block';\r\n        this.selection.rotationHandle.style.display = display;\r\n        this.selection.rotationBridge.style.display = display;\r\n    };\r\n\r\n     function convertEventHammerToMouse(event) {\r\n         // Convert Hammer touch-event X,Y into mouse-event X,Y.\r\n         event.pageX = event.pointers[0].clientX;\r\n         event.pageY = event.pointers[0].clientY;\r\n     }\r\n\r\n    /**\r\n     * Creates an element spanning the full height and width of its parent.\r\n     * It serves as our surface to draw the selection box.\r\n     *\r\n     * @return {HTMLElement}\r\n     */\r\n    function createSelectionLayer() {\r\n\r\n        const _document = this.getDocument();\r\n        var selectionLayer = _document.createElement('div');\r\n        selectionLayer.style.position = 'absolute';\r\n        selectionLayer.style.top = 0;\r\n        selectionLayer.style.bottom = 0;\r\n        selectionLayer.style.left = 0;\r\n        selectionLayer.style.right = 0;\r\n        //don't let the selection box be visible outside the selection layer\r\n        selectionLayer.style.overflow = 'hidden';\r\n        selectionLayer.style.visibility = 'hidden';\r\n        togglePointerEvents(selectionLayer, false);\r\n        return selectionLayer;\r\n    }\r\n\r\n    /**\r\n     * Creates a single drag point with the corresponding styles\r\n     *\r\n     * @param {number} diameter - The size of the drag point\r\n     * @param {string} position - The cardinal(n, s, w, e) or ordinal(nw, nw, sw, se) direction of the point\r\n     * @return {HTMLElement}\r\n     */\r\n    function createDragPoint(position) {\r\n\r\n        const _document = this.getDocument();\r\n        var point = _document.createElement('div');\r\n\r\n        setResizeCursor(point, position);\r\n        point.className = 'selector-drag-point autodesk-markups-extension-core-make-me-bigger sdp-handle-' + position;\r\n        point.classList.add('adsk-viewing-viewer');\r\n        point.setAttribute('data-sdp-handle', position);\r\n\r\n        return point;\r\n    }\r\n\r\n    function createRotatePoint () {\r\n        const _document = this.getDocument();\r\n        var point = _document.createElement('div');\r\n        point.classList.add('adsk-viewing-viewer');\r\n        point.classList.add('selector-rotate-point');\r\n        point.classList.add('autodesk-markups-extension-core-make-me-bigger');\r\n        setResizeCursor(point, 'w');\r\n\r\n        return point;\r\n    }\r\n\r\n    function createRotationBridge() {\r\n        const _document = this.getDocument();\r\n        var rotationBridge = _document.createElement('div');\r\n        rotationBridge.classList.add('adsk-viewing-viewer');\r\n        rotationBridge.classList.add('selector-rotate-point');\r\n        rotationBridge.classList.add('autodesk-markups-extension-core-make-me-bigger');\r\n        rotationBridge.classList.add('rotation-bridge');\r\n        setResizeCursor(rotationBridge, 'w');\r\n\r\n        return rotationBridge;\r\n    }\r\n\r\n    function setResizeCursor (element, direction) {\r\n\r\n        var cursor;\r\n        switch(direction) {\r\n            case 'n':\r\n            case 's':\r\n                cursor = 'ns-resize';\r\n                break;\r\n            case 'w':\r\n            case 'e':\r\n                cursor = 'ew-resize';\r\n                break;\r\n            case 'ne':\r\n            case 'sw':\r\n                cursor = 'nesw-resize';\r\n                break;\r\n            case 'nw':\r\n            case 'se':\r\n                cursor = 'nwse-resize';\r\n                break;\r\n        }\r\n        element.style.cursor = cursor;\r\n    }\r\n\r\n    /**\r\n     * Creates the 8 drag points of the selection box.\r\n     *\r\n     * @this EditFrame\r\n     */\r\n    function createDragPoints(selector) {\r\n\r\n        ['n', 's', 'w', 'e', 'nw', 'ne', 'sw', 'se'].forEach(function (direction) {\r\n            //store the drag point and put it in the DOM\r\n            this.selection.handle[direction] = createDragPoint.call(this, direction);\r\n            selector.appendChild(this.selection.handle[direction]);\r\n        }.bind(this));\r\n    }\r\n\r\n    /**\r\n     * Determines if an element is a drag point\r\n     *\r\n     * @return {boolean}\r\n     */\r\n    function isDragPoint(element) {\r\n\r\n        return matchesSelectorAux(element, '.selector-drag-point');\r\n    }\r\n\r\n    /**\r\n     * Determines if an element is a rotate point\r\n     *\r\n     * @return {boolean}\r\n     */\r\n    function isRotatePoint(element) {\r\n\r\n        return matchesSelectorAux(element, '.selector-rotate-point');\r\n    }\r\n\r\n    /**\r\n     * Creates the element that will be used as the selection box. It also\r\n     * takes care of adding the drag handles\r\n     *\r\n     * @return {HTMLElement} - the selection box\r\n     * @this EditFrame\r\n     */\r\n    function createSelectorBox() {\r\n\r\n        const _document = this.getDocument();\r\n        var selectorBox = _document.createElement('div');\r\n        togglePointerEvents(selectorBox, true);\r\n        selectorBox.classList.add('selector-box');\r\n\r\n        this.selection.rotationBridge = createRotationBridge.bind(this)();\r\n        selectorBox.appendChild(this.selection.rotationBridge);\r\n\r\n        this.selection.rotationHandle = createRotatePoint.bind(this)();\r\n        selectorBox.appendChild(this.selection.rotationHandle);\r\n\r\n        createDragPoints.bind(this)(selectorBox);\r\n\r\n        //store the selector box\r\n        this.selection.element = selectorBox;\r\n\r\n        if (!av.isMobileDevice()) {\r\n            this.onWheelBinded = this.onWheel.bind(this);\r\n            this.selection.element.addEventListener('wheel', this.onWheelBinded);\r\n            this.selection.element.addEventListener('DOMMouseScroll', this.onWheelBinded); // firefox\r\n        }\r\n\r\n        //add the selection box to the selection layer\r\n        this.selectionLayer.appendChild(this.selection.element);\r\n\r\n        //we are just creating the box, start it out hidden\r\n        updateSelectionBoxState.bind(this)(false);\r\n\r\n        return selectorBox;\r\n    }\r\n\r\n    /**\r\n     * Utility to create the CSS translate3d value from a given 2d point\r\n     *\r\n     * @param {number} x - coordinate\r\n     * @param {number} y - coordinate\r\n     * @return {string}\r\n     */\r\n    function toTranslate3d(x, y) {\r\n\r\n        return 'translate3d(' + x + 'px,' + y + 'px,0)';\r\n    }\r\n\r\n\r\n    /**\r\n     * Updates the display state of the selection box\r\n     *\r\n     * @param {boolean} active - The new state of the the selection box\r\n     * @this EditFrame\r\n     */\r\n    function updateSelectionBoxState(active) {\r\n\r\n        this.selection.active = active;\r\n        this.selection.element.style.display = active ? 'block' : 'none';\r\n    }\r\n\r\n    /**\r\n     * Updates the position and rotation of the selection box.\r\n     *\r\n     * @param {number} x - The x coordinate to place the selection box\r\n     * @param {number} y - The y coordinate to place the selection box\r\n     * @param {number} rotation - The amount of degrees to rotate the selection box\r\n     * @this EditFrame\r\n     */\r\n    function updateSelectorBoxPosition(x, y, rotation) {\r\n\r\n        this.selection.x = x;\r\n        this.selection.y = y;\r\n        this.selection.rotation = rotation;\r\n        var size = this.markup.getBoundingRect();\r\n        //TODO: consider DomElementStyle\r\n\r\n        size.width += this.frameMargin * 2;\r\n        size.height += this.frameMargin * 2;\r\n\r\n        var transform = toTranslate3d(x, y) + ' rotate(' + rotation + 'rad)';\r\n        var transformOrigin = (size.width / 2) + 'px ' + (size.height / 2) + 'px';\r\n\r\n        this.selection.element.style.msTransform =\r\n            this.selection.element.style.webkitTransform =\r\n            this.selection.element.style.transform = transform;\r\n        this.selection.element.style.msTransformOrigin =\r\n            this.selection.element.style.webkitTransformOrigin =\r\n            this.selection.element.style.transformOrigin = transformOrigin;\r\n    }\r\n\r\n    /**\r\n     * Updates the dimensions of the selection box (width and height).\r\n     *\r\n     * @param {number} width - The new width of the selection box\r\n     * @param {number} height - The new height of the selection box\r\n     * @this EditFrame\r\n     */\r\n    function updateSelectorBoxDimensions(width, height) {\r\n\r\n        this.selection.width = width;\r\n        this.selection.height = height;\r\n        this.selection.element.style.width = width + 'px';\r\n        this.selection.element.style.height = height + 'px';\r\n    }\r\n\r\n    /**\r\n     * Attaches all the necessary listeners to handle a drag action.\r\n     *\r\n     * @this EditFrame\r\n     */\r\n    function handleSelectionBoxDragging () {\r\n\r\n        this.selection.element.addEventListener('mousedown', this._onRepositionMouseDown.bind(this));\r\n    }\r\n\r\n    /**\r\n     * Handles panning when right clicking down\r\n     * @param event\r\n     * @returns {boolean} returns true if the event was handled\r\n     * @private\r\n     */\r\n    proto._handleRightClickDown = function(event) {\r\n\r\n        if (!av.isMobileDevice() && (avp.isRightClick(event, this.editor.viewer.navigation) || avp.isMiddleClick(event))) {\r\n            this.editor.input.onMouseDownRightClick(event);\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    };\r\n\r\n    var ignoreFirstMouseMove = false;\r\n    proto._onRepositionMouseDown = function (event, cursor) {\r\n\r\n        if (this._handleRightClickDown(event))\r\n            return;\r\n\r\n        // Return for markups that are not allowed to be repositioned.\r\n        if (this.markup && this.markup.preventReposition) return;\r\n\r\n        // ignore the first mouse move for the Microsoft Surface\r\n        ignoreFirstMouseMove = !av.isMobileDevice() && av.isTouchDevice();\r\n        //a synthetic start means that the event was triggered manually and not as a\r\n        //result of a mousedown on the edit frame\r\n        const _window = this.getWindow();\r\n        var syntheticStart = !(event instanceof _window.MouseEvent);\r\n\r\n        //during a real mousedown, ignore events originating from a resizing handle\r\n        if (!syntheticStart && (isDragPoint(event.target) || isRotatePoint(event.target))) return;\r\n\r\n        //get the cursor position\r\n        cursor = syntheticStart ?  cursor : this.editor.getMousePosition();\r\n\r\n        //store the initial cursor and axis constrains\r\n        this.initialCursor = cursor;\r\n        this.initialPosition = this.markup.getClientPosition();\r\n        this.areAxisConstrained = false;\r\n        this.axisConstrains = new THREE.Vector2(1,1);\r\n\r\n        //update the function that will handle the mousemove and mouseup events\r\n        this.onMouseMove = this._onRepositionMouseMove.bind(this);\r\n        this.onMouseUp = this._onRepositionMouseUp.bind(this);\r\n\r\n        if (this.selection.dragging)\r\n            return;\r\n\r\n        this.selection.dragging = true;\r\n        this.editor.beginActionGroup();\r\n\r\n        //if alt down I drop a clone.\r\n        if (event && event.altKey) {\r\n            var editor = this.editor;\r\n            var cloneMarkup = new CloneMarkup(editor, editor.getId(), this.markup, this.markup.position);\r\n            cloneMarkup.execute();\r\n        }\r\n\r\n        this.dispatchEvent({ type: MarkupEvents.EVENT_EDITFRAME_EDITION_START }); // Moving around\r\n    };\r\n\r\n    proto._onRepositionMouseMove = function(event) {\r\n\r\n        // This check is needed for selecting markups on devices that have touch screen + mouse (eg: Microsoft Surface)\r\n        if (ignoreFirstMouseMove) {\r\n            ignoreFirstMouseMove = false;\r\n            return false;\r\n        }\r\n        //ignore mousemove events if the dragging state hasn't been activated\r\n        if (!this.selection.dragging || !this.markup || this.markup.preventReposition) return false;\r\n\r\n        //get the position of the cursor relative to selection layer\r\n        var cursor = this.editor.getMousePosition();\r\n\r\n        //constrain axis if shift key is down.\r\n        var constrainAxis = this.editor.input.constrainAxis;\r\n        if (this.areAxisConstrained !== constrainAxis) {\r\n            this.areAxisConstrained = constrainAxis;\r\n            this.axisConstrains = constrainAxis ? new THREE.Vector2(0, 0) : new THREE.Vector2(1,1);\r\n\r\n            this.initialPosition.x += cursor.x - this.initialCursor.x;\r\n            this.initialPosition.y += cursor.y - this.initialCursor.y;\r\n\r\n            this.initialCursor.x = cursor.x;\r\n            this.initialCursor.y = cursor.y;\r\n        }\r\n\r\n        //determine how many pixel we have to shift the\r\n        //selection box to keep the cursor on the drag point\r\n        var movement = {\r\n            x: cursor.x - this.initialCursor.x,\r\n            y: cursor.y - this.initialCursor.y\r\n        };\r\n\r\n        var deadZone = 15;\r\n        if (this.axisConstrains.x === 0 && this.axisConstrains.y === 0) {\r\n\r\n            if (Math.abs(movement.x) > deadZone) {\r\n                this.axisConstrains.x = 1;\r\n                movement.x += movement.x < 0 ?  deadZone : -deadZone;\r\n            } else\r\n            if (Math.abs(movement.y) > deadZone) {\r\n                this.axisConstrains.y = 1;\r\n                movement.y += movement.y < 0 ?  deadZone : -deadZone;\r\n            }\r\n        }\r\n\r\n        var x = this.initialPosition.x + movement.x * this.axisConstrains.x;\r\n        var y = this.initialPosition.y + movement.y * this.axisConstrains.y;\r\n\r\n        updateSelectorBoxPosition.bind(this)(x, y, this.selection.rotation);\r\n\r\n        //tell the markup to start transforming\r\n        //the markup expects an (x, y) coordinate that\r\n        //uses an origin at the center, adjust our x, y because\r\n        //our origin starts at the top left\r\n        var position = this.editor.positionFromClientToMarkups(x, y);\r\n        var setPosition = new SetPosition(this.editor, this.markup, position);\r\n        setPosition.execute();\r\n        return true;\r\n    };\r\n\r\n    proto._onRepositionMouseUp = function () {\r\n\r\n        if (this.markup && this.markup.preventReposition) return;\r\n\r\n        this.last = null;\r\n\r\n        //this should never be called after the mouse up because we are no longer repositioning\r\n        this.onMouseMove = function () {/*do nothing*/};\r\n        this.onMouseUp = function () {/*do nothing*/};\r\n\r\n        if(!this.selection.dragging) {\r\n            return;\r\n        }\r\n\r\n        this.editor.closeActionGroup();\r\n        this.selection.dragging = false;\r\n        this.dispatchEvent({ type: MarkupEvents.EVENT_EDITFRAME_EDITION_END }); // Moving around\r\n    };\r\n\r\n    proto._onResizeMouseDown = function (event) {\r\n\r\n        if (this._handleRightClickDown(event))\r\n            return;\r\n\r\n        var target = event.target;\r\n\r\n        //is the target where the mousedown occurred a drag point\r\n        if (!isDragPoint(target)) {\r\n            return;\r\n        }\r\n\r\n        //keep a reference to the point where the drag started\r\n        this.selection.handle.resizing = target;\r\n        //figure out which direction this point should resize\r\n        var direction = this.selection.handle.resizing.getAttribute('data-sdp-handle');\r\n        //set the cursor position for the entire layer\r\n        this.containingDiv.style.cursor = direction + '-resize';\r\n\r\n        var cursor = this.editor.getMousePosition();\r\n\r\n        var position = this.markup.getClientPosition();\r\n        var size = this.markup.getBoundingRect();\r\n\r\n        //store the center\r\n        this.initial = {\r\n            x: position.x,\r\n            y: position.y,\r\n            width: size.width,\r\n            height: size.height,\r\n            mouseX: cursor.x,\r\n            mouseY: cursor.y\r\n        };\r\n\r\n        this.onMouseMove = this._onResizeMouseMove.bind(this);\r\n        this.onMouseUp = this._onResizeMouseUp.bind(this);\r\n\r\n        if (this.selection.resizing) {\r\n            return;\r\n        }\r\n\r\n        this.selection.resizing = true;\r\n        this.editor.beginActionGroup();\r\n\r\n        setHandleSelected(event.target, true);\r\n\r\n        //notify the markup that dragging has started\r\n        this.dispatchEvent({ type: MarkupEvents.EVENT_EDITFRAME_EDITION_START }); // Resizing\r\n    };\r\n\r\n    proto._onResizeMouseMove = function (event) {\r\n\r\n        if (!this.selection.resizing) return false;\r\n\r\n        var cursor = this.editor.getMousePosition();\r\n        var initial = this.initial;\r\n\r\n        var movement = {\r\n            x: cursor.x - initial.mouseX,\r\n            y: cursor.y - initial.mouseY\r\n        };\r\n\r\n        var vector = new THREE.Vector3(movement.x, movement.y, 0);\r\n        var undoRotation = new THREE.Matrix4().makeRotationZ(-this.selection.rotation);\r\n        movement = vector.applyMatrix4(undoRotation);\r\n\r\n        var x = initial.x,\r\n            y = initial.y,\r\n            width = initial.width,\r\n            height = initial.height;\r\n\r\n        var localSpaceDelta = new THREE.Vector3();\r\n\r\n        //get the direction of the arrow being dragged\r\n        var direction = this.selection.handle.resizing.getAttribute('data-sdp-handle');\r\n\r\n        // TODO: Make a mechanism to configure and use this feature from Markups Core.\r\n        // If shift is pressed, figure aspect ratio is maintained.\r\n        if (this.editor.input.keepAspectRatio && ['nw', 'ne', 'sw', 'se'].indexOf(direction) !== -1) {\r\n\r\n            var delta = new THREE.Vector3(movement.x, movement.y, 0);\r\n            switch (direction){\r\n                case 'nw': movement.set(-initial.width,-initial.height, 0); break;\r\n                case 'ne': movement.set( initial.width,-initial.height, 0); break;\r\n                case 'sw': movement.set( initial.width,-initial.height, 0); break;\r\n                case 'se': movement.set( initial.width, initial.height, 0); break;\r\n            }\r\n            movement.normalize();\r\n            movement = delta.projectOnVector(movement);\r\n        }\r\n\r\n        var translations = {\r\n            n: function () {\r\n                height -= movement.y;\r\n                localSpaceDelta.y = movement.y;\r\n            },\r\n            s: function () {\r\n                height += movement.y;\r\n                localSpaceDelta.y = movement.y;\r\n            },\r\n            w: function () {\r\n                width -= movement.x;\r\n                localSpaceDelta.x = movement.x;\r\n            },\r\n            e: function () {\r\n                width += movement.x;\r\n                localSpaceDelta.x = movement.x;\r\n            },\r\n            nw: function () {\r\n                this.n();\r\n                this.w();\r\n            },\r\n            ne: function () {\r\n                this.n();\r\n                this.e();\r\n            },\r\n            sw: function () {\r\n                this.s();\r\n                this.w();\r\n            },\r\n            se: function () {\r\n                this.s();\r\n                this.e();\r\n            }\r\n        };\r\n\r\n        translations[direction]();\r\n\r\n        // Check if new size is smaller than min width or height\r\n        if (width <= this.markup.getMinWidth() || height <= this.markup.getMinHeight()) return;\r\n\r\n        var redoRotation = new THREE.Matrix4().makeRotationZ(this.selection.rotation);\r\n        var actualDelta = localSpaceDelta.applyMatrix4(redoRotation);\r\n\r\n        var newPos = this.editor.positionFromClientToMarkups(\r\n            x + (actualDelta.x * 0.5),\r\n            y + (actualDelta.y * 0.5));\r\n\r\n        var newSize = this.editor.sizeFromClientToMarkups(width, height);\r\n\r\n        var setSize = new SetSize(this.editor, this.markup, newPos, newSize.x, newSize.y);\r\n        setSize.execute();\r\n        return true;\r\n    };\r\n\r\n    function setHandleSelected (handle, isSelected) {\r\n        if (isSelected) {\r\n            handle.classList.add('selected');\r\n        } else {\r\n            handle.classList.remove('selected');\r\n        }\r\n    }\r\n\r\n    proto._onResizeMouseUp = function (event) {\r\n        this.selection.resizing = false;\r\n        this.selection.handle.resizing = null;\r\n        this.containingDiv.style.cursor = '';\r\n\r\n        for (var direction in this.selection.handle) {\r\n            if (this.selection.handle[direction]) {\r\n                setHandleSelected(this.selection.handle[direction], false);\r\n            }\r\n        }\r\n\r\n\r\n        this.editor.closeActionGroup();\r\n        this.dispatchEvent({ type: MarkupEvents.EVENT_EDITFRAME_EDITION_END }); // Resizing\r\n\r\n        //this should never be called after the mouse up because we are no longer resizing\r\n        this.onMouseMove = function () {/*do nothing*/\r\n        };\r\n        this.onMouseUp = function () {/*do nothing*/\r\n        };\r\n    };\r\n\r\n\r\n    /**\r\n     * Attaches all the necessary listeners to handle a resizing action.\r\n     *\r\n     * @this EditFrame\r\n     */\r\n    function handleSelectionBoxResizing() {\r\n        this.selectionLayer.addEventListener('mousedown', this._onResizeMouseDown.bind(this));\r\n    }\r\n\r\n    function handleSelectionBoxRotating () {\r\n\r\n        this.selection.element.addEventListener('mousedown', this._onRotationMouseDown.bind(this));\r\n    }\r\n\r\n    var initialRotation;\r\n    var initialHandlePosition;\r\n\r\n    proto._onRotationMouseDown = function (event) {\r\n\r\n        if (this._handleRightClickDown(event))\r\n            return;\r\n\r\n        //ignore anything not coming from the rotation point\r\n        if (!isRotatePoint(event.target)) return;\r\n\r\n        this.editor.beginActionGroup();\r\n        this.selection.rotating = true;\r\n\r\n        //store the initial cursor\r\n        initialHandlePosition = this.editor.getMousePosition();\r\n\r\n        initialRotation = this.selection.rotation || 0;\r\n\r\n        //update the function that will handle the mousemove and mouseup events\r\n        this.onMouseMove = this._onRotationMouseMove.bind(this);\r\n        this.onMouseUp = this._onRotationMouseUp.bind(this);\r\n\r\n        setHandleSelected(event.target, true);\r\n\r\n        this.dispatchEvent({ type: MarkupEvents.EVENT_EDITFRAME_EDITION_START }); // Rotating\r\n    };\r\n\r\n     proto._onRotationMouseMove = function (event) {\r\n\r\n        //ignore mousemove events if the dragging state hasn't been activated\r\n        if (!this.selection.rotating) return false;\r\n\r\n        var cursor = this.editor.getMousePosition();\r\n        var position = this.markup.getClientPosition();\r\n\r\n        var r = getAngleBetweenPoints(position, cursor);\r\n        var r2 = getAngleBetweenPoints(position, initialHandlePosition);\r\n        var rotation = r - r2 + initialRotation;\r\n\r\n        // TODO: Make a mechanism to configure and use this feature from Markups Core.\r\n        if (this.editor.input.snapRotations) {\r\n            var snap = degreesToRadians(22.5);\r\n            rotation = Math.ceil(rotation / snap) * snap;\r\n        }\r\n\r\n         //pass rotation as degrees\r\n         updateSelectorBoxPosition.bind(this)(this.selection.x, this.selection.y, rotation);\r\n\r\n        //convert to radians\r\n        var setRotation = new SetRotation(this.editor, this.markup, rotation);\r\n        setRotation.execute();\r\n        return true;\r\n    };\r\n\r\n    proto._onRotationMouseUp = function (event) {\r\n\r\n        this.selection.rotating = false;\r\n        initialRotation = null;\r\n        initialHandlePosition = null;\r\n        setHandleSelected(this.selection.rotationHandle, false);\r\n        this.editor.closeActionGroup();\r\n        this.dispatchEvent({ type: MarkupEvents.EVENT_EDITFRAME_EDITION_END }); // Rotating\r\n    };\r\n\r\n    /**\r\n     * Attaches double click listener and pass events to markup, markups such as text use it to enter text edit\r\n     * mode.\r\n     *\r\n     * @this EditFrame\r\n     */\r\n    function handleSelectionDoubleClick() {\r\n\r\n        var doubleClick = function (event) {\r\n            if (event.defaultPrevented) {\r\n                return;\r\n            }\r\n            this.selection.dragging = false;\r\n            var editMode = this.editor.editMode;\r\n            editMode && editMode.onMouseDoubleClick(this.markup);\r\n        }.bind(this);\r\n\r\n        var selectorBoxWrapper = this.selectionLayer;\r\n        selectorBoxWrapper.addEventListener('dblclick', doubleClick);\r\n    }\r\n\r\n    function togglePointerEvents(element, state) {\r\n\r\n        element.style.pointerEvents = state ? 'auto' : 'none';\r\n    }\r\n\r\n    function getAngleBetweenPoints (p1, p2) {\r\n\r\n        return Math.atan2(p2.y - p1.y, p2.x - p1.x);\r\n    }\r\n\r\n     function matchesSelectorAux(domElem, selector) {\r\n         if (domElem.matches) return domElem.matches(selector); //Un-prefixed\r\n         if (domElem.msMatchesSelector) return domElem.msMatchesSelector(selector);  //IE\r\n         if (domElem.mozMatchesSelector) return domElem.mozMatchesSelector(selector); //Firefox (Gecko)\r\n         if (domElem.webkitMatchesSelector) return domElem.webkitMatchesSelector(selector); // Opera, Safari, Chrome\r\n         return false;\r\n     }\r\n","'use strict';\r\n\r\n    var avp = Autodesk.Viewing.Private;\r\n\r\n    export function MarkupTool() {\r\n\r\n        Autodesk.Viewing.ToolInterface.call(this);\r\n        this.names = [\"markups.core\"];\r\n        this.panTool = null;\r\n        this.allowNav = false;\r\n        this.is2d = false;\r\n\r\n        this.coreExt = null;\r\n        this.hotkeysEnabled = true;\r\n\r\n        var _ctrlDown = false;\r\n        var _shiftDown = false;\r\n\r\n        // Non-ToolInterface methods //\r\n\r\n        this.allowNavigation = function(allow) {\r\n            this.allowNav = allow;\r\n        };\r\n        this.setCoreExtension = function(coreExt) {\r\n            this.coreExt = coreExt;\r\n        };\r\n        this.setHotkeysEnabled = function(enabled) {\r\n            this.hotkeysEnabled = enabled;\r\n        };\r\n\r\n\r\n        // ToolInterface methods //\r\n\r\n        this.activate = function(name, viewerApi) {\r\n            this.panTool = viewerApi.toolController.getTool(\"pan\");\r\n            if (this.panTool) {\r\n                this.panTool.activate(\"pan\"); // TODO: What if we want \"zoom\" here?\r\n            }\r\n\r\n            this.is2d = viewerApi.model.is2d();\r\n            this.viewer = viewerApi;\r\n        };\r\n\r\n        this.deactivate = function(name) {\r\n            if (this.panTool) {\r\n                this.panTool.deactivate(\"pan\");\r\n            }\r\n        };\r\n\r\n        this.handleKeyDown = function(event, keyCode) {\r\n\r\n            if (!this.coreExt.editMode) {\r\n                return false;\r\n            }\r\n\r\n            if (!this.hotkeysEnabled) {\r\n                return true; // Consume event\r\n            }\r\n\r\n            // Don't propagate key handling down to tool //\r\n\r\n            switch (keyCode) {\r\n                case Autodesk.Viewing.KeyCode.CONTROL: _ctrlDown = true; break;\r\n                case Autodesk.Viewing.KeyCode.SHIFT: _shiftDown = true; break;\r\n\r\n                case Autodesk.Viewing.KeyCode.x: _ctrlDown && !this.allowNav && this.coreExt.cut(); break;\r\n                case Autodesk.Viewing.KeyCode.c: _ctrlDown && !this.allowNav && this.coreExt.copy(); break;\r\n                case Autodesk.Viewing.KeyCode.v: _ctrlDown && !this.allowNav && this.coreExt.paste(); break;\r\n                case Autodesk.Viewing.KeyCode.d:\r\n                    if (_ctrlDown && !this.allowNav) {\r\n                        // Duplicate\r\n                        this.coreExt.copy();\r\n                        this.coreExt.paste();\r\n                    }\r\n                    break;\r\n                case Autodesk.Viewing.KeyCode.z:\r\n                    if (_ctrlDown && !_shiftDown && !this.allowNav) {\r\n                        this.coreExt.undo();\r\n                    }\r\n                    else if (_ctrlDown && _shiftDown && !this.allowNav) {\r\n                        this.coreExt.redo(); // Also support Ctrl+Y\r\n                    }\r\n                    break;\r\n                case Autodesk.Viewing.KeyCode.y: _ctrlDown && !this.allowNav && this.coreExt.redo(); break; // Also support ctrl+shift+z\r\n                case Autodesk.Viewing.KeyCode.ESCAPE: this.coreExt.onUserCancel(); break;\r\n\r\n                case Autodesk.Viewing.KeyCode.BACKSPACE: // Fall through\r\n                case Autodesk.Viewing.KeyCode.DELETE:\r\n                    var selectedMarkup = this.coreExt.getSelection();\r\n                    if (selectedMarkup) {\r\n                        this.coreExt.deleteMarkup(selectedMarkup);\r\n                    }\r\n                    break;\r\n                case Autodesk.Viewing.KeyCode.F12:\r\n                    return false; // To allow opening developer console.\r\n\r\n                default: break;\r\n            }\r\n\r\n            return true; // Consume event\r\n        };\r\n        this.handleKeyUp = function(event, keyCode) {\r\n\r\n            if (!this.coreExt.editMode) {\r\n                return false;\r\n            }\r\n\r\n            if (!this.hotkeysEnabled) {\r\n                return true; // Consume event\r\n            }\r\n\r\n            // Don't propagate key handling down to tool\r\n\r\n            switch (keyCode) {\r\n                case Autodesk.Viewing.KeyCode.CONTROL: _ctrlDown = false; break;\r\n                case Autodesk.Viewing.KeyCode.SHIFT: _shiftDown = false; break;\r\n                default: break;\r\n            }\r\n\r\n            return true; // Consume event ONLY\r\n        };\r\n\r\n        this.update = function() {\r\n            if (this.allowNav && this.panTool && this.panTool.update) {\r\n                return this.panTool.update();\r\n            }\r\n            return false;\r\n        };\r\n\r\n        this.handleSingleClick = function( event, button ) {\r\n            if (this.allowNav) {\r\n                // If pan tool won't handle single click, then pass over the event.\r\n                if (this.panTool && this.panTool.handleSingleClick)\r\n                    return this.panTool.handleSingleClick(event, button);\r\n                else\r\n                    return false;\r\n            }\r\n            return true; // Consume event\r\n        };\r\n        this.handleDoubleClick = function( event, button ) {\r\n            if (this.allowNav) {\r\n                // If pan tool won't handle double click, then pass over the event\r\n                if (this.panTool && this.panTool.handleDoubleClick) {\r\n                    return this.panTool.handleDoubleClick(event, button);\r\n                }\r\n                else\r\n                    return false;\r\n            }\r\n            return true; // Consume event\r\n        };\r\n        this.handleSingleTap = function( event ) {\r\n            if (this.allowNav) {\r\n                // If pan tool won't handle single tap, then pass over the event\r\n                if (this.panTool && this.panTool.handleSingleTap) {\r\n                    return this.panTool.handleSingleTap(event);\r\n                }\r\n                else\r\n                    return false;\r\n            }\r\n            return true; // Consume event\r\n        };\r\n        this.handleDoubleTap = function( event ) {\r\n            if (this.allowNav) {\r\n                // If pan tool won't handle double tap, then pass over the event\r\n                if (this.panTool && this.panTool.handleDoubleTap) {\r\n                    return this.panTool.handleDoubleTap(event);\r\n                }\r\n                else\r\n                    return false;\r\n            }\r\n            return true; // Consume event\r\n        };\r\n        this.handleWheelInput = function(delta, event) {\r\n            if (this.allowNav || this.is2d) {\r\n                // If pan tool won't handle wheel input, then pass over the event\r\n                if (this.panTool && this.panTool.handleWheelInput) {\r\n                    this.coreExt.callSnapperMouseMove();\r\n                    return this.panTool.handleWheelInput(delta, event);\r\n                }\r\n                else\r\n                    return false;\r\n            }\r\n            return true; // Consume event\r\n        };\r\n        this.handleButtonDown = function(event, button) {\r\n            if (this.allowNav || (this.is2d && (avp.isRightClick(event, this.viewer.navigation) || avp.isMiddleClick(event)))) {\r\n                // If pan tool won't handle button down, then pass over the event\r\n                if (this.panTool && this.panTool.handleButtonDown) {\r\n                    return this.panTool.handleButtonDown(event, button);\r\n                }\r\n                else\r\n                    return false;\r\n            }\r\n            return true; // Consume event\r\n        };\r\n        this.handleButtonUp = function(event, button) {\r\n            if (this.allowNav || (this.is2d && (avp.isRightClick(event, this.viewer.navigation) || avp.isMiddleClick(event)))) {\r\n                // If pan tool won't handle button up, then pass over the event\r\n                if (this.panTool && this.panTool.handleButtonUp) {\r\n                    return this.panTool.handleButtonUp(event, button);\r\n                }\r\n                else\r\n                    return false;\r\n            }\r\n            return true; // Consume event\r\n        };\r\n        this.handleMouseMove = function(event) {\r\n            if (this.allowNav || this.is2d) {\r\n                // If pan tool won't handle button move, then pass over the event\r\n                if (this.panTool && this.panTool.handleMouseMove) {\r\n                    return this.panTool.handleMouseMove(event);\r\n                }\r\n                else\r\n                    return false;\r\n            }\r\n            return true; // Consume event\r\n        };\r\n        this.handleGesture = function(event) {\r\n            if (this.allowNav || this.is2d) {\r\n                // If pan tool won't handle gesture, then pass over the event\r\n                if (this.panTool && this.panTool.handleGesture) {\r\n                    return this.panTool.handleGesture(event);\r\n                }\r\n                else\r\n                    return false;\r\n            }\r\n            return true; // Consume event\r\n        };\r\n        this.handleBlur = function(event) {\r\n            if (this.allowNav) {\r\n                // If pan tool won't handle blur, then pass over the event\r\n                if (this.panTool && this.panTool.handleBlur) {\r\n                    return this.panTool.handleBlur(event);\r\n                }\r\n                else\r\n                    return false;\r\n            }\r\n            return true; // Consume event\r\n        };\r\n    }\r\n","\r\n// Maps EditMode id (string) into a contructor/class\r\nvar _editModes = {};\r\n\r\nclass EditModeManager {\r\n    constructor(){\r\n        // nothing //\r\n    }\r\n\r\n    register(id, clazz) {\r\n        if (id in _editModes)\r\n            throw new Error(`EditMode with id (${id}) already registered.`);\r\n        \r\n            _editModes[id] = clazz;\r\n    }\r\n\r\n    unregister(id) {\r\n        if (id in _editModes)\r\n            delete _editModes[id];\r\n    }\r\n\r\n    getClass(id) {\r\n        return _editModes[id] || null;\r\n    }\r\n\r\n    getRegistered() {\r\n        var ret = {}\r\n        for (var id in _editModes) {\r\n            if (_editModes.hasOwnProperty(id)) {\r\n                ret[id] = _editModes[id];\r\n            }\r\n        }\r\n        return ret; // shallow copy.\r\n    }\r\n}\r\n\r\n\r\nexport var theEditModeManager =  new EditModeManager();","\r\nimport { theEditModeManager } from '../EditModeManager'\r\nimport * as MarkupTypes from '../MarkupTypes'\r\n\r\nimport { EditModeArrow } from './EditModeArrow'\r\nimport { EditModeText } from './EditModeText'\r\nimport { EditModeRectangle } from './EditModeRectangle'\r\nimport { EditModeCircle } from './EditModeCircle'\r\nimport { EditModeCloud } from './EditModeCloud'\r\nimport { EditModeFreehand } from './EditModeFreehand'\r\nimport { EditModeHighlight } from './EditModeHighlight'\r\nimport { EditModePolyline } from './EditModePolyline'\r\nimport { EditModePolycloud } from './EditModePolycloud'\r\nimport { EditModeCallout } from './EditModeCallout'\r\nimport { EditModeDimension } from './EditModeDimension'\r\nimport { EditModeStamp } from './EditModeStamp'\r\n\r\n\r\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_ARROW, EditModeArrow);\r\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_TEXT, EditModeText);\r\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_RECTANGLE, EditModeRectangle);\r\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_CIRCLE, EditModeCircle);\r\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_CLOUD, EditModeCloud);\r\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_FREEHAND, EditModeFreehand);\r\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_HIGHLIGHT, EditModeHighlight);\r\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_POLYLINE, EditModePolyline);\r\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_POLYCLOUD, EditModePolycloud);\r\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_CALLOUT, EditModeCallout);\r\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_DIMENSION, EditModeDimension);\r\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_STAMP, EditModeStamp);\r\n\r\n","\n      import API from \"!../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../node_modules/css-loader/dist/cjs.js!./Markups.css\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../node_modules/css-loader/dist/cjs.js!./Markups.css\";\n       export default content && content.locals ? content.locals : undefined;\n","'use strict';\r\n\r\nimport { EditActionManager } from './edit-actions/EditActionManager'\r\nimport * as MarkupEvents from './MarkupEvents'\r\nimport * as MarkupTypes from './MarkupTypes'\r\nimport { addTraitEventDispatcher, createSvgElement, setSvgParentAttributes,\r\n    MARKUP_DEFAULT_STROKE_WIDTH_IN_PIXELS, MARKUP_DEFAULT_FONT_WIDTH_IN_PIXELS,\r\n    hideLmvUi, restoreLmvUi, dismissLmvHudMessage, \r\n    removeAllMetadata, transferChildNodes, addSvgMetadata,\r\n    svgNodeToString, checkPolygon, stringToSvgNode, createMarkupFromSVG,\r\n    worldToClient, clientToWorld } from './MarkupsCoreUtils'\r\nimport { cloneStyle, copyStyle, createStyle } from './StyleUtils'\r\nimport { DomElementStyle } from './DomElementStyle'\r\nimport { Clipboard } from './edit-clipboard/Clipboard'\r\nimport { InputHandler } from './edit-input/InputHandler'\r\nimport { EditFrame } from './EditFrame'\r\nimport { MarkupTool } from './MarkupTool'\r\nimport { EditModeArrow } from './edit-modes/EditModeArrow'\r\n\r\nimport * as Blah from './edit-modes/BuiltinEditModes' // IMPORTANT!! HAS SIDE EFFECTS\r\nimport CSS from './Markups.css' // IMPORTANT!!\r\n\r\n\r\n    var MeasureCommon = Autodesk.Viewing.MeasureCommon;\r\n\r\n    var PERSPECTIVE_MODE_SCALE = 1000;\r\n\r\n    /**\r\n     * Extension that allows end users to draw 2D markups on top of 2D and 3D models.\r\n     *\r\n     * @tutorial feature_markup\r\n     * @param {Autodesk.Viewing.Viewer3D} viewer - Viewer instance used to operate on.\r\n     * @param {object} options - Same Dictionary object passed into {@link Autodesk.Viewing.Viewer3D|Viewer3D}'s constructor.\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#show|show()}.\r\n     * @param {boolean} [options.markupDisableHotkeys] - Disables hotkeys for copy, cut, paste, duplicate, undo, redo and deselect.\r\n     * @param {Autodesk.Viewing.ToolInterface} [options.markupToolClass] - Class override for input handling.\r\n     * Use it to override/extend default hotkeys and/or mouse/gesture input.\r\n     * @memberof Autodesk.Viewing.Extensions.Markups.Core\r\n     * @constructor\r\n     */\r\n    export function MarkupsCore(viewer, options) {\r\n\r\n        Autodesk.Viewing.Extension.call(this, viewer, options);\r\n\r\n        this.options = this.options || {};\r\n        this.markups = [];\r\n        this.styles = {};\r\n\r\n        this.activeLayer = '';\r\n        this.duringViewMode = false;\r\n        this.duringEditMode = false;\r\n\r\n        this.svgLayersMap = {};\r\n\r\n        // Add action manager.\r\n        this.actionManager = new EditActionManager( 50 ); // history of 50 actions.\r\n        this.actionManager.addEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onEditActionHistoryChanged.bind(this));\r\n\r\n        this.nextId = 0; // Used to identify markups by id during an edit session.\r\n\r\n        // Clipboard.\r\n        this.clipboard = new Clipboard(this);\r\n\r\n        // Default Input handler.\r\n        this.input = new InputHandler();\r\n        this.input.setGlobalManager(this.globalManager);\r\n\r\n        // Bind functions so they have access to globalManager\r\n        this.createSvgElement = createSvgElement.bind(this);\r\n        this.addSvgMetadata = addSvgMetadata.bind(this);\r\n        this.checkPolygon = checkPolygon.bind(this);\r\n\r\n        // Extension will dispatch events.\r\n        addTraitEventDispatcher(this);\r\n\r\n        viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT, function() {\r\n            this.getStrokeWidth();\r\n            this.getFontWidth();\r\n        }.bind(this), { once: true });\r\n\r\n        // Handled events.\r\n        this.onCameraChangeBinded = this.onCameraChange.bind(this);\r\n        this.onViewerResizeBinded = function(event) {\r\n            // This is ugly, but we need to do this twice\r\n            var self = this;\r\n            // First usage is to avoid a blinking scenario\r\n            self.onViewerResize(event);\r\n            requestAnimationFrame(function(){\r\n                // Second one is to actually make it work on some resize scenarios.\r\n                // Check the unlikely scenario that we are no longer in view mode.\r\n                if (self.duringViewMode) {\r\n                    self.onViewerResize(event);\r\n                }\r\n            });\r\n        }.bind(this);\r\n\r\n        this.onMarkupSelectedBinded = this.onMarkupSelected.bind(this);\r\n        this.onMarkupEnterEditionBinded = this.onMarkupEnterEdition.bind(this);\r\n        this.onMarkupCancelEditionBinded = this.onMarkupCancelEdition.bind(this);\r\n        this.onMarkupDeleteEditionBinded = this.onMarkupDeleteEdition.bind(this);\r\n        this.onToolChangeBinded = this.onToolChange.bind(this);\r\n        this.onUnitsCalibrationStartsBinded = this.onUnitsCalibrationStarts.bind(this);\r\n\r\n        viewer.addEventListener(MeasureCommon.Events.UNITS_CALIBRATION_STARTS_EVENT, this.onUnitsCalibrationStartsBinded);\r\n    }\r\n\r\n    MarkupsCore.prototype = Object.create(Autodesk.Viewing.Extension.prototype);\r\n    MarkupsCore.prototype.constructor = MarkupsCore;\r\n\r\n    var proto = MarkupsCore.prototype;\r\n\r\n    proto.load = async function () {\r\n\r\n        // Add layer where annotations will actually live\r\n        var svg = this.svg = this.createSvgElement('svg');\r\n        setSvgParentAttributes(svg);\r\n\r\n        // NOTE: Required since LMV renders Y coordinates upwards,\r\n        // while browser's Y coordinates goes downwards.\r\n        var svgStyle = new DomElementStyle();\r\n        svgStyle.setAttribute('position', 'absolute');\r\n        svgStyle.setAttribute('left', '0');\r\n        svgStyle.setAttribute('top', '0');\r\n        svgStyle.setAttribute('transform', 'scale(1,-1)', { allBrowsers: true});\r\n        svgStyle.setAttribute('transformOrigin', '0, 0', { allBrowsers: true});\r\n        svg.setAttribute('style', svgStyle.getStyleString());\r\n\r\n        this.bounds = {x:0, y:0, width:0, height:0};\r\n\r\n        this.input.attachTo(this);\r\n\r\n        //Instantiate edit frame.\r\n        this.editFrame = new EditFrame(this.viewer.container, this);\r\n        this.editFrame.addEventListener(MarkupEvents.EVENT_EDITFRAME_EDITION_START, function(){this.disableMarkupInteractions(true);}.bind(this));\r\n        this.editFrame.addEventListener(MarkupEvents.EVENT_EDITFRAME_EDITION_END, function(){this.disableMarkupInteractions(false);}.bind(this));\r\n\r\n        // Register tool\r\n        var toolClass = this.options.markupToolClass || MarkupTool;\r\n        this.changeMarkupTool(toolClass, !this.options.markupDisableHotkeys);\r\n\r\n        await this.viewer.loadExtension('Autodesk.Snapping');\r\n\r\n        this.snapper = new Autodesk.Viewing.Extensions.Snapping.Snapper(this.viewer, {markupMode:true});\r\n        this.viewer.toolController.registerTool(this.snapper);\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Change the markup tool's class in order to implement a different behaviour to the UI.\r\n     * @param {Autodesk.Viewing.Extensions.Markups.Core.MarkupTool} toolClass - Implementation or extension of MarkupTool's class.\r\n     * @param {boolean} enableHotKeys - Whether to enable markup's hot-keys or not.\r\n     */\r\n    proto.changeMarkupTool = function(toolClass, enableHotKeys) {\r\n        if (this.markupTool) {\r\n            this.viewer.toolController.deregisterTool(this.markupTool);\r\n            this.markupTool = null;\r\n        }\r\n\r\n        this.markupTool = new toolClass();\r\n        this.markupTool.setCoreExtension(this);\r\n        this.markupTool.setHotkeysEnabled(enableHotKeys);\r\n        this.viewer.toolController.registerTool(this.markupTool);\r\n    };\r\n\r\n    proto.unload = function() {\r\n\r\n        this.hide();\r\n\r\n        this.input.detachFrom(this);\r\n\r\n        this.editFrame.unload();\r\n\r\n        if (this.markupTool) {\r\n            this.viewer.toolController.deregisterTool(this.markupTool);\r\n            this.markupTool = null;\r\n        }\r\n\r\n        if (this.snapper) {\r\n            this.viewer.toolController.deregisterTool(this.snapper);\r\n            this.snapper = null;\r\n        }\r\n\r\n        var svg = this.svg;\r\n        if (svg && this.onMouseDownBinded) {\r\n            svg.removeEventListener(\"mousedown\", this.onMouseDownBinded);\r\n            this.onMouseDownBinded = null;\r\n        }\r\n        if (svg.parentNode) {\r\n            svg.parentNode.removeChild(svg);\r\n        }\r\n        this.editModeSvgLayerNode = null;\r\n        this.svg = null;\r\n\r\n        return true;\r\n    };\r\n\r\n    MarkupsCore.prototype.getStrokeWidth = function() {\r\n        \r\n        if (!this.initialStrokeWidth || (this.viewer.model && !this.viewer.model.is2d())) {\r\n            this.initialStrokeWidth = this.sizeFromClientToMarkups(0, MARKUP_DEFAULT_STROKE_WIDTH_IN_PIXELS).y;\r\n        }\r\n\r\n        return this.initialStrokeWidth;\r\n    };\r\n\r\n    MarkupsCore.prototype.getFontWidth = function() {\r\n        \r\n        if (!this.initialFontWidth || (this.viewer.model && !this.viewer.model.is2d())) {\r\n            this.initialFontWidth = this.sizeFromClientToMarkups(0, MARKUP_DEFAULT_FONT_WIDTH_IN_PIXELS).y;\r\n        }\r\n\r\n        return this.initialFontWidth;\r\n    };\r\n\r\n    /**\r\n     * Toggle in and out of Edit mode. In Edit mode the user is able to draw markups on the canvas.\r\n     *\r\n     * See also\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#enterEditMode|enterEditMode()} and\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#leaveEditMode|leaveEditMode()}\r\n     */\r\n    MarkupsCore.prototype.toggleEditMode = function() {\r\n\r\n        if (this.duringEditMode) {\r\n            this.leaveEditMode();\r\n        } else {\r\n            this.enterEditMode();\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Enables mouse interactions and mobile device gestures over the Viewer canvas to create or draw markups.\r\n     *\r\n     * Exit Edit mode by calling {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#leaveEditMode|leaveEditMode()}.\r\n     *\r\n     * See also\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#show|show()}\r\n     * @param {string} layerId - [optional] Identifier for the layer of markups to be edited. Example \"Layer1\".\r\n     * @returns {boolean} Returns true if editMode is active\r\n     */\r\n    MarkupsCore.prototype.enterEditMode = function(layerId) {\r\n\r\n        function disableLayerMarkups(layer, disable){\r\n            if (layer){\r\n                var layerMarkups = layer.markups;\r\n                for (var k = 0; k < layerMarkups.length; k++){\r\n                    var m = layerMarkups[k];\r\n                    m.disableInteractions(disable);\r\n                }\r\n            }\r\n        }\r\n        if (layerId) {\r\n            if (!this.svgLayersMap[layerId]) {\r\n                // if layerId is supplied but it does not exist in the svgLayerMap then create the new layer\r\n                console.warn(\"No such layer exists.\");\r\n                return false;\r\n            }\r\n        }\r\n\r\n        // If not currently shown, then show\r\n        if (!this.duringViewMode) {\r\n            if (!this.show()){\r\n                return false; // Failed to enter view mode.\r\n            }\r\n        }\r\n\r\n        // Initialize the edit mode layer if it does not exist\r\n        if(!this.editModeSvgLayerNode) {\r\n            var parSvg = this.createSvgElement('g');\r\n            this.editModeSvgLayerNode = {\r\n                markups: [],\r\n                svg: parSvg\r\n            };\r\n            this.editModeSvgLayerNode.svg.setAttribute('cursor', 'default');\r\n        }\r\n\r\n\r\n        if ((this.editModeSvgLayerNode.svg.parentNode != this.svg) || !layerId) {\r\n            this.svg.appendChild(this.editModeSvgLayerNode.svg);\r\n        }\r\n        this.svg.setAttribute('cursor', 'crosshair');\r\n\r\n\r\n        if (layerId) {\r\n            var layer = this.svgLayersMap[layerId];\r\n            // If the layer exists in the layer map, use the information stored for that specific layer.\r\n            if (layer) {\r\n                // Remove the edit layer when entering edit mode of a specific edit mode.\r\n                var editModeLayerParentNode = this.editModeSvgLayerNode.svg.parentNode;\r\n                editModeLayerParentNode && editModeLayerParentNode.removeChild(this.editModeSvgLayerNode.svg);\r\n\r\n                // disable the markups in the editModeLayer\r\n                disableLayerMarkups(this.editModeSvgLayerNode, true);\r\n\r\n                // Enable interactions for markups in the current edit layer and disable interactions for markups in\r\n                // the other layers.\r\n                for (var key in this.svgLayersMap){\r\n                    var markups = this.svgLayersMap[key].markups;\r\n                    for (var i = 0; i < markups.length; i++) {\r\n                        var markup = markups[i];\r\n                        if (key !== layerId.toString()){\r\n                            // disable all not in the current layer.\r\n                            markup.disableInteractions(true);\r\n                        } else {\r\n                            // enable all markups in current layer.\r\n                            markup.disableInteractions(false);\r\n                        }\r\n                    }\r\n                }\r\n\r\n                // assign the current layer to the global active layer\r\n                this.activeLayer = layerId;\r\n                this.editingLayer = layerId;\r\n                var svgParent = layer.svg;\r\n\r\n                // remove previous svg layer child from svg\r\n                svgParent.parentNode && this.svg.removeChild(svgParent);\r\n\r\n                // reassign the markups in that layer to the global markups list\r\n                this.markups = layer.markups.slice();\r\n\r\n                // re-append svg layer child to svg to make it the top most layer\r\n                this.svg.appendChild(svgParent);\r\n            }\r\n        } else {\r\n            // disable interactions for the previous markups\r\n            // Example: enterEditMode(layer) -> enterEditMode()\r\n            if (this.editingLayer) {\r\n                for (var k = 0; k < this.markups.length; k++) {\r\n                    var m = this.markups[k];\r\n                    m.disableInteractions(true);\r\n                }\r\n                disableLayerMarkups(this.editModeSvgLayerNode, false);\r\n            }\r\n            this.editingLayer = '';\r\n            if (!this.editModeSvgLayerNode) {\r\n                this.markups = [];\r\n            }else{\r\n                this.markups = this.editModeSvgLayerNode.markups.slice();\r\n            }\r\n            this.activeLayer = '';\r\n        }\r\n\r\n        this.input.enterEditMode();\r\n        this.activateTool(true);\r\n        this.styles = {}; // Clear EditMode styles.\r\n        this.defaultStyle = null;\r\n        this.duringEditMode = true;\r\n        this.changeEditMode(new EditModeArrow(this));\r\n        this.actionManager.clear();\r\n        this.dispatchEvent({ type: MarkupEvents.EVENT_EDITMODE_ENTER });\r\n        this.allowNavigation(false);\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Exits Edit mode.\r\n     *\r\n     * See also {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#enterEditMode|enterEditMode()}.\r\n     *\r\n     * @returns {boolean} Returns true if Edit mode has been deactivated\r\n     */\r\n    MarkupsCore.prototype.leaveEditMode = function() {\r\n\r\n        var NOT_IN_EDIT_MODE = true;\r\n        var WE_ARE_STILL_IN_EDIT_MODE = false;\r\n\r\n        if (!this.duringEditMode || !this.duringViewMode) {\r\n            return NOT_IN_EDIT_MODE;\r\n        }\r\n\r\n        var viewer = this.viewer;\r\n        if (!viewer) {\r\n            return WE_ARE_STILL_IN_EDIT_MODE; // something is very wrong...\r\n        }\r\n\r\n        this.editMode.destroy();\r\n        this.editMode = null;\r\n        this.duringEditMode = false;\r\n\r\n        if (this.snapper) {\r\n            this.snapper.indicator.clearOverlays();\r\n            this.snapper.clearSnapped();\r\n        }\r\n\r\n        // Remove the edit layer\r\n        if (this.editModeSvgLayerNode && this.editModeSvgLayerNode.svg.parentNode){\r\n            this.svg.removeChild(this.editModeSvgLayerNode.svg);\r\n        }\r\n        this.svg.setAttribute('cursor', 'default');\r\n\r\n        this.input.leaveEditMode();\r\n        this.editFrame.setMarkup(null);\r\n        this.activateTool(true);\r\n\r\n        this.allowNavigation(true);\r\n        this.dispatchEvent({ type: MarkupEvents.EVENT_EDITMODE_LEAVE });\r\n        return NOT_IN_EDIT_MODE;\r\n    };\r\n\r\n    /**\r\n     * Toggle between visible markups, i.e., show() and hidden markups, i.e., hide().\r\n     */\r\n    MarkupsCore.prototype.toggle = function() {\r\n\r\n        if (this.duringViewMode) {\r\n            this.hide();\r\n        } else {\r\n            this.show();\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Enables loading of previously saved markups.\r\n     * Exit Edit mode by calling {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#hide|hide()}.\r\n     *\r\n     * See also\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#enterEditMode|enterEditMode()}.\r\n     * @returns {boolean} Whether it successfully entered view mode or not.\r\n     */\r\n    MarkupsCore.prototype.show = function() {\r\n\r\n        var viewer = this.viewer;\r\n        if (!viewer || !viewer.model || !this.svg) {\r\n            return false;\r\n        }\r\n\r\n        // Return if already showing or in edit-mode.\r\n        // Notice that edit mode requires that we are currently show()-ing.\r\n        if (this.duringViewMode || this.duringEditMode) {\r\n            return true;\r\n        }\r\n\r\n        viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT, this.onCameraChangeBinded);\r\n        viewer.addEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT, this.onViewerResizeBinded);\r\n\r\n        // Add parent svg of all markups.\r\n        viewer.container.appendChild(this.svg);\r\n        viewer.reorderElements(this.svg);\r\n\r\n        this.input.enterViewMode();\r\n        hideLmvUi(viewer);\r\n\r\n        // TODO: Nasty hack, currently there is no API to disable mouse highlighting in 3d models.\r\n        // TODO: We nuke rollover function in viewer, for now, public api will be added soon.\r\n        this.onViewerRolloverObject = viewer.impl.rolloverObject;\r\n        viewer.impl.rolloverObject = function(){};\r\n\r\n        this.activateTool(true);\r\n        var camera = viewer.impl.camera;\r\n        this.onViewerResize({ width: camera.clientWidth, height: camera.clientHeight });\r\n\r\n        // See function loadMarkups() for when the actual SVG gets added onstage //\r\n        this.svgLayersMap = {};\r\n        this.duringViewMode = true;\r\n        this.allowNavigation(true);\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Removes any markup currently overlaid on the viewer. It exits Edit mode if it is active.\r\n     *\r\n     * See also\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#show|show()}\r\n     * @returns {boolean} Whether it successfully left view mode or not.\r\n     */\r\n    MarkupsCore.prototype.hide = function() {\r\n\r\n        var RESULT_HIDE_OK = true;\r\n        var RESULT_HIDE_FAIL = false;\r\n\r\n        var viewer = this.viewer;\r\n        if (!viewer || !this.duringViewMode) {\r\n            return RESULT_HIDE_OK;\r\n        }\r\n\r\n        if (this.duringEditMode) {\r\n            if (!this.leaveEditMode()) {\r\n                return RESULT_HIDE_FAIL;\r\n            }\r\n        }\r\n\r\n        viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT, this.onCameraChangeBinded);\r\n        viewer.removeEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT, this.onViewerResizeBinded);\r\n\r\n        var svg = this.svg;\r\n        svg.parentNode && svg.parentNode.removeChild(svg);\r\n\r\n        // Remove all Markups and metadata (if any)\r\n        this.unloadMarkupsAllLayers();\r\n        removeAllMetadata(svg);\r\n\r\n        this.input.leaveViewMode();\r\n        restoreLmvUi(viewer);\r\n        this.viewer.impl.rolloverObject = this.onViewerRolloverObject;\r\n\r\n        this.activateTool(false);\r\n        this.duringViewMode = false;\r\n        return RESULT_HIDE_OK;\r\n    };\r\n\r\n    /**\r\n     * Removes newly created markups in the current editing layer.\r\n     * Markups that were created in a specific layer will not be removed.\r\n     *\r\n     * Markups should have been added while in\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#enterEditMode|Edit mode}.\r\n     */\r\n    MarkupsCore.prototype.clear = function() {\r\n        // Can only clear specific layers when in the edit mode of that layer.\r\n        if (!this.duringEditMode) {\r\n            console.warn(\"Clear only removes markups when in Edit Mode.\");\r\n            return;\r\n        }\r\n        var editModeLayer = this.editingLayer ? this.svgLayersMap[this.editingLayer] : this.editModeSvgLayerNode;\r\n        if (editModeLayer) {\r\n            var markups = editModeLayer.markups;\r\n            var svg = editModeLayer.svg;\r\n            if (svg && svg.childNodes.length > 0) {\r\n                while (svg.childNodes.length) {\r\n                    svg.removeChild(svg.childNodes[0]);\r\n                }\r\n            }\r\n            while (markups.length > 0) {\r\n                var markup = markups[0];\r\n                this.removeMarkup(markup);\r\n                markup.destroy();\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Returns an SVG string with the markups created so far.\r\n     * The SVG string can be reloaded using\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#loadMarkups|loadMarkups()}.\r\n     *\r\n     * Markups should have been added while in\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#enterEditMode|Edit mode}.\r\n     * @returns {string} Returns an SVG element with all of the created markups in a string format.\r\n     */\r\n    MarkupsCore.prototype.generateData = function() {\r\n\r\n        var defaultLayer = this.editModeSvgLayerNode.svg;\r\n\r\n        if (this.editMode) {\r\n            this.editMode.onSave();\r\n        }\r\n\r\n        // Sanity check, remove any lingering metadata nodes\r\n        removeAllMetadata(this.svg);\r\n\r\n        if (this.activeLayer){\r\n            defaultLayer = this.svgLayersMap[this.activeLayer].svg;\r\n        }\r\n\r\n        var tmpNode = this.createSvgElement(\"svg\");\r\n        transferChildNodes(this.svg, tmpNode); // Transfer includes this.editModeSvgLayerNode\r\n        transferChildNodes(defaultLayer, this.svg);\r\n\r\n        // version 1: first implementation.\r\n        // version 2: added global offset to markup positions.\r\n        // version 3: change node structure to include hitareas, hit areas are not exported.\r\n        // version 4: scale perspective markups space by PERSPECTIVE_MODE_SCALE because bug in firefox. LMV-1150\r\n        var metadataObject = {\r\n            \"data-model-version\": \"4\"\r\n        };\r\n        var metadataNode = this.addSvgMetadata(this.svg, metadataObject);\r\n        var metadataNodes = [ metadataNode ];\r\n\r\n        // Notify each markup to inject metadata\r\n        this.markups.forEach(function(markup){\r\n            var addedNode = markup.setMetadata();\r\n            if (addedNode) {\r\n                metadataNodes.push(addedNode);\r\n            }\r\n        });\r\n\r\n        // Generate the data!\r\n        var data = svgNodeToString(this.svg);\r\n\r\n        // Remove metadataObject before returning\r\n        metadataNodes.forEach(function(metadataNode){\r\n            metadataNode.parentNode.removeChild(metadataNode);\r\n        });\r\n\r\n        transferChildNodes(this.svg, defaultLayer);\r\n        transferChildNodes(tmpNode, this.svg);\r\n        tmpNode = null; // get rid of it.\r\n\r\n        return  data;\r\n    };\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    MarkupsCore.prototype.generatePoints3d = function() {\r\n\r\n        var result = {markups: [], main: null};\r\n        var markups = this.markups;\r\n        var markupsCount = markups.length;\r\n\r\n        if (markupsCount === 0) {\r\n            return result;\r\n        }\r\n\r\n        // Gather a 3d point for markup.\r\n        var idTarget = this.viewer.impl.renderer().readbackTargetId();\r\n        for(let i = 0; i < markupsCount; ++i) {\r\n\r\n            var markup = markups[i];\r\n            var point = markup.generatePoint3d(idTarget) || null;\r\n            result.markups.push(\r\n                {\r\n                    id: markup.id,\r\n                    type: markup.type,\r\n                    point: point || null\r\n                });\r\n        }\r\n\r\n\r\n        // If there is 3d point associated with an arrow, we use that as main point.\r\n        if (markupsCount === 1) {\r\n\r\n            var main = result.markups[0].point;\r\n            result.main = main && main.clone();\r\n            return result;\r\n        }\r\n\r\n        for(let i = 0; i < markupsCount; ++i) {\r\n\r\n            var collision = result.markups[i];\r\n            if (collision.type === MarkupTypes.MARKUP_TYPE_ARROW && collision.point !== null) {\r\n\r\n                result.main = collision.point.clone();\r\n                return result;\r\n            }\r\n        }\r\n\r\n        // If there is no arrows, we average bounding boxes and get a 3d point inside it.\r\n        var bbX0 = Number.POSITIVE_INFINITY;\r\n        var bbY0 = Number.POSITIVE_INFINITY;\r\n        var bbX1 = Number.NEGATIVE_INFINITY;\r\n        var bbY1 = Number.NEGATIVE_INFINITY;\r\n\r\n        for(let i = 0; i < markupsCount; ++i) {\r\n\r\n            var boundingBox = markups[i].generateBoundingBox();\r\n\r\n            bbX0 = Math.min(bbX0, boundingBox.min.x);\r\n            bbY0 = Math.min(bbY0, boundingBox.min.y);\r\n            bbX1 = Math.max(bbX1, boundingBox.max.x);\r\n            bbY1 = Math.max(bbY1, boundingBox.max.y);\r\n        }\r\n\r\n        var polygon = {};\r\n\r\n        polygon.vertexCount = 4;\r\n        polygon.xVertices = new Float32Array([bbX0, bbX1, bbX1, bbX0]);\r\n        polygon.yVertices = new Float32Array([bbY0, bbY0, bbY1, bbY1]);\r\n\r\n        var point2d = this.checkPolygon(polygon, idTarget);\r\n        var point3d = point2d && this.viewer.clientToWorld(point2d.x, point2d.y);\r\n        result.main = point3d && point3d.point;\r\n\r\n        return result;\r\n    };\r\n\r\n    /**\r\n     * Renders the markups onto a 2D canvas context to generate an image.\r\n     * @param {CanvasRenderingContext2D} context - Markups are drawn using the context provided\r\n     */\r\n    MarkupsCore.prototype.renderToCanvas = function(context, callback, renderAllMarkups) {\r\n\r\n        var width = this.bounds.width;\r\n        var height = this.bounds.height;\r\n        var viewBox = this.getSvgViewBox(width, height);\r\n        var numberOfScreenshotsTaken = 0;\r\n        var markups = [];\r\n        var layer;\r\n\r\n        var onMarkupScreenshotTaken = function () {\r\n            if (callback && (++numberOfScreenshotsTaken === markups.length)) {\r\n                callback();\r\n            }\r\n        }.bind(this);\r\n\r\n        if (renderAllMarkups) {\r\n            var svgKeys = Object.keys(this.svg.childNodes);\r\n            var layersKeys = Object.keys(this.svgLayersMap);\r\n\r\n            // Append only markups that their parent layer is contained inside the svg main container.\r\n            for (var i = 0; i < svgKeys.length; i++) {                \r\n                for (var j = 0; j < layersKeys.length; j++) {\r\n                    layer = this.svgLayersMap[layersKeys[j]];\r\n                    if (this.svg.childNodes[svgKeys[i]] === layer.svg) {\r\n                        markups = markups.concat(layer.markups);\r\n                    }\r\n                }\r\n            }\r\n        } else {\r\n            layer = this.svgLayersMap[this.activeLayer] || this.editModeSvgLayerNode;\r\n            markups = layer.markups;\r\n        }\r\n\r\n        if (markups.length === 0) {\r\n            callback();\r\n        } else {\r\n            markups.forEach(function(markup) {\r\n                markup.renderToCanvas(context, viewBox, width, height, onMarkupScreenshotTaken);\r\n            });\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Changes the active drawing tool. For example, from the Arrow drawing tool to the Rectangle drawing tool.\r\n     * Only applicable while in {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#enterEditMode|Edit mode}.\r\n     *\r\n     * Supported values are:\r\n     * - `new Autodesk.Viewing.Extensions.Markups.Core.EditModeArrow(MarkupsCoreInstance)`\r\n     * - `new Autodesk.Viewing.Extensions.Markups.Core.EditModeRectangle(MarkupsCoreInstance)`\r\n     * - `new Autodesk.Viewing.Extensions.Markups.Core.EditModeCircle(MarkupsCoreInstance)`\r\n     * - `new Autodesk.Viewing.Extensions.Markups.Core.EditModeCloud(MarkupsCoreInstance)`\r\n     * - `new Autodesk.Viewing.Extensions.Markups.Core.EditModeText(MarkupsCoreInstance)`\r\n     * - `new Autodesk.Viewing.Extensions.Markups.Core.EditModeFreehand(MarkupsCoreInstance)`\r\n     * - `new Autodesk.Viewing.Extensions.Markups.Core.EditModePolyline(MarkupsCoreInstance)`\r\n     * - `new Autodesk.Viewing.Extensions.Markups.Core.EditModePolycloud(MarkupsCoreInstance)`\r\n     *\r\n     * This function fires event `Autodesk.Viewing.Extensions.Markups.Core.EVENT_EDITMODE_CHANGED`.\r\n     * @param {Object} editMode - Object instance for the drawing tool\r\n     */\r\n    MarkupsCore.prototype.changeEditMode = function(editMode) {\r\n\r\n        var oldEditMode = this.editMode;\r\n        oldEditMode && oldEditMode.destroy();\r\n\r\n        editMode.addEventListener(MarkupEvents.EVENT_EDITMODE_CREATION_BEGIN, function() {this.disableMarkupInteractions(true);}.bind(this));\r\n        editMode.addEventListener(MarkupEvents.EVENT_EDITMODE_CREATION_END, function(){this.disableMarkupInteractions(false);}.bind(this));\r\n        editMode.addEventListener(MarkupEvents.EVENT_MARKUP_DESELECT, function(event){this.dispatchEvent(event);}.bind(this));\r\n\r\n        this.editMode = editMode;\r\n        this.styles[editMode.type] = cloneStyle(editMode.getStyle());\r\n\r\n        this.dispatchEvent({type:MarkupEvents.EVENT_EDITMODE_CHANGED, target: editMode});\r\n    };\r\n\r\n    /**\r\n     * Check whether a user can perform camera navigation operations on the current loaded model.\r\n     * While the extension is active, the user can still draw markups.\r\n     * Panning and zooming are only supported for orthographic cameras.\r\n     *\r\n     * @return {boolean} Whether {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#allowNavigation|allowNavigation()} can succeed.\r\n     */\r\n    MarkupsCore.prototype.isNavigationAllowed = function() {\r\n\r\n        return !this.viewer.impl.camera.isPerspective;\r\n    };\r\n\r\n    /**\r\n     * Enables click, tap, and swipe behavior to allow camera zoom and panning operations. It is only available in\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#enterEditMode|Edit mode}.\r\n     *\r\n     * @param {boolean} allow - Whether camera navigation interactions are active or not.\r\n     */\r\n    MarkupsCore.prototype.allowNavigation = function(allow) {\r\n\r\n        //we will still need to update the markup styles even if in perspective mode\r\n        var editMode = this.editMode;\r\n        this.navigating = allow;\r\n\r\n        if (allow){\r\n            this.svg.setAttribute(\"pointer-events\", \"none\");\r\n            editMode && this.selectMarkup(null);\r\n        } else {\r\n            this.svg.setAttribute(\"pointer-events\", \"painted\");\r\n        }\r\n\r\n        // Update pointer events for all markups.\r\n        var markups = this.markups;\r\n        var markupsCount = markups.length;\r\n\r\n        for(var i = 0; i < markupsCount; ++i) {\r\n            markups[i].updateStyle();\r\n        }\r\n        editMode && editMode.notifyAllowNavigation(allow);\r\n\r\n        // Navigation is not allowed while in perspective mode.\r\n        if (allow && (this.duringEditMode || this.duringViewMode) && !this.isNavigationAllowed()) {\r\n            return false;\r\n        }\r\n\r\n        // Clear snapper.\r\n        if (allow && this.snapper) {\r\n            this.snapper.indicator.clearOverlays();\r\n            this.snapper.clearSnapped();\r\n        }\r\n\r\n        this.markupTool.allowNavigation(allow);\r\n\r\n    };\r\n\r\n    /**\r\n     * Sets mouse interactions and mobile device gestures with markups. Only applicable in\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#enterEditMode|Edit mode}.\r\n     * @param {boolean} disable - true to disable interactions with markups; false to enable interactions with markups; default false.\r\n     */\r\n    MarkupsCore.prototype.disableMarkupInteractions = function(disable) {\r\n\r\n        if (this.editModeSvgLayerNode) {\r\n            this.editModeSvgLayerNode.svg.setAttribute('cursor', disable ? 'inherit' : 'default');\r\n        }\r\n        this.markups.forEach(function(markup) {markup.disableInteractions(disable);});\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param isActive\r\n     * @private\r\n     */\r\n    MarkupsCore.prototype.activateTool = function(isActive) {\r\n        if (isActive) {\r\n            if (!this.cachedNavigationTool) {\r\n                this.cachedNavigationTool = this.viewer.getActiveNavigationTool();\r\n                this.viewer.addEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT, this.onToolChangeBinded);\r\n            }\r\n            this.viewer.setActiveNavigationTool(this.markupTool.getName());\r\n        } else {\r\n\r\n            if (this.cachedNavigationTool) {\r\n                this.viewer.setActiveNavigationTool(this.cachedNavigationTool);\r\n                this.cachedNavigationTool = null;\r\n            } else {\r\n                var defaultToolName = this.viewer.getDefaultNavigationToolName();\r\n                this.viewer.setActiveNavigationTool(defaultToolName);\r\n            }\r\n\r\n            this.viewer.removeEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT, this.onToolChangeBinded);\r\n        }\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param event\r\n     * @private\r\n     */\r\n    MarkupsCore.prototype.onToolChange = function(event) {\r\n\r\n        if (event.toolName !== this.markupTool.getName())\r\n            return;\r\n\r\n        if (event.active) {\r\n            var navAllowed = this.isNavigationAllowed();\r\n            this.viewer.setNavigationLockSettings({\r\n                pan      : navAllowed,\r\n                zoom     : navAllowed,\r\n                orbit    : false,\r\n                roll     : false,\r\n                fov      : false,\r\n                walk     : false,\r\n                gotoview : false\r\n            });\r\n        }\r\n        this.viewer.setNavigationLock(event.active);\r\n    };\r\n\r\n    MarkupsCore.prototype.onUnitsCalibrationStarts = function() {\r\n        if (this.duringEditMode) {\r\n            this.hide();\r\n        }\r\n    };\r\n\r\n    //// Input /////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n    proto.changeInputHandler = function(inputHandler) {\r\n\r\n        this.input.detachFrom(this);\r\n        inputHandler.attachTo(this);\r\n        this.input = inputHandler;\r\n\r\n        if (this.duringEditMode) {\r\n            inputHandler.enterEditMode();\r\n        }\r\n\r\n        if (this.duringViewMode) {\r\n            inputHandler.enterViewMode();\r\n        }\r\n    };\r\n\r\n    //// Copy and Paste System /////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n    /**\r\n     * Standard copy operation. Applies to any selected markup.<br>\r\n     * See also\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#cut|cut()} and\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#paste|paste()}.\r\n     */\r\n    MarkupsCore.prototype.copy = function() {\r\n\r\n        this.clipboard.copy();\r\n    };\r\n\r\n    /**\r\n     * Standard cut operation. Applies to any selected markup, which gets removed from the screen at call time.<br>\r\n     * See also\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#copy|copy()} and\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#paste|paste()}.\r\n     */\r\n    MarkupsCore.prototype.cut = function() {\r\n\r\n        this.clipboard.cut();\r\n    };\r\n\r\n    /**\r\n     * Standard paste operation. This function will paste any previously copied or cut markup.\r\n     * Can be called repeatedly after a single copy or cut operation.<br>\r\n     * See also\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#copy|copy()} and\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#cut|cut()}.\r\n     */\r\n    MarkupsCore.prototype.paste = function() {\r\n\r\n        this.clipboard.paste();\r\n    };\r\n\r\n    //// Undo and Redo System //////////////////////////////////////////////////////////////////////////////////////////\r\n    /**\r\n     * Will undo the previous operation.<br>\r\n     * The Undo/Redo stacks will track any change done to the existing markups.<br>\r\n     * See also\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#redo|redo()} and\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#isUndoStackEmpty|isUndoStackEmpty()}.\r\n     */\r\n    MarkupsCore.prototype.undo = function() {\r\n\r\n        this.actionManager.undo();\r\n    };\r\n\r\n    /**\r\n     * Will redo any previously undo operation.<br>\r\n     * See also\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#undo|undo()},\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#isRedoStackEmpty|isRedoStackEmpty()}.\r\n     */\r\n    MarkupsCore.prototype.redo = function() {\r\n\r\n        this.actionManager.redo();\r\n    };\r\n\r\n    /**\r\n     * Returns true when {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#undo|undo()}\r\n     * produces no changes.\r\n     * @return {boolean} true if there are no changes to undo; false if there are changes to undo.\r\n     */\r\n    MarkupsCore.prototype.isUndoStackEmpty = function() {\r\n\r\n        return this.actionManager.isUndoStackEmpty();\r\n    };\r\n\r\n    /**\r\n     * Returns true when {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#redo|redo()}\r\n     * produces no changes.\r\n     * @return {boolean} true if there are no changes to redo; false if there are changes to redo.\r\n     */\r\n    MarkupsCore.prototype.isRedoStackEmpty = function() {\r\n\r\n        return this.actionManager.isRedoStackEmpty();\r\n    };\r\n\r\n    proto.beginActionGroup = function() {\r\n\r\n        this.actionManager.beginActionGroup();\r\n    };\r\n\r\n    proto.closeActionGroup = function() {\r\n\r\n        this.actionManager.closeActionGroup();\r\n    };\r\n\r\n    proto.cancelActionGroup = function() {\r\n\r\n        this.actionManager.cancelActionGroup();\r\n    };\r\n\r\n    /**\r\n     * Helper function for generating unique markup ids.\r\n     * @returns {number}\r\n     */\r\n    proto.getId = function() {\r\n\r\n        return ++this.nextId;\r\n    };\r\n\r\n    /**\r\n     * @param event\r\n     * @private\r\n     */\r\n    proto.onEditActionHistoryChanged = function(event) {\r\n\r\n        var data = event.data;\r\n        if((data.action !== 'undo' && data.targetId !== -1)) {\r\n\r\n            // Markup can be null when deleting, that's ok, we unselect in that case.\r\n            let markup = this.getMarkup(data.targetId);\r\n            this.selectMarkup(markup);\r\n        }\r\n        if(data.action === 'undo' && !this.isUndoStackEmpty()) {\r\n\r\n          let markup = this.getMarkup(this.actionManager.getLastElementInUndoStack().getTargetId());\r\n          this.selectMarkup(markup);\r\n        }\r\n\r\n        this.dispatchEvent(event);\r\n    };\r\n\r\n    /**\r\n     * Returns a markup with the specified ID. Returns null when not found.\r\n     * The ID can be retrieved from the return value of getSelection(). <br>\r\n     * See also\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#getSelection|getSelection()}.\r\n     * @param {string} id Markup identifier.\r\n     * @returns {Autodesk.Viewing.Extensions.Markups.Core.Markup} Returns markup object.\r\n     */\r\n    MarkupsCore.prototype.getMarkup = function(id) {\r\n\r\n        var markups = this.markups;\r\n        var markupsCount = markups.length;\r\n\r\n        for(var i = 0; i < markupsCount; ++i) {\r\n            if (markups[i].id == id) {\r\n                return markups[i];\r\n            }\r\n        }\r\n\r\n        return null;\r\n    };\r\n\r\n\r\n    /**\r\n     * Selects or deselects a markup. A selected markup gets an overlayed UI that allows you to perform transformations\r\n     * such as resizing, rotations, and translations. To deselect a markup, send a null value. <br>\r\n     * See also\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#getMarkup|getMarkup()}.\r\n     * @param {Autodesk.Viewing.Extensions.Markups.Core.Markup|null} markup The markup instance to select. Set the value to null to deselect a markup.\r\n     */\r\n    MarkupsCore.prototype.selectMarkup = function(markup) {\r\n\r\n        if (markup) {\r\n\r\n            if (this.editMode.type === markup.type) {\r\n                this.editMode.setSelection(markup);\r\n            } else {\r\n\r\n                var editMode = markup.getEditMode();\r\n                editMode.setSelection(null);\r\n\r\n                this.changeEditMode(editMode);\r\n                this.setStyle(markup.getStyle());\r\n                this.editMode.setSelection(markup);\r\n            }\r\n        } else {\r\n            // fix for text markup in view mode\r\n            if (this.editMode){\r\n                this.editMode.setSelection(null);\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Returns the currently selected markup. A selected markup has a custom UI overlayed that allows you to perform\r\n     * resizing, rotations and translations.<br>\r\n     * See also\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#selectMarkup|selectMarkup()}.\r\n     * @returns {Autodesk.Viewing.Extensions.Markups.Core.Markup|null} Returns selected markup object; null if no markup is selected.\r\n     */\r\n    MarkupsCore.prototype.getSelection = function() {\r\n\r\n        return this.editMode.getSelection();\r\n    };\r\n\r\n    /**\r\n     * Deletes a markup from the canvas. Only applies while in\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#enterEditMode|Edit mode}.\r\n     * @param {Autodesk.Viewing.Extensions.Markups.Core.Markup} markup - Markup object.\r\n     * @param {boolean} [dontAddToHistory] Whether delete action can be {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#undo|undone}.\r\n     */\r\n    MarkupsCore.prototype.deleteMarkup = function(markup, dontAddToHistory) {\r\n\r\n        if (!this.editMode || (this.editMode && this.editMode.selectedMarkup.id !== markup.id)) {\r\n            this.editMode = markup.getEditMode();\r\n        }\r\n        this.editMode.deleteMarkup(markup, dontAddToHistory);\r\n    };\r\n\r\n    proto.addMarkup = function(markup) {\r\n\r\n        var markups;\r\n        var layer = this.activeLayer;\r\n        var layerObject = this.svgLayersMap[layer] || '';\r\n\r\n        if (layerObject) {\r\n            var svgParent = layerObject.svg;\r\n            // append markup svg to layer svg\r\n            markup.setParent(svgParent);\r\n            // Add markup to layer markups if it does not exist\r\n            layerObject.markups.push(markup);\r\n            markups = layerObject.markups.slice();\r\n        } else {\r\n            // if layer is undefined create a edit mode svg layer\r\n            markup.setParent(this.editModeSvgLayerNode.svg);\r\n            this.editModeSvgLayerNode.markups.push(markup);\r\n            markups = this.editModeSvgLayerNode.markups.slice();\r\n        }\r\n        \r\n        markup.addEventListener(MarkupEvents.EVENT_MARKUP_SELECTED, this.onMarkupSelectedBinded);\r\n        markup.addEventListener(MarkupEvents.EVENT_MARKUP_ENTER_EDITION, this.onMarkupEnterEditionBinded);\r\n        markup.addEventListener(MarkupEvents.EVENT_MARKUP_CANCEL_EDITION, this.onMarkupCancelEditionBinded);\r\n        markup.addEventListener(MarkupEvents.EVENT_MARKUP_DELETE_EDITION, this.onMarkupDeleteEditionBinded);\r\n        // Only set the global markups array when in edit mode\r\n        if (this.duringEditMode) {\r\n            this.markups = markups;\r\n        }\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param markup\r\n     * @private\r\n     */\r\n    proto.removeMarkup = function(markup) {\r\n\r\n        if (!markup){\r\n            return false;\r\n        }\r\n        var self = this;\r\n\r\n        /**\r\n         * Get the layer markups in which the markup exists.\r\n         * This function will remove the markup if it exists in the corresponding layer markups array.\r\n         * @param markup\r\n         * @returns {number} returns -1 if the markup does not exist in a layer markups array\r\n         */\r\n        function removeMarkupIfExists(markup){\r\n            var markupIndex;\r\n            var layerMarkups = -1;\r\n            // check if the markup exists in the edit layer\r\n            if (self.editModeSvgLayerNode){\r\n                var editLayerMarkups = self.editModeSvgLayerNode.markups;\r\n                markupIndex = editLayerMarkups.indexOf(markup);\r\n                if (markupIndex !== -1) {\r\n                    // remove the markup from the corresponding markup array\r\n                    editLayerMarkups.splice(markupIndex, 1);\r\n                    layerMarkups = editLayerMarkups.slice();\r\n                    // update the global markups array if the markup is in the active layer\r\n                    if (self.activeLayer === ''){\r\n                        self.markups = layerMarkups;\r\n                    }\r\n                    return layerMarkups;\r\n                }\r\n            }\r\n            // check if the markup exists in a layer\r\n            if (self.svgLayersMap) {\r\n                for (var layer in self.svgLayersMap) {\r\n                    var markups = self.svgLayersMap[layer].markups;\r\n                    markupIndex = markups.indexOf(markup);\r\n                    if (markupIndex !== -1) {\r\n                        // remove the markup from the corresponding markup array\r\n                        markups.splice(markupIndex, 1);\r\n                        layerMarkups = markups.slice();\r\n                        // update the global markups array if the markup is in the active layer\r\n                        if (self.activeLayer === layer){\r\n                            self.markups = layerMarkups;\r\n                        }\r\n                        return layerMarkups;\r\n                    }\r\n                }\r\n            }\r\n            return layerMarkups;\r\n        }\r\n\r\n        var layerMarkups = removeMarkupIfExists(markup);\r\n        if (layerMarkups === -1)\r\n            return false;\r\n\r\n        markup.setParent(null);\r\n\r\n        markup.removeEventListener(MarkupEvents.EVENT_MARKUP_SELECTED, this.onMarkupSelectedBinded);\r\n        markup.removeEventListener(MarkupEvents.EVENT_MARKUP_ENTER_EDITION, this.onMarkupEnterEditionBinded);\r\n        markup.removeEventListener(MarkupEvents.EVENT_MARKUP_CANCEL_EDITION, this.onMarkupCancelEditionBinded);\r\n        markup.removeEventListener(MarkupEvents.EVENT_MARKUP_DELETE_EDITION, this.onMarkupDeleteEditionBinded);\r\n\r\n        var editMode = this.editMode;\r\n        if (editMode) {\r\n            var selectedMarkup = editMode.getSelection();\r\n            if (selectedMarkup === markup) {\r\n                this.selectMarkup(null);\r\n            }\r\n        }\r\n    };\r\n\r\n    //// Markups style /////////////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n    MarkupsCore.prototype.setStyle = function(style) {\r\n\r\n        var styles = this.styles;\r\n        var editMode = this.editMode;\r\n\r\n        copyStyle(style, styles[editMode.type]);\r\n        // copyStyle(styles[editMode.type], style);\r\n        editMode.setStyle(styles[editMode.type]);\r\n    };\r\n\r\n    MarkupsCore.prototype.getStyle = function() {\r\n\r\n        return cloneStyle(this.styles[this.editMode.type]);\r\n    };\r\n\r\n    MarkupsCore.prototype.getDefaultStyle = function() {\r\n\r\n        var defaultStyleAttributes = [\r\n            'stroke-width',\r\n            'font-size',\r\n            'font-family',\r\n            'font-style',\r\n            'font-weight',\r\n            'stroke-color',\r\n            'stroke-opacity',\r\n            'fill-color',\r\n            'text-data',\r\n            'fill-opacity'];\r\n        this.defaultStyle = this.defaultStyle || createStyle(defaultStyleAttributes, this);\r\n\r\n        return this.defaultStyle;\r\n    };\r\n\r\n    //// Markups depth order ///////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n    /**\r\n     *\r\n     * @param markup\r\n     */\r\n    proto.bringToFront = function(markup) {\r\n\r\n        this.sendMarkupTo(markup, this.markups.length-1);\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param markup\r\n     */\r\n    proto.sendToBack = function(markup) {\r\n\r\n        this.sendMarkupTo(markup, 0);\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param markup\r\n     */\r\n    proto.bringForward = function(markup) {\r\n\r\n        var markupIndex = this.markups.indexOf(markup);\r\n        this.sendMarkupTo(markup, markupIndex+1);\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param markup\r\n     */\r\n    proto.bringBackward = function(markup) {\r\n\r\n        var markupIndex = this.markups.indexOf(markup);\r\n        this.sendMarkupTo(markup, markupIndex-1);\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param markup\r\n     * @param index\r\n     * @private\r\n     */\r\n    proto.sendMarkupTo = function(markup, index) {\r\n\r\n        var markups = this.markups;\r\n        var markupIndex = markups.indexOf(markup);\r\n\r\n        if (markupIndex === -1 || index < 0 || index >= markups.length) {\r\n            return;\r\n        }\r\n\r\n        markups.splice(markupIndex, 1);\r\n        index = markupIndex > index ? index -1 : index;\r\n        markups.splice(index, 0, markup);\r\n\r\n        // TODO: Add markup in right position not always at the end.\r\n        markup.setParent(null);\r\n        if (this.activeLayer){\r\n            var parent = this.svgLayersMap[this.activeLayer].svg;\r\n            markup.setParent(parent);\r\n        }else {\r\n            markup.setParent(this.editModeSvgLayerNode.svg);\r\n        }\r\n    };\r\n\r\n\r\n    /**\r\n     * Loads data (SVG string) for all markups in a specified layer (layerId) to the Viewer's canvas.<br>\r\n     *\r\n     * See also\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#unloadMarkups|unloadMarkups()}, and\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#hideMarkups|hideMarkups()}.\r\n     *\r\n     * @param {string} markupString - SVG string with markups. See also {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#generateData|generateData()}.\r\n     * @param {string} layerId - Identifier for the layer where the markup should be loaded to. Example \"Layer1\".\r\n     * @return {boolean} Whether the markup string was able to be loaded successfully\r\n     */\r\n    MarkupsCore.prototype.loadMarkups = function (markupString, layerId) {\r\n\r\n        if (this.duringEditMode) {\r\n            console.warn(\"Markups will not be loaded during the edit mode\");\r\n            return false;\r\n        }\r\n\r\n        if (!this.duringViewMode) {\r\n            return false;\r\n        }\r\n\r\n        if (!layerId) {\r\n            console.warn(\"loadMarkups failed; missing 2nd argument 'layerId'\");\r\n            return false;\r\n        }\r\n\r\n        // Can it be parsed into SVG?\r\n        var parent = stringToSvgNode(markupString);\r\n        if (!parent) {\r\n            return false;\r\n        }\r\n\r\n        // If the supplied layerId exists in the svg layers map and there are children in the svg then return false.\r\n        if (layerId in this.svgLayersMap && this.svg.childNodes.length > 0) {\r\n            console.warn(\"This layer is already loaded, will not load again.\");\r\n            return false;\r\n        }\r\n        this.activeLayer = layerId;\r\n        var svgLayerNode = this.svgLayersMap[layerId];\r\n\r\n        // if the layer exists, delete it\r\n        if (svgLayerNode)\r\n            delete this.svgLayersMap[layerId];\r\n\r\n        // create an empty parent svg layer node for layerId\r\n        // Child markups will get added to th parent svg layer node in the addMarkup function\r\n        var newSvg = this.createLayerNode();\r\n\r\n        svgLayerNode = {\r\n            markups: [],\r\n            svgString: markupString,\r\n            svg: newSvg\r\n        };\r\n        this.svgLayersMap[layerId] = svgLayerNode;\r\n\r\n        var children = parent.childNodes;\r\n        for (var i = 0; i < children.length; i++) {\r\n            var child = children[i];\r\n            var markup = createMarkupFromSVG(child, this);\r\n            // Disable markups if already in edit mode and the active layer is different\r\n            if (markup && this.duringEditMode && this.editingLayer !== this.activeLayer) {\r\n                markup.disableInteractions(true);\r\n            }\r\n\r\n            if (!markup && child.localName !== \"metadata\") {\r\n                // Append child removes it from parent and copies it over to the new svg layer node,\r\n                // so we need to reduce index by 1 to continue proper iteration\r\n                svgLayerNode.svg.appendChild(child);\r\n                i--;\r\n                if (typeof child.setAttribute === 'function') {\r\n                    child.setAttribute(\"pointer-events\", \"none\");\r\n                }\r\n            }\r\n        }\r\n\r\n        var svgParentNode = this.svgLayersMap[this.activeLayer].svg;\r\n\r\n        this.svg.appendChild(svgParentNode);\r\n        // If already in an edit mode layer then reassign active layer to edit layer\r\n        if(this.duringEditMode && this.editingLayer !== this.activeLayer) {\r\n            this.activeLayer = this.editingLayer;\r\n            if (this.editingLayer)\r\n                this.markups = this.svgLayersMap[this.activeLayer].markups.slice();\r\n        }\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * TODO: Probably this function needs to be moved to MarkupCoreUtils.js\r\n     * Creates a new layer node\r\n     * */\r\n\r\n    proto.createLayerNode = function() {\r\n\r\n        var newSvgLayerNode = this.createSvgElement('g');\r\n        newSvgLayerNode.setAttribute('cursor', 'default');\r\n        return newSvgLayerNode;\r\n    };\r\n\r\n    /**\r\n     * Revert any changes made to the specific layer.\r\n     *\r\n     * See also\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#loadMarkups|loadMarkups()} and\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#enterEditMode|enterEditMode()}.\r\n     *\r\n     * @param {string} layerId - ID of the layer to revert any changes that were made to it.\r\n     * @returns {boolean} true if the layer was unloaded, false if the layer was not unloaded.\r\n     */\r\n    MarkupsCore.prototype.revertLayer = function(layerId){\r\n        if (!layerId) {\r\n            console.warn(\"revertLayer failed because no layerId was supplied.\");\r\n            return false;\r\n        }\r\n        var svgLayerNode = this.svgLayersMap[layerId];\r\n        if (!svgLayerNode){\r\n            console.warn(\"The supplied layer does not exist.\");\r\n            return false;\r\n        }\r\n        var inEditMode = this.duringEditMode;\r\n        // Leave editMode to revert a layer\r\n        if (inEditMode)\r\n            this.leaveEditMode();\r\n\r\n        // keep track of previous global markups.\r\n        var currentMarkups = this.markups.slice();\r\n        // Set the global markups to the markups in the current layer. These ones get removed in the unloadMarkups\r\n        this.markups = svgLayerNode.markups;\r\n        var layerSvg = svgLayerNode.svgString;\r\n        this.unloadMarkups(layerId);\r\n        this.loadMarkups(layerSvg, layerId);\r\n        // Assign markups\r\n        if (this.editingLayer){\r\n            if(this.editingLayer !== layerId) {\r\n                this.markups = currentMarkups;\r\n                var layerObject = this.svgLayersMap[this.editingLayer];\r\n                if (layerObject) {\r\n                    layerObject.markups = currentMarkups;\r\n                }\r\n            }\r\n        }else{\r\n            if(this.editModeSvgLayerNode){\r\n                this.editModeSvgLayerNode.markups = currentMarkups;\r\n            }\r\n        }\r\n\r\n        if(this.editingLayer || this.editingLayer.length === 0){\r\n            var svg = this.editingLayer.length === 0 ? this.editModeSvgLayerNode.svg : this.svgLayersMap[this.editingLayer].svg;\r\n            if (svg.parentNode == this.svg) {\r\n                this.svg.removeChild(svg);\r\n                this.svg.appendChild(svg);\r\n            }\r\n        }\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Removes markups from the DOM (Document Object Model). This is helpful for freeing up memory.<br>\r\n     *\r\n     * See also\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#loadMarkups|loadMarkups()},\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#unloadMarkupsAllLayers|unloadMarkupsAllLayers()},\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#clear|clear()},\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#hide|hide()}, and\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#hideMarkups|hideMarkups()}.\r\n     *\r\n     * @param {string} layerId - ID of the layer containing all markups to unload (from the DOM).\r\n     * @return {boolean} Whether the operation succeeded or not.\r\n     */\r\n    MarkupsCore.prototype.unloadMarkups = function(layerId) {\r\n\r\n        if (!layerId) {\r\n            console.warn(\"unloadMarkups failed; No layerId provided.\");\r\n            return false;\r\n        }\r\n\r\n        var svgLayerNode = this.svgLayersMap[layerId];\r\n        if (!svgLayerNode) {\r\n            // TODO: Do we need to log anything here?\r\n            console.warn('No such layer exists to unload.');\r\n            return false;\r\n        }\r\n\r\n        var layerMarkups = svgLayerNode.markups.slice();\r\n        var numMarkups = layerMarkups.length;\r\n        for (var i = 0; i < numMarkups; i++) {\r\n            var markup = layerMarkups[i];\r\n            this.removeMarkup(markup);\r\n            markup.destroy();\r\n        }\r\n\r\n        // Remove the markups in the layer from the svg canvas\r\n        if (svgLayerNode.svg.parentNode === this.svg)\r\n            this.svg.removeChild(svgLayerNode.svg);\r\n\r\n        // Delete the layer from the layer map.\r\n        delete this.svgLayersMap[layerId];\r\n        // Reset the active layer if the supplied layer id is the same as the active layer\r\n        if (this.activeLayer.toString() === layerId.toString()) {\r\n            this.activeLayer = '';\r\n        }\r\n        // Leave edit mode and reset the editing layer if the supplied layer is the same as the current editing layer\r\n        if (this.editingLayer && this.editingLayer.toString() === layerId.toString()){\r\n            this.editingLayer = '';\r\n            this.duringEditMode && this.leaveEditMode();\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Removes all markups loaded so far. Great for freeing up memory.\r\n     *\r\n     * See also\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#loadMarkups|loadMarkups()},\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#unloadMarkups|unloadMarkups()},\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#clear|clear()},\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#hide|hide()}, and\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#hideMarkups|hideMarkups()}.\r\n     */\r\n    MarkupsCore.prototype.unloadMarkupsAllLayers = function() {\r\n        this.activeLayer = '';\r\n        var self = this;\r\n\r\n        //this is specific to the editModeSvgLayerNode, enterEditMode().\r\n        var unloadSvgLayerNode = function() {\r\n            if (self.editModeSvgLayerNode) {\r\n                var layerMarkups = self.editModeSvgLayerNode.markups.slice();\r\n                var numMarkups = layerMarkups.length;\r\n                for (var i = 0; i < numMarkups; i++) {\r\n                    var markup = layerMarkups[i];\r\n                    self.removeMarkup(markup);\r\n                    markup.destroy();\r\n                }\r\n            }\r\n        };\r\n\r\n        // Unload the markups in the editModeSvgLayerNode\r\n        unloadSvgLayerNode();\r\n        var layerId;\r\n        for (layerId in this.svgLayersMap){\r\n            this.unloadMarkups(layerId);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Hides all markups in a specified layer. Note that hidden markups will not be unloaded.\r\n     * Use the {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#showMarkups|showMarkups()} method to make\r\n     * them visible again; no additional parsing is required.\r\n     *\r\n     * See also\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#showMarkups|showMarkups()},\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#unloadMarkups|unloadMarkups()}, and\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#loadMarkups|loadMarkups()}.\r\n     *\r\n     * @param {string} layerId - ID of the layer containing all markups that should be hidden (in the DOM).\r\n     * @return {boolean} Whether the operation succeeded or not.\r\n     */\r\n    MarkupsCore.prototype.hideMarkups = function(layerId) {\r\n\r\n        if (!layerId) {\r\n            console.warn(\"hideMarkups failed; No layerId provided.\");\r\n            return false;\r\n        }\r\n\r\n        var svgLayerNode = this.svgLayersMap[layerId];\r\n        if (!svgLayerNode) {\r\n            // TODO: Do we need to log anything here?\r\n            return false;\r\n        }\r\n        var layerSvg = svgLayerNode.svg;\r\n\r\n        // Return false if the layer svg is not present in the main svg\r\n        if (layerSvg.parentNode != this.svg) {\r\n            console.warn(\"Layer is already hidden.\");\r\n            return false;\r\n        }\r\n        // remove the layer svg from the main svg\r\n        this.svg.removeChild(layerSvg);\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Unhides a layer of hidden markups\r\n     * ({@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#hideMarkups|hideMarkups()}).\r\n     *\r\n     * @param {string} layerId - ID of the layer containing all markups to unload (from the DOM).\r\n     * @return {boolean} Whether the operation succeeded or not.\r\n     */\r\n    MarkupsCore.prototype.showMarkups = function(layerId) {\r\n\r\n        if (!layerId) {\r\n            console.warn(\"showMarkups failed; No layerId provided.\");\r\n            return false;\r\n        }\r\n\r\n        var svgLayerNode = this.svgLayersMap[layerId];\r\n        if (!svgLayerNode) {\r\n            // TODO: Do we need to log anything here?\r\n            return false;\r\n        }\r\n        // Append the layer svg to the main svg\r\n        var layerSvg = svgLayerNode.svg;\r\n        this.svg.appendChild(layerSvg);\r\n    };\r\n\r\n    //// Client Space <-> Markup Space /////////////////////////////////////////////////////////////////////////////////\r\n\r\n    proto.positionFromClientToMarkups = function(x, y) {\r\n\r\n        return this.clientToMarkups(x, y);\r\n    };\r\n\r\n    proto.positionFromMarkupsToClient = function(x, y) {\r\n\r\n        return this.markupsToClient(x, y);\r\n    };\r\n\r\n    proto.vectorFromClientToMarkups = function(x, y) {\r\n\r\n        var a = this.clientToMarkups(0, 0);\r\n        var b = this.clientToMarkups(x, y);\r\n\r\n        return {x: b.x - a.x, y: b.y - a.y};\r\n    };\r\n\r\n    proto.vectorFromMarkupsToClient = function(x, y) {\r\n\r\n        var a = this.markupsToClient(0, 0);\r\n        var b = this.markupsToClient(x, y);\r\n\r\n        return {x: b.x - a.x, y: b.y - a.y};\r\n    };\r\n\r\n    proto.sizeFromClientToMarkups = function(w, h) {\r\n\r\n        var a = this.clientToMarkups(0, 0);\r\n        var b = this.clientToMarkups(w, h);\r\n\r\n        return {x: Math.abs(b.x - a.x), y: Math.abs(b.y - a.y)};\r\n    };\r\n\r\n    proto.sizeFromMarkupsToClient = function(w, h) {\r\n\r\n        var a = this.markupsToClient(0, 0);\r\n        var b = this.markupsToClient(w, h);\r\n\r\n        return {x: Math.abs(b.x - a.x), y: Math.abs(b.y - a.y)};\r\n    };\r\n\r\n    proto.markupsToClient = function(x, y) {\r\n\r\n        var camera = this.viewer.impl.camera;\r\n        var point = new THREE.Vector3(x, y, 0);\r\n\r\n        if (camera.isPerspective) {\r\n\r\n            var bb = this.viewer.impl.getCanvasBoundingClientRect();\r\n\r\n            point.x =( point.x / PERSPECTIVE_MODE_SCALE * (bb.height * 0.5) + bb.width  * 0.5);\r\n            point.y =(-point.y / PERSPECTIVE_MODE_SCALE * (bb.height * 0.5) + bb.height * 0.5);\r\n        } else {\r\n\r\n            point.applyMatrix4(camera.matrixWorld);\r\n            point.sub(camera.position);\r\n\r\n            // In LMV model is offset by a global offset, we correct this offset when transforming to markups space, so\r\n            // exported markups don't have the offset.\r\n            var globalOffset = this.viewer.model && this.viewer.model.getData().globalOffset;\r\n            if (globalOffset) {\r\n                point.sub(globalOffset);\r\n            }\r\n\r\n            point = worldToClient(point, this.viewer, false);\r\n            point.z = 0;\r\n        }\r\n\r\n        return point;\r\n    };\r\n\r\n    proto.clientToMarkups = function(x, y) {\r\n\r\n        var camera = this.viewer.impl.camera;\r\n        var point = new THREE.Vector3(x, y, 0);\r\n\r\n        if (camera.isPerspective) {\r\n\r\n            var bb = this.viewer.impl.getCanvasBoundingClientRect();\r\n\r\n            // Multiply by PERSPECTIVE_MODE_SCALE because Firfox on Windows machines have problems to deal with very small paths.\r\n            point.x = (point.x - bb.width  * 0.5) / (bb.height * 0.5) * PERSPECTIVE_MODE_SCALE;\r\n            point.y =-(point.y - bb.height * 0.5) / (bb.height * 0.5) * PERSPECTIVE_MODE_SCALE;\r\n        } else {\r\n\r\n            point = clientToWorld(point.x, point.y, 0, this.viewer);\r\n\r\n            // In LMV model is offset by a global offset, we correct this offset when transforming to markups space, so\r\n            // exported markups don't have the offset.\r\n            var globalOffset = this.viewer.model && this.viewer.model.getData().globalOffset;\r\n            if (globalOffset) {\r\n                point.add(globalOffset);\r\n            }\r\n\r\n            point.add(camera.position);\r\n            point.applyMatrix4(camera.matrixWorldInverse);\r\n            point.z = 0;\r\n        }\r\n\r\n        return point;\r\n    };\r\n\r\n    proto.getSvgViewBox = function(clientWidth, clientHeight) {\r\n\r\n        // Get pan offset.\r\n        var lt = this.clientToMarkups(0, 0);\r\n        var rb = this.clientToMarkups(clientWidth, clientHeight);\r\n\r\n        var l = Math.min(lt.x, rb.x);\r\n        var t = Math.min(lt.y, rb.y);\r\n        var r = Math.max(lt.x, rb.x);\r\n        var b = Math.max(lt.y, rb.y);\r\n\r\n        return [l , t, r-l, b-t].join(' ');\r\n    };\r\n\r\n    proto.getBounds = function () {\r\n\r\n        return this.bounds;\r\n    };\r\n\r\n    proto.getMousePosition = function() {\r\n\r\n        // When snapping, use the snap position instead of the mouse position\r\n        // as the start point of the markup drawing.\r\n        // For now only works for 2D.\r\n        if (this.editMode.useWithSnapping() && this.snapper && this.snapper.isSnapped()) {\r\n            return this.getSnapPosition();\r\n        }\r\n        return this.input.getMousePosition();\r\n    };\r\n\r\n    proto.getSnapPosition = function() {\r\n\r\n        var point = MeasureCommon.getSnapResultPosition(this.snapper.getSnapResult(), this.viewer);\r\n        var p = this.project(point);\r\n        return {x: p.x, y: p.y};\r\n    };\r\n\r\n    proto.project = function(position) {\r\n        var camera = this.viewer.navigation.getCamera();\r\n        var containerBounds = this.viewer.navigation.getScreenViewport();\r\n\r\n        var p = new THREE.Vector3().copy(position);\r\n        p.project(camera);\r\n\r\n        return new THREE.Vector3(Math.round((p.x + 1) / 2 * containerBounds.width),\r\n            Math.round((-p.y + 1) / 2 * containerBounds.height), p.z);\r\n    };\r\n\r\n    //// Handled Events ////////////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n    proto.onCameraChange = function() {\r\n\r\n        // Update annotations' parent transform.\r\n        var viewBox = this.getSvgViewBox(this.bounds.width, this.bounds.height);\r\n\r\n        // HACK, for some reason the 2nd frame returns an empty canvas.\r\n        // The reason why this happens is that the code above calls into the viewer\r\n        // and a division by zero occurs due to LMV canvas having zero width and height\r\n        // When we detect this case, avoid setting the viewBox value and rely on one\r\n        // previously set.\r\n        if (viewBox === \"NaN NaN NaN NaN\") {\r\n            return;\r\n        }\r\n\r\n        if (this.svg) {\r\n            this.svg.setAttribute('viewBox', viewBox);\r\n        }\r\n\r\n\r\n        var editMode = this.editMode;\r\n\r\n        if (editMode) {\r\n            // Edit frame has to be updated, re-setting the selected markup does the job.\r\n            if (this.editFrame.isActive()) {\r\n                var selectedMarkup = editMode.getSelection();\r\n                this.editFrame.setMarkup(selectedMarkup);\r\n            }\r\n\r\n            if (editMode.updateTextBoxStyle) {\r\n                editMode.updateTextBoxStyle();\r\n            }\r\n\r\n            if (this.snapper && editMode.useWithSnapping()) {\r\n                this.snapper.indicator.render();\r\n            }\r\n        }\r\n    };\r\n\r\n    proto.onViewerResize = function(event) {\r\n\r\n        this.bounds.x = 0;\r\n        this.bounds.y = 0;\r\n        this.bounds.width = event.width;\r\n        this.bounds.height = event.height;\r\n\r\n        if (this.svg) {\r\n            this.svg.setAttribute('width', this.bounds.width);\r\n            this.svg.setAttribute('height', this.bounds.height);\r\n        }\r\n\r\n        this.onCameraChange();\r\n    };\r\n\r\n    proto.callSnapperMouseDown = function() {\r\n\r\n        // Disable snapper in freehand mode\r\n        if (this.editMode && this.editMode.useWithSnapping()){\r\n            var mousePosition = this.input.getMousePosition();\r\n            if (this.snapper) {\r\n                this.snapper.onMouseDown(mousePosition);\r\n                this.snapper.indicator.render();\r\n            }\r\n        }else{\r\n            // Clear the snapper when selecting a markup that does not allow snapping.\r\n            if (this.snapper){\r\n                this.snapper.clearSnapped();\r\n                this.snapper.indicator.clearOverlays();\r\n            }\r\n        }\r\n    };\r\n\r\n    proto.callSnapperMouseMove = function() {\r\n\r\n        if (this.editMode && this.editMode.useWithSnapping()) {\r\n            var mousePosition = this.input.getMousePosition();\r\n            if (this.snapper) {\r\n                this.snapper.onMouseMove(mousePosition);\r\n                this.snapper.indicator.render();\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Handler to mouse move events, used to create markups.\r\n     *\r\n     * @param event\r\n     * @returns {boolean} - if the event was handed by the editor\r\n     * @private\r\n     */\r\n    proto.onMouseMove = function(event) {\r\n\r\n        if (this.navigating) {\r\n            return false;\r\n        }\r\n        \r\n        let eventHandled = false;\r\n        if (this.editFrame.isActive() && event.type === 'mousemove') {\r\n            eventHandled = this.editFrame.onMouseMove(event);\r\n        }\r\n\r\n        this.callSnapperMouseMove();\r\n\r\n        eventHandled = this.editMode && this.editMode.onMouseMove(event) || eventHandled;\r\n\r\n        return eventHandled;\r\n    };\r\n\r\n    /**\r\n     * Handler to mouse down events, used to start creation markups.\r\n     * @private\r\n     */\r\n    proto.onMouseDown = function(event) {\r\n\r\n        dismissLmvHudMessage();\r\n\r\n        this.callSnapperMouseDown();\r\n\r\n        var bounds = this.getBounds();\r\n        var mousePosition = this.getMousePosition();\r\n\r\n        if (mousePosition.x >= bounds.x && mousePosition.x <= bounds.x + bounds.width &&\r\n            mousePosition.y >= bounds.y && mousePosition.y <= bounds.y + bounds.height) {\r\n            this.editMode.onMouseDown(event);\r\n        }\r\n\r\n        // TODO: There is a better way to do this, implement when undo/redo group.\r\n        if(!this.editMode.creating && event.target === this.svg) {\r\n            this.selectMarkup(null);\r\n        }\r\n        this.ignoreNextMouseUp = false;\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {*} event \r\n     * @returns {boolean} - true / false means the editor did / didn't handle the event\r\n     * @private\r\n     */\r\n    proto.onMouseUp = function(event) {\r\n\r\n        if (this.navigating) {\r\n            return false;\r\n        }\r\n\r\n        if (this.editFrame.isActive()) {\r\n            this.editFrame.onMouseUp(event);\r\n            return true;\r\n        }\r\n\r\n        if(!this.ignoreNextMouseUp) {\r\n            return this.editMode.onMouseUp(event);\r\n        }\r\n    };\r\n\r\n    proto.onMouseDoubleClick = function(event) {\r\n\r\n        if (this.navigating) {\r\n            return;\r\n        }\r\n\r\n        if (this.editFrame.isActive()) {\r\n            return;\r\n        }\r\n\r\n        this.editMode.onMouseDoubleClick(event);\r\n    };\r\n\r\n    proto.onUserCancel = function() {\r\n        if (!this.editMode) {\r\n            return;\r\n        }\r\n        else if (this.editMode.creating) {\r\n            this.editMode.creationCancel();\r\n        } else {\r\n            this.editMode.unselect();\r\n        }\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param event\r\n     */\r\n    proto.onMarkupSelected = function(event) {\r\n\r\n        this.selectMarkup(event.markup);\r\n        this.dispatchEvent(event);\r\n    };\r\n\r\n    proto.onMarkupEnterEdition = function() {\r\n\r\n    };\r\n\r\n    proto.onMarkupCancelEdition = function() {\r\n\r\n        this.onUserCancel();\r\n    };\r\n\r\n    proto.onMarkupDeleteEdition = function(event) {\r\n\r\n        this.removeMarkup(event.markup);\r\n        this.editMode.deleteMarkup();\r\n    };\r\n\r\n    Autodesk.Viewing.theExtensionManager.registerExtension('Autodesk.Viewing.MarkupsCore', MarkupsCore);\r\n","\n      import API from \"!../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../node_modules/css-loader/dist/cjs.js!./MarkupsGui.css\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../node_modules/css-loader/dist/cjs.js!./MarkupsGui.css\";\n       export default content && content.locals ? content.locals : undefined;\n","import { getStyleDefaultValues } from '../core/StyleUtils'\r\nimport * as MarkupEvents from '../core/MarkupEvents' \r\nimport * as MarkupTypes from '../core/MarkupTypes'\r\nimport { theEditModeManager } from '../core/EditModeManager'\r\n\r\nimport CSS from './MarkupsGui.css' // IMPORTANT!!\r\n\r\n    var CORE_EXTENSION = 'Autodesk.Viewing.MarkupsCore';\r\n\r\n    export function MarkupsGui(viewer, options) {\r\n        Autodesk.Viewing.Extension.call(this, viewer, options);\r\n        this.domEvents = [];\r\n        this.name = 'markup';\r\n        this.onEditModeEnter = this.onEditModeEnter.bind(this);\r\n        this.onEditModeLeave = this.onEditModeLeave.bind(this);\r\n        this.onEditModeChange = this.onEditModeChange.bind(this);\r\n        this.onMarkupSelected = this.onMarkupSelected.bind(this);\r\n    }\r\n\r\n    MarkupsGui.prototype = Object.create(Autodesk.Viewing.Extension.prototype);\r\n    MarkupsGui.prototype.constructor = MarkupsGui;\r\n    var proto = MarkupsGui.prototype;\r\n    var av = Autodesk.Viewing;\r\n    var avp = av.Private;\r\n\r\n    proto.load = function () {\r\n\r\n        this.viewer.loadExtension(CORE_EXTENSION).then( coreExt => {\r\n\r\n            this.core = coreExt;\r\n\r\n            // Hook into markup core events\r\n            this.core.addEventListener(MarkupEvents.EVENT_EDITMODE_ENTER, this.onEditModeEnter);\r\n            this.core.addEventListener(MarkupEvents.EVENT_EDITMODE_LEAVE, this.onEditModeLeave);\r\n            this.core.addEventListener(MarkupEvents.EVENT_EDITMODE_CHANGED, this.onEditModeChange);\r\n            this.core.addEventListener(MarkupEvents.EVENT_MARKUP_SELECTED, this.onMarkupSelected);\r\n        });\r\n\r\n        return true;\r\n    };\r\n\r\n    proto.unload = function() {\r\n\r\n        this.deactivate(); // not necessary, but leaves the viewer in an unusable state without it\r\n        this.unhookAllEvents();\r\n\r\n        this.core.removeEventListener(MarkupEvents.EVENT_EDITMODE_ENTER, this.onEditModeEnter);\r\n        this.core.removeEventListener(MarkupEvents.EVENT_EDITMODE_LEAVE, this.onEditModeLeave);\r\n        this.core.removeEventListener(MarkupEvents.EVENT_EDITMODE_CHANGED, this.onEditModeChange);\r\n        this.core.removeEventListener(MarkupEvents.EVENT_MARKUP_SELECTED, this.onMarkupSelected);\r\n\r\n        this.destroyToolUi();\r\n        this.destroyToolbarUI();\r\n        this.core = null;\r\n\r\n        return true;\r\n    };\r\n\r\n    proto.onToolbarCreated = function(toolbar) {\r\n        \r\n        var self = this;\r\n\r\n        this.markupToolButton = new Autodesk.Viewing.UI.Button(\"toolbar-markupTool\");\r\n        this.markupToolButton.setToolTip(\"Markup\");\r\n        this.markupToolButton.setIcon(\"adsk-icon-markup\");\r\n        this.markupToolButton.onClick = function () {\r\n            // Since the bar will get hidden when closed, there\r\n            // is no need to track button state (active or not)\r\n            self.activate();\r\n        };\r\n\r\n        var modelTools = toolbar.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID);\r\n        if (modelTools) {\r\n            modelTools.addControl(this.markupToolButton, {index:0});\r\n        }\r\n    };\r\n\r\n    proto.destroyToolbarUI = function() {\r\n        if (this.markupToolButton) {\r\n            var toolbar = this.viewer.getToolbar();\r\n            if (toolbar) {\r\n                this.markupToolButton.removeFromParent();\r\n            }\r\n            this.markupToolButton = null;\r\n        }\r\n    };\r\n\r\n    proto.onEditModeEnter = function() {\r\n        avp.logger.log('ENTER edit mode');\r\n        this.showToolsUi();\r\n    };\r\n\r\n    proto.onEditModeLeave = function() {\r\n        avp.logger.log('LEAVE edit mode');\r\n        this.hideToolsUi();\r\n    };\r\n\r\n    proto.onEditModeChange = function(event) {\r\n        if (!this.domToolSelect || this.ignoreChangeEvent)\r\n            return;\r\n        var editMode = this.core.editMode;\r\n        var optionList = this.domToolSelect.options;\r\n        for (var i=0, len=optionList.length; i<len; i++) {\r\n            var option = optionList[i];\r\n            if (option.value === editMode.type) {\r\n                this.domToolSelect.selectedIndex = i; // doesn't fire event\r\n                break;\r\n            }\r\n        }\r\n    };\r\n\r\n    proto.onMarkupSelected = function(event) {\r\n\r\n        var markup = event.markup;\r\n        var editMode = this.core.editMode;\r\n        this.setStylesUi(editMode, markup);\r\n    };\r\n\r\n    proto.showToolsUi = function() {\r\n        this.createToolsUi();\r\n\r\n        // Hide some UI\r\n        var canNavigate = this.core.isNavigationAllowed();\r\n        this.setControlVisibility('.lmv-markup-gui-enterNavMode', canNavigate, 'inline-block');\r\n        this.exitNavigationMode();\r\n        this.domContent.style.display = 'block'; // remove collapsed state\r\n\r\n        // It's okay if we call these many times in a row, no biggie.\r\n        this.viewer.container.appendChild(this.domRoot);\r\n    };\r\n\r\n    proto.hideToolsUi = function() {\r\n        if (this.domRoot && this.domRoot.parentNode) {\r\n            this.domRoot.parentNode.removeChild(this.domRoot);\r\n        }\r\n    };\r\n\r\n    proto.createToolsUi = function() {\r\n\r\n        if (this.domRoot)\r\n            return;\r\n\r\n        function createEditModeOption(locLabel, editModeType) {\r\n            return [\r\n                '<option value=\"', editModeType, '\">',\r\n                    locLabel,\r\n                '</option>'\r\n            ].join('');\r\n        }\r\n\r\n        var html = [\r\n            '<div class=\"lmv-markup-gui-toolbar-content\">',\r\n\r\n                '<button class=\"lmv-markup-gui-collapse-btn\">&lt;-&gt;</button>',\r\n                '<button class=\"lmv-markup-editmode-done\">Exit</button>',\r\n                '<div class=\"lmv-markup-gui-collapse-content\">',\r\n                    '<div class=\"lmv-markup-gui-editMode\">',\r\n                        '<button class=\"lmv-markup-gui-enterNavMode\">Navigate</button>',\r\n                        '<button class=\"lmv-markup-gui-undo\">&#8617;</button>',\r\n                        '<button class=\"lmv-markup-gui-redo\">&#8618;</button>',\r\n                        '<br>',\r\n                        '<button class=\"lmv-markup-gui-delete\">Delete</button>',\r\n                        '<button class=\"lmv-markup-gui-duplicate\">Duplicate</button>',\r\n                        '<br>',\r\n                        '<button class=\"lmv-markup-gui-cut\">Cut</button>',\r\n                        '<button class=\"lmv-markup-gui-copy\">Copy</button>',\r\n                        '<button class=\"lmv-markup-gui-paste\">Paste</button>',\r\n                        '<br>',\r\n                        '<span>Markup:</span>', // TODO: Localize\r\n                        '<select class=\"lmv-markup-tool-select\">',\r\n                            createEditModeOption('Arrow', MarkupTypes.MARKUP_TYPE_ARROW),\r\n                            createEditModeOption('Rectangle', MarkupTypes.MARKUP_TYPE_RECTANGLE),\r\n                            createEditModeOption('Circle', MarkupTypes.MARKUP_TYPE_CIRCLE),\r\n                            createEditModeOption('Text', MarkupTypes.MARKUP_TYPE_TEXT),\r\n                            createEditModeOption('Callout', MarkupTypes.MARKUP_TYPE_CALLOUT),\r\n                            createEditModeOption('Cloud', MarkupTypes.MARKUP_TYPE_CLOUD),\r\n                            createEditModeOption('PolyLine', MarkupTypes.MARKUP_TYPE_POLYLINE),\r\n                            createEditModeOption('Polycloud', MarkupTypes.MARKUP_TYPE_POLYCLOUD),\r\n                            createEditModeOption('Freehand', MarkupTypes.MARKUP_TYPE_FREEHAND),\r\n                            createEditModeOption('Highlight', MarkupTypes.MARKUP_TYPE_HIGHLIGHT),\r\n                            createEditModeOption('Dimension', MarkupTypes.MARKUP_TYPE_DIMENSION),\r\n                            createEditModeOption('SVG Stamp', MarkupTypes.MARKUP_TYPE_STAMP),\r\n                        '</select>',\r\n                        '<br>',\r\n                        '<div class=\"lmv-markup-gui-style-options\"></div>',\r\n                    '</div>',\r\n                    '<div class=\"lmv-markup-gui-navMode\" style=\"display:none;\">',\r\n                        '<button class=\"lmv-markup-gui-exitNavMode\">Back to Markup</button>',\r\n                    '</div>',\r\n                '</div>',\r\n            '</div>'\r\n        ].join('');\r\n\r\n        const _document = this.getDocument();\r\n        this.domRoot = _document.createElement('div');\r\n        this.domRoot.className = 'lmv-markup-gui-toolbar';\r\n        this.domRoot.innerHTML = html;\r\n\r\n        this.domContent = this.domRoot.querySelector('.lmv-markup-gui-collapse-content');\r\n        this.domToolSelect = this.domRoot.querySelector('.lmv-markup-tool-select');\r\n        this.domStylesRoot = this.domRoot.querySelector('.lmv-markup-gui-style-options');\r\n\r\n        // General\r\n        this.hookEvent('click', '.lmv-markup-gui-collapse-btn', this.onToggleCollapse.bind(this));\r\n        this.hookEvent('click', '.lmv-markup-editmode-done', this.onEditModeDone.bind(this));\r\n        this.hookEvent('click', '.lmv-markup-gui-enterNavMode', this.enterNavigationMode.bind(this));\r\n        this.hookEvent('click', '.lmv-markup-gui-exitNavMode', this.exitNavigationMode.bind(this));\r\n        this.hookEvent('click', '.lmv-markup-gui-undo', this.onUndoClick.bind(this));\r\n        this.hookEvent('click', '.lmv-markup-gui-redo', this.onRedoClick.bind(this));\r\n        this.hookEvent('click', '.lmv-markup-gui-delete', this.onDeleteClick.bind(this));\r\n        this.hookEvent('click', '.lmv-markup-gui-cut', this.onCutClick.bind(this));\r\n        this.hookEvent('click', '.lmv-markup-gui-copy', this.onCopyClick.bind(this));\r\n        this.hookEvent('click', '.lmv-markup-gui-paste', this.onPasteClick.bind(this));\r\n        this.hookEvent('click', '.lmv-markup-gui-duplicate', this.onDuplicateClick.bind(this));\r\n        // Tools\r\n        this.hookEvent('change', '.lmv-markup-tool-select', this.onSelectEditMode.bind(this));\r\n        this.hookEvent('change', '.lmv-markup-gui-style-select', this.onStyleChange.bind(this));\r\n        // Text input fields for tools\r\n        this.hookEvent('input', '.lmv-markup-gui-style-textarea', this.onStyleChange.bind(this));\r\n        this.hookEvent('propertychange', '.lmv-markup-gui-style-textarea', this.onStyleChange.bind(this));\r\n\r\n        this.setStylesUi(this.core.editMode);\r\n    };\r\n\r\n    proto.destroyToolUi = function() {\r\n        if (this.domRoot) {\r\n            this.hideToolsUi();\r\n            this.domRoot = null;\r\n        }\r\n    };\r\n\r\n    proto.getEditMode = function(editModeType) {\r\n        var EditModeClass = theEditModeManager.getClass(editModeType);\r\n        if (!EditModeClass)\r\n            return null;\r\n\r\n        var editMode = new EditModeClass(this.core);\r\n        return editMode;\r\n    };\r\n\r\n    proto.onToggleCollapse = function() {\r\n        var curr = this.domContent.style.display;\r\n        if (curr === 'none')\r\n            this.domContent.style.display = 'block';\r\n        else\r\n            this.domContent.style.display = 'none';\r\n    };\r\n\r\n    proto.onEditModeDone = function() {\r\n        this.deactivate();\r\n    };\r\n\r\n    proto.enterNavigationMode = function() {\r\n        this.core.allowNavigation(true);\r\n        this.setControlVisibility('.lmv-markup-gui-editMode', false);\r\n        this.setControlVisibility('.lmv-markup-gui-navMode', true);\r\n    };\r\n    proto.exitNavigationMode = function() {\r\n        this.core.allowNavigation(false);\r\n        this.setControlVisibility('.lmv-markup-gui-editMode', true);\r\n        this.setControlVisibility('.lmv-markup-gui-navMode', false);\r\n    };\r\n\r\n    proto.onUndoClick = function() {\r\n        this.core.undo();\r\n    };\r\n    proto.onRedoClick = function() {\r\n        this.core.redo();\r\n    };\r\n    proto.onDeleteClick = function() {\r\n        var markup = this.core.getSelection();\r\n        if (markup) {\r\n            this.core.deleteMarkup(markup);\r\n        }\r\n    };\r\n    proto.onCutClick = function() {\r\n        this.core.cut();\r\n    };\r\n    proto.onCopyClick = function() {\r\n        this.core.copy();\r\n    };\r\n    proto.onPasteClick = function() {\r\n        this.core.paste();\r\n    };\r\n    proto.onDuplicateClick = function() {\r\n        // only when there's a selection\r\n        var markup = this.core.getSelection();\r\n        if (markup) {\r\n            this.core.copy();\r\n            this.core.paste();\r\n        }\r\n    };\r\n\r\n    proto.onSelectEditMode = function(event) {\r\n        var editModeType = event.target.value;\r\n        var editMode = this.getEditMode(editModeType);\r\n        if (!editMode) {\r\n            avp.logger.error('Markup editMode not found for type: ' + editModeType);\r\n            return;\r\n        }\r\n\r\n        if (editMode.cancelEditModeChange) {\r\n            avp.logger.warn('There was a problem selecting current editMode');\r\n            return;\r\n        }\r\n\r\n        this.ignoreChangeEvent = true;\r\n        this.core.changeEditMode(editMode);\r\n        this.ignoreChangeEvent = false;\r\n        this.setStylesUi(editMode);\r\n        this.domToolSelect.blur(); // remove focus from UI\r\n    };\r\n\r\n    proto.onStyleChange = function(event) {\r\n        var select = event.target;\r\n\r\n        var styleKey = select.getAttribute('style-key');\r\n        var valueType = select.getAttribute('value-type');\r\n\r\n\r\n        var markup = this.core.getSelection();\r\n        var style = markup ? markup.getStyle() : this.core.getStyle();\r\n\r\n        // if it's a string input, just take the raw value\r\n        if (valueType === 'string') {\r\n            style[styleKey] = select.value;\r\n        } else {\r\n            var option = select.options[select.selectedIndex];\r\n            style[styleKey] = getTypedValue(option.value, valueType);\r\n            select.blur(); // remove focus from UI\r\n        }\r\n\r\n        this.core.setStyle(style);\r\n\r\n        function getTypedValue(val, type) {\r\n            if (type === 'number')\r\n                return Number(val);\r\n            if (type === 'boolean')\r\n                return val === 'true';\r\n            return val;\r\n        }\r\n    };\r\n\r\n    proto.setStylesUi = function(editMode, markup) {\r\n\r\n        var style = markup ? markup.style : editMode.style;\r\n        var defaults = getStyleDefaultValues(style, this.core);\r\n\r\n        this.domStylesRoot.innerHTML = ''; // flush UI\r\n        for (var key in defaults) {\r\n            // Quite inefiient because we are re-creating DOM constantly\r\n            // Consider optimize if it becomes a problem\r\n            var domElem = this.getUiForStyleKey(key, defaults[key], style[key]);\r\n            this.domStylesRoot.appendChild(domElem);\r\n        }\r\n    };\r\n\r\n    proto.getUiForStyleKey = function(key, defaults, current) {\r\n\r\n        var selectionIndex = defaults.default;\r\n        var options = [];\r\n        var values = defaults.values;\r\n        for (var i=0, len=values.length; i<len; ++i) {\r\n            var optLine = [\r\n                '<option value=\"', values[i].value,'\">',\r\n                    values[i].name,\r\n                '</option>'\r\n            ].join('');\r\n            options.push(optLine);\r\n\r\n            if (this.valueEquals(values[i].value, current)) {\r\n                selectionIndex = i;\r\n            }\r\n        }\r\n\r\n        var valueType = typeof values[0].value;\r\n\r\n        // TODO: Build specialized controls for each style-attribute\r\n        const _document = this.getDocument();\r\n        var domElem = _document.createElement('div');\r\n        var html = [];\r\n        let isText = key.includes('text');\r\n      \r\n        if (isText) {\r\n          html = [\r\n            '<span>', key,'</span>',\r\n            '<br>',\r\n            '<textarea class=\"lmv-markup-gui-style-textarea\" style-key=\"', key, '\" value-type=\"', valueType, '\">',\r\n            current || '',\r\n            '</textarea>'].\r\n            join('');\r\n          } else {\r\n            html = [\r\n            '<span>', key, '</span>',\r\n            '<select class=\"lmv-markup-gui-style-select\" style-key=\"', key, '\" value-type=\"', valueType,'\">',\r\n                options.join(''),\r\n            '</select>'\r\n            ].join('');\r\n        }\r\n\r\n        domElem.innerHTML = html;\r\n\r\n        if (!isText) {\r\n            // select index\r\n            var domSelect = domElem.querySelector('select');\r\n            domSelect.selectedIndex = selectionIndex;\r\n        }\r\n\r\n        return domElem;\r\n    };\r\n    proto.valueEquals = function(value1, value2) {\r\n\r\n        return value1 === value2;\r\n    }\r\n\r\n    proto.setControlVisibility = function(selector, isVisible, visibleValue) {\r\n        var elem = this.domRoot.querySelector(selector);\r\n        if (!visibleValue)\r\n            visibleValue = 'block';\r\n        elem.style.display = isVisible ? visibleValue : 'none';\r\n    };\r\n\r\n    proto.hookEvent = function(eventStr, selector, callbackFn) {\r\n        var handler = function(event){\r\n            if (this.matchesSelector(event.target, selector)){\r\n                callbackFn(event);\r\n            }\r\n        }.bind(this);\r\n        this.domRoot.addEventListener(eventStr, handler);\r\n        this.domEvents.push({str: eventStr, handler: handler });\r\n    };\r\n\r\n    proto.unhookAllEvents = function() {\r\n        var domRoot = this.domRoot;\r\n        this.domEvents.forEach(function(event) {\r\n            domRoot.removeEventListener(event.str, event.handler);\r\n        });\r\n        this.domEvents = [];\r\n    };\r\n\r\n    proto.matchesSelector = function(domElem, selector) {\r\n        if (domElem.matches) return domElem.matches(selector); //Un-prefixed\r\n        if (domElem.msMatchesSelector) return domElem.msMatchesSelector(selector);  //IE\r\n        if (domElem.mozMatchesSelector) return domElem.mozMatchesSelector(selector); //Firefox (Gecko)\r\n        if (domElem.webkitMatchesSelector) return domElem.webkitMatchesSelector(selector); // Opera, Safari, Chrome\r\n        return false;\r\n    };\r\n\r\n    proto.getStyleOptions = function(editMode) {\r\n        var style = editMode.getStyle();\r\n        return getStyleDefaultValues(style, this.core);\r\n    };\r\n\r\n    proto.activate = function () {\r\n        if(!this.activeStatus) {\r\n            this.core.enterEditMode();\r\n            this.activeStatus = true;\r\n        }\r\n        return true;\r\n    };\r\n\r\n    proto.deactivate = function () {\r\n        if(this.activeStatus) {\r\n            this.core.hide();\r\n            this.activeStatus = false;\r\n        }\r\n        return true;\r\n    };\r\n\r\n\r\n    Autodesk.Viewing.theExtensionManager.registerExtension('Autodesk.Viewing.MarkupsGui', MarkupsGui);\r\n","'use strict';\r\n\r\nimport { MarkupsCore } from './core/MarkupsCore'\r\nimport { MarkupsGui } from './gui/MarkupsGui'\r\n\r\nimport { Clipboard } from './core/edit-clipboard/Clipboard'\r\nimport { CloneMarkup } from './core/edit-actions/CloneMarkup'\r\nimport { CreateArrow } from './core/edit-actions/CreateArrow'\r\nimport { CreateCallout } from './core/edit-actions/CreateCallout'\r\nimport { CreateCircle } from './core/edit-actions/CreateCircle'\r\nimport { CreateCloud } from './core/edit-actions/CreateCloud'\r\nimport { CreateDimension } from './core/edit-actions/CreateDimension'\r\nimport { CreateFreehand } from './core/edit-actions/CreateFreehand'\r\nimport { CreateHighlight } from './core/edit-actions/CreateHighlight'\r\nimport { CreatePolycloud } from './core/edit-actions/CreatePolycloud'\r\nimport { CreatePolyline } from './core/edit-actions/CreatePolyline'\r\nimport { CreateRectangle } from './core/edit-actions/CreateRectangle'\r\nimport { CreateText } from './core/edit-actions/CreateText'\r\nimport { CreateStamp } from './core/edit-actions/CreateStamp'\r\nimport { DeleteArrow } from './core/edit-actions/DeleteArrow'\r\nimport { DeleteCallout } from './core/edit-actions/DeleteCallout'\r\nimport { DeleteCircle } from './core/edit-actions/DeleteCircle'\r\nimport { DeleteCloud } from './core/edit-actions/DeleteCloud'\r\nimport { DeleteDimension } from './core/edit-actions/DeleteDimension'\r\nimport { DeleteFreehand } from './core/edit-actions/DeleteFreehand'\r\nimport { DeleteHighlight } from './core/edit-actions/DeleteHighlight'\r\nimport { DeletePolycloud } from './core/edit-actions/DeletePolycloud'\r\nimport { DeletePolyline } from './core/edit-actions/DeletePolyline'\r\nimport { DeleteRectangle } from './core/edit-actions/DeleteRectangle'\r\nimport { DeleteText } from './core/edit-actions/DeleteText'\r\nimport { DeleteStamp } from './core/edit-actions/DeleteStamp'\r\n\r\nimport { EditAction } from './core/edit-actions/EditAction' \r\nimport { EditActionGroup } from './core/edit-actions/EditActionGroup' \r\nimport { EditActionManager } from './core/edit-actions/EditActionManager' \r\nimport { EditFrame } from './core/EditFrame' \r\n\r\nimport { EditMode } from './core/edit-modes/EditMode'\r\nimport { EditModeArrow } from './core/edit-modes/EditModeArrow'\r\nimport { EditModeCallout } from './core/edit-modes/EditModeCallout'\r\nimport { EditModeCircle } from './core/edit-modes/EditModeCircle'\r\nimport { EditModeCloud } from './core/edit-modes/EditModeCloud'\r\nimport { EditModeDimension } from './core/edit-modes/EditModeDimension'\r\nimport { EditModeFreehand } from './core/edit-modes/EditModeFreehand'\r\nimport { EditModeHighlight } from './core/edit-modes/EditModeHighlight'\r\nimport { EditModePen } from './core/edit-modes/EditModePen'\r\nimport { EditModePolycloud } from './core/edit-modes/EditModePolycloud'\r\nimport { EditModePolyline } from './core/edit-modes/EditModePolyline'\r\nimport { EditModeRectangle } from './core/edit-modes/EditModeRectangle'\r\nimport { EditModeText } from './core/edit-modes/EditModeText'\r\nimport { EditModeStamp } from './core/edit-modes/EditModeStamp'\r\nimport { EditorTextInput } from './core/edit-modes/EditorTextInput'\r\n\r\n\r\nimport { Markup } from './core/Markup'\r\nimport { MarkupArrow } from './core/MarkupArrow'\r\nimport { MarkupCallout } from './core/MarkupCallout'\r\nimport { MarkupCircle } from './core/MarkupCircle'\r\nimport { MarkupCloud } from './core/MarkupCloud'\r\nimport { MarkupDimension } from './core/MarkupDimension'\r\nimport { MarkupFreehand } from './core/MarkupFreehand'\r\nimport { MarkupHighlight } from './core/MarkupHighlight'\r\nimport { MarkupPen } from './core/MarkupPen'\r\nimport { MarkupPolycloud } from './core/MarkupPolycloud'\r\nimport { MarkupPolyline } from './core/MarkupPolyLine'\r\nimport { MarkupRectangle } from './core/MarkupRectangle'\r\nimport { MarkupText } from './core/MarkupText'\r\nimport { MarkupStamp } from './core/MarkupStamp'\r\nimport { MarkupTool } from './core/MarkupTool'\r\n\r\nimport { SetArrow } from './core/edit-actions/SetArrow'\r\nimport { SetCallout } from './core/edit-actions/SetCallout'\r\nimport { SetCircle } from './core/edit-actions/SetCircle'\r\nimport { SetCloud } from './core/edit-actions/SetCloud'\r\nimport { SetDimension } from './core/edit-actions/SetDimension'\r\nimport { SetFreehand } from './core/edit-actions/SetFreehand'\r\nimport { SetHighlight } from './core/edit-actions/SetHighlight'\r\nimport { SetPolycloud } from './core/edit-actions/SetPolycloud'\r\nimport { SetPolyline } from './core/edit-actions/SetPolyline'\r\nimport { SetPosition } from './core/edit-actions/SetPosition'\r\nimport { SetRectangle } from './core/edit-actions/SetRectangle'\r\nimport { SetRotation } from './core/edit-actions/SetRotation'\r\nimport { SetSize } from './core/edit-actions/SetSize'\r\nimport { SetStyle } from './core/edit-actions/SetStyle'\r\nimport { SetText } from './core/edit-actions/SetText'\r\nimport { SetStamp } from './core/edit-actions/SetStamp'\r\n\r\n\r\nimport * as MarkupEvents from './core/MarkupEvents'\r\nimport * as MarkupTypes from './core/MarkupTypes'\r\n\r\nimport * as Utils from './core/MarkupsCoreUtils'\r\nimport * as StyleUtils from './core/StyleUtils'\r\n\r\nimport { theEditModeManager } from './core/EditModeManager'\r\n\r\n// All the things\r\nexport const Core = {\r\n    Clipboard,\r\n    CloneMarkup,\r\n    CreateArrow,\r\n    CreateCallout,\r\n    CreateCircle,\r\n    CreateCloud,\r\n    CreateDimension,\r\n    CreateFreehand,\r\n    CreateHighlight,\r\n    CreatePolycloud,\r\n    CreatePolyline,\r\n    CreateRectangle,\r\n    CreateText,\r\n    CreateStamp,\r\n    DeleteArrow,\r\n    DeleteCallout,\r\n    DeleteCircle,\r\n    DeleteCloud,\r\n    DeleteDimension,\r\n    DeleteFreehand,\r\n    DeleteHighlight,\r\n    DeletePolycloud,\r\n    DeletePolyline,\r\n    DeleteRectangle,\r\n    DeleteText,\r\n    DeleteStamp,\r\n\r\n    EditAction,\r\n    EditActionGroup,\r\n    EditActionManager,\r\n    EditFrame,\r\n\r\n    EditMode,\r\n    EditModeArrow,\r\n    EditModeCallout,\r\n    EditModeCircle,\r\n    EditModeCloud,\r\n    EditModeDimension,\r\n    EditModeFreehand,\r\n    EditModeHighlight,\r\n    EditModePen,\r\n    EditModePolycloud,\r\n    EditModePolyline,\r\n    EditModeRectangle,\r\n    EditModeText,\r\n    EditModeStamp,\r\n    EditorTextInput,\r\n\r\n    Markup,\r\n    MarkupArrow,\r\n    MarkupCallout,\r\n    MarkupCircle,\r\n    MarkupCloud,\r\n    MarkupDimension,\r\n    MarkupFreehand,\r\n    MarkupHighlight,\r\n    MarkupPen,\r\n    MarkupPolycloud,\r\n    MarkupPolyline,\r\n    MarkupRectangle,\r\n    MarkupText,\r\n    MarkupStamp,\r\n    MarkupTool,\r\n    \r\n    MarkupsCore,\r\n\r\n    SetArrow,\r\n    SetCallout,\r\n    SetCircle,\r\n    SetCloud,\r\n    SetDimension,\r\n    SetFreehand,\r\n    SetHighlight,\r\n    SetPolycloud,\r\n    SetPolyline,\r\n    SetPosition,\r\n    SetRectangle,\r\n    SetRotation,\r\n    SetSize,\r\n    SetStyle,\r\n    SetText,\r\n    SetStamp,\r\n\r\n\r\n    MarkupEvents,\r\n    MarkupTypes,\r\n    theEditModeManager,\r\n    Utils,\r\n};\r\n\r\n// Spread the markup types to minimize breaking changes (sigh)\r\nfor (var markupType in MarkupTypes) {\r\n    Core[markupType] = MarkupTypes[markupType];\r\n}\r\n\r\n// Spread the event ids to minimize breaking changes (sigh)\r\nfor (var eventType in MarkupEvents) {\r\n    Core[eventType] = MarkupEvents[eventType];\r\n}\r\n\r\n// Merge StyleUtils with utils (because those methods used to live in Utils)\r\nfor (var thing in StyleUtils) {\r\n    if (thing in Core.Utils)\r\n        throw new Error(`Property ${thing} from StyleUtils already present in MarkupsCoreUtils.`);\r\n\r\n    Core.Utils[thing] = StyleUtils[thing];\r\n}\r\n\r\n\r\nexport const Gui = {\r\n    MarkupsGui\r\n}\r\n\r\n\r\n// Also map back to legacy namespace\r\nAutodesk.Viewing.Extensions.Markups = {\r\n    Core\r\n};\r\n"],"names":["___CSS_LOADER_EXPORT___","push","module","id","exports","cssWithMappingToString","list","toString","this","map","item","content","needLayer","concat","length","join","i","modules","media","dedupe","supports","layer","undefined","alreadyImportedModules","k","_k","cssMapping","btoa","base64","unescape","encodeURIComponent","JSON","stringify","data","sourceMapping","sourceURLs","sources","source","sourceRoot","stylesInDOM","getIndexByIdentifier","identifier","result","modulesToDom","options","idCountMap","identifiers","base","count","indexByIdentifier","obj","css","sourceMap","references","updater","addElementStyle","byIndex","splice","api","domAPI","update","newObj","remove","lastIdentifiers","newList","index","newLastIdentifiers","_i","_index","memo","insert","style","target","styleTarget","document","querySelector","window","HTMLIFrameElement","contentDocument","head","e","getTarget","Error","appendChild","element","createElement","setAttributes","attributes","styleElement","nonce","setAttribute","insertStyleElement","styleTagTransform","apply","parentNode","removeChild","removeStyleElement","styleSheet","cssText","firstChild","createTextNode","rgbcolor","stackblurCanvas","canvas","hasOwnProperty","canvg_1","fn","createCommonjsModule","windowEnv","DOMParser","doc","createCanvas","width","height","c","matchesSelector","canvg","s","opts","svg","console","log","msg","init","ctx","uniqueId","UniqueId","Definitions","Styles","StylesSpecificity","Animations","Images","ViewPort","viewPorts","Clear","SetCurrent","RemoveCurrent","pop","Current","ComputeSize","d","Math","sqrt","pow","ImagesLoaded","loaded","trim","replace","compressSpaces","ajax","url","AJAX","XMLHttpRequest","ActiveXObject","open","send","responseText","parseXml","xml","Windows","Data","Xml","xmlDoc","Dom","XmlDocument","settings","XmlLoadSettings","prohibitDtd","loadXml","async","loadXML","parser","xmldom","parseFromString","Property","name","value","prototype","getValue","hasValue","numValue","n","parseFloat","match","valueOrDefault","def","numValueOrDefault","addOpacity","opacityProp","newValue","color","ok","r","g","b","getDefinition","isUrlDefinition","indexOf","getFillStyleDefinition","createGradient","createPattern","getHrefAttribute","pt","attribute","getDPI","getREM","rootEmSize","getEM","emSize","getUnits","isPixels","toPixels","viewPort","processPercent","toMilliseconds","toRadians","PI","textBaselineMapping","toTextBaseline","Font","Variants","Weights","CreateFont","fontStyle","fontVariant","fontWeight","fontSize","fontFamily","inherit","f","Parse","font","that","split","set","ff","ToNumberArray","a","Point","x","y","angleTo","p","atan2","applyTransform","v","xp","yp","CreatePoint","CreatePath","path","BoundingBox","x1","y1","x2","y2","Number","NaN","addPoint","isNaN","addX","addY","addBoundingBox","bb","addQuadraticCurve","p0x","p0y","p1x","p1y","p2x","p2y","cp1x","cp1y","cp2x","cp2y","addBezierCurve","p3x","p3y","p0","p1","p2","p3","t","b2ac","t1","t2","isPointInBox","Transform","Type","translate","unapply","applyToPoint","rotate","angle","cx","cy","cos","sin","scale","matrix","m","transform","h","det","SkewBase","skewX","tan","skewY","transforms","type","transformType","AspectRatio","aspectRatio","desiredWidth","desiredHeight","minX","minY","refX","refY","align","meetOrSlice","scaleX","scaleY","scaleMin","min","scaleMax","max","Element","EmptyProperty","ElementBase","node","styles","stylesSpecificity","children","createIfNotExists","skipAncestors","parent","ps","render","save","mask","filter","setContext","renderChildren","clearContext","restore","addChild","childNode","create","child","CreateElement","addStylesFromStyleDefinition","selector","specificity","existingSpecificity","allUppercase","RegExp","normalizeAttributeName","test","toLowerCase","nodeType","nodeName","childNodes","captureTextNodes","text","textContent","tspan","RenderedElementBase","calculateOpacity","opacity","el","opacityStyle","fromMeasure","fs","fillStyle","strokeStyle","newLineWidth","lineWidth","lineCap","lineJoin","miterLimit","paintOrder","gaps","setLineDash","webkitLineDash","mozDash","offset","lineDashOffset","webkitLineDashOffset","mozDashOffset","currentFontSize","clip","globalAlpha","PathElementBase","beginPath","Mouse","checkPath","fill","stroke","markers","getMarkers","marker","getBoundingBox","baseClearContext","baseSetContext","getComputedStyle","getPropertyValue","root","moveTo","lineTo","closePath","viewBox","rect","rx","ry","KAPPA","bezierCurveTo","circle","arc","ellipse","line","getPoints","points","polyline","polygon","basePath","PathParser","tokens","reset","command","previousCommand","start","control","current","angles","isEnd","isCommandOrEnd","isRelativeCommand","getToken","getScalar","nextCommand","getPoint","makeAbsolute","getAsControlPoint","getAsCurrentPoint","getReflectedControlPoint","addMarker","from","priorTo","addMarkerAngle","getMarkerPoints","getMarkerAngles","j","pp","newP","curr","cntrl","cp","quadraticCurveTo","xAxisRotation","largeArcFlag","sweepFlag","currp","l","cpp","centp","u","acos","a1","ad","dir","ah","halfWay","sx","sy","pattern","tempSvg","cctx","getContext","baseRender","point","defs","GradientBase","stops","getGradient","gradientUnits","attributesToInherit","inheritStopContainer","stopsContainer","attributeToInherit","parentOpacityProp","addParentOpacity","addColorStop","rootView","MAX_VIRTUAL_PIXELS","group","tempCtx","linearGradient","createLinearGradient","radialGradient","fx","fy","createRadialGradient","stop","stopColor","AnimateBase","duration","begin","maxDuration","getProperty","attributeType","attributeName","initialValue","initialUnits","removed","calcValue","delta","frozen","animationFrozen","animationFrozenValue","updated","to","values","progress","ret","lb","floor","ub","ceil","animate","animateColor","parseInt","animateTransform","horizAdvX","isRTL","isArabic","fontFace","missingGlyph","glyphs","arabicForm","unicode","fontface","ascent","descent","unitsPerEm","missingglyph","glyph","textBaseline","initializeCoordinates","getAnchorDelta","childBB","getChildBoundingBox","renderChild","startI","textAnchor","measureTextRecursive","adjustChildCoordinates","textParent","measureText","TextElementBase","getGlyph","customFont","strokeText","getText","fillText","reverse","dx","lw","measure","textToMeasure","tref","hasText","baseRenderChildren","checkBoundingBox","onclick","onmousemove","cursor","image","href","isSvg","img","crossOrigin","self","onload","onerror","src","drawSvg","complete","drawImage","symbol","cssDefs","cssDef","cssClasses","cssProps","cssClass","props","prop","substr","getSelectorSpecificity","srcs","urlStart","urlEnd","fonts","getElementsByTagName","use","elementTransform","oldParent","cMask","maskCtx","globalCompositeOperation","fillRect","clipPath","hasContext2D","CanvasRenderingContext2D","oldBeginPath","oldClosePath","call","px","py","efd","extraFilterDistance","feDropShadow","feMorphology","feComposite","feColorMatrix","m1","m2","m3","imGet","rgba","imSet","val","mi","srcData","getImageData","clearRect","putImageData","feGaussianBlur","blurRadius","canvasRGBA","display","body","title","desc","MISSING","className","load","loadXmlDoc","dom","mapXY","offsetLeft","offsetTop","offsetParent","scrollX","scrollY","clientX","event","clientY","documentElement","isFirstRender","draw","clientWidth","clientHeight","cWidth","cHeight","xRatio","yRatio","waitingForImages","intervalID","setInterval","needUpdate","hasEvents","needAnimationUpdate","FRAMERATE","runEvents","clearInterval","events","run","eventElements","isPointInPath","build","getElementById","svgTags","querySelectorAll","svgTag","getBoundingClientRect","insertBefore","div","innerHTML","matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector","jQuery","Zepto","$","is","Sizzle","attributeRegex","idRegex","classRegex","pseudoElementRegex","pseudoClassWithBracketsRegex","pseudoClassRegex","elementRegex","typeCount","findMatch","regex","dy","dw","dh","cOpts","ignoreMouse","ignoreAnimation","ignoreDimensions","ignoreClear","offsetX","offsetY","scaleWidth","scaleHeight","factory","global","RGBColor","color_string","charAt","simple_colors","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dodgerblue","feldspar","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgrey","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslateblue","lightslategray","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","snow","springgreen","steelblue","teal","thistle","tomato","turquoise","violet","violetred","wheat","white","whitesmoke","yellow","yellowgreen","key","color_defs","re","example","process","bits","processor","exec","channels","toRGB","toHex","getHelpXML","examples","Array","sc","list_item","list_color","example_div","list_item_value","Map","some","__entries__","size","configurable","get","delete","has","clear","forEach","Object","defineProperties","Function","requestAnimationFrame","bind","setTimeout","Date","now","o","MutationObserver","connected_","mutationEventsAdded_","mutationsObserver_","observers_","onTransitionEnd_","refresh","addObserver","connect_","removeObserver","disconnect_","updateObservers_","gatherActive","hasActive","broadcastActive","addEventListener","observe","childList","characterData","subtree","removeEventListener","disconnect","propertyName","getInstance","instance_","keys","defineProperty","enumerable","writable","ownerDocument","defaultView","_","arguments","reduce","SVGGraphicsElement","SVGElement","getBBox","broadcastWidth","broadcastHeight","contentRect_","isActive","left","right","top","bottom","boxSizing","round","abs","broadcastRect","DOMRectReadOnly","contentRect","activeObservations_","observations_","TypeError","callback_","controller_","callbackCtx_","unobserve","clearActive","WeakMap","w","ResizeObserver","define","amd","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","getter","__esModule","definition","Symbol","toStringTag","nc","MARKUP_TYPE_ARROW","MARKUP_TYPE_TEXT","MARKUP_TYPE_RECTANGLE","MARKUP_TYPE_CIRCLE","MARKUP_TYPE_CLOUD","MARKUP_TYPE_FREEHAND","MARKUP_TYPE_HIGHLIGHT","MARKUP_TYPE_POLYLINE","MARKUP_TYPE_POLYCLOUD","MARKUP_TYPE_CALLOUT","MARKUP_TYPE_DIMENSION","MARKUP_TYPE_STAMP","EditAction","editor","targetId","addToHistory","selectOnExecution","execute","actionManager","redo","undo","merge","action","isIdentity","createStyle","defaults","getStyleDefaultValues","default","copyStyle","destination","isStyleEqual","cloneStyle","clone","getFontSizes","normalWidth","getOpacities","defaultTransparent","normaStrokeWidth","getStrokeWidth","normaFontWidth","getFontWidth","EVENT_EDITMODE_CHANGED","EVENT_EDITMODE_ENTER","EVENT_EDITMODE_LEAVE","EVENT_MARKUP_SELECTED","EVENT_MARKUP_DRAGGING","EVENT_MARKUP_ENTER_EDITION","EVENT_MARKUP_CANCEL_EDITION","EVENT_MARKUP_DELETE_EDITION","EVENT_HISTORY_CHANGED","EVENT_EDITMODE_CREATION_BEGIN","EVENT_EDITMODE_CREATION_END","EVENT_MARKUP_DESELECT","EVENT_EDITFRAME_EDITION_START","EVENT_EDITFRAME_EDITION_END","av","Autodesk","Viewing","Markup","styleAttributes","viewer","setGlobalManager","globalManager","position","rotation","getDefaultStyle","highlightColor","constraintWidth","constraintHeight","constraintRotation","minWidth","minHeight","highlighted","selected","checkLineSegment","checkPolygon","renderToCanvasX","renderToCanvas","addTraitEventDispatcher","GlobalManagerMixin","proto","SetStyle","markup","newStyle","oldStyle","getStyle","destroy","unselect","setParent","shape","__proto__","overrides","getCloneOverrides","member","cloneNode","GlobalManager","parse","cloneShape","hitarea","bindDomEvents","hammer","listeners","select","updateStyle","dispatchEvent","highlight","interactionsDisabled","setStyle","edit","cancel","deleteMarkup","getEditMode","warn","getClientPosition","positionFromMarkupsToClient","getClientSize","sizeFromMarkupsToClient","getBoundingRect","setRotation","parentRect","impl","getCanvasBoundingClientRect","boundRect","strokeWidth","getRotation","setPosition","setSize","isWidthConstrained","isHeightConstrained","isRotationConstrained","setMinWidth","setMinHeight","getMinWidth","getMinHeight","disableInteractions","disable","setStrokeWidth","constrainsToBounds","bounds","onMouseDown","editFrame","startDrag","generatePoint3d","idTarget","generateBoundingPolygon","checkLineSegmentAux","point2d","point3d","clientToWorld","xVertices","yVertices","midAB","THREE","Vector2","multiplyScalar","midAC","midDB","midDC","center","add","checkPolygonAux","generateBoundingBox","boundingBox","vertexCount","bbX0","POSITIVE_INFINITY","bbY0","bbX1","NEGATIVE_INFINITY","bbY1","bbX","bbY","halfSize","lt","Vector3","rt","rb","Matrix4","makeTranslation","makeRotationZ","multiply","applyMatrix4","Float32Array","setMetadata","setMouseDisabledWhenTouching","isFirst","onMouseDownBinded","isFinal","_this","isTouchDevice","Hammer","Manager","recognizers","GestureRecognizers","singletap","handlePointerEventMouse","inputClass","isIE11","PointerEventInput","TouchInput","onSingleTapBinded","onHammerInputBinded","on","onMouseOutBinded","onMouseOverBinded","callback","getPath","getTransform","radiansToDegrees","constructor","EditMode","selectedMarkup","dragging","draggingAnnotationIniPosition","draggingMouseIniPosition","initialX","initialY","minSize","creating","CREATION_METHOD_DRAG","CREATION_METHOD_CLICK","CREATION_METHOD_CLICKS","creationMethod","getMarkup","DeleteArrow","arrow","createArrow","CreateArrow","tail","removeTraitEventDispatcher","fireEv","selectedId","setMarkup","markupId","creationBegin","creationEnd","isCancelling","isMinSizeValid","creationCancel","finishDragging","closeActionGroup","creationCancelled","cancelActionGroup","setSelection","bringToFront","isTextInputHelperActive","textInputHelper","setEditFrame","getSelection","cantUndo","tmp","startDragging","mousePosition","getMousePosition","getFinalMouseDraggingPosition","getBounds","finalX","finalY","input","makeSameXY","maxDelta","sign","notifyAllowNavigation","allows","onMouseMove","onMouseUp","onMouseDoubleClick","onSave","getDraggingPosition","isInsideBounds","useWithSnapping","model","is2d","SetArrow","newHead","newTail","oldHead","oldTail","applyState","epsilon","MeasureCommon","EditModeArrow","MarkupArrow","addMarkupMetadata","createMarkupPathSvg","deleteArrow","lineSnapped","snapper","geomType","getGeometryType","SnapType","SNAP_VERTEX","SNAP_EDGE","SNAP_MIDPOINT","SNAP_CIRCLE_CENTER","getEdge","arrowMinSize","positionFromClientToMarkups","constrain","beginActionGroup","arrowVector","lengthSq","normalize","arrowId","getId","final","isSnapped","project","vertices","end","z","parallel","nearestPointInPointToLine","pEnd","pStart","perpendicular","distanceTo","sizeFromClientToMarkups","xO","yO","xF","yF","vO","vF","vDir","sub","dot","vFDir","vCenter","strokeColor","composeRGBAString","setAttributeToMarkupSvg","updateMarkupPathSvgHitarea","xo","yo","direction","metadata","String","sizeX","sizeY","sizeYOver3","tailW","headW","spikeOffset","addMarkup","removeMarkup","DeleteRectangle","rectangle","createRectangle","CreateRectangle","SetRectangle","newPosition","newSize","oldPosition","oldSize","EditModeRectangle","MarkupRectangle","deleteRectangle","pos","clientToMarkups","firstCorner","startZ","fillColor","createRectanglePath","DeleteText","createText","CreateText","SetCallout","isFrameUsed","newText","oldText","newIsFrameUsed","oldIsFrameUsed","SetSize","newWidth","oldWidth","newHeight","oldHeight","callout","createEvent","Event","bubbles","evt","getGlobal","initEvent","ta","heightOffset","cachedHeight","changeOverflow","offsetWidth","overflow","resize","originalHeight","overflows","arr","scrollTop","getParentOverflows","_document","getDocument","docTop","endHeight","scrollHeight","_window","getWindow","styleHeight","computed","actualHeight","offsetHeight","err","pageResize","removeWindowEventListener","overflowX","wordWrap","addWindowEventListener","paddingTop","paddingBottom","borderTopWidth","borderBottomWidth","methods","RUNTIME_SUPPORTED","autosize","DomElementStyle","BROWSER_PREFIXES","dirty","styleString","allBrowsers","prefix","removeAttribute","isArray","getStyleString","elements","generateStyle","EditorTextInput","parentDiv","singleLine","defaultText","maxLength","EVENT_TEXT_CHANGE","EVENT_TEXT_SET_ACTIVE","EVENT_TEXT_SET_INACTIVE","textArea","rows","firstEdit","startingHeight","entries","observer","styleTextArea","measureDiv","trimRight","lastNonSpace","trimLeft","firstNonSpace","EditModeCallout","helper","container","onHelperTextChange","onHelperSetActive","onHistoryChangeBinded","onHistoryChange","setInactive","setActive","textMarkup","placeholderText","i18n","constrainToCanvas","initFromMarkup","isIOSDevice","txtArea","focus","dataBag","blur","onResizeBinded","frameWidth","frameHeight","xPos","yPos","updateStyleFirst","padding","getClientFontSize","lineHeightPercentage","lineHeight","setPosAndSize","temp","injectSizeValues","newPos","fontHeight","textAreaStyle","getTextValuesForMarkup","sizeUpdateRequired","active","activeMarkup","activeFirstEdit","textValues","getTextValues","lines","generateLines","acceptAndExit","newLines","ox","oy","onCameraChanged","str","linesBreaks","styleMeasureStr","maxLineLength","linesOutput","len","splitLine","output","remaining","done","innerText","parts","getShorterLine","splitWord","iLastSpace","lastIndexOf","trailingWord","word","lenSoFar","part","okayWord","extraWord","deleteCallout","DeleteCallout","clientFontSize","initialWidth","initialHeight","createCallout","CreateCallout","selectMarkup","databag","setIsHelperTextActive","setIsShapeVisible","textStyle","curSelection","updateTextBoxStyle","FONT_SIZE_SCALE","MarkupCallout","createSvgElement","textShape","createMarkupTextSvg","rectShape","createMarkupGroupSvg","currentText","currentTextLines","prevHighlight","isHelperTextActive","textString","setIsFilledFrameUsed","setText","stylesEqual","getTextLines","highlightChanged","editMode","duringEditMode","rebuildTextSvg","textContainerTransform","getTextContainerTransform","textTransform","getTextTransform","setMarkupTextSvgTransform","updateMarkupTextSvgClipper","updateMarkupTextSvgHitarea","textHelperValues","yOffset","getLineHeight","hasRectShape","setIsFilledFrameVisible","isVisible","isframeused","margin","EDIT_FRAME_DEFAULT_MARGIN","SetText","EditModeText","deleteText","MarkupText","textDirty","textSize","updateMarkupTextSvgBackground","DeleteCircle","createCircle","CreateCircle","SetCircle","EditModeCircle","MarkupCircle","deleteCircle","firstPosition","ellipseW","ellipseH","createEllipsePath","DeleteCloud","cloud","createCloud","CreateCloud","SetCloud","EditModeCloud","newStrokeWidth","newColor","oldStrokeWidth","oldColor","MarkupCloud","deleteCloud","radius","createArcTo","xRadius","yRadius","createCorner","corner","getSideParameters","diameter","xValueInset","yValueOffset","hSidesParameters","vSidesParameters","cornerSizeX","cornerSizeY","cornerRadiusX","cornerRadiusY","halfStrokeWidth","sp","createTSide","createRSide","createBSide","createLSide","MarkupPen","EditModePen","smoothen","bufferSize","locations","isAbsoluteCoords","updatePath","slice","locationsCount","toFixed","locationA","locationB","DeleteFreehand","freehand","createFreehand","CreateFreehand","deletePen","movements","location","appendToBuffer","amendPath","lastX","lastY","removeFromAbsolutePath","addToAbsolutePath","setPen","absolutePath","clearSnapped","buffer","movementsLastIndex","createPen","createAbsolutePath","cameraWidth","camera","cameraHeight","xs","simplify","ys","error","absolutePathIndexes","numToRemove","shift","getAveragePoint","tmpBuffer","totalX","totalY","SetFreehand","EditModeFreehand","MarkupFreehand","DeletePolyline","createPolyline","CreatePolyline","closed","SetPolyline","EditModePolyline","setPositionAndSize","minFn","collection","targets","maxFn","MarkupPolyline","deletePolyline","lastIndex","lastMove","areMarkupsPointsInClientRange","DeletePolycloud","polycloud","createPolycloud","CreatePolycloud","SetPolycloud","EditModePolycloud","MarkupPolycloud","deletePolycloud","updateCorners","side","cornerA","cornerB","orientation","rA","rB","D","pointA","pointB","xS","xT","yS","yT","intersec","cross","vecAB","createSidePath","bodyCount","bodyRadius","bodyDiameter","createCornerPath","first","large","fstPoint","sndPoint","pointC","getOrientation","sides","sidesCount","vecBA","getSides","corners","sideA","sideB","getCorners","cornersCount","bodyA","bodyB","updateSides","DeleteHighlight","createHighlight","CreateHighlight","SetHighlight","EditModeHighlight","MarkupHighlight","DeleteDimension","dimension","createDimension","CreateDimension","secondAnchor","firstAnchor","SetDimension","newFirstAnchor","newSecondAnchor","oldFirstAnchor","oldSecondAnchor","_cursorPosition","EditModeDimension","measurement","Measurement","MeasurementTypes","MEASUREMENT_DISTANCE","measureExt","getExtension","abortDimensionMarkup","cancelEditModeChange","enterEditMode","sharedMeasureConfig","forceCalibrate","getData","isLeaflet","isPdf","calibrationTool","isCalibrated","openCalibrationRequiredDialog","MarkupDimension","measureTextLines","initialText","preventReposition","deleteDimension","updateTextBox","updateViewportId","getDistance","computeResult","picks","distanceXYZ","Private","convertUnits","getUnitString","units","calibrationFactor","formatValueWithUnits","precision","updateMeasurement","measurementNumber","pick","getPick","geomVertex","intersectPoint","copyResults","viewportId","setViewportId","pickFirstAnchor","clearAllPicks","dimensionId","viewportIndex2d","pickSecondAnchor","mouseDown","correctPerpendicularPicks","getSnapResultPosition","indicator","isRightClick","navigation","inverseProject","constrainAxis","isVisibleChar","keyCode","measureTextLine","handleKeyDown","KeyCode","ENTER","BACKSPACE","substring","handleKeyDownBinded","getTextAreaTransform","shouldFlip","degreesToRadians","lineSize","edgeH","textOffset","backgroundTransform","inverse","flip","segmentLength","DeleteStamp","stamp","createStamp","CreateStamp","SetStamp","EditModeStamp","svgData","MarkupStamp","createShapeGroup","scriptSvgData","loadSvgData","deleteStamp","svgString","svgNode","stringToSvgNode","getDimensions","getAttribute","styleChanged","customSvg","vb","strings","avp","_gWindow","_gDocument","MARKUP_DEFAULT_STROKE_WIDTH_IN_PIXELS","MARKUP_DEFAULT_FONT_WIDTH_IN_PIXELS","MARKUP_DEFAULT_HITAREAS_MARGIN_IN_PIXELS","createElementNS","setSvgParentAttributes","hitareaMargin","markupFill","markupStroke","strokeEnabled","fillEnabled","navigating","clipperId","getUniqueID","clipperUrl","clipper","background","clippedArea","addSvgMetadata","metadataNode","dataVersionNode","markupNode","removeAllMetadata","nodes","svgChildren","transferChildNodes","nodeFrom","nodeInto","tmpArray","generateUUID","svgNodeToString","domNode","hitareas","removeHitareas","hitareaParent","childrenCount","XMLSerializer","serializeToString","hitareasCount","addHitareas","stringNode","client","listener","hasEventListener","li","typeListeners","worldToClient","snap","worldToViewport","viewportToClient","depth","clientToViewport","unproject","viewportX","viewportY","metersToModel","meters","getUnitScale","radians","degrees","range","hideLmvUi","toolbar","setActiveNavigationTool","dismissLmvHudMessage","hideLmvPanels","hideLmvToolsAndPanels","restoreLmvUi","showLmvToolsAndPanels","hide","dockingPanels","panel","panelContainer","classList","contains","visibilityChanged","ext","displayViewCube","displayHomeButton","anim","getElementsByClassName","viewerContainer","viewerContainerChildrenCount","animator","keyFrameAnimator","isPaused","pauseCameraAnimations","pause","playButton","modelTools","getControl","setIcon","setToolTip","keepDismissing","HudMessage","dismiss","ignore","widthInPixels","createMarkupFromSVG","meta","isClosed","getLocations","locStr","pointPair","getAttributeVector","posVec","strPos","getPosition","getSize","strRot","createMarkup","logger","getCurrentStyle","markupList","svgLayersMap","activeLayer","markups","hexRGBString","x0","y0","deviceRatio","devicePixelRatio","idTargetWidth","idTargetHeight","idTargetBuffer","check","verxtexCount","isInsidePolygon","bbW","bbH","endX","endY","createStyleSheet","sheet","addRuleToStyleSheet","insertRule","addRule","measureStyle","linesCount","relative","halfW","halfH","tmpSvg","isSafari","markupGroup","Image","tolerance","highestQuality","getSqSegDist","simplifyDPStep","last","sqTolerance","simplified","maxSqDist","sqDist","prevPoint","newPoints","simplifyRadialDist","simplifyDouglasPeucker","EditActionGroup","actions","EditActionManager","historySize","undoStack","redoStack","close","actionsCount","isOpen","isEmpty","addAction","compact","actionA","actionB","getTargetId","CloneMarkup","getEditActionGroup","undoStackCount","isUndoStackEmpty","isRedoStackEmpty","getLastElementInUndoStack","Clipboard","pastePosition","copy","cut","paste","_mouseEnabled","_mousePrevValue","_lock","InputHandler","snapRotations","keepAspectRatio","onWheelBinded","onWheel","onTouchDragBinded","onTouchDrag","onTouchPanBinded","onTouchPan","onTouchPinchBinded","onTouchPinch","onSingleTap","onDoubleTapBinded","onDoubleTap","onMouseMoveBinded","onMouseUpBinded","onMouseDoubleClickBinded","onHammerInput","isMouseDown","processMouseEvent","shiftKey","convertEventHammerToMouse","pointers","SetPosition","attachTo","detachFrom","drag","doubletap","doubletap2","singletap2","press","pan","pinch","recognizeWith","requireFailure","enableMouseButtons","state","addDocumentEventListener","removeDocumentEventListener","isMobileDevice","leaveEditMode","off","enterViewMode","leaveViewMode","toolController","mousewheel","preventDefault","mousemove","onMouseDownRightClick","inFullscreen","activeElement","__clientToCanvasCoords","markupTool","handleButtonDown","onMouseUpRightClick","handleButtonUp","isMiddleClick","getTool","distributeGesture","callSnapperMouseMove","SetRotation","curAngle","newRotation","oldRotation","EditFrame","containingDiv","selectionLayer","createSelectionLayer","frameMargin","selection","resizing","handle","createSelectorBox","onHammerDragBinded","onHammerDrag","onHammerDoubleTapBinded","onHammerDoubleTap","handleSelectionBoxDragging","handleSelectionBoxResizing","handleSelectionDoubleClick","handleSelectionBoxRotating","pageX","pageY","visibility","togglePointerEvents","createDragPoint","setResizeCursor","createRotatePoint","createRotationBridge","rotationBridge","createDragPoints","isDragPoint","matchesSelectorAux","isRotatePoint","selectorBox","rotationHandle","updateSelectionBoxState","updateSelectorBoxPosition","toTranslate3d","transformOrigin","msTransform","webkitTransform","msTransformOrigin","webkitTransformOrigin","updateSelectorBoxDimensions","_onRepositionMouseDown","unload","doubleMargin","enable","enableResizeHandles","enableRotationHandle","_onRepositionMouseMove","_onRepositionMouseUp","isDragging","isResizing","isRotating","rotating","updateEditorInput","callSnapperMouseDown","_onRotationMouseDown","_onResizeMouseDown","_handleRightClickDown","initialRotation","initialHandlePosition","ignoreFirstMouseMove","setHandleSelected","isSelected","doubleClick","defaultPrevented","pointerEvents","getAngleBetweenPoints","domElem","syntheticStart","MouseEvent","initialCursor","initialPosition","areAxisConstrained","axisConstrains","altKey","movement","initial","mouseX","mouseY","_onResizeMouseMove","_onResizeMouseUp","vector","undoRotation","localSpaceDelta","projectOnVector","nw","ne","sw","se","redoRotation","actualDelta","_onRotationMouseMove","_onRotationMouseUp","MarkupTool","ToolInterface","names","panTool","allowNav","coreExt","hotkeysEnabled","_ctrlDown","_shiftDown","allowNavigation","allow","setCoreExtension","setHotkeysEnabled","enabled","activate","viewerApi","deactivate","CONTROL","SHIFT","ESCAPE","onUserCancel","DELETE","F12","handleKeyUp","handleSingleClick","button","handleDoubleClick","handleSingleTap","handleDoubleTap","handleWheelInput","handleMouseMove","handleGesture","handleBlur","_editModes","theEditModeManager","register","clazz","unregister","getClass","getRegistered","PERSPECTIVE_MODE_SCALE","MarkupsCore","Extension","duringViewMode","onEditActionHistoryChanged","nextId","clipboard","CAMERA_CHANGE_EVENT","once","onCameraChangeBinded","onCameraChange","onViewerResizeBinded","onViewerResize","onMarkupSelectedBinded","onMarkupSelected","onMarkupEnterEditionBinded","onMarkupEnterEdition","onMarkupCancelEditionBinded","onMarkupCancelEdition","onMarkupDeleteEditionBinded","onMarkupDeleteEdition","onToolChangeBinded","onToolChange","onUnitsCalibrationStartsBinded","onUnitsCalibrationStarts","Events","UNITS_CALIBRATION_STARTS_EVENT","svgStyle","disableMarkupInteractions","toolClass","markupToolClass","changeMarkupTool","markupDisableHotkeys","loadExtension","Extensions","Snapping","Snapper","markupMode","registerTool","enableHotKeys","deregisterTool","editModeSvgLayerNode","initialStrokeWidth","initialFontWidth","toggleEditMode","layerId","disableLayerMarkups","layerMarkups","show","parSvg","editModeLayerParentNode","editingLayer","svgParent","activateTool","defaultStyle","changeEditMode","clearOverlays","toggle","VIEWER_RESIZE_EVENT","reorderElements","onViewerRolloverObject","rolloverObject","unloadMarkupsAllLayers","editModeLayer","generateData","defaultLayer","tmpNode","metadataNodes","addedNode","generatePoints3d","main","markupsCount","renderer","readbackTargetId","collision","context","renderAllMarkups","getSvgViewBox","numberOfScreenshotsTaken","onMarkupScreenshotTaken","svgKeys","layersKeys","oldEditMode","isNavigationAllowed","isPerspective","cachedNavigationTool","getActiveNavigationTool","TOOL_CHANGE_EVENT","getName","defaultToolName","getDefaultNavigationToolName","toolName","navAllowed","setNavigationLockSettings","zoom","orbit","roll","fov","walk","gotoview","setNavigationLock","changeInputHandler","inputHandler","dontAddToHistory","layerObject","markupIndex","editLayerMarkups","removeMarkupIfExists","sendMarkupTo","sendToBack","bringForward","bringBackward","loadMarkups","markupString","svgLayerNode","createLayerNode","localName","svgParentNode","newSvgLayerNode","revertLayer","currentMarkups","layerSvg","unloadMarkups","numMarkups","unloadSvgLayerNode","hideMarkups","showMarkups","markupsToClient","vectorFromClientToMarkups","vectorFromMarkupsToClient","matrixWorld","globalOffset","matrixWorldInverse","getSnapPosition","getSnapResult","getCamera","containerBounds","getScreenViewport","eventHandled","ignoreNextMouseUp","theExtensionManager","registerExtension","domEvents","onEditModeEnter","onEditModeLeave","onEditModeChange","then","core","unhookAllEvents","destroyToolUi","destroyToolbarUI","onToolbarCreated","markupToolButton","UI","Button","onClick","TOOLBAR","MODELTOOLSID","addControl","getToolbar","removeFromParent","showToolsUi","hideToolsUi","domToolSelect","ignoreChangeEvent","optionList","selectedIndex","setStylesUi","createToolsUi","canNavigate","setControlVisibility","exitNavigationMode","domContent","domRoot","createEditModeOption","locLabel","editModeType","html","domStylesRoot","hookEvent","onToggleCollapse","onEditModeDone","enterNavigationMode","onUndoClick","onRedoClick","onDeleteClick","onCutClick","onCopyClick","onPasteClick","onDuplicateClick","onSelectEditMode","onStyleChange","EditModeClass","styleKey","valueType","option","getUiForStyleKey","selectionIndex","optLine","valueEquals","isText","includes","value1","value2","visibleValue","eventStr","callbackFn","handler","getStyleOptions","activeStatus","Core","MarkupEvents","MarkupTypes","Utils","markupType","eventType","thing","Gui","MarkupsGui","Markups"],"sourceRoot":""}